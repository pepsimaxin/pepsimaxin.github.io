{"posts":[{"title":"èŠèŠ mutableStateListOf","text":"Source Code based on: androidx.compose.**:**:1.5.0 è®²ä»»ä½•ä¸€ä¸ªæ–°çš„ä¸»é¢˜æˆ–è€…çŸ¥è¯†ç‚¹ï¼Œä¹ æƒ¯æ€§çš„ä» Demo å¼€å§‹ï¼Œæ¯”å¦‚ï¼š 1234567891011class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) var name by mutableStateOf(&quot;Hi, Compose&quot;) setContent { Text(name) } }} è¿™æ®µä»£ç å·²ç»ç†Ÿçš„ä¸èƒ½å†ç†Ÿäº†å§ï¼Ÿå¦‚æœæˆ‘ä»¬ç”¨ by mutableStateOf åˆå§‹åŒ–ä¸€ä¸ªå˜é‡ï¼Œé‚£ name å°±ä¼šå˜æˆä¸€ä¸ªè¢« Composeã€Œè‡ªåŠ¨è®¢é˜…ã€çš„å˜é‡ã€‚ æˆ‘ä»¬ä¹‹å‰æ–‡ç« çš„ä¾‹å­ï¼Œéƒ½æ˜¯ç”¨ by mutableStateOf åŒ…äº†ä¸€ä¸ª Stringï¼Œå¦‚æœæ¢æˆåˆ«çš„ç±»å‹ï¼Œè¡Œä¸è¡Œï¼Ÿ 1234fun &lt;T&gt; mutableStateOf( value: T, // æ³›å‹å‚æ•° policy: SnapshotMutationPolicy&lt;T&gt; = structuralEqualityPolicy()): MutableState&lt;T&gt; = createSnapshotMutableState(value, policy) ä¾‹å¦‚ï¼šInt ç±»å‹ 12345678910111213141516class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) var num by mutableStateOf(1) setContent { Text( text = &quot;å½“å‰æ•°å€¼ï¼š$num&quot;, Modifier.clickable { num++ } ) } }} ä»£ç ä¸åšè§£é‡Šäº†ï¼Œç›´æ¥çœ‹æ•ˆæœï¼š ä¾‹å¦‚ï¼šList ç±»å‹ 123// num ç±»å‹ï¼šMutableList&lt;Int&gt;// mutableStateOf ç±»å‹ï¼šMutableState&lt;MutableList&lt;Int&gt;&gt;var nums by mutableStateOf(mutableListOf(1, 2, 3)) æˆ‘ä»¬åœ¨ä»£ç é‡Œé¢ç”¨èµ·æ¥ï¼š 123456789101112131415class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) var nums by mutableStateOf(mutableListOf(1, 2, 3)) setContent { Column { for (num in nums) { Text(&quot;ç¬¬ $num å—æ–‡å­—&quot;) } } } }} è¿è¡Œï¼š ç°åœ¨æˆ‘ä»¬ç¨å¾®æ”¹ä¸‹ä»£ç ï¼š 1234567891011121314151617181920class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) var nums by mutableStateOf(mutableListOf(1, 2, 3)) setContent { Column { Button(onClick = { nums.add(nums.last() + 1) }) { Text(&quot;List åŠ  1&quot;) } for (num in nums) { Text(&quot;ç¬¬ $num å—æ–‡å­—&quot;) } } } }} ä»£ç å¾ˆç®€å•ï¼šæˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ª Buttonï¼Œæ¯æ¬¡ç‚¹å‡»åï¼Œnums ä¼šæ·»åŠ ä¸€ä¸ªå€¼ï¼Œæ¯”æœ€æœ‰ä¸€ä¸ªå€¼å¤§ 1ã€‚ è¿è¡Œï¼š Button ç–¯ç‹‚ç‚¹å‡»ï¼Œä½†æ˜¯æ²¡ç”Ÿæ•ˆï¼ä¸ºä»€ä¹ˆï¼Ÿ æˆ‘ä»¬å…ˆæ¥æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼ŒmutableStateOf åŸç†æ˜¯ä»€ä¹ˆï¼Ÿæˆ‘ä»¬å›å¿†ä¸€ä¸‹ï¼š mutableStateOf ä¹‹æ‰€ä»¥å¯ä»¥å¯¹å˜é‡è¿›è¡Œè®¢é˜…å’Œåˆ·æ–°ï¼Œä¸»è¦æ˜¯å› ä¸ºå†…éƒ¨çš„ get() å’Œ set() æ–¹æ³•åŠ äº†é’©å­ï¼Œæˆ–è€…è¯´å®ƒçš„ set() æ–¹æ³•æ˜¯èµ‹å€¼ï¼æ˜¯æ”¹å˜äº†å˜é‡çš„æŒ‡å‘ï¼Œå®ƒæ˜¯ç›´æ¥æŠŠå¯¹è±¡ç»™æ›¿æ¢äº†ï¼Œä½†åœ¨æˆ‘ä»¬è¿™ä¸ªä»£ç é‡Œé¢ nums ä»…ä»…æ˜¯æ”¹å˜äº†å®ƒå†…éƒ¨çš„çŠ¶æ€ï¼ æ‰€ä»¥ï¼Œå®ƒä¸ä¼šå‡ºå‘ setValue() çš„è°ƒç”¨ï¼Œä»è€Œä¸ä¼šè§¦å‘è‡ªåŠ¨åˆ·æ–°çš„æ“ä½œã€‚ ä¸ºäº†éªŒè¯æ˜¯ä¸æ˜¯å› ä¸ºæ²¡æœ‰é‡ç»„ï¼Œæˆ‘ä»¬å¯ä»¥æ”¹ä¸‹ä»£ç ï¼š 12345678910111213141516171819202122class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) var nums by mutableStateOf(mutableListOf(1, 2, 3)) var refresh by mutableStateOf(&quot;å¼ºåˆ¶åˆ·æ–°&quot;) setContent { Column { Text(refresh, Modifier.clickable { refresh = &quot;åˆ·æ–°å®Œæˆ&quot;}) Button(onClick = { nums.add(nums.last() + 1) }) { Text(&quot;List åŠ  1&quot;) } for (num in nums) { Text(&quot;ç¬¬ $num å—æ–‡å­—&quot;) } } } }} æˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ª Text() ç»„ä»¶ï¼Œæ”¹å˜ refresh çš„å€¼ï¼Œé‚£ä¹ˆç†è®ºä¸Šå®ƒå°±ä¼šå¸¦ç€ã€Œæ•´ä¸ªé‡ç»„ä½œç”¨åŸŸå†…ã€çš„ç»„ä»¶å…¨éƒ¨ã€Œåˆ·æ–°ã€ï¼ŒåŒ…æ‹¬ Listã€‚ è¿è¡Œï¼š æˆåŠŸåˆ·æ–°äº† List ï¼ ç°åœ¨æˆ‘ä»¬å°±å¾ˆæ¸…æ¥šäº†ï¼ŒmutableStateOf æ²¡æ³•å¯¹ List ç±»å‹çš„å¯¹è±¡å®ç°ç±»ä¼¼ Stringã€Int çš„è‡ªåŠ¨è®¢é˜…åŠåˆ·æ–°ï¼Œé‚£æœ‰æ²¡æœ‰è§£å†³åŠæ³•ï¼Ÿ ä¸Šé¢æˆ‘ä»¬è¯´è¿‡äº†ï¼Œé—®é¢˜çš„æ ¹æœ¬åŸå› æ˜¯ List åªæ˜¯å†…éƒ¨çš„å˜åŒ–ï¼Œè€Œä¸æ˜¯å®ƒè‡ªå·±æœ¬èº«å¯¹è±¡çš„å˜åŒ–ï¼Œé‚£æˆ‘ä»¬åœ¨å†…éƒ¨æ“ä½œå®Œåç›´æ¥æŠŠ List é‡æ–°ç»™æ¢äº†ä¸å°±è¡Œäº†ï¼Ÿè¯•è¯•ï¼š 1234567891011121314151617181920212223class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) var nums by mutableStateOf(mutableListOf(1, 2, 3)) setContent { Column { Button(onClick = { // nums é‡æ–°èµ‹å€¼ nums = nums.toMutableList().apply { add(nums.last() + 1) } }) { Text(&quot;List åŠ  1&quot;) } for (num in nums) { Text(&quot;ç¬¬ $num å—æ–‡å­—&quot;) } } } }} è¿è¡Œï¼š æˆåŠŸåˆ·æ–°äº† List ï¼ ä½†è¿™æ ·å†™å°±ä¼šæ˜¾å¾—å¾ˆå¥‡æ€ªï¼šæ—¢ç„¶å¯¹äº Stringã€Int è¿™äº›ç±»å‹ï¼ŒCompose æä¾›äº† mutableStateOfï¼Œéš¾é“å¯¹äº List è¿™ç§è¿™ä¹ˆå¸¸ç”¨çš„ç±»å‹ï¼Œå°±æ²¡æœ‰ä¸€ä¸ª mutable*** çš„å‡½æ•°ç»™æˆ‘ä»¬ç”¨ï¼Ÿ é‚£å¿…é¡»æœ‰ï¼å®ƒå°±æ˜¯ mutableStateListOfï¼å®ƒå¯ä»¥è§‚æµ‹åˆ°å†…éƒ¨ List çš„æ•°æ®å˜åŒ–ï¼ æˆ‘ä»¬å¯ä»¥åƒä¸‹é¢è¿™æ ·ç”³æ˜ï¼š 12345678910var nums by mutableStateListOf(mutableListOf(1, 2, 3)) // æœ‰çº¢çº¿æ ‡æ³¨ï¼Œå†™æ³•é”™è¯¯// mutableStateListOf æ˜¯å†…éƒ¨å…ƒç´ è¢«è§‚æµ‹ï¼Œè€Œä¸æ˜¯å®ƒæœ¬èº«è¢«è§‚æµ‹ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æŠŠ `by` æ¢æˆ `=`var nums = mutableStateListOf(mutableListOf(1, 2, 3))// `var` ä¹Ÿå¯ä»¥æ¢æˆ `val`val nums = mutableStateListOf(mutableListOf(1, 2, 3))// mutableStateListOf æœ¬èº«å°±ä»£è¡¨ä¸€ä¸ªå¯è§‚æµ‹çš„ Listï¼Œæ‰€ä»¥ mutableListOf ä¹Ÿå¯ä»¥å»é™¤val nums = mutableStateListOf(1, 2, 3) // è¿™å°±æ˜¯æœ€ç»ˆçš„å†™æ³• è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥ä¼˜åŒ–ä¸‹ä»£ç äº†ï¼š 1234567891011121314151617181920class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) val nums = mutableStateListOf(1, 2, 3) setContent { Column { Button(onClick = { nums.add(nums.last() + 1) }) { Text(&quot;List åŠ  1&quot;) } for (num in nums) { Text(&quot;ç¬¬ $num å—æ–‡å­—&quot;) } } } }} è¿è¡Œï¼š æåˆ° Listï¼Œæˆ‘ä»¬å°±ä¼šæƒ³åˆ° Mapï¼ŒåŒæ · Map ä¹Ÿæä¾›äº†ä¸€ä¸ª mutableStateMapOfï¼å®ƒä¹Ÿå¯ä»¥è§‚æµ‹åˆ°å†…éƒ¨ Map çš„æ•°æ®å˜åŒ–ï¼ 12345678910111213141516171819class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) val maps = mutableStateMapOf(1 to &quot;One&quot;, 2 to &quot;Two&quot;) setContent { Column { Button(onClick = { maps[3] = &quot;Three&quot; }) { Text(&quot;Maps åŠ  1&quot;) } for ((key, value) in maps) { Text(&quot;$key å¯¹åº” value: $value&quot;) } } } }} è¿è¡Œï¼š","link":"/2025/07/18/compose/Compose%20--%20%E7%8A%B6%E6%80%81%E8%AE%A2%E9%98%85%20&%20%E8%87%AA%E5%8A%A8%E5%88%B7%E6%96%B0%20--%2004.%20mutableStateListOf/"},{"title":"æ·±åº¦è§£æ mutableStateOf æºç ","text":"å…¶å®åŸç†æ€§åˆ†æçš„æ–‡ç« ï¼ŒçœŸçš„å¾ˆéš¾è®²çš„é€šä¿—æ˜“æ‡‚ï¼Œè®²çš„ç®€å•æµ…æ˜¾æ²¡å¿…è¦å†™ï¼Œè®²çš„ç¹çéš¾æ‡‚å¾€å¾€å¤§å®¶ä¹Ÿä¸ä¹æ„çœ‹ï¼Œæ‰€ä»¥æ€ä¹ˆæ‰¾ä¸ªå¥½çš„è§’åº¦æ…¢æ…¢é’»è¿›å»å°¤ä¸ºé‡è¦ï¼Œæ¯”å¦‚ï¼šBegin simple codeï¼ Simple Code æ­£å¦‚æˆ‘ä¸Šé¢è¯´çš„ï¼Œç›´æ¥è®²åŸç†å¤ªæ¯ç‡¥ï¼ˆä½ ä¹Ÿä¼šå¾ˆæ‡µï¼‰ï¼Œæˆ‘å–œæ¬¢ä»ç®€å•ä»£ç å…¥æ‰‹ï¼Œå¸¦ä½ ä¸€ç‚¹ç‚¹è¿›å…¥ï¼Œç°åœ¨å¼€å§‹ã€‚ å…ˆçœ‹ä¸€ä¸ªæœ€ç®€å•çš„ä»£ç ç¤ºä¾‹ï¼š 1234567891011121314class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) // è¿™ç§å®šä¹‰å˜é‡çš„æ–¹å¼éšå¤„å¯è§äº† val name = mutableStateOf(&quot;Compose&quot;) setContent { ComposeBlogTheme { Text(name.value) } } }} æˆ‘å…ˆæ¥ç®€å•è§£è¯»ä¸€ä¸‹è¿™æ®µä»£ç èƒŒåçš„åŸç†ï¼š å½“æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå˜é‡ nameï¼Œç”¨ ã€ŒmutableStateOfã€ åŒ…èµ·æ¥åï¼šâ¤µï¸å®ƒå°±å˜æˆäº†ä¸€ä¸ª MutableState ç±»å‹çš„å¯¹è±¡ï¼ˆåé¢ä¼šåˆ†ææºç ï¼‰ã€‚ åŒæ—¶ï¼Œæˆ‘ä»¬å–å€¼çš„è¯å¿…é¡»è¦å†™ ã€Œname.valueã€ï¼Œè¿™æ ·èƒ½æ‰èƒ½å–åˆ°å˜é‡å€¼ï¼šâ€Composeâ€ã€‚â¤µï¸å› ä¸º name ä¸å†æ˜¯ä¸€ä¸ª Stringï¼Œè€Œæ˜¯ MutableState å¯¹è±¡ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠå®ƒå«åšã€ŒState: çŠ¶æ€ã€ã€‚ æ­¤æ—¶ï¼Œname æ˜¯ä¸€ä¸ªã€Œè¢«è®¢é˜…çš„çŠ¶æ€ã€ï¼Œã€Œname.valueã€å°±æ˜¯ä¸€ä¸ªè¢«è®¢é˜…çš„å€¼ï¼šâ¤µï¸å¦‚æœå®ƒå‘ç”Ÿå˜åŒ–ï¼ŒText() å‡½æ•°å°±ä¼šé‡æ–°æ‰§è¡Œä¸€éï¼Œæ›´æ–°åˆ°æœ€æ–°çš„å€¼ã€‚ ç°åœ¨æˆ‘ä»¬ä¿®æ”¹ä¸‹ä»£ç ï¼Œ3s åæ”¹å˜ name.value çš„å€¼ï¼š 123456789101112131415161718class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) val name = mutableStateOf(&quot;Compose&quot;) setContent { ComposeBlogTheme { Text(name.value) } LaunchedEffect(true) { delay(3000) // 3s å»¶è¿Ÿ name.value = &quot;Kotlin&quot; // ä¿®æ”¹ name.value } } }} è¿è¡Œï¼Œæ•ˆæœå¦‚ä¸‹ï¼š ç°åœ¨å…³äº mutableStateOf çš„ç”¨æ³•ä½ å·²ç»æŒæ¡äº†ï¼Œä½†ä½ ä¼šä¸ä¼šäº§ç”Ÿä¸€ä¸ªç–‘é—®ï¼Ÿ name è¢«ã€Œè‡ªåŠ¨è®¢é˜…ã€äº†ï¼Œå®ƒçš„å€¼æ”¹å˜äº†å°±ä¼šè®©ç•Œé¢ã€Œé‡æ–°åˆ·æ–°ã€ï¼Œè¿™èƒŒåçš„ã€ŒçŠ¶æ€è®¢é˜… &amp; åˆ·æ–°æœºåˆ¶ã€çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ å¦‚æœä½ æƒ³æ·±å…¥äº†è§£ï¼Œé‚£ä¹ˆæ¥ç€å¾€ä¸‹çœ‹ã€‚ çŠ¶æ€è®¢é˜… &amp; è‡ªåŠ¨åˆ·æ–° åŸºäº androidx.compose.runtime:runtime:1.7.1 ç‰ˆæœ¬ ç¡¬æ ¸éƒ¨åˆ†èµ°èµ·ï¼ŒæŸ¥çœ‹ mutableStateOf() æºç ï¼š 1234fun &lt;T&gt; mutableStateOf( value: T, policy: SnapshotMutationPolicy&lt;T&gt; = structuralEqualityPolicy()): MutableState&lt;T&gt; = createSnapshotMutableState(value, policy) mutableStateOf() è¿”å›çš„æ˜¯ä¸€ä¸ª MutableState å¯¹è±¡ï¼Œè¿™ä¸ªæˆ‘ä»¬å‰é¢è¯´è¿‡ã€‚ mutableStateOf() åˆè°ƒç”¨äº†å¦ä¸€ä¸ªå‡½æ•°ï¼šcreateSnapshotMutableState()ã€‚ è¿›å…¥ createSnapshotMutableState() ï¼š 1234internal actual fun &lt;T&gt; createSnapshotMutableState( value: T, policy: SnapshotMutationPolicy&lt;T&gt;): SnapshotMutableState&lt;T&gt; = ParcelableSnapshotMutableState(value, policy) åˆè°ƒç”¨äº† ParcelableSnapshotMutableState() å‡½æ•°ï¼š 1234567internal class ParcelableSnapshotMutableState&lt;T&gt;( value: T, policy: SnapshotMutationPolicy&lt;T&gt;) : SnapshotMutableStateImpl&lt;T&gt;(value, policy), Parcelable { // è¿™é‡Œå†…éƒ¨çš„ä»£ç å…¨éƒ¨éƒ½æ˜¯å¯¹ Parcelable æ¥å£çš„å®ç°ï¼Œæˆ‘ä»¬ä¸ç”¨å…³å¿ƒï¼Œä¸æ˜¯æ ¸å¿ƒå†…å®¹ ... ...} å…³é”®åœ¨ SnapshotMutableStateImplï¼Œå®ƒé‡Œé¢æ‰æ˜¯æœ€æ ¸å¿ƒçš„é€»è¾‘ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788internal open class SnapshotMutableStateImpl&lt;T&gt;( value: T, override val policy: SnapshotMutationPolicy&lt;T&gt;) : StateObjectImpl, SnapshotMutableState&lt;T&gt; { @Suppress(&quot;UNCHECKED_CAST&quot;) override var value: T get() = next.readable(this).value set(value) = next.withCurrent { if (!policy.equivalent(it.value, value)) { next.overwritable(this, it) { this.value = value } } } private var next: StateStateRecord&lt;T&gt; = StateStateRecord(value).also { if (Snapshot.isInSnapshot) { it.next = StateStateRecord(value).also { next -&gt; next.snapshotId = Snapshot.PreexistingSnapshotId } } } override val firstStateRecord: StateRecord get() = next override fun prependStateRecord(value: StateRecord) { @Suppress(&quot;UNCHECKED_CAST&quot;) next = value as StateStateRecord&lt;T&gt; } @Suppress(&quot;UNCHECKED_CAST&quot;) override fun mergeRecords( previous: StateRecord, current: StateRecord, applied: StateRecord ): StateRecord? { val previousRecord = previous as StateStateRecord&lt;T&gt; val currentRecord = current as StateStateRecord&lt;T&gt; val appliedRecord = applied as StateStateRecord&lt;T&gt; return if (policy.equivalent(currentRecord.value, appliedRecord.value)) current else { val merged = policy.merge( previousRecord.value, currentRecord.value, appliedRecord.value ) if (merged != null) { appliedRecord.create().also { (it as StateStateRecord&lt;T&gt;).value = merged } } else { null } } } override fun toString(): String = next.withCurrent { &quot;MutableState(value=${it.value})@${hashCode()}&quot; } private class StateStateRecord&lt;T&gt;(myValue: T) : StateRecord() { override fun assign(value: StateRecord) { @Suppress(&quot;UNCHECKED_CAST&quot;) this.value = (value as StateStateRecord&lt;T&gt;).value } override fun create(): StateRecord = StateStateRecord(value) var value: T = myValue } /** * The componentN() operators allow state objects to be used with the property destructuring * syntax */ override operator fun component1(): T = value override operator fun component2(): (T) -&gt; Unit = { value = it } /** * A function used by the debugger to display the value of the current value of the mutable * state object without triggering read observers. */ @Suppress(&quot;unused&quot;) val debuggerDisplayValue: T @JvmName(&quot;getDebuggerDisplayValue&quot;) get() = next.withCurrent { it }.value} å¥½é•¿å•Šï½ç®—äº†ï¼Œä¸çœ‹äº†ğŸ™ˆâ€¦ å¦‚æœä½ ä»æ‰“ç®—ç»§ç»­å¾€ä¸‹çœ‹ï¼Œé‚£æ¥ä¸‹æ¥æˆ‘ä¼šå¸¦ä½ ä¸€æ­¥æ­¥æ¢ç´¢å…¶ä¸­çš„å¥¥ç§˜ï¼ å…ˆçœ‹å¼€å¤´éƒ¨åˆ†ï¼š 12345678910111213141516171819202122232425internal open class SnapshotMutableStateImpl&lt;T&gt;( value: T, override val policy: SnapshotMutationPolicy&lt;T&gt;) : StateObjectImpl, SnapshotMutableState&lt;T&gt; { @Suppress(&quot;UNCHECKED_CAST&quot;) override var value: T get() = next.readable(this).value set(value) = next.withCurrent { if (!policy.equivalent(it.value, value)) { next.overwritable(this, it) { this.value = value } } } private var next: StateStateRecord&lt;T&gt; = StateStateRecord(value).also { if (Snapshot.isInSnapshot) { it.next = StateStateRecord(value).also { next -&gt; next.snapshotId = Snapshot.PreexistingSnapshotId } } } override val firstStateRecord: StateRecord get() = next ... ...} ä¸€ä¸ª value å±æ€§å°å…¥çœ¼å¸˜ï¼Œè¿™å°±æ˜¯æ–‡ç« å¼€å¤´ä»£ç é‡Œé¢ç”¨åˆ°çš„ name.valueã€‚ value æœ‰ get() å’Œ set() å‡½æ•°ï¼Œå¹¶ä¸”éƒ½æœ‰å…·ä½“çš„å®ç°ã€‚ ğŸ““ next æ˜¯ä¸ªå•¥ï¼Ÿ æ— è®ºæ˜¯ get() è¿˜æ˜¯ set() éƒ½æœ‰ä¸€ä¸ª nextã€‚ 12get() = next.readable(this).valueset(value) = next.withCurrent {...} å®ƒæ˜¯ä¸ªå•¥ï¼Ÿæˆ‘ä»¬å¾—å…ˆææ˜ç™½è¿™ä¸ªï¼ 1234567private var next: StateStateRecord&lt;T&gt; = StateStateRecord(value).also { if (Snapshot.isInSnapshot) { it.next = StateStateRecord(value).also { next -&gt; next.snapshotId = Snapshot.PreexistingSnapshotId } }} å®ƒçš„ç±»å‹æ˜¯ StateStateRecordï¼Œé‚£ StateStateRecord åˆæ˜¯ä¸ªå•¥ï¼Ÿ 12345678910private class StateStateRecord&lt;T&gt;(myValue: T) : StateRecord() { override fun assign(value: StateRecord) { @Suppress(&quot;UNCHECKED_CAST&quot;) this.value = (value as StateStateRecord&lt;T&gt;).value } override fun create(): StateRecord = StateStateRecord(value) var value: T = myValue} StateStateRecord åˆç»§æ‰¿äº† StateRecordï¼Œé‚£ StateRecord åˆæ˜¯ä¸ªå•¥å‘¢ï¼Ÿ 123456abstract class StateRecord { internal var snapshotId: Int = currentSnapshot().id // è®°å½•å¿«ç…§ id internal var next: StateRecord? = null // ä¸‹ä¸€ä¸ªçŠ¶æ€è®°å½•çš„å¼•ç”¨ï¼ŒçŠ¶æ€è®°å½•å­˜å‚¨åœ¨ä¸€ä¸ªé“¾è¡¨ä¸­ abstract fun assign(value: StateRecord) // å¤åˆ¶ StateRecord abstract fun create(): StateRecord // åˆ›å»ºä¸€ä¸ªæ–°çš„è®°å½•ç›¸åŒçš„ StateRecord} çœ‹ä¸æ‡‚ï¼Ÿæ²¡å…³ç³»ï¼Œåˆ°è¿™é‡Œä½ åªéœ€è¦è®°ä½ä¸€ç‚¹ï¼šStateRecord æ˜¯ä¸€ä¸ªé“¾è¡¨çš„æ•°æ®ç»“æ„å³å¯ï¼Œè€Œ StateStateRecord å®ç°äº†å®ƒï¼Œå¹¶ä¸”å°† value è¿›è¡Œäº†å°è£…ã€‚ ä¸‹é¢æˆ‘ä»¬è¦è®²åˆ«çš„äº†ï¼Œå…ˆè®°ä½ï¼šStateRecord æ˜¯ä¸€ä¸ªé“¾è¡¨çš„æ•°æ®ç»“æ„ï¼ æ¥ç€è¯´ï¼Œå¦‚æœä½ ä»”ç»†çœ‹ä»£ç çš„è¯ï¼Œä¼šå‘ç° SnapshotMutableStateImpl å…¶å®ç»§æ‰¿äº†ä¸¤ä¸ªæ¥å£ï¼š 123456internal open class SnapshotMutableStateImpl&lt;T&gt;( value: T, override val policy: SnapshotMutationPolicy&lt;T&gt;) : StateObjectImpl, SnapshotMutableState&lt;T&gt; { ... ...} ä¸€ä¸ª StateObjectImplã€ä¸€ä¸ª SnapshotMutableStateã€‚ æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹ SnapshotMutableStateï¼š 123456interface SnapshotMutableState&lt;T&gt; : MutableState&lt;T&gt; { /** * A policy to control how changes are handled in a mutable snapshot. */ val policy: SnapshotMutationPolicy&lt;T&gt;} SnapshotMutableState ç»§æ‰¿äº† MutableStateï¼Œæ­£å¥½å¯¹åº”ç€æˆ‘ä»¬æ–‡ç« å¼€å¤´è¯´çš„ï¼ŒmutableStateOf() è¿”å›çš„å°±æ˜¯ä¸€ä¸ª MutableStateï¼Œæˆ‘ä»¬ä¹‹å‰è¯´æ˜¯å› ä¸ºå®ƒå®ç°äº†ã€Œè®¢é˜…ã€ä»è€Œå¯ä»¥ã€Œåˆ·æ–°ã€ã€‚ ä½†ï¼ï¼ï¼çœŸæ­£çš„åŸå› å¹¶ä¸æ˜¯å› ä¸ºå®ƒï¼ çœŸæ­£å®ç°çŠ¶æ€è®¢é˜…æœºåˆ¶çš„æ˜¯å¦å¤–ä¸€ä¸ªæ¥å£ï¼šStateObjet æˆ‘ä»¬ç°åœ¨æ¥çœ‹ä¸‹ StateObjectImpl å¹²äº†ä»€ä¹ˆäº‹ï¼š 123internal abstract class StateObjectImpl internal constructor() : StateObject { ...} å®ç°äº† StateObject æ¥å£ï¼š 1234567891011121314interface StateObject { /** * The first state record in a linked list of state records. */ val firstStateRecord: StateRecord fun prependStateRecord(value: StateRecord) fun mergeRecords( previous: StateRecord, current: StateRecord, applied: StateRecord ): StateRecord? = null} ä»£ç éå¸¸ç®€å•ï¼Œä½†é‡Œé¢æœ‰ä¸€ä¸ª æ ¸å¿ƒï¼š 1val firstStateRecord: StateRecord å®ƒæ˜¯å¹²å˜›ç”¨çš„ï¼Ÿæˆ‘ä»¬å»ç…ç…å“ªé‡Œç”¨äº†å®ƒï¼š 12345678910private var next: StateStateRecord&lt;T&gt; = StateStateRecord(value).also { if (Snapshot.isInSnapshot) { it.next = StateStateRecord(value).also { next -&gt; next.snapshotId = Snapshot.PreexistingSnapshotId } }} override val firstStateRecord: StateRecord get() = next å“¦ï¼ŒåŸæ¥ firstStateRecord æ˜¯ç”¨æ¥è®°å½• StateRecord è¿™ä¸ªé“¾è¡¨çš„ å¤´èŠ‚ç‚¹ ç”¨çš„ã€‚ ğŸ““ get() ä¸Šé¢åº”è¯¥ç®—æ˜¯æŠŠ next æ˜¯ä»€ä¹ˆè®²æ¸…æ¥šäº†å§ï¼Ÿ å®ƒå°±æ˜¯ StateRecordï¼Œæ›´å‡†ç¡®çš„è¯´å°±æ˜¯ StateRecord é“¾è¡¨çš„å¤´èŠ‚ç‚¹ ä¸‹é¢æˆ‘ä»¬å¼€å§‹æ‰’æ‰’ get() çš„é€»è¾‘ï¼š 1get() = next.readable(this).value è¿›å…¥ readable() ï¼š 1234567891011fun &lt;T : StateRecord&gt; T.readable(state: StateObject): T { val snapshot = Snapshot.current // ç¬¬ä¸€ä»¶äº‹ snapshot.readObserver?.invoke(state) // ç¬¬äºŒä»¶äº‹ return readable(this, snapshot.id, snapshot.invalid) ?: sync { val syncSnapshot = Snapshot.current @Suppress(&quot;UNCHECKED_CAST&quot;) readable(state.firstStateRecord as T, syncSnapshot.id, syncSnapshot.invalid) ?: readError() }} å¹²äº†ä¸¤ä»¶äº‹ï¼Œç¬¬ä¸€ä»¶äº‹ï¼š 1snapshot.readObserver?.invoke(state) // ç¬¬ä¸€ä»¶äº‹ readObserver æ˜¯ä¸€ä¸ªè¯»æ“ä½œçš„è§‚å¯Ÿè€…ï¼Œè¿™ä¸ªæ“ä½œæ˜¯è®°å½• StateObject ä¸­çš„å€¼è¢«å“ªé‡Œè°ƒç”¨äº†ï¼Œæ¯”å¦‚å¼€å¤´çš„ä»£ç ç¤ºä¾‹ï¼š 1234567891011121314151617181920class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) val name = mutableStateOf(&quot;Compose&quot;) setContent { ComposeBlogTheme { // è¿™é‡Œè°ƒç”¨äº† name.valueï¼Œå°±ä¼šæ‰§è¡Œåˆ°ï¼š // get() --&gt; readObserver() --&gt; è®°å½•è¿™é‡Œè°ƒç”¨äº† value å€¼ Text(name.value) } LaunchedEffect(true) { delay(3000) name.value = &quot;Kotlin&quot; } } }} æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªæ“ä½œç†è§£ä¸ºå®ƒæ˜¯ä¸€ä¸ªè®¢é˜…æ“ä½œï¼šè®¢é˜…çŠ¶æ€ï¼Œè®°å½• name.value åœ¨å“ªé‡Œè°ƒç”¨äº†ã€‚ ç¬¬äºŒä»¶äº‹ï¼š 12345return readable(this, snapshot.id, snapshot.invalid) ?: sync { val syncSnapshot = Snapshot.current @Suppress(&quot;UNCHECKED_CAST&quot;) readable(state.firstStateRecord as T, syncSnapshot.id, syncSnapshot.invalid) ?: readError()} åˆè°ƒç”¨äº†ä¸‰å‚æ•°çš„ readable()ï¼š 1234567891011121314151617private fun &lt;T : StateRecord&gt; readable(r: T, id: Int, invalid: SnapshotIdSet): T? { // The readable record is the valid record with the highest snapshotId var current: StateRecord? = r var candidate: StateRecord? = null while (current != null) { if (valid(current, id, invalid)) { candidate = if (candidate == null) current else if (candidate.snapshotId &lt; current.snapshotId) current else candidate } current = current.next } if (candidate != null) { @Suppress(&quot;UNCHECKED_CAST&quot;) return candidate as T } return null} å‰è¾¹æˆ‘ä»¬è¯´è¿‡ï¼šStateRecord æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œè€Œä¸‰å‚æ•°é‡Œé¢çš„å·¥ä½œå°±æ˜¯é€šè¿‡è¡¨å¤´å¯¹è±¡éå†åˆ—è¡¨æ¥è·å– æœ€æ–°çš„ã€æœ‰æ•ˆçš„ StateRecordã€‚ æœ€ç»ˆè¿”å›ä¸€ä¸ª æœ€æ–°çš„ã€æœ‰æ•ˆçš„ StateRecordã€‚ï¼ˆä»€ä¹ˆæ˜¯æœ€æ–°çš„ã€æœ‰æ•ˆçš„ï¼Œè¿™ä¸ªå¯ä»¥ä¸ç”¨å…³å¿ƒï¼Œè¿™è·Ÿè¦ç»“åˆ Snapshot å¿«ç…§ç³»ç»Ÿè¯´ï¼Œä½ ç›´æ¥è¿‡æ»¤å³å¯ï¼Œä¸å½±å“æˆ‘ä»¬åŸç†çš„ç†è§£ï¼‰ æ‰€ä»¥ï¼Œæ•´ä¸ª readable() æ–¹æ³•å°±å¹²äº†ä¸¤ä»¶äº‹ï¼š è¿”å›æœ€æ–°çš„ã€æœ‰æ•ˆçš„ StateRecord è®°å½•åœ¨å“ªé‡Œè°ƒç”¨äº† value 1get() = next.readable(this).value æœ€åè¿˜å‰©ä¸€ä¸ª valueï¼Œè¿™å°±å¾ˆç®€å•äº†ï¼Œå‰é¢æˆ‘ä»¬è¯´è¿‡ StateStateRecord (StateRecord çš„å®ç°ç±») ä¼šå¯¹ value è¿›è¡Œå°è£…ï¼Œè€Œ StateRecord åªæ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œæˆ‘ä»¬è¦æƒ³è·å–åˆ°å€¼ï¼Œå°±è¦å†è°ƒç”¨ value è·å–å†…éƒ¨è¢«åŒ…ç€çš„å€¼ã€‚ åˆ°è¿™é‡Œ get() å°±è®²å®Œäº†ï¼ ğŸ““ set() ç°åœ¨æ¥çœ‹ set() çš„å…·ä½“ä»£ç ï¼šï¼ˆç»†èŠ‚ç‚¹æ³¨æ„ï¼šè¿™è¾¹æˆ‘æŠŠä»£ç æˆªå›¾äº†ï¼Œè€Œä¸æ˜¯çº¯ä»£ç æ®µï¼Œä½ ç•™æ„ä¸€ä¸‹ï¼Œä¸‹é¢ä¼šå›å½’åˆ°è¿™é‡Œï¼‰ next æ˜¯å•¥ä¸ç”¨è¯´äº†å§ï¼Œé‚£ withCurrent æ˜¯ä»€ä¹ˆï¼Ÿ 12inline fun &lt;T : StateRecord, R&gt; T.withCurrent(block: (r: T) -&gt; R): R = block(current(this)) å®ƒåªæœ‰ä¸€ä¸ªå‚æ•° blockï¼Œè€Œ block æ˜¯ä¸€ä¸ªå‡½æ•°ç±»å‹çš„å‚æ•°ï¼Œå®ƒçš„å·¥ä½œå¾ˆç›´æ¥ï¼Œç›´æ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°ç±»å‹çš„å‚æ•°ï¼Œä¹Ÿå°±æ˜¯ withCurrent åé¢è·Ÿç€çš„ Lambda è¡¨è¾¾å¼ã€‚ block é‡Œé¢ä¼ å…¥äº†ä¸€ä¸ª current å‡½æ•°ï¼Œå®ƒåšäº†ä»€ä¹ˆï¼š 12345678internal fun &lt;T : StateRecord&gt; current(r: T) = Snapshot.current.let { snapshot -&gt; readable(r, snapshot.id, snapshot.invalid) ?: sync { Snapshot.current.let { syncSnapshot -&gt; readable(r, syncSnapshot.id, syncSnapshot.invalid) } } ?: readError() } å‘ç°äº†ä»€ä¹ˆï¼Ÿå®ƒè°ƒç”¨äº†ä¸€ä¸ªä¸‰å‚æ•°çš„ readable()ï¼Œä½ è¿˜è®°å¾—ä¸‰å‚æ•°çš„ readable() æ˜¯åšä»€ä¹ˆçš„å—ï¼Ÿ â‡’ è·å– æœ€æ–°çš„ã€æœ‰æ•ˆçš„ StateRecordã€‚ è¿™ä¸ªæ—¶å€™ä½ å†çœ‹ä¸‹æˆ‘å¼€å¤´ä¸ºå•¥å¯¹ä»£ç åšäº†æˆªå›¾ï¼š æ‡‚å•¥æ„æ€æ²¡ï¼ŸwithCurrent ä¼ å…¥çš„ current å‡½æ•°çš„è¿”å›å€¼å°±å¯¹åº”ç€ä»£ç æç¤ºå™¨æç¤ºçš„ it å¯¹è±¡ï¼ˆä¸€ä¸ª StateStateRecordï¼‰ã€‚ æ¥ç€çœ‹ä»£ç ï¼š 123456set(value) = next.withCurrent { // åˆ¤æ–­æ–°æ—§å€¼ if (!policy.equivalent(it.value, value)) { next.overwritable(this, it) { this.value = value } }} if åˆ¤æ–­é‡Œé¢ä¼šåˆ¤æ–­å–åˆ°çš„ StateRecord çš„å€¼å’Œæ–°è®¾ç½®çš„å€¼æ˜¯å¦ç›¸åŒï¼Œæ²¡å˜ç›´æ¥ç»“æŸï¼Œå˜äº†å°±è¿›å…¥ä¸‹ä¸€æ­¥ overwritable()ã€‚ æˆ‘ä»¬çœ‹çœ‹å®ƒåšäº†ä»€ä¹ˆï¼š 123456789101112131415internal inline fun &lt;T : StateRecord, R&gt; T.overwritable( state: StateObject, candidate: T, block: T.() -&gt; R): R { var snapshot: Snapshot = snapshotInitializer return sync { // ç¬¬ä¸€ä»¶äº‹ snapshot = Snapshot.current // ç¬¬äºŒä»¶äº‹ this.overwritableRecord(state, snapshot, candidate).block() }.also { notifyWrite(snapshot, state) }} ä¹Ÿå¹²äº†ä¸¤ä»¶äº‹ï¼š è·å–å¿«ç…§ï¼›2. è°ƒç”¨äº†overwritableRecord() å‡½æ•°ï¼› Snapshot å¿«ç…§çš„çŸ¥è¯†æˆ‘ä»¬å¯ä»¥å…ˆå¿½ç•¥ï¼Œæ¥çœ‹ overwritableRecord() åšäº†ä»€ä¹ˆï¼š 12345678910111213141516171819202122internal fun &lt;T : StateRecord&gt; T.overwritableRecord( state: StateObject, snapshot: Snapshot, candidate: T): T { if (snapshot.readOnly) { // If the snapshot is read-only, use the snapshot recordModified to report it. snapshot.recordModified(state) } val id = snapshot.id // æ ¸å¿ƒæ¨¡å— 1 if (candidate.snapshotId == id) return candidate // æ ¸å¿ƒæ¨¡å— 2 val newData = sync { newOverwritableRecordLocked(state) } newData.snapshotId = id if (candidate.snapshotId != Snapshot.PreexistingSnapshotId) snapshot.recordModified(state) return newData} æˆ‘ä»¬å°†ä»£ç åˆ†ä¸ºä¸¤ç«¯æ¥çœ‹ï¼š æ ¸å¿ƒä»£ç å— 1ï¼š å¦‚æœä¼ è¿›æ¥çš„ StateRecord çš„å¿«ç…§ id æ­£å¥½å¯¹åº”å½“å‰ snapshot çš„ idï¼Œé‚£ä¹ˆç›´æ¥è¿”å›ã€‚ æ ¸å¿ƒä»£ç å— 2ï¼š å¦åˆ™ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æˆ–è€…è¿”å›ä¸€ä¸ªå¼ƒç”¨çš„ StateRecordï¼Œç„¶åå°†å¿«ç…§ id èµ‹äºˆæ–°çš„ StateRecordã€‚ è¯´ç™½äº†æœ€ç»ˆå°±æ˜¯è¦å–åˆ°ä¸€ä¸ªå¯¹åº”å½“å‰ snapshot çš„ StateRecordï¼ 1234567891011121314internal inline fun &lt;T : StateRecord, R&gt; T.overwritable( state: StateObject, candidate: T, block: T.() -&gt; R): R { var snapshot: Snapshot = snapshotInitializer return sync { snapshot = Snapshot.current // å–åˆ°ä¸€ä¸ªå¯¹åº”å½“å‰ snapshot çš„ StateRecord this.overwritableRecord(state, snapshot, candidate).block() }.also { notifyWrite(snapshot, state) }} å–åˆ°å¯¹åº”å½“å‰ snapshot çš„ StateRecord åï¼Œç´§æ¥ç€è°ƒç”¨äº† block()ï¼Œå®ƒæ˜¯ä¼ è¿›æ¥çš„å‚æ•°ï¼Œæ˜¯å¤–é¢ä¼ è¿›æ¥çš„ï¼Œä¹Ÿå°±æ˜¯ {this.value = value}ã€‚ 123456set(value) = next.withCurrent { // åˆ¤æ–­æ–°æ—§å€¼ if (!policy.equivalent(it.value, value)) { next.overwritable(this, it) { this.value = value } }} åˆæ‹å›æ¥äº†ï¼ŒæŠŠä¼ å…¥çš„æ–°å€¼èµ‹å€¼ç»™æ‹¿åˆ°çš„ StateRecord å†…éƒ¨çš„ valueï¼Œè¿™ä¸å°±æ˜¯å†™æ–°å€¼çš„æ“ä½œä¹ˆï¼Ÿ åˆ°è¿™é‡Œæ˜¯ä¸æ˜¯ set() æµç¨‹æ˜¯ä¸æ˜¯æˆ‘ä»¬å°±è®²å®Œäº†ï¼Ÿ Noï½ï¼Œæˆ‘ä»¬å†çœ‹ä¸€ä¸‹ overwritable() æ–¹æ³•å†…éƒ¨ï¼š 1234567891011121314internal inline fun &lt;T : StateRecord, R&gt; T.overwritable( state: StateObject, candidate: T, block: T.() -&gt; R): R { var snapshot: Snapshot = snapshotInitializer return sync { snapshot = Snapshot.current // è¿™é‡Œè®²å®Œäº† this.overwritableRecord(state, snapshot, candidate).block() }.also { notifyWrite(snapshot, state) // ä½†è¿™é‡Œè¿˜æœ‰ä¸ª notifyWrite }} è¿˜æœ‰ä¸€è¡Œæˆ‘ä»¬é—æ¼äº†ï¼ŒnotifyWrite() åˆåšäº†ä»€ä¹ˆï¼Ÿ 1234internal fun notifyWrite(snapshot: Snapshot, state: StateObject) { snapshot.writeCount += 1 snapshot.writeObserver?.invoke(state)} æœ‰ç§ä¼¼æ›¾ç›¸è¯†çš„æ„Ÿè§‰ï¼Œåœ¨å‰é¢åˆ†æ get() å‡½æ•°çš„æ—¶å€™ï¼Œæˆ‘ä»¬çœ‹åˆ°è¿‡å•å‚æ•°çš„ readable() é‡Œé¢æœ‰ä¸€è¡Œï¼š 1snapshot.readObserver?.invoke(state) é‚£è¿™é‡Œçš„ä½œç”¨å‘¢ï¼Ÿ â‡’ å¯»æ‰¾å˜é‡åœ¨å“ªé‡Œè¢«è¯»äº†ï¼Œç„¶åå°†è¿™éƒ¨åˆ†å†…å®¹çš„ç»„åˆæ ‡è®°ä¸ºå¤±æ•ˆï¼Œç­‰åˆ°ä¸‹ä¸€å¸§çš„æ—¶å€™ä¼šé‡ç»„åˆ·æ–°ã€‚ æ‰€ä»¥ï¼Œæ•´ä¸ª set() æ–¹æ³•å°±å¹²äº†ä¸¤ä»¶äº‹ï¼š å°†ä¼ å…¥çš„å€¼èµ‹å€¼ç»™ StateRecord å†…éƒ¨çš„ value å†™å…¥é€šçŸ¥åˆ·æ–° åˆ°è¿™é‡Œæˆ‘ä»¬å°±åŸºæœ¬ä¸Šèƒ½å¤Ÿå¾ˆæ¸…æ™°çš„æ˜ç™½äº†çŠ¶æ€è®¢é˜…&amp;è‡ªåŠ¨åˆ·æ–°æœºåˆ¶çš„åŸç†äº†ï¼š å½“ get() è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œä¸ä»…è¿”å›å€¼ï¼Œè¿˜ä¼šè®°å½•è¯»å€¼çš„åœ°æ–¹ï¼Œä¹Ÿå°±æ˜¯å“ªé‡Œè°ƒç”¨äº†ï¼ˆç›¸å½“äºè®¢é˜…ï¼‰ã€‚ å½“ set() è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œä¸ä»…ä¿®æ”¹å€¼ï¼Œè¿˜ä¼šæŸ¥æ‰¾è¯»å€¼çš„åœ°æ–¹ï¼Œç„¶åè¿›è¡Œåˆ·æ–°æ“ä½œï¼ˆç›¸å½“äºé€šçŸ¥ï¼‰ã€‚ ä»£ç†/å§”æ‰˜ï¼šby åœ¨å®é™…å¼€å‘ä¸­ï¼Œå¦‚æœæ¯æ¬¡è·å–å€¼éƒ½è¦åŠ ä¸Š value ä¼šæ˜¾å¾—å¾ˆå†—ä½™ï¼Œæ‰€ä»¥ Compose ç»™æˆ‘ä»¬æä¾›äº†ä¸€ç§æ›´æ–¹ä¾¿çš„å†™æ³•ï¼šbyã€‚å®ƒæ˜¯ Kotlin çš„ä¸€ä¸ªå…³é”®å­—ï¼Œè¡¨ç¤ºå·¦è¾¹çš„å˜é‡ç”¨å³è¾¹çš„å¯¹è±¡ä½œä¸ºä»£ç†ï¼ˆå§”æ‰˜ï¼‰ã€‚ 12345678910111213class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) val name by mutableStateOf(&quot;Compose&quot;) setContent { ComposeBlogTheme { Text(name) // å¯ä»¥ç›´æ¥ nameï¼Œè€Œä¸éœ€è¦ name.value } } }} å¦‚æœä½ è¿™ä¹ˆå†™ï¼ŒIDLE ä¼šæç¤ºæŠ¥é”™ï¼Œå› ä¸º name å§”æ‰˜ç»™äº† mutableStateOfï¼Œå¦‚æœæˆ‘ä»¬è¦è·å– name çš„å€¼ï¼Œé‚£å§”æ‰˜å¯¹è±¡éœ€è¦è°ƒç”¨ getValue() å’Œ setValue() ä¸¤ä¸ªå‡½æ•°ï¼Œè¿™ä¸¤ä¸ªå‡½æ•°éœ€è¦è‡ªå·±å®ç°ã€‚ ä½†å®é™…ä¸Šå¹¶ä¸éœ€è¦æˆ‘ä»¬å®ç°ï¼Œä½ é€šè¿‡æç¤ºä¹Ÿå¯ä»¥çœ‹å‡ºæ¥ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å¯¼å…¥ï¼Œå› ä¸º Compose å†…éƒ¨å·²ç»å¸®æˆ‘ä»¬å®ç°å¥½äº†è¿™ä¸ªæ–¹æ³•ã€‚ 12import androidx.compose.runtime.getValueimport androidx.compose.runtime.setValue è‡ªæ­¤ï¼Œå…³äº Compose çš„çŠ¶æ€è®¢é˜…&amp;è‡ªåŠ¨åˆ·æ–°æœºåˆ¶çš„åŸç†ç®—æ˜¯è®²æ˜ç™½äº†å§ï¼","link":"/2025/07/01/compose/Compose%20--%20%E7%8A%B6%E6%80%81%E8%AE%A2%E9%98%85%20&%20%E8%87%AA%E5%8A%A8%E6%9B%B4%E6%96%B0%20--%2001.%20%E8%A7%A3%E6%9E%90%20mutableStateOf%20%E6%BA%90%E7%A0%81/"},{"title":"æœ‰çŠ¶æ€ã€æ— çŠ¶æ€ã€çŠ¶æ€æå‡","text":"Source Code based on: androidx.compose.**:**:1.5.0 å…ˆæ¥çœ‹ä¸¤æ®µ Compose çš„å®˜æ–¹æè¿°ï¼š åˆ©ç”¨ Composeï¼Œæ‚¨å¯ä»¥æ„å»ºä¸ä¸ç‰¹å®š activity æˆ– fragment ç›¸å…³è”çš„å°å‹ã€Œæ— çŠ¶æ€ã€ç»„ä»¶ï¼Œè¿™è®©æ‚¨å¯ä»¥è½»æ¾é‡ç”¨å’Œæµ‹è¯•è¿™äº›ç»„ä»¶ã€‚ ä½¿ç”¨ remember å­˜å‚¨å¯¹è±¡çš„å¯ç»„åˆé¡¹åŒ…å«ã€Œå†…éƒ¨çŠ¶æ€ã€ï¼Œè¿™ä¼šä½¿è¯¥å¯ç»„åˆé¡¹ã€Œæœ‰çŠ¶æ€ã€ã€‚åœ¨è°ƒç”¨æ–¹ä¸éœ€è¦æ§åˆ¶çŠ¶æ€ï¼Œå¹¶ä¸”ä¸å¿…è‡ªè¡Œç®¡ç†çŠ¶æ€ä¾¿å¯ä½¿ç”¨çŠ¶æ€çš„æƒ…å†µä¸‹ï¼Œã€Œæœ‰çŠ¶æ€ã€ä¼šéå¸¸æœ‰ç”¨ã€‚ä½†æ˜¯ï¼Œå…·æœ‰ã€Œå†…éƒ¨çŠ¶æ€ã€çš„å¯ç»„åˆé¡¹å¾€å¾€ä¸æ˜“é‡å¤ä½¿ç”¨ï¼Œä¹Ÿæ›´éš¾æµ‹è¯•ã€‚ æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŠ›å‡ºä¸‰ä¸ªé—®é¢˜ï¼š ä»€ä¹ˆæ˜¯ã€Œæ— çŠ¶æ€ã€ï¼Ÿ ä»€ä¹ˆæ˜¯ã€Œæœ‰çŠ¶æ€ã€ï¼Ÿ ä»€ä¹ˆæ˜¯ã€Œå†…éƒ¨çŠ¶æ€ã€ï¼Ÿ å¸¦ç€è¿™ä¸‰ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¼€å§‹æ¢è®¨ Compose ä¸­çš„çŠ¶æ€ã€‚ æ— çŠ¶æ€çŠ¶æ€æ˜¯ä»€ä¹ˆï¼Ÿ åœ¨ä¼ ç»Ÿ Android ä¸­ï¼Œæ¯”å¦‚ TextViewï¼Œå®ƒçš„çŠ¶æ€å°±æ˜¯ã€Œå†…éƒ¨çš„å±æ€§ã€ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ getText() è·å– TextView çš„æ–‡å­—ï¼ŒsetText() è®¾ç½® TextView çš„æ–‡å­—ã€‚ æˆ‘ä»¬çœ‹ä¸‹é¢çš„ä»£ç ï¼š 12345678910class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { val name = &quot;Hi, Compose&quot; Text(name) } }} ç°åœ¨æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼šText() ç»„ä»¶åœ¨è¿™é‡Œèƒ½åƒ TextView() ä¸€æ ·æ—¢èƒ½ getText()ã€ä¹Ÿèƒ½ setText() å—ï¼Ÿ å¾ˆæ˜æ˜¾ä¸èƒ½ï¼Text(name) åªæ˜¯ç”¨äº† nameï¼Œå¹¶æ²¡æœ‰ä¿å­˜ï¼Œæ‰€ä»¥å®ƒæ˜¯ä¸€ä¸ªã€Œæ— çŠ¶æ€ç»„ä»¶ã€ã€‚ æœ‰çŠ¶æ€ç°åœ¨æˆ‘ä»¬è‡ªå®šä¹‰ä¸€ä¸ª Compose å‡½æ•°ï¼š 12345@Composablefun HiCompose() { val name = &quot;Hi, Compose&quot; Text(name)} è¯·é—®ï¼šText() æœ‰çŠ¶æ€å—ï¼Ÿ- - æ²¡æœ‰ï¼ˆæˆ‘ä»¬åˆšåˆšæ‰è¯´è¿‡ï¼‰ é‚£ä¹ˆï¼šHiCompose() å‘¢ï¼Ÿ- - æœ‰ï¼å®ƒçš„å†…éƒ¨æœ‰ä¸€ä¸ªå±äºå®ƒè‡ªå·±çš„å˜é‡ï¼šHi, Composeï¼Œå‡†ç¡®çš„æ¥è¯´ï¼Œå®ƒæ˜¯æœ‰ã€Œå†…éƒ¨çŠ¶æ€ã€çš„ã€‚ æ‰€ä»¥ï¼ŒCompose ç»„ä»¶æ˜¯å¯ä»¥ã€Œæœ‰çŠ¶æ€ã€ï¼Œä¹Ÿå¯ä»¥ã€Œæ— çŠ¶æ€ã€ï¼Œè€Œæ‰€è°“çš„æœ‰æ²¡æœ‰çŠ¶æ€ - - å…¶å®éƒ½æ˜¯æŒ‡ï¼šã€Œå†…éƒ¨çŠ¶æ€ã€ï¼ çŠ¶æ€æå‡æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼Œæ—¢ç„¶ HiCompose() å‡½æ•°æ˜¯æœ‰ã€Œå†…éƒ¨çŠ¶æ€ã€çš„ï¼Œé‚£æˆ‘å¦‚æœæƒ³ä»ã€Œå¤–éƒ¨ã€è·å–å®ƒçš„ã€Œå†…éƒ¨çŠ¶æ€ã€ï¼Œè¯¥å¦‚ä½•åšï¼Ÿ æ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼š 123456789101112131415class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { HiCompose().name ??? // è¿™é‡Œå¦‚ä½•è·å–åˆ° HiCompose å†…éƒ¨çš„ name? } }}@Composablefun HiCompose() { val name = &quot;Hi, Compose&quot; Text(name)} è¿™å°±ç›¸å½“äºä½ è¦ä»å¤–éƒ¨è·å–ä¸€ä¸ªå‡½æ•°å†…éƒ¨çš„å˜é‡ï¼Œæ˜¯è·å–ä¸åˆ°çš„ï¼Œé‚£å¦‚ä½•åšå‘¢ï¼Ÿ 123456789101112131415class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { val name = &quot;Hi, Compose&quot; HiCompose(name) } }}@Composablefun HiCompose(name: String) { Text(name)} æˆ‘ä»¬æŠŠ HiCompose() ã€Œå†…éƒ¨çŠ¶æ€ã€ç»™æåˆ°äº†ã€Œå‚æ•°ã€é‡Œé¢ï¼Œç„¶åå¤–éƒ¨å°±å¯ä»¥ä¼ å…¥ã€ŒçŠ¶æ€ã€ï¼Œä¸¤è€…å°±è”ç³»èµ·æ¥äº†ã€‚ åœ¨ Compose ä¸­è¿™ç§åšæ³•å°±å«åšï¼šã€ŒçŠ¶æ€æç¤ºã€ï¼ˆState Hoistingï¼‰ é‚£ä¹ˆï¼Œæ­¤æ—¶ HiCompose è¿˜æœ‰çŠ¶æ€å—ï¼Ÿ- - ç°åœ¨å®ƒå°±æ˜¯ã€Œæ— çŠ¶æ€ã€çš„ï¼å› ä¸ºå®ƒå·²ç»æ²¡æœ‰ã€Œå†…éƒ¨çŠ¶æ€ã€äº†ï¼ŒçŠ¶æ€ä¸Šæåˆ°å¤–é¢å»äº†ã€‚ è¾“å…¥æ¡†ï¼šTextFieldCompose æœ‰ä¸€ä¸ªå…¸å‹çš„çŠ¶æ€æå‡çš„ç»„ä»¶ç¤ºä¾‹ï¼šTextFieldï¼Œå®ƒæ˜¯ä¸€ä¸ªæ–‡æœ¬è¾“å…¥æ¡†ï¼Œç±»ä¼¼äº EditTextã€‚ 123456789class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { TextField(value = , onValueChange = ) } }} å…¶ä¸­ value å°±æ˜¯ä» TextField å†…éƒ¨æå‡ä¸Šæ¥çš„ï¼Œæˆ‘ä»¬æ¥ç»™å®ƒä¼ ä¸ªå€¼ï¼š 12345678910class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { var name = &quot;&quot; TextField(name, onValueChange = ) } }} onValueChange æ˜¯ä¸€ä¸ªå‡½æ•°ç±»å‹çš„å‚æ•°ï¼Œå¯ä»¥å†™æˆ Lambda è¡¨è¾¾å¼ï¼š 12345678910111213class MainActivity : ComponentActivity() { @OptIn(ExperimentalMaterial3Api::class) override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { var name = &quot;&quot; TextField(name, { }) } }} æ­¤æ—¶ä»€ä¹ˆä¹Ÿæ²¡å¡«ï¼Œè¿è¡Œçœ‹ä¸‹æ•ˆæœï¼š é”®ç›˜éƒ½æ•²å†’çƒŸäº†ï¼Œä½†æ˜¯è¾“å…¥æ¡†å´æ²¡æœ‰ä»»ä½•å†…å®¹ï¼Œé—®é¢˜è‚¯å®šå‡ºåœ¨ onValueChangeï¼Œå› ä¸ºæˆ‘ä»¬ä»€ä¹ˆä¹Ÿæ²¡å¡«ï¼Œé‚£å¡«ä»€ä¹ˆï¼Ÿ 12345678910111213class MainActivity : ComponentActivity() { @OptIn(ExperimentalMaterial3Api::class) override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { var name = &quot;&quot; TextField(name, { newValue -&gt; name = newValue }) } }} è¿™å°±è¿™ä¹ˆç®€å•ï¼ŒnewValue å°±æ˜¯è¾“å…¥çš„å†…å®¹ï¼ŒæŠŠ newValue èµ‹å€¼ç»™ nameï¼Œname æ‰æ˜¯è¾“å…¥æ¡†æ˜¾ç¤ºçš„å†…å®¹å®é™…å€¼ã€‚ è¿è¡Œçœ‹ä¸‹æ•ˆæœï¼š æ€ä¹ˆè¿˜ä¸è¡Œï¼Ÿå¦‚æœä½ çœ‹äº†ä¹‹å‰çš„æ–‡ç« ï¼Œåº”è¯¥èƒ½æ‰¾åˆ°é—®é¢˜ç‚¹åœ¨å“ªï¼ ä¿®æ”¹ä¸‹ä»£ç ï¼š 12345678910111213class MainActivity : ComponentActivity() { @OptIn(ExperimentalMaterial3Api::class) override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { var name by remember { mutableStateOf(&quot;&quot;) } TextField(name, { newValue -&gt; name = newValue }) } }} å†æ¬¡è¿è¡Œï¼š","link":"/2025/07/13/compose/Compose%20--%20%E7%8A%B6%E6%80%81%E8%AE%A2%E9%98%85%20&%20%E8%87%AA%E5%8A%A8%E6%9B%B4%E6%96%B0%20--%2003.%20%E6%9C%89%E7%8A%B6%E6%80%81%E3%80%81%E6%97%A0%E7%8A%B6%E6%80%81%E3%80%81%E7%8A%B6%E6%80%81%E6%8F%90%E5%8D%87/"},{"title":"ç»†è¯´ remember å’Œé‡ç»„ä½œç”¨åŸŸ","text":"åŸºäº androidx.compose.runtime:runtime:1.7.1 ç‰ˆæœ¬ é˜…è¯»æœ¬ç¯‡æ–‡ç« ä¹‹å‰ï¼Œå»ºè®®å…ˆçœ‹çœ‹ã€ è§£æ mutableStateOf æºç  ã€‘ ä¸€æ–‡ï¼Œå› ä¸ºä¸¤ç¯‡æ–‡ç« æ˜¯ä¸Šä¸‹ç¯‡çš„å…³ç³»ï¼Œçœ‹å®Œä¸Šç¯‡ï¼Œå¯ä»¥æ›´å¥½çš„ä¸²è”çŸ¥è¯†ç‚¹ã€‚ Simple Code è¯ä¸å¤šè¯´ï¼Œè¿˜æ˜¯è€æ ·å­ï¼Œä» Demo ä¸€æ­¥æ­¥å¼•å‡ºæˆ‘ä»¬çš„æ ¸å¿ƒçŸ¥è¯†ç‚¹ã€‚ 1234567891011121314151617class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) var name by mutableStateOf(&quot;Compose&quot;) setContent { Text(name) // å»¶æ—¶æ›´æ–° Text å†…å®¹ LaunchedEffect(true) { delay(3000) name = &quot;Kotlin&quot; } } }} ä¸€æ®µå¾ˆç®€å•çš„ä»£ç ç¤ºä¾‹ï¼Œ3s åæ–‡å­—ä» Compose å˜ä¸º kotlinï¼Œæ‰§è¡Œçœ‹ä¸‹æ•ˆæœï¼š ç°åœ¨æˆ‘ä»¬æ”¹ä¸‹ä»£ç ï¼š 1234567891011121314151617class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { // ä»å¤–é¢æŒªåˆ°é‡Œé¢æ¥... var name by mutableStateOf(&quot;Compose&quot;) Text(name) // å»¶æ—¶æ›´æ–° Text å†…å®¹ LaunchedEffect(true) { delay(3000) name = &quot;Kotlin&quot; } } }} æ‰§è¡Œçœ‹ä¸‹æ•ˆæœï¼š å¥‡æ€ªçš„äº‹æƒ…å‘ç”Ÿäº†ï¼Œ3s åæ–‡å­—æ²¡æœ‰åˆ·æ–°ï¼ é‡ç»„ä½œç”¨åŸŸ é—®é¢˜å‡ºåœ¨å“ªï¼Ÿ é¦–å…ˆæˆ‘ä»¬å›é¡¾ä¸‹ Compose æ˜¯æ€ä¹ˆã€Œåˆ·æ–°ç•Œé¢ã€çš„ï¼Ÿæ¯”å¦‚ä¸Šé¢çš„ä¾‹å­ï¼Œå½“ name é‡æ–°èµ‹å€¼åï¼Œè¯»å–å®ƒçš„åœ°æ–¹ä¼šè¢«æ ‡è®°ä¸ºã€Œå¤±æ•ˆã€ï¼Œç„¶åã€Œé‡ç»„åˆ·æ–°ã€ã€‚ å…³é”®çŸ¥è¯†ç‚¹ åœ¨ Compose ä¸­ã€Œé‡ç»„åˆ·æ–°ã€å¹¶ä¸æ˜¯å•çº¯çš„åˆ·æ–° Text(name) è¿™ä¸€è¡Œï¼Œè€Œæ˜¯ä¼šæŠŠåŒ…å« Text(name) çš„ä»£ç å—ç»™åŒ…èµ·æ¥ï¼Œåˆ·æ–°çš„æ˜¯ã€Œæ•´ä¸ªä»£ç å—ã€ï¼Œæˆ–è€…è¯´é‡ç»„ã€Œæ•´ä¸ªä»£ç å—ã€ï¼ å°±åƒä¸‹é¢è¿™ä¸ªæ ·å­ï¼š è¿™æ®µè“è‰²èƒŒæ™¯çš„ä»£ç å—ä¼šè¢«é‡æ–°æ‰§è¡Œä¸€éï¼Œè¿™ä¸ªè“è‰²åŒºåŸŸå°±æ˜¯æ‰€è°“çš„ï¼šé‡ç»„ä½œç”¨åŸŸï¼ˆRecompose scopeï¼‰ï¼ æ‰€ä»¥å¯¼è‡´æ²¡æœ‰åˆ·æ–°çš„æ ¹æœ¬åŸå› å°±æ˜¯ï¼š ä¸ä»…ä»… Text(name) ä¼šè¢«é‡æ–°æ‰§è¡Œï¼Œvar name by mutableStateOf(&quot;Compose&quot;) ä¹Ÿä¼šæ‰§è¡Œï¼å¯¼è‡´ name åˆè¢«é‡æ–°åˆå§‹åŒ–äº†ã€‚ rememberé‚£æ€ä¹ˆè§£å†³ï¼Ÿä¸çŸ¥é“ä½ å‘ç°æ²¡æœ‰ï¼Œå…¶å®å¼€å‘å·¥å…·å·²ç»æç¤ºæˆ‘ä»¬äº†ï¼š mutableStateOf æ˜¯æ ‡çº¢çš„ï¼Œå¹¶ä¸”é”™è¯¯æç¤ºï¼šCreating a state object during composition without using remember. æ„æ€å°±æ˜¯ï¼šä½ åœ¨ç»„åˆè¿‡ç¨‹é‡Œé¢åˆ›å»ºäº† StateObject å¯¹è±¡ï¼Œä½†æ˜¯æ²¡æœ‰ç”¨ rememberã€‚ é‚£æ€ä¹ˆä½¿ç”¨ï¼Ÿå¾ˆç®€å•ï¼Œåªéœ€è¦å¥—ä¸€å±‚ rememberï¼Œä»£ç å¦‚ä¸‹ï¼š 123456789101112131415class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { var name by remember { mutableStateOf(&quot;Compose&quot;) } Text(name) LaunchedEffect(true) { delay(3000) name = &quot;Kotlin&quot; } } }} åŠ äº† remember åï¼Œåœ¨ç¬¬ä¸€æ¬¡æ‰§è¡Œçš„æ—¶å€™ï¼Œä¼šæ‰§è¡Œ Lambda è¡¨è¾¾å¼ï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œ mutableStateOf(&quot;Compose&quot;)ï¼Œå¹¶ä¸” remember ä¼šä¿å­˜ç»“æœï¼ˆStateObjectï¼‰ï¼Œå†æ¬¡è°ƒç”¨çš„æ—¶å€™ä¼šç›´æ¥è¿”å›ä¿å­˜çš„è€å¯¹è±¡ï¼ˆStateObjectï¼‰ï¼Œè€Œä¸æ˜¯å†æ¬¡æ‰§è¡Œ Lambda è¡¨è¾¾å¼é‡Œé¢çš„ä»£ç ï¼Œç›¸å½“äºå……å½“äº†ã€Œç¼“å­˜ã€çš„åŠŸèƒ½ã€‚ æˆ‘ä»¬æ‰§è¡Œä¸‹ä¿®æ”¹åçš„ä»£ç ï¼š æ–‡å­—æ›´æ–°äº†ï¼remember èµ·åˆ°äº†ç¼“å­˜çš„ä½œç”¨ï¼Œå°±æ˜¯ä¸ºäº†é˜²æ­¢å¤šæ¬¡åˆå§‹åŒ–å˜é‡è€Œå¯¼è‡´ç¨‹åºä¸å¯æ§ï¼ æ‰€ä»¥æœ‰ä¸ªåŸåˆ™ åœ¨ Compose é‡Œé¢ä½ åªè¦ç”¨äº† mutableStateOfï¼Œé‚£ä¹ˆèƒ½åŠ  remember æˆ‘ä»¬å°±åŠ  rememberã€‚ å¦å¤–æˆ‘ä»¬éœ€è¦æ³¨æ„ remember æ˜¯å¯ä»¥å¸¦å‚æ•°çš„ï¼šå¯ä»¥ã€Œä¸€ä¸ªã€æˆ–è€…ã€Œå¤šä¸ªã€å‚æ•°ã€‚ 1234567891011121314151617181920212223242526272829ğŸ“„ androidx.compose.runtime -&gt; Composables.kt/** * Remember the value returned by [calculation] if [key1] is equal to the previous composition, * otherwise produce and remember a new value by calling [calculation]. */@Composableinline fun &lt;T&gt; remember( key1: Any?, calculation: @DisallowComposableCalls () -&gt; T): T { return currentComposer.cache(currentComposer.changed(key1), calculation)}/** * Remember the value returned by [calculation] if [key1] and [key2] are equal to the previous * composition, otherwise produce and remember a new value by calling [calculation]. */@Composableinline fun &lt;T&gt; remember( key1: Any?, key2: Any?, calculation: @DisallowComposableCalls () -&gt; T): T { return currentComposer.cache( currentComposer.changed(key1) or currentComposer.changed(key2), calculation )} æœ‰ä»€ä¹ˆç”¨ï¼Œä¸¾ä¸ªä¾‹å­è¯´æ˜ï¼Œæ¯”å¦‚æˆ‘ä»¬è‡ªå®šä¹‰äº†ä¸€ä¸ª Composable å‡½æ•°ï¼š 12345@Composablefun showCharCount(value: String) { val length = value.length Text(&quot;å­—ç¬¦ä¸²é•¿åº¦ï¼š$length&quot;)} å¾ˆç®€å•ï¼Œä¸€ä¸ªæ˜¾ç¤ºå­—ç¬¦ä¸²é•¿åº¦çš„å‡½æ•°ã€‚ ç°åœ¨æˆ‘ä»¬æ¥å‡è®¾ä¸€ä¸ªåœºæ™¯ï¼š ä¼ å…¥è¿›æ¥çš„å­—ç¬¦ä¸²ç‰¹åˆ«é•¿ï¼› å¹¶ä¸” showCharCount åå¤è¢«è°ƒç”¨äº†å¾ˆå¤šæ¬¡ï¼› é‚£ä¹ˆ value.length æ¯æ¬¡éƒ½è¢«è°ƒç”¨ï¼Œå°±æ˜¾å¾—æœ‰ç‚¹ç¬¨é‡äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç»™å®ƒåŠ ä¸Šä¸€ä¸ª rememberï¼š 1234567@Composablefun showCharCount(value: String) { val length = remember { value.length } Text(&quot;å­—ç¬¦ä¸²é•¿åº¦ï¼š$length&quot;)} ä½†æ­¤æ—¶å°±ä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼š 12345678910@Composablefun showCharCount(value: String) { // ç¬¬ä¸€æ¬¡ä¼ è¿›æ¥ï¼šabcd // ç¬¬äºŒæ¬¡ä¼ è¿›æ¥ï¼šabcdefg // ç¬¬ä¸‰æ¬¡ä¼ è¿›æ¥ï¼šabcdefghijklmn val length = remember { value.length } Text(&quot;å­—ç¬¦ä¸²é•¿åº¦ï¼š$length&quot;)} å­—ç¬¦ä¸²é•¿åº¦æ°¸è¿œéƒ½æ˜¯ï¼š4ï¼Œå› ä¸º value.length ä¸ä¼šè¢«æ‰§è¡Œï¼Œé‚£æ€ä¹ˆåŠï¼š 12345678910@Composablefun showCharCount(value: String) { // ç¬¬ä¸€æ¬¡ä¼ è¿›æ¥ï¼šabcd // ç¬¬äºŒæ¬¡ä¼ è¿›æ¥ï¼šabcdefg // ç¬¬ä¸‰æ¬¡ä¼ è¿›æ¥ï¼šabcdefghijklmn val length = remember(value) { value.length } Text(&quot;å­—ç¬¦ä¸²é•¿åº¦ï¼š$length&quot;)} æˆ‘ä»¬ç»™ remember åŠ äº†ä¸€ä¸ªå‚æ•°ï¼švalueï¼Œåªè¦è¿™ä¸ª key å˜åŒ–äº†ï¼Œé‚£ä¹ˆå°±ä¼šé‡æ–°æ‰§è¡Œ Lambda è¡¨è¾¾å¼ï¼Œè¿™å°±æ˜¯å¸¦å‚æ•°çš„ remember çš„ç”¨æ³•ã€‚","link":"/2025/07/07/compose/Compose%20--%20%E7%8A%B6%E6%80%81%E8%AE%A2%E9%98%85%20&%20%E8%87%AA%E5%8A%A8%E6%9B%B4%E6%96%B0%20--%2002.%20remember%20%E5%92%8C%E9%87%8D%E7%BB%84%E4%BD%9C%E7%94%A8%E5%9F%9F/"}],"tags":[{"name":"Compose","slug":"Compose","link":"/tags/Compose/"},{"name":"çŠ¶æ€è®¢é˜… &amp; è‡ªåŠ¨æ›´æ–°","slug":"çŠ¶æ€è®¢é˜…-è‡ªåŠ¨æ›´æ–°","link":"/tags/%E7%8A%B6%E6%80%81%E8%AE%A2%E9%98%85-%E8%87%AA%E5%8A%A8%E6%9B%B4%E6%96%B0/"},{"name":"mutableStateListOf","slug":"mutableStateListOf","link":"/tags/mutableStateListOf/"},{"name":"Compose çŠ¶æ€","slug":"Compose-çŠ¶æ€","link":"/tags/Compose-%E7%8A%B6%E6%80%81/"},{"name":"remember","slug":"remember","link":"/tags/remember/"},{"name":"é‡ç»„ä½œç”¨åŸŸ","slug":"é‡ç»„ä½œç”¨åŸŸ","link":"/tags/%E9%87%8D%E7%BB%84%E4%BD%9C%E7%94%A8%E5%9F%9F/"}],"categories":[{"name":"Compose","slug":"Compose","link":"/categories/Compose/"},{"name":"çŠ¶æ€è®¢é˜… &amp; è‡ªåŠ¨æ›´æ–°","slug":"Compose/çŠ¶æ€è®¢é˜…-è‡ªåŠ¨æ›´æ–°","link":"/categories/Compose/%E7%8A%B6%E6%80%81%E8%AE%A2%E9%98%85-%E8%87%AA%E5%8A%A8%E6%9B%B4%E6%96%B0/"}],"pages":[]}