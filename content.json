{"posts":[{"title":"è§£æ Modifier &amp; CombinedModifier","text":"åŸºäº androidx.compose.runtime:runtime:1.7.1 ç‰ˆæœ¬ ä»€ä¹ˆæ˜¯ Modifier ï¼Ÿ å½“ä½ æƒ³æ·±å…¥äº†è§£ Modifier çš„æ—¶å€™ï¼Œä½ åº”è¯¥å·²ç»åœ¨å®é™…ä»£ç ä¸­ç”¨èµ·æ¥äº†ï¼Œå› ä¸ºéšå¤„å¯è§å„ç§ Modifierï¼Œæ¯”å¦‚ï¼š 12345678Modifier.size() // å°ºå¯¸Modifier.width() // å®½åº¦Modifier.height() // é«˜åº¦Modifier.padding() // é—´è·Modifier.background() // èƒŒæ™¯Modifier.clip() // è£åˆ‡Modifier.clickable() // ç‚¹å‡»... ... é‚£ä¹ˆä½ æœ‰æ²¡æœ‰æ€è€ƒè¿‡ä¸€ä¸ªé—®é¢˜ï¼šè¿™ä¸ªåƒæ ¹éƒ¨ï¼ˆèµ·ç‚¹ï¼‰ä¸€æ ·çš„ Modifier æ˜¯ä¸ªå•¥ï¼Ÿ æˆ‘ä»¬æ¥çœ‹ä¸‹å®ƒçš„å®šä¹‰ï¼š 12345678910111213141516ğŸ“„ androidx.compose.ui.Modifier.ktinterface Modifier { // é‡ç‚¹ï¼šç”³æ˜ä¸€ä¸ª Modifier çš„ä¼´ç”Ÿå¯¹è±¡ï¼ˆå•ä¾‹å¯¹è±¡ï¼‰ companion object : Modifier { // é‡Œé¢å…¨éƒ¨éƒ½æ˜¯æœ€ç®€å•çš„å®ç°ï¼Œè¿™é‡Œé¢çš„æ–¹æ³•æˆ‘ä»¬åé¢ä¼šè¯¦ç»†äº†è§£åˆ°ï¼Œæš‚æ—¶ä¸ç”¨å…³å¿ƒ override fun &lt;R&gt; foldIn(initial: R, operation: (R, Element) -&gt; R): R = initial override fun &lt;R&gt; foldOut(initial: R, operation: (Element, R) -&gt; R): R = initial override fun any(predicate: (Element) -&gt; Boolean): Boolean = false override fun all(predicate: (Element) -&gt; Boolean): Boolean = true override infix fun then(other: Modifier): Modifier = other override fun toString() = &quot;Modifier&quot; }} æ‰€ä»¥å¦‚æœä½ å•å†™ä¸€ä¸ª Modifierï¼Œå°±å¯ä»¥è·å–åˆ°ä¸€ä¸ªæœ€ç®€å•çš„ Modifier æ¥å£çš„å¯¹è±¡ï¼ˆå³ä¼´ç”Ÿå¯¹è±¡ï¼‰ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯ä½œä¸ºä¸€ä¸ªèµ·ç‚¹ç”¨äºé“¾å¼è°ƒç”¨ã€‚ OKï¼Œç°åœ¨æˆ‘ä»¬æ¥çœ‹ä¸€æ®µç®€å•çš„ä»£ç ï¼š 12345678910111213141516class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { ComposeBlogTheme { Custom() } } }}@Composablefun Custom() { Box(Modifier.size(40.dp).background(Color.Blue)) {}} è¿™é‡Œæˆ‘ä»¬è‡ªå®šä¹‰äº†ä¸€ä¸ª Composable å‡½æ•° custom()ï¼Œå†…éƒ¨å°±æ˜¯ä¸€ä¸ª Boxï¼ŒåŒæ—¶å¯¹ Box æ·»åŠ äº†å°ºå¯¸å’ŒèƒŒæ™¯ã€‚ æ•ˆæœå¦‚ä¸‹ï¼š ç°åœ¨æˆ‘ä»¬å®šä¹‰çš„è¿™ä¸ª Custom() å°±æ˜¯ä¸€ä¸ªé€šç”¨çš„å¯ç»„åˆå‡½æ•°ï¼Œå¦‚æœç°åœ¨æˆ‘å¸Œæœ›å¤–éƒ¨è°ƒç”¨è¿™ä¸ª Custom å‡½æ•°çš„æ—¶å€™å¯ä»¥ä»å¤–éƒ¨å»æ”¹å˜ Box çš„é€æ˜åº¦ï¼Œè¯¥æ€ä¹ˆå†™ï¼Ÿ æˆ‘ä»¬å¯èƒ½ä¼šå¾ˆè‡ªç„¶çš„å†™å‡ºä¸‹é¢çš„ä»£ç ï¼š 12345678910111213141516class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { ComposeBlogTheme { Custom(modifier = Modifier.alpha(0.5f)) } } }}@Composablefun Custom(modifier: Modifier) { Box(modifier.size(40.dp).background(Color.Blue)) {}} è¿™æ®µä»£ç ä¸éš¾ç†è§£å§ï¼Ÿæ•ˆæœå¦‚ä¸‹ï¼š æˆ‘ä»¬å¯ä»¥ç»™ Custom() åŠ ä¸€ä¸ª Modifier ç±»å‹çš„å‚æ•°ï¼Œè¿™æ ·å¤–éƒ¨å°±å¯ä»¥é€šè¿‡ä¼ å…¥ä¸€ä¸ª Modifier æ¥ä¿®æ”¹ Box çš„å°ºå¯¸äº†ã€‚ ä½†æ˜¯è¿™å°±ä¼šå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šç°åœ¨å¤–éƒ¨è°ƒç”¨ custom() ï¼Œå°±å¿…é¡»ä¼ å…¥ä¸€ä¸ª Modifierï¼Œè¿™å°±ä¸åˆç†äº†ï¼Œç›¸å½“äºå¼ºåˆ¶è¦æ±‚å¤–éƒ¨å¿…é¡»åŠ è¿™ä¸ª Modifier å‚æ•°ï¼Œæ‰€ä»¥é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šåƒä¸‹é¢è¿™ä¹ˆå†™ï¼š 1234567891011121314151617class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { ComposeBlogTheme { Custom(modifier = Modifier.alpha(0.5f)) // ä¼ äº†ï¼Œcustom å°±ç”¨ä¼ å…¥çš„ Modifier Custom() // ä¸ä¼ ï¼Œcustom å°±ç”¨é»˜è®¤çš„ Modifier } } }}@Composablefun Custom(modifier: Modifier = Modifier) { // è®¾å®šä¸€ä¸ªé»˜è®¤çš„ Modifierï¼Œä½œä¸ºä¸€ä¸ªå ä½ç¬¦ä½¿ç”¨ Box(modifier.size(40.dp).background(Color.Blue)) {}} ç°åœ¨æ˜¯ä¸æ˜¯å°±èƒ½è§£å†³æˆ‘ä»¬å‰é¢çš„é—®é¢˜äº†ï¼Ÿ è¯·è®°ä½ï¼šè¿™æ˜¯ä¸€ä¸ªå¾ˆæ ‡å‡†çš„å†™æ³•ï¼ ä¸ºä»€ä¹ˆè¯´æ˜¯ä¸€ä¸ªæ ‡å‡†å†™æ³•å‘¢ï¼Ÿ æˆ‘ä»¬çœ‹ä¸‹ Box çš„æºç å®šä¹‰ï¼š 1234567@Composableinline fun Box( modifier: Modifier = Modifier, // è¿™é‡Œ contentAlignment: Alignment = Alignment.TopStart, propagateMinConstraints: Boolean = false, content: @Composable BoxScope.() -&gt; Unit) å†æ¢ä¸€ä¸ª Button çœ‹çœ‹ï¼š 1234567@Composablefun Button( onClick: () -&gt; Unit, modifier: Modifier = Modifier, // è¿™é‡Œ enabled: Boolean = true, ... ...) å†æ¢ä¸€ä¸ª Column çœ‹çœ‹ï¼š 1234567@Composableinline fun Column( modifier: Modifier = Modifier, // è¿™é‡Œ verticalArrangement: Arrangement.Vertical = Arrangement.Top, horizontalAlignment: Alignment.Horizontal = Alignment.Start, content: @Composable ColumnScope.() -&gt; Unit) Compose é»˜è®¤æä¾›çš„å‡½æ•°çš„å‚æ•°ä¹Ÿæ˜¯è¿™ç§æ ‡å‡†å†™æ³•ï¼Œæ‰€ä»¥ä»¥åæˆ‘ä»¬å†™è‡ªå®šä¹‰çš„ Compose å‡½æ•°ï¼ŒæŒ‰ç…§è¿™ç§æ ‡å‡†å†™æ³•å°±ä¼šå¾ˆæ–¹ä¾¿ã€‚ Modifier é“¾ æ‰€è°“çš„ã€Œ Modifier é“¾ ã€å…¶å®å°±æ˜¯ç±»ä¼¼ã€Œ Modifier.padding().background() ã€è¿™æ ·çš„é“¾å¼è°ƒç”¨ã€‚åœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­ï¼Œè¿™ç§é“¾å¼è°ƒç”¨å¯¹é¡ºåºçš„æ•æ„Ÿåº¦è¿˜æ˜¯å¾ˆå¼ºçš„ï¼Œä¸åŒçš„è°ƒç”¨é¡ºåºæ˜¾ç¤ºå‡ºæ¥çš„ç»“æœä¼šå®Œå…¨ä¸ä¸€æ ·ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬ç»“åˆå®é™…ä»£ç æ·±å…¥åˆ†æ Modifier é“¾çš„åˆ›å»ºæ­¥éª¤ã€‚ 1234567891011class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { ComposeBlogTheme { Box(Modifier.background(Color.Blue)) } } }} å‰é¢ä½ åº”è¯¥çŸ¥é“äº† Modifier æ˜¯ä»€ä¹ˆäº†ï¼Œå®ƒå°±ç›¸å½“äºä¸€ä¸ªç™½æ¿ï¼Œç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹ Modifier.background() åšäº†ä»€ä¹ˆï¼š 123456789101112131415161718192021ğŸ“„ androidx.compose.foundation.Background.ktfun Modifier.background( color: Color, shape: Shape = RectangleShape): Modifier { val alpha = 1.0f // for solid colors return this.then( // thisï¼šå°±æ˜¯ Modifierï¼Œè¿™é‡Œåˆè°ƒç”¨äº† then() BackgroundElement( color = color, shape = shape, alpha = alpha, inspectorInfo = debugInspectorInfo { name = &quot;background&quot; value = color properties[&quot;color&quot;] = color properties[&quot;shape&quot;] = shape } ) )} æˆ‘ä»¬å¯ä»¥å‘ç° Modifier.backgroud å®é™…ä¸Šåˆè°ƒç”¨äº† this.then(BackgroundElement())ï¼Œæ­¤æ—¶ this æŒ‡é’ˆæŒ‡å‘çš„æ˜¯ä¼´ç”Ÿå¯¹è±¡ Modifierï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹ then() åšäº†ä»€ä¹ˆã€‚ 12345678ğŸ“„ androidx.compose.ui.Modifier.ktinterface Modifier { infix fun then(other: Modifier): Modifier = if (other === Modifier) this else CombinedModifier(this, other) } å¯ä»¥çœ‹åˆ° then() æ˜¯æœ‰å‚æ•°çš„ï¼Œå®ƒçš„å‚æ•°ä¹Ÿæ˜¯ä¸€ä¸ª Modifier ç±»å‹çš„ï¼Œæ‰€ä»¥ä¼ é€’è¿›æ¥çš„ BackgroundElement() ä¹Ÿæ˜¯ä¸€ä¸ª Modifier å—ï¼Ÿ æˆ‘ä»¬æ¥çœ‹ä¸‹å®ƒçš„å®šä¹‰ï¼š 123456789ğŸ“„ androidx.compose.foundation.Background.ktprivate class BackgroundElement( private val color: Color = Color.Unspecified, private val brush: Brush? = null, private val alpha: Float, private val shape: Shape, private val inspectorInfo: InspectorInfo.() -&gt; Unit) : ModifierNodeElement&lt;BackgroundNode&gt;() {} 123ğŸ“„ androidx.compose.ui.node.ModifierNodeElement.ktabstract class ModifierNodeElement&lt;N : Modifier.Node&gt;: Modifier.Element, InspectableValue {} 123ğŸ“„ androidx.compose.ui.Modifier.ktinterface Element : Modifier {} å›å½’ä¸»é¢˜ï¼Œç°åœ¨æˆ‘ä»¬å†æ¥çœ‹çœ‹ then() çš„ä½œç”¨ï¼šå®ƒä¸»è¦è´Ÿè´£æŠŠè°ƒç”¨çš„ Modifierï¼ˆå·¦è¾¹ï¼‰å’Œå‚æ•°ä¼ å…¥çš„ Modifierï¼ˆå³è¾¹ï¼‰è¿›è¡Œåˆå¹¶çš„ã€‚ 1. if (other === Modifier) this å¦‚æœå‚æ•°æ˜¯ä¸€ä¸ªæœ€åŸºæœ¬çš„ Modifier ä¼´ç”Ÿå¯¹è±¡ï¼šcompanion objectï¼Œåˆ™è¿”å›è‡ªå·±ï¼Œå³è°ƒç”¨è€…ã€‚ æ¯”å¦‚æˆ‘è¿™ä¹ˆå†™ï¼š 123Box(Modifier.background(Color.Blue).then(Modifier))==&gt;å°±ä¼šç›´æ¥è¿”å› Box(Modifier.background(Color.Blue) è‡ªèº« é‚£æˆ‘ä»¬ä¾‹å­é‡Œçš„ Modifier.background() è¿”å›çš„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ 1234567891011121314151617Box(Modifier.background(Color.Blue))/** * æ­¤æ—¶ then(Background()) å¾ˆæ˜æ˜¾ä¸æ»¡è¶³ other === Modifier çš„æ¡ä»¶ * æ‰€ä»¥æ ¹æ®åˆ¤æ–­æ¡ä»¶ï¼š * if (other === Modifier) this else CombinedModifier(this, other) * æ­¤æ—¶åº”è¯¥èµ°åˆ° else åˆ†æ”¯ï¼Œæ‰§è¡Œ CombinedModifier(this, other) * * æ˜¯å—ï¼Ÿ ğŸ¤”ğŸ¤”ğŸ¤”ğŸ¤”ğŸ¤”ğŸ¤”ğŸ¤” * * æˆ‘ä»¬æ¥å›é¡¾ä¸€ä¸‹ Modifier è¿™ä¸ªä¼´ç”Ÿå¯¹è±¡ï¼Œå¦‚æœä½ å¤Ÿä»”ç»†çš„è¯ï¼Œåº”è¯¥æ³¨æ„åˆ°äº†ï¼š * å®ƒå†…éƒ¨è¦†å†™äº† then() æ–¹æ³• */companion object : Modifier { ... override infix fun then(other: Modifier): Modifier = other} Modifier å†…éƒ¨å¯¹ then() çš„æ“ä½œæå…¶ç®€å•ï¼šä½ ä¼ è¿›æ¥ä»€ä¹ˆï¼Œæˆ‘å°±ç»™ä½ è¿”å›ä»€ä¹ˆï¼ æ‰€ä»¥ Modifier.background() è¿™ç§è°ƒç”¨æ–¹æœ¬èº«å°±æ˜¯ä¸€ä¸ªä¼´ç”Ÿå¯¹è±¡çš„æƒ…å†µï¼Œä¼šèµ°åˆ°å®ƒè‡ªå·±å†…éƒ¨çš„ then() æ–¹æ³•ï¼Œè¿”å›çš„æ˜¯ BackgroundElement() è‡ªèº«ã€‚ æ­¤æ—¶ Modifier é“¾çš„æ•°æ®ç»“æ„å¦‚ä¸‹ï¼š å¦‚æœâ€œè°ƒç”¨è€…â€å’Œâ€œä¼ è¿›æ¥çš„å‚æ•°â€éƒ½ä¸æ˜¯ Modifier ä¼´ç”Ÿå¯¹è±¡çš„è¯ï¼Œå°±ä¼šèµ°åˆ°ä¸‹é¢ä¸€ä¸ªæ¡ä»¶ã€‚ 2. else CombinedModifier(this, other) è°ƒç”¨ CombinedModifier() è¿›è¡Œä¸¤ä¸ª Modifier çš„èåˆï¼Œå¹¶è¿”å› CombinedModifier è‡ªèº«ã€‚ æ¯”å¦‚æˆ‘ä»¬ç°åœ¨å†æ·»åŠ ä¸€ä¸ªå°ºå¯¸ï¼š 1Box(Modifier.background(Color.Blue).size(40.dp)) æŸ¥çœ‹ size() å‡½æ•°ï¼š 12345678910111213141516ğŸ“„ androidx.compose.foundation.layout.Size.kt@Stablefun Modifier.size(size: Dp) = this.then( SizeElement( minWidth = size, maxWidth = size, minHeight = size, maxHeight = size, enforceIncoming = true, inspectorInfo = debugInspectorInfo { name = &quot;size&quot; value = size } )) è¿™ä¸ªæ—¶å€™çš„ this å°±æ˜¯ BackgroudElement äº†ï¼Œè€Œ then() å†…éƒ¨çš„å‚æ•°åˆæ˜¯ä¸€ä¸ª SizeElementï¼Œæ‰€ä»¥å°±è¦ç”¨åˆ° CombinedModifier è¿›è¡Œèåˆäº†ã€‚ æˆ‘ä»¬æ¥çœ‹ä¸‹ CombinedModifierï¼š 123456ğŸ“„ androidx.compose.ui.Modifier.ktclass CombinedModifier( internal val outer: Modifier, internal val inner: Modifier) : Modifier {} CombinedModifier å…·ä½“æ€ä¹ˆèåˆçš„ï¼Œæˆ‘ä»¬å…ˆä¸éœ€è¦å…³æ³¨ï¼Œä¸‹é¢ä¼šè®²ã€‚ æˆ‘ä»¬è¿™é‡Œä¸»è¦å…³æ³¨å®ƒçš„ä¸¤ä¸ªå‚æ•°ï¼šã€Œ outer ã€ å’Œ ã€Œ inner ã€! æ‰€ä»¥ï¼šBackgroudElement æ˜¯ outerï¼ŒSizeElement æ˜¯ inner ï¼ æ­¤æ—¶ Modifier é“¾çš„æ•°æ®ç»“æ„å¦‚ä¸‹ï¼š ç°åœ¨æˆ‘ä»¬å†æ·»åŠ ä¸€ä¸ªè¾¹è·ï¼š 1Box(Modifier.background(Color.Blue).size(40.dp).padding(10.dp)) æŸ¥çœ‹ padding() å‡½æ•°ï¼š 1234567891011121314ğŸ“„ androidx.compose.foundation.layout.Padding.kt@Stablefun Modifier.padding(all: Dp) = this then PaddingElement( start = all, top = all, end = all, bottom = all, rtlAware = true, inspectorInfo = { name = &quot;padding&quot; value = all }) è¿™ä¸ªæ—¶å€™çš„ this æŒ‡å‘çš„æ˜¯ CombinedModifier å®ä¾‹ï¼Œè€Œ then() å†…éƒ¨çš„å‚æ•°åˆæ˜¯ä¸€ä¸ª PaddingElementï¼Œæ‰€ä»¥åˆè¦ç”¨åˆ° CombinedModifier è¿›è¡Œèåˆäº†ã€‚ æ­¤æ—¶ Modifier é“¾çš„æ•°æ®ç»“æ„å¦‚ä¸‹ï¼š åˆ°è¿™é‡Œï¼Œä½ æœ‰æ²¡æœ‰å‘ç°ï¼ŸModifier é“¾æ¡å†…éƒ¨éƒ½æœ‰ä¸€ä¸ª then() ä½œä¸ºæœ€å¤–å±‚è°ƒç”¨ï¼Œå®ƒå°±ç›¸å½“äºä¸€ä¸ªå¥—å­ï¼Œæ‰“é€ ä¸€ä¸ªä¸€ç¯å¥—ä¸€ç¯çš„é“¾æ¡ã€‚ CombinedModifier ç°åœ¨æˆ‘ä»¬å¼€å§‹æ­£å¼ç ”ç©¶ CombinedModifier çš„æºç æœ¬è´¨ï¼ 1234class CombinedModifier( internal val outer: Modifier, internal val inner: Modifier) : Modifier å‰é¢æˆ‘ä»¬çŸ¥é“äº†ï¼šCombinedModifier è¿æ¥çš„ä¸¤ä¸ª Modifier åˆ†åˆ«å­˜å‚¨åœ¨ outer ä¸ innerï¼Œè€Œ Compose å¯¹ Modifier çš„éå†ï¼Œå…¶å®å°±æ˜¯ä»å¤–ï¼ˆouterï¼‰åˆ°å†…ï¼ˆinnerï¼‰ä¸€å±‚å±‚è®¿é—®çš„ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ outer ä¸ innner å­—æ®µéƒ½è¢« internal å…³é”®å­—ç”³æ˜ï¼Œæ„å‘³ç€ä¸èƒ½è¢«å¤–éƒ¨æ¨¡å—ç›´æ¥è®¿é—®ï¼Œä½†å®˜æ–¹ä¸ºæˆ‘ä»¬æä¾›äº† foldOut() ä¸ foldIn() ä¸“é—¨ç”¨æ¥éå† Modifier é“¾ã€‚ 123456789101112131415161718192021222324252627ğŸ“„ androidx.compose.ui.Modifier.ktclass CombinedModifier( internal val outer: Modifier, internal val inner: Modifier) : Modifier { override fun &lt;R&gt; foldIn(initial: R, operation: (R, Modifier.Element) -&gt; R): R = inner.foldIn(outer.foldIn(initial, operation), operation) // æ­£å‘éå† override fun &lt;R&gt; foldOut(initial: R, operation: (Modifier.Element, R) -&gt; R): R = outer.foldOut(inner.foldOut(initial, operation), operation) // åå‘éå† override fun any(predicate: (Modifier.Element) -&gt; Boolean): Boolean = outer.any(predicate) || inner.any(predicate) // æˆ–è¿ç®— override fun all(predicate: (Modifier.Element) -&gt; Boolean): Boolean = outer.all(predicate) &amp;&amp; inner.all(predicate) // ä¸è¿ç®— override fun equals(other: Any?): Boolean = other is CombinedModifier &amp;&amp; outer == other.outer &amp;&amp; inner == other.inner override fun hashCode(): Int = outer.hashCode() + 31 * inner.hashCode() override fun toString() = &quot;[&quot; + foldIn(&quot;&quot;) { acc, element -&gt; if (acc.isEmpty()) element.toString() else &quot;$acc, $element&quot; } + &quot;]&quot;} ä¾‹å¦‚æˆ‘ä»¬ä¹‹å‰å†™çš„ Modifier é“¾ï¼š 1Modifier.background(Color.Blue).size(40.dp).padding(10.dp) foldIn()ï¼šæ­£å‘éå† Modifier é“¾&nbsp;BackgroundElement -&gt; SizeElement -&gt; PaddingElement foldOut()ï¼šåå‘éå† Modifier é“¾&nbsp;PaddingElement -&gt; SizeModifier -&gt; BackgroundElement foldIn() è§£æ ä½ åº”è¯¥ä¹Ÿå‘ç°äº†ï¼ŒCombinedModifier æœ¬èº«å°±æ˜¯ Modifier æ¥å£çš„å®ç°ç±»ï¼Œå®ƒå†…éƒ¨çš„ foldInã€foldOut éƒ½æ˜¯è¦†å†™äº†å…¶çˆ¶æ¥å£ Modifier çš„å†…éƒ¨æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å…ˆæ¥çœ‹çœ‹ Modifier çš„ foldInï¼ˆå› ä¸ºå®ƒæ›´ç®€å•ï¼‰ï¼š 123interface Modifier { fun &lt;R&gt; foldIn(initial: R, operation: (R, Element) -&gt; R): R} è®©æˆ‘ä»¬åˆ†æä¸€ä¸‹è¿™ä¸ª foldIn å‡½æ•°ï¼š fun &lt;R&gt;ï¼šè¿™æ˜¯ä¸€ä¸ªæ³›å‹å‡½æ•°ï¼Œç±»å‹å‚æ•° R è¡¨ç¤ºç»“æœçš„ç±»å‹ã€‚ initial: Rï¼šä½œä¸ºç´¯ç§¯æ“ä½œçš„åˆå§‹å€¼ï¼ŒfoldIn ä»è¿™ä¸ªå€¼å¼€å§‹ï¼Œå¹¶åœ¨æ¯æ¬¡æ“ä½œä¸­æ›´æ–°å®ƒã€‚ operation: (R, Element) -&gt; Rï¼šè¿™æ˜¯ä¸€ä¸ª lambda è¡¨è¾¾å¼å‚æ•°ï¼Œå®ƒæ¥å—å½“å‰çš„ç´¯ç§¯å€¼å’Œä¿®é¥°ç¬¦é“¾ä¸­çš„å½“å‰å…ƒç´  Elementï¼Œç„¶åè¿”å›æ–°çš„ç´¯ç§¯å€¼ã€‚è¿™ä¸ª lambda è¡¨è¾¾å¼ä¼šè¢«åº”ç”¨äºä¿®é¥°ç¬¦é“¾ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬å¸Œæœ›ç»Ÿè®¡ Modifier é“¾ä¸­ Modifier çš„æ•°é‡ï¼š 123456789val modifier = Modifier .background(Color.Blue) .size(40.dp) .padding(10.dp)val result = modifier.foldIn&lt;Int&gt;(0) { currentIndex, element -&gt; println(&quot;@@@ index: $currentIndex , element :$element&quot;) currentIndex + 1}println(&quot;@@@ result = $result&quot;) çœ‹ä¸æ‡‚ï¼Ÿé‚£æˆ‘ä»¬ç›´æ¥çœ‹ Logï¼š 1234@@@ index: 0 , element :androidx.compose.foundation.BackgroundElement@52227b59@@@ index: 1 , element :androidx.compose.foundation.layout.SizeElement@780004cf@@@ index: 2 , element :androidx.compose.foundation.layout.PaddingElement@b80004cf@@@ result = 3 çœ‹å®Œæœ€ç®€å•çš„ foldIn å‡½æ•°ï¼Œæˆ‘ä»¬å†æ¥çœ‹ CombinedModifier çš„ foldIn å‡½æ•°ï¼š 123456// Modifier æ¥å£çš„ foldIn å‡½æ•°fun &lt;R&gt; foldIn(initial: R, operation: (R, Element) -&gt; R): R// Combinedmodifier è¦†å†™çš„ foldIn å‡½æ•°override fun &lt;R&gt; foldIn(initial: R, operation: (R, Modifier.Element) -&gt; R): R = inner.foldIn(outer.foldIn(initial, operation), operation) çœ‹ä¸æ‡‚æ˜¯ä¹ˆï¼Ÿä¸æ€¥ï¼Œä½ å…ˆæ¥æƒ³æƒ³ Modifier é“¾æ¡ç»è¿‡ CombinedModifier è½¬æ¢åï¼Œæ˜¯ä¸æ˜¯ä¸‹é¢è¿™ä¸ªæ ·å­ï¼š 123456789101112131415161718192021222324252627Modifier.background(Color.Blue).size(40.dp).padding(10.dp)// åˆ†æ­¥éª¤æ‹†è§£1. Modifier.background(Color.Blue) ==&gt; ç­‰åŒäº Modifier.then(Modifier.background()) ==&gt; Modifier.background()2. Modifier.background(Color.Blue).size(40.dp) ==&gt; ç­‰åŒäº Modifier.background().then(Modifier.size()) ==&gt; ç­‰åŒäº CombinedModifier [ outer: Modifier.background(), inner: Modifier.size() ]3. Modifier.background(Color.Blue).size(40.dp).padding(10.dp) ==&gt; ç­‰åŒäº Modifier.background().then(Modifier.size()).then(Modifier.padding()) ==&gt; ç­‰åŒäº CombinedModifier [ outer: CombinedModifier [ outer: Modifier.background(), inner: Modifier.size() ], inner: Modifier.padding() ] å†çœ‹ä¸ªç¤ºä¾‹å›¾ï¼Œå¯èƒ½ä¼šæ›´ç›´è§‚ç‚¹ï¼š ç°åœ¨å†çœ‹ CombinedModifier çš„ foldIn å‡½æ•°ï¼š 12override fun &lt;R&gt; foldIn(initial: R, operation: (R, Modifier.Element) -&gt; R): R = inner.foldIn(outer.foldIn(initial, operation), operation) åœ¨è¿™ä¸ª foldIn å®ç°ä¸­ï¼Œå¯ä»¥çœ‹åˆ°å¤„ç†ä¿®é¥°ç¬¦é“¾çš„è¿‡ç¨‹æ˜¯é€’å½’çš„å’Œåˆ†å±‚çš„ã€‚è®©æˆ‘ä»¬é€æ­¥è§£æè¿™ä¸ªå‡½æ•°ï¼š initial: Rï¼šæ˜¯ç´¯ç§¯æ“ä½œçš„åˆå§‹å€¼ã€‚ operation: (R, Modifier.Element) -&gt; Rï¼šæ˜¯ä¸€ä¸ªåº”ç”¨äºæ¯ä¸€ä¸ª Modifier.Element çš„é«˜é˜¶å‡½æ•°ï¼Œå®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼šå½“å‰çš„ç´¯ç§¯å€¼å’Œ Modifier çš„ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¿”å›æ–°çš„ç´¯ç§¯å€¼ã€‚ inner.foldIn(outer.foldIn(initial, operation), operation)ï¼šå°†ä¸Šä¸€æ­¥çš„ç»“æœä½œä¸ºå®ƒçš„åˆå§‹å€¼ï¼Œå¹¶åœ¨ inner ä¿®æ”¹å™¨é“¾ä¸Šæ‰§è¡Œç›¸åŒçš„ operation å‡½æ•°ã€‚ æ„Ÿè§‰å¥½å¤æ‚å•Šï¼Œæ²¡å…³ç³»ä¸æ…Œï¼Œçœ‹å›¾ï¼š åˆ°è¿™é‡Œæˆ‘ä»¬å†æ¥å›é¡¾ä¸‹åˆšæ‰ç»Ÿè®¡ Modifier æ•°é‡çš„ä¾‹å­ï¼š 123456789val modifier = Modifier .background(Color.Blue) .size(40.dp) .padding(10.dp)val result = modifier.foldIn&lt;Int&gt;(0) { currentIndex, element -&gt; println(&quot;@@@ index: $currentIndex , element :$element&quot;) currentIndex + 1}println(&quot;@@@ result = $result&quot;) Log å¦‚ä¸‹ï¼š 1234@@@ index: 0 , element :androidx.compose.foundation.BackgroundElement@52227b59@@@ index: 1 , element :androidx.compose.foundation.layout.SizeElement@780004cf@@@ index: 2 , element :androidx.compose.foundation.layout.PaddingElement@b80004cf@@@ result = 3 ç°åœ¨æ˜¯ä¸æ˜¯å°±èƒ½æ¯«æ— å‹åŠ›çš„çœ‹æ˜ç™½äº†ï¼Ÿå†æ¥ä¸€å¼ å›¾ï¼š foldOut() è§£æ ä¸ foldIn() ç›¸åï¼Œ æˆ‘ä»¬å°±ä¸å†å•ç‹¬å±•å¼€åˆ†æå®ƒçš„å‚æ•°äº†ï¼Œè¿˜æ˜¯ä»¥å‰é¢ç»Ÿè®¡ Modifier ä¸ªæ•°çš„ä¾‹å­çœ‹ä¸‹ Log è¾“å‡ºï¼š 1234567891011val modifier = Modifier .background(Color.Blue) .size(40.dp) .padding(10.dp)val result = modifier.foldOut&lt;Int&gt;(0) { element, currentIndex -&gt; println(&quot;@@@ index: $currentIndex , element :$element&quot;) currentIndex + 1}println(&quot;@@@ result = $result&quot;) çœ‹ä¸‹ Logï¼š 1234@@@ index: 0 , element :androidx.compose.foundation.layout.PaddingElement@b80004cf@@@ index: 1 , element :element :androidx.compose.foundation.layout.SizeElement@780004cf@@@ index: 2 , element :element :androidx.compose.foundation.BackgroundElement@52227b59@@@ result = 3 æ˜¯ä¸æ˜¯åè¿‡æ¥çš„ï¼Ÿå¦å¤–æ³¨æ„ lambda è¡¨è¾¾å¼å†…éƒ¨çš„å‚æ•°ä½ç½®ä¸ foldIn() æ˜¯åç€æ¥çš„ï¼Œå…¶å®ƒæ²¡æœ‰ä»»ä½•åŒºåˆ«ã€‚ Modifier.Element åœ¨ Modifier æ•´ä¸ªä½“ç³»é‡Œé¢ï¼Œæœ‰å¾ˆå¤š Modifier æ¥å£çš„å­æ¥å£å’Œå®ç°ç±»ï¼Œé™¤äº†æˆ‘ä»¬ä¹‹å‰æè¿‡çš„ companion object ä¼´ç”Ÿå¯¹è±¡å’Œ CombinedModifier ç±»ä¹‹å¤–ï¼Œå…¶ä»–æ‰€æœ‰çš„ Modifierï¼Œä¸ç®¡æ˜¯æ¥å£è¿˜æ˜¯å®ç°ç±»ï¼Œå…¨éƒ¨éƒ½ç›´æ¥æˆ–è€…é—´æ¥çš„ç»§æ‰¿äº† Modifier çš„å¦å¤–ä¸€ä¸ªå­æ¥å£ï¼šElementã€‚ æ¯”å¦‚æˆ‘ä»¬å‰é¢é‡åˆ°çš„ Background èƒŒåçš„ BackgroundElementï¼š 123456789private class BackgroundElement( private val color: Color = Color.Unspecified, private val brush: Brush? = null, private val alpha: Float, private val shape: Shape, private val inspectorInfo: InspectorInfo.() -&gt; Unit) : ModifierNodeElement&lt;BackgroundNode&gt;() {abstract class ModifierNodeElement&lt;N : Modifier.Node&gt; : Modifier.Element ... åˆæ¯”å¦‚ SizeModifierï¼š 12345678910private class SizeElement( private val minWidth: Dp = Dp.Unspecified, private val minHeight: Dp = Dp.Unspecified, private val maxWidth: Dp = Dp.Unspecified, private val maxHeight: Dp = Dp.Unspecified, private val enforceIncoming: Boolean, private val inspectorInfo: InspectorInfo.() -&gt; Unit) : ModifierNodeElement&lt;SizeNode&gt;() {abstract class ModifierNodeElement&lt;N : Modifier.Node&gt; : Modifier.Element ... åˆæ¯”å¦‚ PaddingModifierï¼š 12345678910private class PaddingElement( var start: Dp = 0.dp, var top: Dp = 0.dp, var end: Dp = 0.dp, var bottom: Dp = 0.dp, var rtlAware: Boolean, val inspectorInfo: InspectorInfo.() -&gt; Unit) : ModifierNodeElement&lt;PaddingNode&gt;() {abstract class ModifierNodeElement&lt;N : Modifier.Node&gt; : Modifier.Element ... ä½ ä¼šå‘ç°å®ƒä»¬çš„æ ¹ç»Ÿç»Ÿéƒ½æ˜¯ Modifier.Element è¿™ä¸ªæ¥å£ã€‚ åƒè¿™ç±»ç›´æ¥å­æ¥å£æˆ–å­ç±»è¿˜æœ‰å“ªäº›å‘¢ï¼Œå¦‚å›¾æ‰€ç¤ºï¼Œè¿™äº›æ¥å£å’Œå­ç±»åŸºæœ¬æ¶µç›–äº† Modifier æ‰€æä¾›çš„æ‰€æœ‰èƒ½åŠ›ã€‚","link":"/2025/08/01/compose/Compose%20--%20Modifier%20--%2001.%20%E8%A7%A3%E6%9E%90%20Modifier%20&%20CombinedModifier/"},{"title":"è§£æ Modifier.layout()","text":"å…¶å®åŸç†æ€§åˆ†æçš„æ–‡ç« ï¼ŒçœŸçš„å¾ˆéš¾è®²çš„é€šä¿—æ˜“æ‡‚ï¼Œè®²çš„ç®€å•æµ…æ˜¾æ²¡å¿…è¦å†™ï¼Œè®²çš„ç¹çéš¾æ‡‚å¾€å¾€å¤§å®¶ä¹Ÿä¸ä¹æ„çœ‹ï¼Œæ‰€ä»¥æ€ä¹ˆæ‰¾ä¸ªå¥½çš„è§’åº¦æ…¢æ…¢é’»è¿›å»å°¤ä¸ºé‡è¦ï¼Œæ¯”å¦‚ï¼šBegin simple codeï¼ åŸºäº androidx.compose.runtime:runtime:1.7.1 ç‰ˆæœ¬ Simple Code ä¸€ä¸ª Text()å…ˆæ¥çœ‹ä¸€æ®µæœ€ç®€å•çš„ä»£ç ç¤ºä¾‹ï¼š 123456789101112class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { ComposeBlogTheme { Box(Modifier.background(Color.Green)) { Text(&quot;Hi Compose&quot;) } } } }} è¿™æ®µä»£ç å¾ˆç®€å•ï¼Œæ•ˆæœå›¾å¦‚ä¸‹ï¼š æ¥ä¸‹æ¥åŸºäºè¿™ä¸ª Demoï¼Œæˆ‘ä»¬ä¼šæ…¢æ…¢å¼•å…¥æœ¬ç¯‡æ–‡ç« çš„ä¸»è§’ã€‚ Modifier.layout()åœ¨ Compose ä¸­ Modifier.layout() æ˜¯ä¸€ç§ã€Œå¸ƒå±€ä¿®é¥°ç¬¦ã€ï¼šâ¤µï¸å®ƒä¼šåŒ…è£¹ä¸€ä¸ªå¸ƒå±€èŠ‚ç‚¹ï¼šLayoutNodeï¼ˆä»€ä¹ˆæ˜¯ LayoutNodeï¼Œä¸‹é¢ä¼šè®²ï¼‰ï¼Œâ¤µï¸é€šå¸¸ç”¨ä½œå¯¹ç›®æ ‡ç»„ä»¶ã€Œè¿›è¡Œæµ‹é‡ã€å’Œã€Œä½ç½®æ‘†æ”¾ã€çš„ã€‚ è®²çš„æ›´ç›´ç™½ä¸€ç‚¹å°±æ˜¯ï¼šâ¤µï¸ä½ å¯ä»¥ç”¨ Modifier.layout() æ¥ã€Œè‡ªå®šä¹‰ç›®æ ‡ç»„ä»¶çš„æµ‹é‡è¿‡ç¨‹ã€ä»¥åŠã€Œå†³å®šç›®æ ‡ç»„ä»¶æ€ä¹ˆæ‘†æ”¾ã€ã€‚ æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹åœ¨ä»£ç ä¸­æ€ä¹ˆä½¿ç”¨ï¼Œé€šå¸¸ä¼šåƒä¸‹é¢è¿™æ ·å†™ï¼š 1234567891011121314class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { ComposeBlogTheme { Box(Modifier.background(Color.Green)) { Text(&quot;Hi Compose&quot;, Modifier.layout { measurable, constraints -&gt; } ) } } } }} å°±è¿™ä¹ˆç®€å•ï¼ŒText å°±æ˜¯ç›®æ ‡ç»„ä»¶ï¼Œæˆ‘ä»¬ç»™å®ƒåŠ äº†ä¸€ä¸ª Modifier.layout()ï¼Œæ²¡æœ‰æ·»åŠ ä»»ä½•å…¶ä»–ä»£ç é€»è¾‘ï¼Œ { measurable, constraints -&gt; } æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œ æ­¤æ—¶ä½ ä¼šå‘ç°åœ¨ Android Studio IDLE ä¸­ï¼Œè¿™æ ·å†™æ˜¯ä¼šæ ‡çº¢çš„ï¼š æ­£å¸¸æ¥è¯´ï¼Œæˆ‘è¿™é‡Œä»€ä¹ˆä¹Ÿä¸å¡«ä¸å°±ç›¸å½“äºå¯¹ Text() ä¸åšä»»ä½•ä¿®é¥°å—ï¼Ÿä½†å¾ˆæ˜æ˜¾è¿™æ ·æ˜¯ä¸è¡Œçš„ï¼Œä»£ç å·²ç»æŠ¥é”™äº†ï¼ æ¥ä¸‹æ¥æˆ‘ä»¬ä¸€èµ·å°è¯•è§£å†³è¿™ä¸ªæŠ¥é”™ï¼ é¦–å…ˆæˆ‘ä»¬å‘ç°å½“ä½¿ç”¨ Modifier.layout{} ä¿®é¥°ç¬¦æ—¶ï¼Œä¼ å…¥çš„å›è°ƒ lambda åŒ…å«äº†ä¸¤ä¸ªå‚æ•°ï¼š measurable ï¼šç”¨äºå­å…ƒç´ çš„æµ‹é‡å’Œä½ç½®æ”¾ç½®ï¼› constraints ï¼šç”¨äºçº¦æŸå­å…ƒç´  width å’Œ height çš„æœ€å¤§å€¼å’Œæœ€å°å€¼ã€‚ æˆ‘ä»¬å®šä½åˆ° Modifier.layout() çš„æºç ï¼š 12345ğŸ“„ androidx.compose.ui.layout --&gt; LayoutModifier.ktfun Modifier.layout( measure: MeasureScope.(Measurable, Constraints) -&gt; MeasureResult) = this then LayoutElement(measure) å‘ç°æ²¡ï¼Ÿmeasurable å¯¹åº”çš„æ˜¯ Measurableï¼š 12345678910ğŸ“„ androidx.compose.ui.layout --&gt; Measurable.ktinterface Measurable : IntrinsicMeasurable { /** * Measures the layout with [constraints], returning a [Placeable] layout that has its new * size. A [Measurable] can only be measured once inside a layout pass. */ // è¿”å›ä¸€ä¸ª Placeableï¼Œå®ƒé‡Œé¢åŒ…å«ç›®æ ‡ç»„ä»¶çš„å®½ã€é«˜ç­‰ä¿¡æ¯ fun measure(constraints: Constraints): Placeable} Measurable æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå†…éƒ¨ä»…æœ‰ä¸€ä¸ª measure() æ–¹æ³•ã€‚ æ‰€ä»¥ç°åœ¨å¯ä»¥å¼€å§‹ä¿®æ”¹åˆšæ‰çš„æŠ¥é”™äº†ï¼š 1234567891011121314151617class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { ComposeBlogTheme { Box(Modifier.background(Color.Green)) { Text(&quot;Hi Compose&quot;, Modifier.layout { measurable, constraints -&gt; // ç”¨ä¸€ä¸ªå˜é‡ä¿å­˜è¿”å›çš„ Placeable å¯¹è±¡ val placeable = measurable.measure(constraints) } ) } } } }} ç°åœ¨ä»£ç ä»ç„¶æ˜¯æ ‡çº¢æŠ¥é”™çš„ï¼ŒåŸå› åœ¨äºï¼šæˆ‘ä»¬åªå¤„ç†äº† measurableï¼Œå®ƒè¿”å›çš„æ˜¯ Placeableï¼Œè€Œ Modifier.layout() éœ€è¦è¿”å›çš„ç±»å‹æ˜¯ MeasureResultï¼š 123fun Modifier.layout( measure: MeasureScope.(Measurable, Constraints) -&gt; MeasureResult // éœ€è¦è¿”å› MeasureResult) = this then LayoutModifierElement(measure) æ‰€ä»¥ MeasureResult åˆæ˜¯ä»€ä¹ˆï¼Ÿ 12345678ğŸ“„ androidx.compose.ui.layout --&gt; MeasureResult.ktinterface MeasureResult { val width: Int val height: Int val alignmentLines: Map&lt;AlignmentLine, Int&gt; fun placeChildren()} MeasureResult ä¹Ÿæ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒé‡Œé¢ä¹Ÿæœ‰ width å’Œ heightï¼Œç»§ç»­ä¿®å¤åˆšæ‰çš„æŠ¥é”™ï¼š 1234567891011121314151617181920212223242526class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { ComposeBlogTheme { Text(&quot;ComposeTest&quot;, Modifier.layout { measurable, constraints -&gt; val placeable = measurable.measure(constraints) object : MeasureResult { override val alignmentLines: Map&lt;AlignmentLine, Int&gt; get() = TODO(&quot;Not yet implemented&quot;) override val height: Int get() = TODO(&quot;Not yet implemented&quot;) override val width: Int get() = TODO(&quot;Not yet implemented&quot;) override fun placeChildren() { TODO(&quot;Not yet implemented&quot;) } } } ) } } }} æ—¢ç„¶ Modifier.layout() éœ€è¦ä¸€ä¸ª MeasureResult è¿”å›å¯¹è±¡ï¼Œé‚£æˆ‘ä»¬å°±åœ¨å†…éƒ¨ç»™å®ƒåˆ›å»ºä¸€ä¸ª MeasureResult å¯¹è±¡ï¼Œæ­¤æ—¶ IDLE å°±ä¸ä¼šå†æŠ¥é”™äº†ã€‚ å½“ç„¶æˆ‘ä»¬è¿˜éœ€è¦åšä¸€ä¸ªå·¥ä½œï¼Œé‚£å°±æ˜¯æŠŠ placeable çš„å®½é«˜ä¼ è¿› MeasureResult å†…éƒ¨ï¼Œæ‰€ä»¥æœ€ç»ˆçš„ä»£ç ä¿®æ”¹å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { ComposeBlogTheme { Box(Modifier.background(Color.Green)) { Text(&quot;Hi Compose&quot;, Modifier.layout { measurable, constraints -&gt; val placeable = measurable.measure(constraints) object : MeasureResult { // æµ‹é‡åŸºå‡†çº¿ï¼Œæš‚æ—¶ä¸ç”¨å…³å¿ƒ override val alignmentLines: Map&lt;AlignmentLine, Int&gt; get() = TODO(&quot;Not yet implemented&quot;) // é«˜ï¼šplaceable.height override val height: Int get() = placeable.height // å®½ï¼šplaceable.width override val width: Int get() = placeable.width // æ‘†æ”¾å†…éƒ¨ç»„ä»¶ï¼Œæš‚æ—¶ä¸ç”¨å…³å¿ƒ override fun placeChildren() { TODO(&quot;Not yet implemented&quot;) } } } ) } } } }} è‡³æ­¤æŠ¥é”™å°±ä¿®å¤äº†ï¼Œä¸Šé¢çš„ä»£ç æ¼”ç¤ºäº†å¯¹ Text() æ·»åŠ  Modifier.layout() è¿›è¡Œä¿®é¥°ï¼ˆå½“ç„¶ä¸Šé¢çš„åšæ³•ç­‰åŒäºå•¥ä¹Ÿæ²¡åšï¼‰ã€‚ ä½†è¿™æ®µä»£ç æœ‰ä¸ªç¼ºé™·ï¼šå¦‚æœæ¯æ¬¡é€šè¿‡ Modifier.layout() å¯¹ç»„ä»¶ä¿®é¥°ï¼Œéƒ½å¾—åƒä¸Šé¢è¿™æ ·å†™ä¸€å †ä»£ç ï¼Œé‚£è¿˜ä¸å¾—ç–¯ï¼Ÿ layout() å‡½æ•°å…¶å®åœ¨å®é™…å¼€å‘ä¸­æˆ‘ä»¬å¹¶ä¸ä¼šè¿™ä¹ˆå†™ï¼Œè€Œæ˜¯ä½¿ç”¨ Compose æä¾›ç»™æˆ‘ä»¬çš„ layout() å‡½æ•°ï¼š 1234567891011121314151617181920212223242526272829303132class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { ComposeBlogTheme { Box(Modifier.background(Color.Green)) { Text(&quot;Hi Compose&quot;, Modifier.layout { measurable, constraints -&gt; val placeable = measurable.measure(constraints) /*object : MeasureResult { override val alignmentLines: Map&lt;AlignmentLine, Int&gt; get() = TODO(&quot;Not yet implemented&quot;) override val height: Int get() = TODO(&quot;Not yet implemented&quot;) override val width: Int get() = TODO(&quot;Not yet implemented&quot;) override fun placeChildren() { TODO(&quot;Not yet implemented&quot;) } }*/ layout() { } } ) } } } }} æˆ‘ä»¬æ¥çœ‹ä¸‹ layout() æºç ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940ğŸ“„ androidx.compose.ui.layout --&gt; MeasureScope.ktinterface MeasureScope : IntrinsicMeasureScope { fun layout( width: Int, height: Int, alignmentLines: Map&lt;AlignmentLine, Int&gt; = emptyMap(), placementBlock: Placeable.PlacementScope.() -&gt; Unit ) = layout(width, height, alignmentLines, null, placementBlock) fun layout( width: Int, height: Int, alignmentLines: Map&lt;AlignmentLine, Int&gt; = emptyMap(), rulers: (RulerScope.() -&gt; Unit)? = null, placementBlock: Placeable.PlacementScope.() -&gt; Unit ): MeasureResult { checkMeasuredSize(width, height) return object : MeasureResult { override val width = width override val height = height override val alignmentLines = alignmentLines override val rulers = rulers override fun placeChildren() { // This isn't called from anywhere inside the compose framework. This might // be called by tests or external frameworks. if (this@MeasureScope is LookaheadCapablePlaceable) { placementScope.placementBlock() } else { SimplePlacementScope( width, layoutDirection ).placementBlock() } } } }} å¾ˆæ˜æ˜¾ layout() å‡½æ•°å¸®æˆ‘ä»¬åˆ›å»ºå¥½äº† MeasureResult å¯¹è±¡ï¼ŒåŒæ—¶å®ƒè¿˜å¸®æˆ‘ä»¬å¹²äº†å¦å¤–ä¸¤ä»¶æ²¡åšçš„äº‹ï¼š ç»™ alignmentLines è®¾å®šäº†é»˜è®¤å€¼ï¼› å®ç°äº† placeChildren()ã€‚ æ‰€ä»¥ï¼Œæˆ‘ä»¬ç°åœ¨åªéœ€è¦è¡¥å…¨ layout() å‡½æ•°å‰©ä½™çš„ä¸¤ä¸ªå‚æ•°ï¼šwidth å’Œ heightã€‚ 12345678910111213141516171819class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { ComposeBlogTheme { Box(Modifier.background(Color.Green)) { Text(&quot;Hi Compose&quot;, Modifier.layout { measurable, constraints -&gt; val placeable = measurable.measure(constraints) layout(placeable.width, placeable.height) { } } ) } } } }} è¿™æ ·å†™ä»£ç æ˜¯ä¸æ˜¯ç¬é—´æ„Ÿè§‰æ¸…çˆ½äº†å¾ˆå¤šï¼Ÿä½†å·¥ä½œåˆ°è¿™è¾¹è¿˜æ²¡æœ‰ç»“æŸï¼Œlayout() å‡½æ•°è¿˜æœ‰ç¬¬å››ä¸ªå‚æ•°ï¼Œæ˜¯ä¸€ä¸ª Lambda è¡¨è¾¾å¼ï¼Œä¸»è¦å·¥ä½œæ˜¯å¤„ç†è¢«ä¿®é¥°ç»„ä»¶çš„æ‘†æ”¾è§„åˆ™ï¼Œæ¯”å¦‚åç§»é‡ã€‚ 12345678fun layout( width: Int, height: Int, alignmentLines: Map&lt;AlignmentLine, Int&gt; = emptyMap(), placementBlock: Placeable.PlacementScope.() -&gt; Unit // Lambda è¡¨è¾¾å¼) = object : MeasureResult { ... ...} æˆ‘ä»¬ç»§ç»­å®Œå–„ï¼š 1234567891011121314151617181920class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { ComposeBlogTheme { Box(Modifier.background(Color.Green)) { Text(&quot;Hi Compose&quot;, Modifier.layout { measurable, constraints -&gt; val placeable = measurable.measure(constraints) layout(placeable.width, placeable.height) { // ä¸åšä»»ä½•åç§» placeable.placeRelative(0, 0) } } ) } } } }} ç°åœ¨æ‰€æœ‰å·¥ä½œï¼ˆæµ‹é‡ + æ‘†æ”¾ï¼‰éƒ½å·²å®Œæˆï¼Œè¿è¡Œçœ‹ä¸‹æ•ˆæœï¼š å¯ä»¥çœ‹å‡ºæ¥ï¼Œæ²¡æœ‰ä»»ä½•å˜åŒ–ï¼Œå› ä¸ºæˆ‘ä»¬è™½ç„¶ç”¨ Modifier.layout() å¯¹ Text åšä¿®é¥°ï¼Œä½†å¹¶æ²¡æœ‰å¯¹å®ƒåšä»»ä½•å°ºå¯¸ä¿®æ”¹å’Œä½ç½®åç§»ã€‚ é‚£å¦‚æœæˆ‘ç°åœ¨æƒ³ä¿®æ”¹ Text() çš„å°ºå¯¸ï¼Œè¯¥æ€ä¹ˆåšï¼Ÿ 12345678910111213141516171819class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { ComposeBlogTheme { Box(Modifier.background(Color.Green)) { Text(&quot;Hi Compose&quot;, Modifier.layout { measurable, constraints -&gt; val placeable = measurable.measure(constraints) val size = min(placeable.width, placeable.height) layout(size, size) { placeable.placeRelative(0, 0) } }) } } } }} æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª size å˜é‡ï¼Œé€šè¿‡ min() å‡½æ•°è·å–å®½é«˜æœ€å°å€¼ï¼Œç„¶åé‡æ–°ä¼ å…¥ layout() é‡Œé¢ï¼Œè¿™æ ·å°±ä¼šè·å¾—ä¸€ä¸ªæ­£æ–¹å½¢çš„æ•ˆæœã€‚ å°ºå¯¸ä¿®æ”¹ç¡®å®ç”Ÿæ•ˆäº†ï¼Œæ¥ä¸‹æ¥å†å¢åŠ ä¸€ä¸ªåç§»ï¼š 12345678910111213141516171819class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { ComposeBlogTheme { Box(Modifier.background(Color.Green)) { Text(&quot;Hi Compose&quot;, Modifier.layout { measurable, constraints -&gt; val placeable = measurable.measure(constraints) val size = min(placeable.width, placeable.height) layout(size, size) { placeable.placeRelative(30, 0) } }) } } } }} çœ‹ä¸‹æ•ˆæœï¼š å¦å¤–æœ‰ä¸ªç»†èŠ‚éœ€è¦è¯´æ˜ä¸‹ï¼Œé™¤äº†ä½¿ç”¨ placeRelative å¯¹ç»„ä»¶åç§»å¤–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ place è¿›è¡Œåç§»æ“ä½œï¼Œä¸¤è€…çš„åŒºåˆ«å°±æ˜¯ placeRelative ä¼šè‡ªé€‚åº” RTL å¸ƒå±€ã€‚ è®²åˆ°è¿™é‡Œï¼ŒModifier.layout() ä¿®é¥°ç¬¦å’Œ layout() å‡½æ•°çš„ç”¨æ³•ä½ åº”è¯¥éƒ½æ¸…æ¥šäº†ï¼Œä½†è¿˜æ²¡ç»“æŸï¼Œå‰é¢æˆ‘ä»¬ä¸€ç›´å¿½ç•¥äº†ä¸€ä¸ªå‚æ•°ï¼šconstraintsï¼Œå®ƒæ˜¯ä»€ä¹ˆï¼Ÿ measurable ï¼šç”¨äºå­å…ƒç´ çš„æµ‹é‡å’Œä½ç½®æ”¾ç½®ï¼› constraints ï¼šç”¨äºçº¦æŸå­å…ƒç´  width å’Œ height çš„æœ€å¤§å€¼å’Œæœ€å°å€¼ã€‚ å‰é¢çš„ä¾‹å­å¹¶æ²¡æœ‰å¯¹ constraints åšä»»ä½•ä¿®æ”¹ï¼Œåœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¾€å¾€éœ€è¦é€šè¿‡ constraints å¯¹ç»„ä»¶è¿›è¡Œé™åˆ¶ã€‚ æ¯”å¦‚æˆ‘æƒ³å¯¹ Text() ç»„ä»¶è¿›è¡Œä¸€ä¸ªé™åˆ¶ï¼Œç±»ä¼¼ padding çš„æ•ˆæœï¼Œç»™å®ƒåŠ ä¸€ä¸ª 10dp çš„æœ€å¤§å®½é«˜çš„é™åˆ¶ï¼ˆæœ€å¤§å®½é«˜ç¼©å‡ 10dpï¼‰ã€‚ 12345678910111213141516171819202122class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { ComposeBlogTheme { Box(Modifier.background(Color.Green)) { Text(&quot;Hi Compose&quot;, Modifier.layout { measurable, constraints -&gt; val paddingPx = 10.dp.roundToPx() val placeable = measurable.measure(constraints.copy( maxWidth = constraints.maxWidth - paddingPx * 2, maxHeight = constraints.maxHeight - paddingPx * 2 )) layout(placeable.width + paddingPx * 2, placeable.height + paddingPx * 2) { placeable.placeRelative(paddingPx, paddingPx) } }) } } } }} çœ‹ä¸‹æ•ˆæœï¼š å¾ˆæ˜æ˜¾ï¼Œæˆ‘ä»¬å®ç°çš„æ•ˆæœè·Ÿ Modifier.padding(10.dp) çš„æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œå¦‚æœä½ å»çœ‹çœ‹ Modifier.padding çš„æºç ï¼Œå°±ä¼šå‘ç°å®ƒçš„å†…éƒ¨åŸç†è·Ÿæˆ‘ä»¬ä¾‹å­æ˜¯ä¸€æ ·çš„ã€‚ 1234567@Stablefun Modifier.padding( horizontal: Dp = 0.dp, vertical: Dp = 0.dp) = this then PaddingElement( ... ...) 12345678private class PaddingElement( var start: Dp = 0.dp, var top: Dp = 0.dp, var end: Dp = 0.dp, var bottom: Dp = 0.dp, var rtlAware: Boolean, val inspectorInfo: InspectorInfo.() -&gt; Unit) : ModifierNodeElement&lt;PaddingNode&gt;() { 1234567891011121314151617181920212223242526272829private class PaddingNode( var start: Dp = 0.dp, var top: Dp = 0.dp, var end: Dp = 0.dp, var bottom: Dp = 0.dp, var rtlAware: Boolean) : LayoutModifierNode, Modifier.Node() { override fun MeasureScope.measure( measurable: Measurable, constraints: Constraints ): MeasureResult { val horizontal = start.roundToPx() + end.roundToPx() val vertical = top.roundToPx() + bottom.roundToPx() val placeable = measurable.measure(constraints.offset(-horizontal, -vertical)) val width = constraints.constrainWidth(placeable.width + horizontal) val height = constraints.constrainHeight(placeable.height + vertical) return layout(width, height) { if (rtlAware) { placeable.placeRelative(start.roundToPx(), top.roundToPx()) } else { placeable.place(start.roundToPx(), top.roundToPx()) } } }} LayoutNode æµ…æ é€šè¿‡å‰é¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼š ä¸è®ºæ˜¯ä½¿ç”¨ Modifier.layout() ä¿®é¥°ç¬¦è¿˜æ˜¯ä½¿ç”¨ Compose æä¾›ç»™æˆ‘ä»¬çš„ç°æˆçš„ä¿®é¥°ç¬¦ï¼Œæ¯”å¦‚ï¼šModifier.padding() / Modifier.size()ï¼Œå®ƒä»¬éƒ½ä¼šå¯¹è¢«ä¿®é¥°ç»„ä»¶äº§ç”Ÿç²¾ç»†å½±å“ï¼ˆç»„ä»¶å¤§å°ã€ä½ç½®åç§»ï¼‰ã€‚ ä½†åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä»…ä»…æ˜¯ä» UI æ•ˆæœä¸Šçœ‹åˆ° Modifier.layout() ä¼šå½±å“è¢«ä¿®é¥°ç»„ä»¶ï¼Œä½†æºç åº•å±‚æ˜¯å¦‚ä½•äº§ç”Ÿå½±å“çš„å‘¢ï¼Ÿ è¿™æ‰æ˜¯æˆ‘ä»¬è¿™ç¯‡æ–‡ç« çš„æ ¸å¿ƒä»·å€¼ï¼ æ‰€ä»¥ï¼Œæœ€ç¡¬æ ¸çš„åŸç†éƒ¨åˆ†æ¥äº†ï¼ æˆ‘ä»¬å°±æ‹¿å¸¸ç”¨çš„ Modifier.padding() åˆ†æï¼Œæ¥çœ‹ä¸‹å®ƒçš„æºç  123456789101112131415161718192021222324252627282930313233ğŸ“„ androidx.compose.foundation.layout --&gt; Padding.kt@Stablefun Modifier.padding( start: Dp = 0.dp, top: Dp = 0.dp, end: Dp = 0.dp, bottom: Dp = 0.dp) = this then PaddingElement( start = start, top = top, end = end, bottom = bottom, rtlAware = true, inspectorInfo = { name = &quot;padding&quot; properties[&quot;start&quot;] = start properties[&quot;top&quot;] = top properties[&quot;end&quot;] = end properties[&quot;bottom&quot;] = bottom })private class PaddingElement( var start: Dp = 0.dp, var top: Dp = 0.dp, var end: Dp = 0.dp, var bottom: Dp = 0.dp, var rtlAware: Boolean, val inspectorInfo: InspectorInfo.() -&gt; Unit) : ModifierNodeElement&lt;PaddingNode&gt;() {abstract class ModifierNodeElement&lt;N : Modifier.Node&gt; : Modifier.Element, InspectableValue { è¿™é‡Œæœ‰é—®é¢˜ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ å±‚çº§å…³ç³»éå¸¸æ¸…æ™°ï¼šModifier.padding() è°ƒç”¨ä¸€ä¸ª PaddingElement å¯¹è±¡ï¼Œè€Œ PaddingElement å®ç°äº† ModifierNodeElement ç±»ï¼ˆè¿™æ˜¯ä¸ªèŒƒå‹ç±»ï¼Œå…¶ä¸­åŒ…å«äº† PaddingNodeï¼‰ï¼ŒModifierNodeElement åˆç»§æ‰¿äº† Modifier.Element æ¥å£ã€‚ è¿™ä¸ª LayoutModifier ä¼šè¢« Compose ç”¨äºä¿®æ”¹æµ‹é‡å’Œå¸ƒå±€è¿‡ç¨‹ï¼Œä»è€Œæœ€ç»ˆå½±å“åˆ°ç•Œé¢å…ƒç´ çš„ä½ç½®å’Œå°ºå¯¸ã€‚ æ‰€ä»¥æˆ‘ä»¬çš„é‡ç‚¹å°±æ˜¯è¦ç ”ç©¶ LayoutModifier æ˜¯å¦‚ä½•å½±å“ç»„ä»¶çš„ï¼ ä½†æ˜¯ï¼åœ¨åˆ†æ LayoutModifier åŸç†ä¹‹å‰ï¼Œæœ‰ä¸€ä¸ªæ ¸å¿ƒçŸ¥è¯†ç‚¹æ˜¯å¿…é¡»è¦æå‰äº†è§£çš„ã€‚ è¿™æ®µä»£ç æˆ‘ä»¬å†ç†Ÿæ‚‰ä¸è¿‡äº†å§ï¼š 123456789101112class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { ComposeBlogTheme { Box(Modifier.background(Color.Green)) { Text(&quot;Hi Compose&quot;) } } } }} Box ã€Text è¿™äº›å‡½æ•°åœ¨å®é™…è¿è¡Œçš„æ—¶å€™ï¼Œå…¶å®å¹¶ä¸æ˜¯è¿™äº›å‡½æ•°ç›´æ¥å­˜åœ¨äºå†…å­˜é‡Œé¢ï¼Œè€Œæ˜¯ Compose åˆ©ç”¨è¿™äº›å‡½æ•°åˆ›é€ å‡ºçš„ä¸€äº›å¯¹è±¡å­˜åœ¨äºå†…å­˜é‡Œé¢ï¼Œè¿™ä¸ªå¯¹è±¡å°±æ˜¯ï¼šLayoutNodeï¼Œå®ƒæ‰æ˜¯æœ€åº•å±‚çš„é‚£ä¸ªèŠ‚ç‚¹ï¼Œè¿›è¡Œå®é™…çš„ã€Œ æµ‹é‡ã€å¸ƒå±€ã€ç»˜åˆ¶ã€è§¦æ‘¸åé¦ˆ ã€ç­‰å·¥ä½œï¼Œä½ å¯ä»¥æŸ¥çœ‹ ã€Compose æ˜¯å¦‚ä½•å°†æ•°æ®è½¬æ¢æˆ UI çš„ï¼Ÿã€‘è¿™ç¯‡æ–‡ç« ï¼Œäº†è§£è½¬æ¢çš„æ€ç»´æ¨¡å‹ï¼ æˆ‘ä»¬æ—¢ç„¶æƒ³çŸ¥é“ LayoutModifier æ˜¯å¦‚ä½•ç²¾ç»†å½±å“ Text() ç»„ä»¶ï¼Œé‚£å°±å¾—å…ˆç ”ç©¶æ˜ç™½ Text() è‡ªå·±çš„æµ‹é‡ã€å¸ƒå±€ã€ç»˜åˆ¶çš„åŸç†ï¼Œå› ä¸º LayoutModifier æ˜¯åŒ…ç€è¿™ä¸ª Text() çš„ã€‚ åœ¨ LayoutNode ä¸­ï¼Œæµ‹é‡å’Œå¸ƒå±€æ˜¯ç”± remeasure() å‡½æ•°å’Œ replace() ä¸¤ä¸ªå‡½æ•°å¤„ç†ã€‚ 123456ğŸ“„ androidx.compose.ui.node --&gt; LayoutNode.ktinternal class LayoutNode(..) { internal fun replace() // å¸ƒå±€ internal fun remeasure() // æµ‹é‡} remeasure()æˆ‘ä»¬å…ˆæ¥åˆ†æ remeasure() å‡½æ•°ï¼š 12345678910111213141516171819ğŸ“„ androidx.compose.ui.node --&gt; LayoutNode.ktinternal class LayoutNode(..) { internal fun remeasure( constraints: Constraints? = layoutDelegate.lastConstraints ): Boolean { return if (constraints != null) { if (intrinsicsUsageByParent == UsageByParent.NotUsed) { clearSubtreeIntrinsicsUsage() } // æµ‹é‡å·¥ä½œäº¤ç»™ LayoutNodeLayoutDelegate çš„å†…éƒ¨ç±» MeasurePassDelegate å¤„ç† measurePassDelegate.remeasure(constraints) } else { false } }} LayoutNode å†…éƒ¨è¦å¤„ç†çš„äº‹æƒ…éå¸¸å¤šï¼Œå®ƒæŠŠæµ‹é‡çš„å·¥ä½œäº¤ç»™äº† MeasurePassDelegate æ¥å¤„ç†ã€‚ 123456789101112131415161718192021222324ğŸ“„ androidx.compose.ui.node --&gt; LayoutNodeLayoutDelegate.ktinternal class LayoutNodeLayoutDelegate( private val layoutNode: LayoutNode) { inner class MeasurePassDelegate : Measurable, Placeable(), AlignmentLinesOwner, MotionReferencePlacementDelegate { fun remeasure(constraints: Constraints): Boolean { ... if (layoutNode.measurePending || measurementConstraints != constraints) { ... performMeasure(constraints) // å…³é”®ä»£ç  ... } else { ... } return false } }} è¿™æ®µä»£ç å¾ˆé•¿ï¼Œä½†æˆ‘ä»¬åªéœ€è¦å…³æ³¨ä¸€è¡Œå…³é”®ä»£ç ï¼šperformMeasure(constraints)ã€‚ 1234567891011121314151617181920212223ğŸ“„ androidx.compose.ui.node --&gt; LayoutNodeLayoutDelegate.ktinternal class LayoutNodeLayoutDelegate( private val layoutNode: LayoutNode) { private var performMeasureConstraints = Constraints() private val performMeasureBlock: () -&gt; Unit = { outerCoordinator.measure(performMeasureConstraints) } private fun performMeasure(constraints: Constraints) { ... layoutNode.requireOwner().snapshotObserver.observeMeasureSnapshotReads( layoutNode, affectsLookahead = false, performMeasureBlock // å…³é”®ä»£ç  ) ... }} æˆ‘ä»¬ä»ç„¶åªéœ€è¦å…³æ³¨ï¼šouterCoordinator.measure(performMeasureConstraints)ï¼Œå®ƒæ˜¯åšå®é™…æµ‹é‡å·¥ä½œçš„ã€‚ ç»§ç»­è·Ÿè¸ªï¼š 123456789ğŸ“„ androidx.compose.ui.layout --&gt; Measurable.ktinterface Measurable : IntrinsicMeasurable { /** * Measures the layout with [constraints], returning a [Placeable] layout that has its new * size. A [Measurable] can only be measured once inside a layout pass. */ fun measure(constraints: Constraints): Placeable} What ï¼Ÿï¼Ÿï¼Ÿæ€ä¹ˆæ˜¯ä¸ªæ¥å£å•Šï¼Œæ²¡æœ‰ä»»ä½•å¤„ç†é€»è¾‘å•Šï¼ï¼ï¼ è½¬å¿µä¸€æƒ³ï¼Œæ—¢ç„¶æ˜¯ä¸ªæ¥å£ï¼Œé‚£è‚¯å®šæœ‰å…¶ä»–åœ°æ–¹å®ç°äº†è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥æœä¸€ä¸‹å“ªäº›åœ°æ–¹å®ç°äº†ã€‚ æœ‰ 9 ä¸ªåœ°æ–¹å®ç°äº†ï¼Œä½†å“ªä¸€ä¸ªæ‰æ˜¯æˆ‘ä»¬éœ€è¦çš„å‘¢ï¼Ÿåˆ«æ…Œï¼Œæˆ‘å¸¦ä½ æ‰¾ä¸€ä¸‹ã€‚ æˆ‘ä»¬å¾€å›é€€ï¼Œæ‰¾æ‰¾åˆšæ‰å“ªé‡Œè°ƒç”¨ measure() æ–¹æ³•çš„ï¼Ÿ 1234567891011121314151617181920ğŸ“„ androidx.compose.ui.node --&gt; LayoutNodeLayoutDelegate.ktinternal class LayoutNodeLayoutDelegate( private val layoutNode: LayoutNode) { /** * 2. outerCoordinator ç”±ä¼ è¿›æ¥çš„ layoutNode å‚æ•°å†³å®šï¼Œé‚£ä¹ˆæˆ‘ä»¬å¾—æ‰¾æ‰¾ layoutNode æ˜¯å“ªé‡Œä¼ è¿›æ¥çš„ * è¿™é‡Œè®°ä½ï¼š * a. æ¥ä¸‹æ¥æˆ‘ä»¬å…ˆæ‰¾åˆ°å“ªé‡Œä¼ å…¥äº† layoutNode * b. æ‰¾åˆ°åæˆ‘ä»¬å†çœ‹ layoutNode.nodes.outerCoordinator æ˜¯ä»€ä¹ˆï¼Ÿ */ val outerCoordinator: NodeCoordinator get() = layoutNode.nodes.outerCoordinator private val performMeasureBlock: () -&gt; Unit = { // 1. è¿™é‡Œè°ƒç”¨äº† measure()ï¼Œé‚£ä¹ˆ outerCoordinator æ˜¯ä»€ä¹ˆï¼Ÿ outerCoordinator.measure(performMeasureConstraints) }} ç»§ç»­å›é€€åˆ°ä¸Šä¸€å±‚ï¼š 1234567891011121314151617181920212223ğŸ“„ androidx.compose.ui.node --&gt; LayoutNodeLayoutDelegate.ktinternal class LayoutNodeLayoutDelegate( private val layoutNode: LayoutNode) { inner class MeasurePassDelegate : Measurable, Placeable(), AlignmentLinesOwner { // 2. æˆ‘ä»¬ç»§ç»­å›é€€ fun remeasure(constraints: Constraints): Boolean { ... if (layoutNode.measurePending || measurementConstraints != constraints) { ... // 1. æ²¡æœ‰åœ°æ–¹ä¼ å…¥ layoutNode å•Š performMeasure(constraints) ... } return false } }} ç»§ç»­å›é€€åˆ°ä¸Šä¸€å±‚ï¼š 12345678910111213141516171819202122232425262728293031323334353637ğŸ“„ androidx.compose.ui.node --&gt; LayoutNode.ktinternal class LayoutNode(..) { // 2. é€šè¿‡ layoutDelegate è·å– measurePassDelegateï¼Œé‚£ layoutDelegate æ˜¯ä»€ä¹ˆï¼Ÿ internal val measurePassDelegate get() = layoutDelegate.measurePassDelegate ... // 4. æ¥æ¥æ¥ï¼Œnodes åœ¨è¿™é‡Œï¼ŒNodeChain åˆæ˜¯ä»€ä¹ˆï¼Ÿ internal val nodes = NodeChain(this) /** * 3. LayoutNodeLayoutDelegate(this) çœ‹åˆ°è¿™è¡Œä»£ç ä½ æœ‰æ²¡æœ‰æƒ³èµ·æ¥ä»€ä¹ˆï¼Ÿ * è¿™ä¸ª this ä¸å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„é‚£ä¸ª layoutNode å‚æ•°å˜›ï¼ * ç°åœ¨æˆ‘ä»¬å†çœ‹ä¸‹åˆšåˆšç”¨åˆ°è¿™ä¸ªå‚æ•°çš„åœ°æ–¹ï¼š * * val outerCoordinator: NodeCoordinator * get() = layoutNode.nodes.outerCoordinator * * è¿˜è®°å¾—å§ï¼Ÿç°åœ¨ layoutNode æ‰¾åˆ°äº†ï¼Œæ¥ä¸‹æ¥çœ‹çœ‹ nodes æ˜¯ä»€ä¹ˆï¼Ÿ */ internal val layoutDelegate = LayoutNodeLayoutDelegate(this) internal fun remeasure( constraints: Constraints? = layoutDelegate.lastConstraints ): Boolean { return if (constraints != null) { ... // 1. è¿˜æ˜¯æ²¡æœ‰åœ°æ–¹ä¼ å…¥ layoutNode å•Šï¼Œåˆ«æ€¥ï¼Œæˆ‘ä»¬çœ‹çœ‹ measurePassDelegate æ˜¯ä»€ä¹ˆï¼Ÿ measurePassDelegate.remeasure(constraints) } else { false } }} NodeChainæˆ‘ä»¬å†æ¥çœ‹çœ‹ NodeChain æ˜¯ä»€ä¹ˆï¼Ÿ 123456789101112131415161718192021ğŸ“„ androidx.compose.ui.node --&gt; NodeChain.ktinternal class NodeChain(val layoutNode: LayoutNode) { /** * 2. å†çœ‹è¿™é‡Œï¼Œè€Œ innerCoordinator åˆæ˜¯ InnerNodeCoordinatorï¼ */ internal val innerCoordinator = InnerNodeCoordinator(layoutNode) /** * ä¸å¿˜åˆå¿ƒï¼Œå†æ¬¡æ¬å‡ºä»£ç ï¼š * * val outerCoordinator: NodeCoordinator * get() = layoutNode.nodes.outerCoordinator * * 1. å“¦ï¼ŒåŸæ¥å¦‚æ­¤ï¼š * layoutNode.nodes.outerCoordinator æ˜¯ innerCoordinator */ internal var outerCoordinator: NodeCoordinator = innerCoordinator private set ... ...} ä»£ç è·Ÿè¸ªåˆ°è¿™é‡Œå°±çœŸç›¸æ˜¾ç°äº†ï¼Œåˆ°åº•æ˜¯å“ªä¸ªå®ç°ç±»å¤„ç†äº† measure() æ–¹æ³•ï¼Œä½ ç°åœ¨æ¸…æ¥šäº†å§ï¼Ÿå†æ¥çœ‹ä¸‹åˆšåˆšçš„æˆªå›¾ï¼š æ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬å°±çœ‹çœ‹ InnerNodeCoordinator æ˜¯å¦‚ä½•è´Ÿè´£å…·ä½“æµ‹é‡çš„ï¼š 123456789101112131415161718192021222324252627282930ğŸ“„ androidx.compose.ui.node --&gt; InnerNodeCoordinator.ktinternal class InnerNodeCoordinator( layoutNode: LayoutNode) : NodeCoordinator(layoutNode) { override fun measure(constraints: Constraints): Placeable { @Suppress(&quot;NAME_SHADOWING&quot;) val constraints = if (forceMeasureWithLookaheadConstraints) { lookaheadDelegate!!.constraints } else { constraints } return performingMeasure(constraints) { // before rerunning the user's measure block reset previous measuredByParent for children layoutNode.forEachChild { it.measurePassDelegate.measuredByParent = LayoutNode.UsageByParent.NotUsed } // 2. è¿”å›ä¸€ä¸ª MeasureResult å¯¹è±¡ç»™ replace() å»å¸ƒå±€ measureResult = with(layoutNode.measurePolicy) { // 1. æœ€æ ¸å¿ƒå¤„ï¼šè¿™è¾¹å°±æ˜¯æœ€åº•å±‚å¼€å§‹æµ‹é‡çš„å·¥ä½œäº† measure(layoutNode.childMeasurables, constraints) } onMeasured() this } }} åˆ†æåˆ°è¿™é‡Œï¼Œå…³äºç»„ä»¶è‡ªèº«çš„æµ‹é‡å’Œå¸ƒå±€æµç¨‹å°±è·‘é€šäº†ï¼š æˆ‘ä»¬åœ¨ä»£ç ä¸­æ‰€å†™çš„ Boxã€Text ç­‰ç»„ä»¶å†…éƒ¨ä¼šæœ‰è‡ªå·±è®¾å®šçš„æµ‹é‡æ•°æ®ï¼Œä»–ä»¬åœ¨ä»£ç å®é™…è¿è¡Œè¿‡ç¨‹ä¸­ä¼šè¢« Comopse è½¬æ¢æˆ LayoutNode èŠ‚ç‚¹ï¼ˆåŒ…å«æ‰€æœ‰ç»„ä»¶è‡ªèº«çš„æµ‹é‡æ•°æ®ï¼‰ï¼Œç„¶åä¸€å±‚å±‚å¾€ä¸‹ä¼ ï¼Œæœ€ç»ˆä¼ åˆ° InnerNodeCoordinatorï¼Œç”±å®ƒè¿›è¡Œæœ€åº•å±‚çš„æµ‹é‡å·¥ä½œï¼Œæµ‹é‡å®Œæˆåä¼šè¿”å›ä¸€ä¸ª MeasureResult å¯¹è±¡å†äº¤ç»™ replace() å‡½æ•°å®Œæˆå¸ƒå±€å·¥ä½œã€‚ æ‰€ä»¥ï¼ŒDo you understand? LayoutModifer çš„å·¥ä½œåŸç† å‰é¢æˆ‘ä»¬å·²ç»äº†è§£äº†ç»„ä»¶è‡ªèº«çš„æµ‹é‡å’Œå¸ƒå±€åŸç†ï¼Œç°åœ¨å°±å¯ä»¥å¼€å§‹åˆ†æ LayoutModifer æ˜¯å¦‚ä½•å½±å“ç»„ä»¶çš„æµ‹é‡å’Œå¸ƒå±€äº†ã€‚ å°±åƒæˆ‘ä»¬å‰é¢è¯´çš„é‚£æ ·ï¼Œæ‰€æœ‰ç»„ä»¶æœ€ç»ˆéƒ½ä¼šè¢«è½¬æ¢ä¸ºä¸€ä¸ª LayoutNodeï¼Œè¿™ä¸ª LayoutNode åŒ…å«äº†æ‰€æœ‰çš„æµ‹é‡æ•°æ®ï¼Œé‚£åŒæ ·å®ƒä¹Ÿä¼šåŒ…å«ä½ å¯¹ç»„ä»¶è®¾å®šçš„ Modifierï¼Œæ‰€ä»¥æœ€ç»ˆç»è¿‡ä¸€äº›åˆ—è½¬æ¢ï¼Œä¹Ÿä¼šä¼ åˆ° LayoutNode é‡Œé¢ï¼Œè€Œ LayoutNode é‡Œé¢ä¹Ÿæœ‰ä¸€ä¸ª modifier å˜é‡ï¼Œå­˜å‚¨çš„å°±æ˜¯ä¿®é¥° Composable å‡½æ•°çš„ Modifierã€‚ LayoutNode.Modiferç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹å…·ä½“çš„ä»£ç é€»è¾‘ï¼š 123456789101112131415161718192021222324252627// ğŸ“„ androidx.compose.ui.node --&gt; LayoutNode.ktinternal class LayoutNode(..) { override var modifier: Modifier get() = _modifier // å¦‚æœæœ‰æ–°å€¼å˜åŒ– set(value) { ... if (isAttached) { applyModifier(value) } else { pendingModifier = value } } private fun applyModifier(modifier: Modifier) { _modifier = modifier nodes.updateFrom(modifier) // å…³é”®ä»£ç  layoutDelegate.updateParentData() if (lookaheadRoot == null &amp;&amp; nodes.has(Nodes.ApproachMeasure)) { lookaheadRoot = this } }} è¿™é‡Œçš„ nodes åº”è¯¥ä¸é™Œç”Ÿäº†å§ï¼Ÿå‰ä¸€èŠ‚æˆ‘ä»¬å·²ç»çŸ¥é“äº†å®ƒæ˜¯ NodeChain å¯¹è±¡ã€‚ 1internal val nodes = NodeChain(this) ä½†æ˜¯ NodeChain æ˜¯ä»€ä¹ˆï¼Ÿ å…¶å®å®ƒå°±æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œè€Œä¸”æ˜¯ä¸ªã€ŒåŒå‘é“¾è¡¨ã€ 1234567891011ğŸ“„ androidx.compose.ui.node --&gt; NodeChain.ktinternal class NodeChain(val layoutNode: LayoutNode) { internal val innerCoordinator = InnerNodeCoordinator(layoutNode) internal var outerCoordinator: NodeCoordinator = innerCoordinator private set internal val tail: Modifier.Node = innerCoordinator.tail internal var head: Modifier.Node = tail private set ...} 1. å¤´ã€å°¾èŠ‚ç‚¹éƒ½æ˜¯ Modifier.Node ç±»å‹ï¼ 2. å…¶ä¸­çš„ NodeCoordinator æ˜¯ç”¨æ¥è¾…åŠ© Node èŠ‚ç‚¹å¤„ç†æµ‹é‡å’Œå¸ƒå±€çš„ï¼Œå…¶ä¸­åŒ…å« measure å’Œ placeAt çš„å‡½æ•°é€»è¾‘ã€‚ 3. NodeChain é“¾è¡¨ä¸Šçš„æ¯ä¸€ä¸ª Node éƒ½ä¼šå¯¹åº”çš„ç»‘å®šä¸€ä¸ª NodeCoordinator å¯¹è±¡æ¥è¾…åŠ©å¤„ç†ã€‚ï¼ˆä¸ç†è§£æ²¡å…³ç³»ï¼Œæ¥ç€å¾€ä¸‹çœ‹ï¼ï¼‰ updateFrom()æ¥ä¸‹æ¥çœ‹çœ‹ updateFrom çš„å…·ä½“å·¥ä½œï¼Œå®ƒä¸»è¦è´Ÿè´£ NodeChain é“¾è¡¨çš„ã€Œæ›´æ–°ã€ï¼Œæ¯å½“æœ‰ Modifier å¯¹è±¡è¢«è®¾ç½®åˆ° LayoutNode ä¸Šé¢ï¼Œéƒ½ä¼šè°ƒç”¨ updateFrom å‡½æ•°è¿›è¡Œæ›´æ–°å¯¹åº”çš„ NodeChainã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465ğŸ“„ androidx.compose.ui.node --&gt; NodeChain.ktinternal class NodeChain(val layoutNode: LayoutNode) { // è´Ÿè´£æœ€å†…å±‚æµ‹é‡çš„ NodeCoordinator internal val innerCoordinator = InnerNodeCoordinator(layoutNode) // è´Ÿè´£å¤–å±‚æµ‹é‡çš„ NodeCoordinatorï¼Œåˆå§‹å€¼æ˜¯ InnerNodeCoordinator internal var outerCoordinator: NodeCoordinator = innerCoordinator private set // åŒå‘é“¾è¡¨çš„å°¾èŠ‚ç‚¹ internal val tail: Modifier.Node = innerCoordinator.tail // åŒå‘é“¾è¡¨çš„å¤´èŠ‚ç‚¹ internal var head: Modifier.Node = tail private set ... internal fun updateFrom(m: Modifier) { var coordinatorSyncNeeded = false val paddedHead = padChain() var before = current val beforeSize = before?.size ?: 0 /** * ğŸ“ æ ¸å¿ƒä»£ç  1: * fillVector ä¼šå°† Modifier å±•å¼€é“ºå¹³åˆ°ä¸€ä¸ªæ•°ç»„ï¼Œ * åé¢çš„ä»£ç å°±å¯ä»¥ç”¨è¿™ä¸ªæ•°ç»„éå† */ val after = m.fillVector(buffer ?: mutableVectorOf()) var i = 0 // æ£€æŸ¥æ›´æ–°å·®å¼‚ if (after.size == beforeSize) { ... // è¿™æ®µä»£ç ä¸ç”¨çœ‹ï¼Œåªè¦åŠ äº† Modifier.xx é»˜è®¤ä¸ä¼šèµ°åˆ°è¿™è¾¹ } else if (layoutNode.applyingModifierOnAttach &amp;&amp; beforeSize == 0) { // ç¬¬ä¸€æ¬¡ç»„è£… Modifier.Node åŒå‘é“¾è¡¨ coordinatorSyncNeeded = true var node = paddedHead while (i &lt; after.size) { val next = after[i] val parent = node /** * ğŸ“ æ ¸å¿ƒä»£ç  2: ç»„è£…åŒå‘é“¾è¡¨çš„å…·ä½“é€»è¾‘ */ node = createAndInsertNodeAsChild(next, parent) logger?.nodeInserted(0, i, next, parent, node) i++ } syncAggregateChildKindSet() } else if (after.size == 0) { // åˆ é™¤æ‰€æœ‰ modifier ... } else { ... } current = after buffer = before?.also { it.clear() } /** * ğŸ“ æ ¸å¿ƒä»£ç  3: æ›´æ–°å¤´èŠ‚ç‚¹ */ head = trimChain(paddedHead) if (coordinatorSyncNeeded) { /** * ğŸ“ æ ¸å¿ƒä»£ç  4: å…³è” Modifier.Node å’Œ NodeCoordinator */ syncCoordinators() } }} æ¥ä¸‹æ¥è·Ÿç€æˆ‘æ·±å…¥åˆ†ææ¯ä¸€è¡Œæ ¸å¿ƒä»£ç ï¼å¸Œæœ›ä½ èƒ½æ²‰ä¸‹å¿ƒçœ‹ä¸‹å»ï¼ŒåŒ…æ•™åŒ…ä¼šï¼ ğŸ“ åˆ†è§£ Modifierå…ˆæ¥çœ‹ç¬¬ä¸€ä¸ªæ ¸å¿ƒä»£ç ï¼š 1val after = m.fillVector(buffer ?: mutableVectorOf()) m å°±æ˜¯ä½ çš„ Modifier é“¾ï¼Œè¿™é‡Œçš„ buffer é»˜è®¤ä¸º nullï¼ŒmutableVectorOf() å…¶å®è·Ÿ buffer ä¸€æ ·éƒ½æ˜¯ä¸€ä¸ªå¯å˜åˆ—è¡¨ï¼Œåªæ˜¯å®¹é‡ä¸åŒè€Œå·²ï¼Œä½ åªè¦çŸ¥é“å®ƒå°±æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œç”¨æ¥è£…åˆ†è§£åçš„å•ä¸ª Modifier ç”¨çš„å°±è¡Œäº†ã€‚ æ¥ç€æˆ‘ä»¬å¼€å§‹åˆ†æ fillVector å‡½æ•°ï¼š 123456789101112131415161718192021222324252627282930313233343536ğŸ“„ androidx.compose.ui.node --&gt; NodeChain.ktprivate fun Modifier.fillVector( result: MutableVector&lt;Modifier.Element&gt;): MutableVector&lt;Modifier.Element&gt; { val capacity = result.size.coerceAtLeast(16) /** * 1. åˆ›å»ºä¸€ä¸ªå…ƒç´ ä¸º Modifier çš„å¯å˜åˆ—è¡¨ï¼Œå¹¶åœ¨åˆå§‹åŒ–åæ·»åŠ ä¼ è¿›æ¥çš„ Modifierï¼Œ * ä» stack åå­—å°±å¯ä»¥çœ‹å‡ºæ¥ï¼Œè¿™é‡Œç›¸å½“äºåˆ›å»ºäº†ä¸€ä¸ªæ ˆï¼Œå¹¶ä¸”å®¹é‡ä¸º 16 */ val stack = MutableVector&lt;Modifier&gt;(capacity).also { it.add(this) } var predicate: ((Modifier.Element) -&gt; Boolean)? = null // 2. åªè¦æ ˆä¸ä¸ºç©ºï¼Œä¸€ç›´å¾ªç¯ while (stack.isNotEmpty()) { // 3. ä»æ ˆä¸­ç§»é™¤å¹¶è·å–æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå­˜åˆ° next å˜é‡ä¸­ when (val next = stack.removeAt(stack.size - 1)) { // 4. å¦‚æœ next æ˜¯ CombinedModifier ç±»å‹ is CombinedModifier -&gt; { stack.add(next.inner) // æŠŠ inner éƒ¨åˆ†åŠ å…¥åˆ° stack ä¸­ stack.add(next.outer) // æŠŠ outer éƒ¨åˆ†åŠ å…¥åˆ° stack ä¸­ } // 5. å¦‚æœ next æ˜¯ Modifier.Element ç±»å‹ï¼Œåˆ™ç›´æ¥åŠ åˆ° result ä¸­ is Modifier.Element -&gt; result.add(next) /** * 6. å¦‚æœ next æ˜¯ Modifier çš„å…¶ä»–å®ç°ï¼Œå¯èƒ½æˆ‘ä»¬ä¸çŸ¥é“å…·ä½“å®ç°ç»†èŠ‚ï¼Œ * æŠŠ itï¼ˆå¯èƒ½æ˜¯ Modifier.Element çš„å®ä¾‹ï¼‰åŠ å…¥åˆ° result ä¸­ */ else -&gt; next.all(predicate ?: { element: Modifier.Element -&gt; result.add(element) true }.also { predicate = it }) } } // 7. åœ¨å¤„ç†å®Œæ‰€æœ‰çš„å…ƒç´ ä¹‹åï¼Œè¿”å› resultï¼Œå®ƒåŒ…å«äº†æ‰€æœ‰çš„ Modifier.Element return result} è¿™ä¸ªå‡½æ•°å…¶å®å°±æ˜¯åˆ›å»ºäº†ä¸€ä¸ª Modifier è°ƒç”¨æ ˆï¼Œä»¥ä¾¿å¯ä»¥è¿­ä»£åœ°å¤„ç†ä¸€ä¸ªå¯èƒ½åµŒå¥—çš„ Modifier ç»“æ„ã€‚æ ˆçš„ä½¿ç”¨æ˜¯ä¸ºäº†åœ¨ä¸ä½¿ç”¨é€’å½’çš„æƒ…å†µä¸‹æ‰å¹³åŒ–ä¿®é¥°ç¬¦çš„ç»“æ„ã€‚ æ³¨æ„ï¼ä» 1.3.0-beta01 ç‰ˆæœ¬å¼€å§‹ï¼ŒCompose ä¸­ä¸å†ä½¿ç”¨ foldIn/foldOut å‡½æ•°å¯¹ Modifier è¿›è¡Œéå†äº†ï¼Œåœ¨ 1.3.0-beta01 ä¹‹å‰çš„ç‰ˆæœ¬ LayoutNode æºç ä¸­æ˜¯é€šè¿‡ foldOut éå† + å¤´æ’æ³•å¤„ç†ï¼Œè€Œç°åœ¨æ˜¯é€šè¿‡ fillVector å‡½æ•°å¤„ç†è¾¾åˆ°ç±»ä¼¼çš„æ•ˆæœã€‚ çœ‹çš„æ‡‚å—ï¼Ÿæ˜¯ä¸æ˜¯å¾ˆæ‡µï¼Ÿæˆ‘ä»¬æ¥ä¸ªå®é™…ä¾‹å­å§ï¼Œæ¯”å¦‚ä¼ å…¥çš„ Modifier é“¾å¦‚ä¸‹ï¼š 1234567891011// è¿™æ˜¯ä½ å†™çš„ä»£ç Box(Modifier.padding(10.dp).size(20.dp))// æ­¤æ—¶ Modifier é“¾ä¸º:modifierChain = Modifier.padding(10.dp).size(20.dp)// å®é™…çš„ç»“æ„ï¼šCombinedModifier( PaddingElement // outer SizeElement // inner) æˆ‘ä»¬æ¥çœ‹çœ‹ fillVector æ˜¯æ€ä¹ˆå¤„ç†å®ƒçš„ï¼š &nbsp;&nbsp;&nbsp;&nbsp;â¡ï¸ 1. å½“è°ƒç”¨ fillVector å‡½æ•°æ—¶ï¼Œåˆå§‹çŠ¶æ€æ˜¯ modifierChain æ”¾å…¥äº†ä¸€ä¸ªç©ºçš„ stack ä¸­ã€‚ &nbsp;&nbsp;&nbsp;&nbsp;â¡ï¸ 2. æ­¤æ—¶ stack ä¸ä¸ºç©ºï¼Œå¼€å§‹å¾ªç¯ï¼š &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ğŸ”¸ removeAt ä» stack çš„æœ«å°¾ï¼ˆæœ€ååŠ å…¥çš„å…ƒç´ ï¼‰ç§»é™¤ CombinedModifierï¼ˆå› ä¸ºå®ƒæ˜¯é“¾ä¸­æœ€åä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œå¹¶å°†å…¶èµ‹å€¼ç»™ nextã€‚ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ğŸ”¸ next æ˜¯ä¸€ä¸ª CombinedModifier å®ä¾‹ï¼Œæ­¤æ—¶å°±æŠŠ inner å’Œ outer åˆ†åˆ«åŠ è¿› stack ä¸­ï¼Œè¿™ä¸ªæ—¶å€™ stack é‡Œé¢å°±æœ‰äº†ä¸¤ä¸ªå…ƒç´ ï¼š[SizeElement, PaddingElement]ã€‚ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ğŸ”¸ å†æ¬¡å¾ªç¯ï¼Œè¿™ä¸ªæ—¶å€™å†æ¬¡å¼€å§‹ removeAt ä»æœ«å°¾å–ï¼Œå…ˆå–åˆ° PaddingElementï¼Œæ¡ä»¶åˆ¤æ–­å‘ç°å®ƒæ˜¯ä¸€ä¸ª Modifier.Elementï¼Œé‚£å°±æŠŠå®ƒåŠ è¿› result é‡Œé¢ï¼ˆresult ä¹Ÿæ˜¯ä¸€ä¸ªå¯å˜åˆ—è¡¨ï¼‰ã€‚ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ğŸ”¸ ç»§ç»­å¾ªç¯ï¼Œåˆå–åˆ°äº† SizeElementï¼Œå‘ç°å®ƒä¹Ÿæ˜¯ä¸€ä¸ª Modifier.Elementï¼Œé‚£å°±ç›´æ¥åŠ è¿› result é‡Œé¢ã€‚ &nbsp;&nbsp;&nbsp;&nbsp;â¡ï¸ 3. ç»§ç»­å¾ªç¯ï¼Œå•ªï½ stack æ²¡ä¸œè¥¿äº†ï¼Œå¾ªç¯ç»“æŸï¼Œç›´æ¥è¿”å› result ç»“æœï¼š[PaddingElement, SizeElement]ã€‚ è¿™æ®µæµç¨‹æˆ‘ç»™ä½ ç”»äº†å¼ å›¾ï¼š ğŸ“ æ„å»ºåŒå‘é“¾è¡¨ç°åœ¨æˆ‘ä»¬æ¥åˆ†æç¬¬äºŒæ®µæ ¸å¿ƒä»£ç ï¼š 123456789101112131415// NodeChain.kt} else if (layoutNode.applyingModifierOnAttach &amp;&amp; beforeSize == 0) { // ç¬¬ä¸€æ¬¡ç»„è£… Modifier.Node åŒå‘é“¾è¡¨ coordinatorSyncNeeded = true var node = paddedHead ğŸŸ¡ 1. node åˆå§‹å€¼æ˜¯ä»€ä¹ˆï¼Ÿ while (i &lt; after.size) { ğŸŸ¡ 2. after æ˜¯ä»€ä¹ˆï¼Ÿ val next = after[i] val parent = node // ğŸ“ æ ¸å¿ƒä»£ç  2: ç»„è£…åŒå‘é“¾è¡¨çš„å…·ä½“é€»è¾‘ node = createAndInsertNodeAsChild(next, parent) logger?.nodeInserted(0, i, next, parent, node) i++ } syncAggregateChildKindSet()} æˆ‘ä»¬å…ˆæ¥çœ‹ nodeï¼Œå®ƒæ˜¯ paddedHeadï¼š 1val paddedHead = padChain() æ¥çœ‹ä¸‹ padChain() åšäº†ä»€ä¹ˆï¼š 123456789101112// NodeChain.ktinternal val tail: Modifier.Node = innerCoordinator.tailinternal var head: Modifier.Node = tail private set private fun padChain(): Modifier.Node { checkPrecondition(head !== SentinelHead) { &quot;padChain called on already padded chain&quot; } val currentHead = head currentHead.parent = SentinelHead SentinelHead.child = currentHead return SentinelHead} è¿™ä¸ªæ—¶å€™ head é»˜è®¤æ˜¯ tailï¼Œå…¶å®å°±æ˜¯ç»„ä»¶æœ¬èº«ï¼šBoxã€‚ SentinelHead æ˜¯ä»€ä¹ˆï¼Ÿå®ƒæœ€ä¸»è¦çš„ä½œç”¨å°±æ˜¯ä½œä¸ºä¸€ä¸ªå“¨å­èŠ‚ç‚¹ï¼Œç®€åŒ–é“¾è¡¨æ“ä½œç”¨çš„ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠå®ƒç†è§£ä¸ºåœ¨ Box è¿™ä¸ª Modifier.Node èŠ‚ç‚¹å‰é¢æ’å…¥ä¸€ä¸ªå“¨å­èŠ‚ç‚¹ï¼Œå®ƒä»¬å½¼æ­¤æ„æˆä¸€ä¸ªåŒå‘é“¾è¡¨ã€‚ after ï¼Œå®ƒå°±æ˜¯å…ˆå‰ result è¿”å›çš„ç»“æœï¼Œå³ï¼š[PaddingElement, SizeElement]ï¼Œæ‰€ä»¥ next ä¼šè½®æµå–åˆ°è¿™ä¸¤ä¸ª Modifier è¿›è¡Œè¿›ä¸€æ­¥çš„æ“ä½œã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬æ¥åˆ†æ createAndInsertNodeAsParent å‡½æ•°ï¼š 123456789101112131415161718// NodeChain.ktprivate fun createAndInsertNodeAsChild( element: Modifier.Element, parent: Modifier.Node,): Modifier.Node { // 1. åˆ›å»ºä¸€ä¸ªæ–°çš„èŠ‚ç‚¹ val node = when (element) { // 2. å¦‚æœ element æ˜¯ ModifierNodeElement çš„å®ä¾‹ï¼Œå®ƒä¼šè°ƒç”¨ element ä¸Šçš„ create æ–¹æ³•ï¼Œ // è¿™ä¸ªæ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªæ–°çš„ Modifier.Node is ModifierNodeElement&lt;*&gt; -&gt; element.create().also { it.kindSet = calculateNodeKindSetFromIncludingDelegates(it) } else -&gt; BackwardsCompatNode(element) } ... // 3. æ’å…¥åˆ°æ ‘ä¸­ return insertChild(node, parent)} æˆ‘ä»¬é‡ç‚¹æ¥çœ‹ä¸€ä¸‹ when() å†…éƒ¨çš„æ“ä½œï¼š é¦–å…ˆå–åˆ°çš„æ˜¯ PaddingElementï¼Œå®ƒæ˜¯ ModifierNodeElement çš„å®ç°ç±»ï¼Œæ‰€ä»¥æ»¡è¶³æ¡ä»¶ï¼Œæ¥ç€è°ƒç”¨ create() æ–¹æ³•ï¼Œä¼šæŠŠ PaddingElement åŒ…è£…æˆä¸€ä¸ª Modifier.Nodeã€‚ ç°åœ¨å·²ç»å¾—åˆ°äº†ä¸€ä¸ª Modifier.Nodeï¼Œæ¥ç€æŠŠå®ƒæ’å…¥æ ‘ä¸­ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹æ“ä½œï¼š 1234567891011121314// NodeChain.ktprivate fun insertChild(node: Modifier.Node, parent: Modifier.Node): Modifier.Node { // 1. parent å°±æ˜¯å“¨å­èŠ‚ç‚¹ï¼Œæ‰€ä»¥ theChild å°±æ˜¯ Box å¯¹åº”çš„ Modifier.Node val theChild = parent.child if (theChild != null) { // 2. node æ˜¯ä¼ è¿›æ¥çš„ PaddingNodeï¼Œå°†ä¸¤ä¸ª Modifier.Node å»ºç«‹åŒå‘é“¾è¡¨å…³ç³» theChild.parent = node node.child = theChild } // 3. å†æŠŠå“¨å­èŠ‚ç‚¹è·Ÿä¼ è¿›æ¥çš„ PaddingNode æ„å»ºåŒå‘é“¾è¡¨å…³ç³» parent.child = node node.parent = parent return node} èƒ½ç†è§£å—ï¼Ÿæˆ‘ä¹Ÿç»™ä½ ç”»äº†å¼ å›¾ï¼š ç°åœ¨å·²ç»å¤„ç†å®Œäº† PaddingElementï¼Œå¾ªç¯å–å€¼ï¼Œæ‹¿å‡ºç¬¬äºŒä¸ª SizeElementï¼Œç»§ç»­å¤„ç†ï¼Œæµç¨‹æˆ‘å°±ä¸å†™äº†ç›´æ¥çœ‹å›¾ï¼š è‡³æ­¤ï¼Œç¬¬äºŒéƒ¨æ„å»ºåŒå‘é“¾è¡¨çš„å·¥ä½œå°±ç»“æŸäº†ï¼Œä½ å‘ç°æ²¡æœ‰ï¼Œè™½ç„¶å…ˆå¤„ç†äº† PaddingElementï¼Œåå¤„ç†äº† SizeElementï¼Œä½†å®é™…ä¸Šæ˜¯æŠŠ SizeElement æ’å…¥åˆ°äº† PaddingElement å†…éƒ¨ï¼Œè¿™å…¶å®å°±è·Ÿè€ç‰ˆæœ¬çš„ foldIn ä»å°¾éƒ¨ä¾¿åˆ©ç„¶åå¤´æ’çš„æ–¹å¼ä¸€æ ·ï¼Œå®ç°äº†åŒæ ·çš„åŠŸèƒ½ã€‚ ğŸ“ æ›´æ–°å¤´èŠ‚ç‚¹ç¬¬äºŒæ®µæ ¸å¿ƒä»£ç å·²ç»æ„å»ºå¥½äº†åŒå‘é“¾è¡¨ï¼Œä½†å¦‚æœä½ çœ‹è¿‡è€ç‰ˆæœ¬çš„ä»£ç ä¼šå‘ç°ï¼Œä»¥å‰æ˜¯æ²¡æœ‰ SentineHead è¿™ä¸ªå“¨å­èŠ‚ç‚¹çš„ï¼Œç›®å‰çš„åŒå‘é“¾è¡¨çš„å¤´èŠ‚ç‚¹æ˜¯ SentineHeadï¼Œå®ƒå¹¶æ²¡æœ‰å®é™…çš„åŠŸèƒ½ä¸Šçš„ç”¨å¤„ï¼Œæ‰€ä»¥è¿™å°±æ˜¯ç¬¬ä¸‰æ­¥æ ¸å¿ƒä»£ç è¦åšçš„äº‹ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ï¼š 12345678910111213141516// NodeChain.ktprivate fun trimChain(paddedHead: Modifier.Node): Modifier.Node { checkPrecondition(paddedHead === SentinelHead) { &quot;trimChain called on already trimmed chain&quot; } // 1. å– SentineHead çš„å­èŠ‚ç‚¹ï¼Œæœ‰å—ï¼Ÿæœ‰ -- å°±æ˜¯ PaddingNode val result = SentinelHead.child ?: tail // 2. æ–­å¼€ SentineHead ä¸ PaddingNode ä¹‹é—´çš„é“¾ result.parent = null SentinelHead.child = null SentinelHead.aggregateChildKindSet = 0.inv() SentinelHead.updateCoordinator(null) checkPrecondition(result !== SentinelHead) { &quot;trimChain did not update the head&quot; } // 3. è¿”å›é“¾ï¼Œæ­¤æ—¶é“¾å°±å®Œå…¨æ˜¯ä¸€ä¸ªç”±ç»„ä»¶è‡ªèº«çš„ Node å’Œ Modifier çš„ Node ç»„æˆçš„åŒå‘é“¾è¡¨äº† return result} ä»£ç å¾ˆç®€å•ï¼Œå°±æ˜¯æŠŠ SentineHead ä»åŒå‘é“¾è¡¨ä¸­æ–­å¼€å»é™¤ï¼Œè¿™æ ·å°±æ˜¯ä¸€ä¸ªæ–°çš„ä»¥ PaddingModifier ä¸ºè¡¨å¤´çš„åŒå‘é“¾è¡¨äº†ã€‚ ğŸ“ åŒæ­¥åè°ƒå™¨æˆ‘ä»¬å‰é¢æåˆ°è¿‡ï¼šNodeCoordinator æ˜¯ç”¨æ¥è¾…åŠ© Node èŠ‚ç‚¹å¤„ç†æµ‹é‡å’Œå¸ƒå±€çš„ï¼Œå…¶ä¸­åŒ…å« measure å’Œ placeAt çš„å‡½æ•°é€»è¾‘ã€‚NodeChain é“¾è¡¨ä¸Šçš„æ¯ä¸€ä¸ª Node éƒ½ä¼šå¯¹åº”çš„ç»‘å®šä¸€ä¸ª NodeCoordinator å¯¹è±¡æ¥è¾…åŠ©å¤„ç†ã€‚ ç°åœ¨ NodeChain é“¾è¡¨å·²ç»å…¨éƒ¨æå®šäº†ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±è¦å¼€å§‹å¯¹é“¾è¡¨ä¸Šæ¯ä¸€ä¸ª Modifier.Node ç»‘å®šä¸€ä¸ª NodeCoordinatorï¼Œç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹ syncCoordinator å‡½æ•°æ˜¯æ€ä¹ˆåšçš„ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849// NodeChain.ktprivate fun syncCoordinators() { var coordinator: NodeCoordinator = innerCoordinator // tail å°±æ˜¯é“¾è¡¨çš„å°¾éƒ¨èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯ç»„ä»¶è‡ªèº«çš„ Modifier.Node // å¼€å§‹éå†ï¼Œè·å–å®ƒçš„çˆ¶èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯ tail -&gt; SizeNode -&gt; PaddingNode var node: Modifier.Node? = tail.parent while (node != null) { // åˆ¤æ–­ Modifier.Node å°±æ˜¯ä¸æ˜¯ LayoutModifierNode val layoutmod = node.asLayoutModifierNode() // å¦‚æœæ˜¯ LayoutModifierNode if (layoutmod != null) { // å¦‚æœèŠ‚ç‚¹å·²æœ‰å…³è”çš„ coordinatorï¼Œåˆ™ä½¿ç”¨ç°æœ‰çš„åè°ƒå™¨ï¼ŒåŒæ—¶åˆ¤æ–­æ­¤åè°ƒå™¨æ‰€å…³è”çš„èŠ‚ç‚¹æ˜¯å¦å˜åŒ–äº†ï¼Œ // å¦‚æœæœ‰å˜åŒ–ï¼Œåˆ™è°ƒç”¨ onLayoutModifierNodeChanged() æ–¹æ³• val next = if (node.coordinator != null) { val c = node.coordinator as LayoutModifierNodeCoordinator val prevNode = c.layoutModifierNode c.layoutModifierNode = layoutmod if (prevNode !== node) c.onLayoutModifierNodeChanged() c } else { // å¦‚æœèŠ‚ç‚¹æ²¡æœ‰å…³è”çš„ coordinatorï¼Œåˆ™åˆ›å»ºä¸€ä¸ª LayoutModifierNodeCoordinatorï¼Œ // å¹¶é€šè¿‡ updateCoordinator æ–¹æ³•å°†è¿™ä¸ªæ–°åè°ƒå™¨å’ŒèŠ‚ç‚¹ç›¸å…³è” val c = LayoutModifierNodeCoordinator(layoutNode, node) node.updateCoordinator(c) c } // ä¸è®ºæ˜¯ä½¿ç”¨æ—§çš„è¿˜æ˜¯æ–°å»ºçš„ coordinatorï¼Œé€šè¿‡è®¾ç½® wrappedBy å’Œ wrapped å±æ€§ï¼Œ // å»ºç«‹å½“å‰ coordinator ä¸ä¸‹ä¸€ä¸ª coordinator çš„åŒ…è£…å…³ç³»ï¼Œ // ç„¶åå°† coordinator å˜é‡æ›´æ–°ä¸ºä¸‹ä¸€ä¸ª coordinator // ä¾‹å¦‚æˆ‘ä»¬è¿™è¾¹çš„ä¾‹å­ï¼štail -&gt; SizeNode coordinator.wrappedBy = next // InnerCoordinator è¢«è°åŒ…è£¹ï¼Ÿ-- LayoutModifierNodeCoordinator next.wrapped = coordinator // LayoutModifierNodeCoordinator åŒ…è£¹äº†è°ï¼Ÿ-- InnerCoordinator coordinator = next // æ›´æ–° coordinatorï¼Œæ¯”å¦‚åé¢å†è·Ÿ PaddingNode å»ºç«‹åŒ…è£¹å…³ç³» } else { // å¦‚æœ node ä¸æ˜¯å¸ƒå±€ä¿®é¥°ç¬¦èŠ‚ç‚¹ï¼Œç›´æ¥è°ƒç”¨ updateCoordinator æ–¹æ³•æ¥æ›´æ–°åè°ƒå™¨ï¼Œ // å°† node å’Œ NodeCoordinator æŒ‚æ¥å…³è” // æ¯”å¦‚ï¼š // Modifier.background().size() // è¿™é‡Œ Modifier.background() è½¬æ¢åçš„ Node å¯¹åº”çš„ NodeCoordinator // ä¸º SizeNode å¯¹åº”çš„ NodeCoordinator node.updateCoordinator(coordinator) } // åœ¨æ¯æ¬¡è¿­ä»£ç»“æŸæ—¶ï¼Œå°† node å˜é‡æ›´æ–°ä¸ºå½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ node.parentï¼Œä¸ºä¸‹ä¸€æ¬¡å¾ªç¯å‡†å¤‡ // ä¹Ÿå°±æ˜¯è·å– SizeNode çš„çˆ¶èŠ‚ç‚¹ -- PaddingNodeï¼Œç»§ç»­å¤„ç† node = node.parent } coordinator.wrappedBy = layoutNode.parent?.innerCoordinator outerCoordinator = coordinator // è°ƒæ•´å¤–å±‚ NodeCoordinator} çœ‹æ‡‚äº†å—ï¼Ÿæˆ‘åˆç”»äº†ä¸€å¼ å›¾ï¼š ç°åœ¨è®©æˆ‘ä»¬ç®€å•æ€»ç»“ä¸‹ updateFrom() çš„å¤„ç†æ­¥éª¤ï¼š åœ¨ Composable ç¼–å†™çš„ Modifier æ˜¯å±‚å±‚åµŒå¥—çš„ï¼Œé¦–å…ˆéœ€è¦å°† Modifier é›†åˆé“ºå¹³åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ï¼› å¦‚æœ NodeChain è¿˜æ²¡æœ‰ç»„è£…è¿‡åŒå‘é“¾è¡¨ï¼Œéå†æ­¥éª¤ä¸€é“ºå¹³çš„ Modifier æ•°ç»„ç»„è£…æˆåŒå‘é“¾è¡¨ï¼Œå¦åˆ™å°±å¯¹åŒå‘é“¾è¡¨å¢é‡æ›´æ–°ï¼› æ›´æ–°åŒå‘é“¾è¡¨å¤´èŠ‚ç‚¹ï¼› å°† Modifier å’Œæ‰€å±çš„ NodeCoordinator æŒ‚æ¥å…³è”ã€‚ ç°åœ¨å»é™¤ä»£ç åˆ†æéƒ¨åˆ†ï¼Œå†æ¥çœ‹ä¸€ä¸ªæ•´ä½“æ€ç»´æ¨¡å‹å›¾ï¼š çœ‹åˆ°è¿™é‡Œï¼Œæ‰€æœ‰çš„ Modifier å¤„ç†å®Œäº†ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥å¼€å§‹æµ‹é‡äº†ï¼Œä½ è¿˜è®°å¾—ç¬¬äºŒèŠ‚æˆ‘ä»¬è®²çš„ç»„ä»¶è‡ªèº«æµ‹é‡çš„ä»£ç é€»è¾‘å—ï¼Ÿæˆ‘ä¼°è®¡ä½ çœ‹åˆ°è¿™ï¼Œåº”è¯¥å·²ç»å…¨å¿˜äº†ï¼Œæ‰€ä»¥å†çœ‹ä¸€ä¸‹æµç¨‹å›¾å§ï¼š çœ‹åˆ°æ²¡ï¼Ÿæ˜¯è°æµ‹é‡çš„ï¼Ÿâ€“ outerCoordinatorï¼ outerCoordinator å¯¹è±¡å°±æ˜¯åšå®é™…æµ‹é‡å·¥ä½œçš„ï¼Œæ‰€ä»¥å¼€å§‹æµ‹é‡çš„æ—¶å€™ï¼Œä»å“ªå¼€å§‹æµ‹ï¼Ÿä¸ç”¨æˆ‘è¯´äº†å§ï¼Ÿ measure()æˆ‘ä»¬çœ‹ä¸‹ LayoutModifierNodeCoordinator æ˜¯æ€ä¹ˆåšæµ‹é‡çš„ï¼š 1234567891011121314151617181920212223242526272829// LayoutModifierNodeCoordinator.ktinternal class LayoutModifierNodeCoordinator( layoutNode: LayoutNode, measureNode: LayoutModifierNode,) : NodeCoordinator(layoutNode) { override fun measure(constraints: Constraints): Placeable { @Suppress(&quot;NAME_SHADOWING&quot;) val constraints = if (forceMeasureWithLookaheadConstraints) { requireNotNull(lookaheadConstraints) { &quot;Lookahead constraints cannot be null in approach pass.&quot; } } else { constraints } performingMeasure(constraints) { measureResult = approachMeasureScope?.let { scope -&gt; ... ... // 1. æ ¸å¿ƒä»£ç ï¼Œwith åŒ…å«äº† LayoutModifierNodeï¼Œæä¾›äº†ä¸€ä¸ª LayoutModifierNode çš„ä¸Šä¸‹æ–‡ } ?: with(layoutModifierNode) { // 2. è¿™é‡Œçš„ wrappedNonNull æ˜¯ä»€ä¹ˆï¼Ÿæˆ‘ä»¬åé¢é©¬ä¸Šå°±è¯´åˆ° measure(wrappedNonNull, constraints) } this@LayoutModifierNodeCoordinator } onMeasured() return this }} measure() çš„å·¥ä½œä¼šè·³è½¬åˆ°å“ªé‡Œï¼Œæ˜¯ç”± with() å†³å®šçš„ï¼Œå®ƒæä¾›äº† LayoutModifierNode ä¸Šä¸‹æ–‡ï¼Œæ‰€ä»¥ measure() è·³è½¬åˆ°äº† LayoutModifierNode é‡Œé¢ã€‚ 12345678910// LayoutModifierNode.ktinterface LayoutModifierNode : Remeasurement, DelegatableNode { fun MeasureScope.measure( measurable: Measurable, constraints: Constraints ): MeasureResult ... ...} LayoutModifierNode åªæ˜¯ä¸€ä¸ªæ¥å£ï¼Œæ‰€ä»¥å…·ä½“çš„æµ‹é‡å®ç°åœ¨å“ªï¼Ÿ è¿™é‡Œæˆ‘ä»¬è¦åˆ†ä¸¤ç§åœºæ™¯æ¥çœ‹ï¼š 1. æˆ‘ä»¬é¦–å…ˆæ¥çœ‹æœ€ç®€å•çš„ä¸€ç§æƒ…å†µï¼šModifier.layout() æ¯”å¦‚æˆ‘ä»¬æ–‡ç« å‰é¢å†™è¿‡çš„ä¸€ä¸ªä¾‹å­ï¼š 1234567891011121314151617181920212223class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { ComposeBlogTheme { Box(Modifier.background(Color.Green)) { Text(&quot;Hi Compose&quot;, // hereï¼Œç†Ÿæ‚‰å—ï¼Ÿ Modifier.layout { measurable, constraints -&gt; val paddingPx = 10.dp.roundToPx() val placeable = measurable.measure(constraints.copy( maxWidth = constraints.maxWidth - paddingPx * 2, maxHeight = constraints.maxHeight - paddingPx * 2 )) layout(placeable.width + paddingPx * 2, placeable.height + paddingPx * 2) { placeable.placeRelative(paddingPx, paddingPx) } }) } } } }} ç‚¹è¿› Modifier.layout {} çœ‹æºç ï¼š 1234567891011// LayoutModifier.ktfun Modifier.layout( measure: MeasureScope.(Measurable, Constraints) -&gt; MeasureResult) = this then LayoutElement(measure)private data class LayoutElement( val measure: MeasureScope.(Measurable, Constraints) -&gt; MeasureResult) : ModifierNodeElement&lt;LayoutModifierImpl&gt;() { override fun create() = LayoutModifierImpl(measure) ... ...} å†ç‚¹å‡» LayoutModifierImpl è¿›å»çœ‹çœ‹ï¼š 12345678910111213internal class LayoutModifierImpl( var measureBlock: MeasureScope.(Measurable, Constraints) -&gt; MeasureResult) : LayoutModifierNode, Modifier.Node() { // çœ‹ï¼ï¼ï¼æ˜¯ä¸æ˜¯é‡å†™äº† MeasureScope.measure æ–¹æ³• ? æ‰€ä»¥å…·ä½“æµ‹é‡å·¥ä½œå°±åœ¨è¿™é‡Œäº†ã€‚ override fun MeasureScope.measure( measurable: Measurable, constraints: Constraints ) = measureBlock(measurable, constraints) override fun toString(): String { return &quot;LayoutModifierImpl(measureBlock=$measureBlock)&quot; }} è¿™é‡Œ measure ç›´æ¥è°ƒç”¨äº† measureBlock()ï¼Œå®ƒæ˜¯å‚æ•°ä¼ è¿›æ¥çš„ï¼Œå¾€å›é€€ï¼š 1234567891011// LayoutModifier.ktfun Modifier.layout( measure: MeasureScope.(Measurable, Constraints) -&gt; MeasureResult) = this then LayoutElement(measure)private data class LayoutElement( val measure: MeasureScope.(Measurable, Constraints) -&gt; MeasureResult) : ModifierNodeElement&lt;LayoutModifierImpl&gt;() { override fun create() = LayoutModifierImpl(measure) ... ...} measureBlock åˆæ˜¯ measureï¼Œè€Œ measure æ˜¯å•¥ï¼Ÿå°±æ˜¯ä½ ä¸»ä»£ç é‡Œé¢å†™åœ¨ Modifier.layout {} é‡Œé¢çš„æµ‹é‡å’Œå¸ƒå±€é€»è¾‘ï¼Œè¿™å°±ç›¸å½“äºå®ç°äº†å°†å†…éƒ¨çš„æµ‹é‡ç»“æœæš´éœ²ç»™ä¸Šå±‚ï¼Œè®©æˆ‘ä»¬èƒ½ä¿®é¥°åšäºŒæ¬¡æµ‹é‡å¤„ç†ã€‚ 2. ç°åœ¨æˆ‘ä»¬å†æ¥çœ‹ç¬¬äºŒç§åœºæ™¯ï¼šModifier.padding(10.dp).size(20.dp) è¿™ä¸ªä¾‹å­ä¸ç”¨å¤šè¯´äº†å§ï¼Œä¹‹å‰åˆ†ææºç å°±æ˜¯åŸºäºå®ƒï¼Œè¿™ä¸ªåœºæ™¯å°±è¦å…³è”åˆ°æˆ‘ä»¬åˆšåˆšæåˆ°çš„ wrappedNonNull äº†ã€‚ 1234567891011121314151617181920212223242526// LayoutModifierNodeCoordinator.ktinternal class LayoutModifierNodeCoordinator( layoutNode: LayoutNode, measureNode: LayoutModifierNode,) : NodeCoordinator(layoutNode) { // 2. wrapped æ˜¯ LayoutModifierNodeCoordinator çš„å†…éƒ¨ NodeCoordinator val wrappedNonNull: NodeCoordinator get() = wrapped!! override fun measure(constraints: Constraints): Placeable { performingMeasure(constraints) { with(layoutModifierNode) { measureResult = if (this is IntermediateLayoutModifierNode) { ... } else { // 1. è¿™é‡Œçš„ wrappedNonNull æ˜¯ä»€ä¹ˆï¼Ÿ measure(wrappedNonNull, constraints) } this@LayoutModifierNodeCoordinator } } onMeasured() return this }} æ³¨é‡Šå†™çš„å¾ˆæ¸…æ¥šï¼šwrapped æ˜¯æœ€å¤–å±‚ LayoutModifierNodeCoordinator çš„å†…éƒ¨ NodeCoordinatorï¼Œæ˜¯è°ï¼Ÿ æ‰€ä»¥ä½ èƒ½çœ‹å‡ºä»€ä¹ˆé—¨é“å—ï¼Ÿæµç¨‹å¾ˆæ¸…æ™°ï¼šæµ‹é‡è¿‡ç¨‹ä¸­ä¼šä»å¤–å¾€é‡Œæ‰§è¡Œæ¯ä¸€ä¸ª NodeCoordinator çš„ measure æ–¹æ³•ï¼Œç›´åˆ°è§¦åº•é‡åˆ°ç»„ä»¶è‡ªèº«çš„ InnerNodeCoordinatorï¼Œå®ƒè´Ÿè´£è‡ªèº«çš„æµ‹é‡ã€‚ æµç¨‹å¦‚ä¸‹ï¼š æˆ‘ä»¬è¦ç»™ Box å¢åŠ  10dp çš„ paddingï¼Œä½†æ­¤æ—¶è¿˜ä¸çŸ¥é“ç»„ä»¶æœ¬èº«å¤§å°ï¼Œæ‰€ä»¥å°±éœ€è¦å…ˆæµ‹é‡å†…éƒ¨ï¼Œä¼šå…ˆå»æ‰¾ 10dp å¥—ç€çš„å†…éƒ¨ï¼› ç°åœ¨å†…éƒ¨è¦è®¾å®š 20dp çš„ sizeï¼Œä½†ä»ç„¶ä¸çŸ¥é“ç»„ä»¶æœ¬èº«å¤§å°ï¼Œéœ€è¦å…ˆæµ‹é‡å†…éƒ¨ï¼Œç»§ç»­å¾€ä¸‹æ‰¾å®ƒçš„å†…éƒ¨ï¼› æ‰¾åˆ°äº†å…·ä½“ç»„ä»¶ Boxï¼Œå®ƒæ˜¯ InnerNodeCoordinatorï¼ŒInnerNodeCoordinator å·²ç»æ²¡æœ‰å†…éƒ¨äº†ï¼Œæ‰€ä»¥ Box æŒ‰ç…§è‡ªå·±çš„æµ‹é‡æ–¹å¼å»æµ‹é‡æ‹¿åˆ°æµ‹é‡ç»“æœï¼› InnerNodeCoordinator æµ‹é‡å‡ºç»“æœåï¼Œå¾€ä¸Šä¼ ç»™è¦è®¾å®š size çš„ LayoutModifierNodeï¼Œåœ¨æµ‹é‡ç»“æœä¸Šè®¾å®š 20dp çš„ size åè¿”å›æµ‹é‡ç»“æœï¼› æ‹¿åˆ°è®¾å®š 20dp size çš„æµ‹é‡ç»“æœåï¼Œå†å¾€ä¸Šä¼ ç»™è¦åŠ  padding çš„ LayoutModifierNodeï¼Œåœ¨æµ‹é‡ç»“æœä¸Šå†æ·»åŠ  10dp çš„ paddingï¼ŒLayoutNode æ‹¿åˆ°æœ€ç»ˆçš„æµ‹é‡ç»“æœã€‚","link":"/2025/08/10/compose/Compose%20--%20Modifier%20--%2003.%20%E8%A7%A3%E6%9E%90%20Modifier.layout()/"},{"title":"èŠèŠ mutableStateListOf","text":"è®²ä»»ä½•ä¸€ä¸ªæ–°çš„ä¸»é¢˜æˆ–è€…çŸ¥è¯†ç‚¹ï¼Œä¹ æƒ¯æ€§çš„ä» Demo å¼€å§‹ï¼Œæ¯”å¦‚ï¼š 1234567891011class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) var name by mutableStateOf(&quot;Hi, Compose&quot;) setContent { Text(name) } }} è¿™æ®µä»£ç å·²ç»ç†Ÿçš„ä¸èƒ½å†ç†Ÿäº†å§ï¼Ÿ å¦‚æœæˆ‘ä»¬ç”¨ by mutableStateOf åˆå§‹åŒ–ä¸€ä¸ªå˜é‡ï¼Œé‚£ name å°±ä¼šå˜æˆä¸€ä¸ªè¢« Composeã€Œè‡ªåŠ¨è®¢é˜…ã€çš„å˜é‡ã€‚ æˆ‘ä»¬ä¹‹å‰æ–‡ç« çš„ä¾‹å­ï¼Œéƒ½æ˜¯ç”¨ by mutableStateOf åŒ…äº†ä¸€ä¸ª Stringï¼Œå¦‚æœæ¢æˆåˆ«çš„ç±»å‹ï¼Œè¡Œä¸è¡Œï¼Ÿ 1234fun &lt;T&gt; mutableStateOf( value: T, // æ³›å‹å‚æ•° policy: SnapshotMutationPolicy&lt;T&gt; = structuralEqualityPolicy()): MutableState&lt;T&gt; = createSnapshotMutableState(value, policy) ä¾‹å¦‚ï¼šInt ç±»å‹ 12345678910111213141516class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) var num by mutableStateOf(1) setContent { Text( text = &quot;å½“å‰æ•°å€¼ï¼š$num&quot;, Modifier.clickable { num++ } ) } }} ä»£ç ä¸åšè§£é‡Šäº†ï¼Œç›´æ¥çœ‹æ•ˆæœï¼š ä¾‹å¦‚ï¼šList ç±»å‹ 123// num ç±»å‹ï¼šMutableList&lt;Int&gt;// mutableStateOf ç±»å‹ï¼šMutableState&lt;MutableList&lt;Int&gt;&gt;var nums by mutableStateOf(mutableListOf(1, 2, 3)) æˆ‘ä»¬åœ¨ä»£ç é‡Œé¢ç”¨èµ·æ¥ï¼š 123456789101112131415class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) var nums by mutableStateOf(mutableListOf(1, 2, 3)) setContent { Column { for (num in nums) { Text(&quot;ç¬¬ $num å—æ–‡å­—&quot;) } } } }} è¿è¡Œï¼š ç°åœ¨æˆ‘ä»¬ç¨å¾®æ”¹ä¸‹ä»£ç ï¼š 1234567891011121314151617181920class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) var nums by mutableStateOf(mutableListOf(1, 2, 3)) setContent { Column { Button(onClick = { nums.add(nums.last() + 1) }) { Text(&quot;List åŠ  1&quot;) } for (num in nums) { Text(&quot;ç¬¬ $num å—æ–‡å­—&quot;) } } } }} ä»£ç å¾ˆç®€å•ï¼šæˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ª Buttonï¼Œæ¯æ¬¡ç‚¹å‡»åï¼Œnums ä¼šæ·»åŠ ä¸€ä¸ªå€¼ï¼Œæ¯”æœ€æœ‰ä¸€ä¸ªå€¼å¤§ 1ã€‚ è¿è¡Œï¼š Button ç–¯ç‹‚ç‚¹å‡»ï¼Œä½†æ˜¯æ²¡ç”Ÿæ•ˆï¼ä¸ºä»€ä¹ˆï¼Ÿ æˆ‘ä»¬å…ˆæ¥æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼ŒmutableStateOf åŸç†æ˜¯ä»€ä¹ˆï¼Ÿæˆ‘ä»¬å›å¿†ä¸€ä¸‹ï¼š mutableStateOf ä¹‹æ‰€ä»¥å¯ä»¥å¯¹å˜é‡è¿›è¡Œè®¢é˜…å’Œåˆ·æ–°ï¼Œä¸»è¦æ˜¯å› ä¸ºå†…éƒ¨çš„ get() å’Œ set() æ–¹æ³•åŠ äº†é’©å­ï¼Œæˆ–è€…è¯´å®ƒçš„ set() æ–¹æ³•æ˜¯èµ‹å€¼ï¼æ˜¯æ”¹å˜äº†å˜é‡çš„æŒ‡å‘ï¼Œå®ƒæ˜¯ç›´æ¥æŠŠå¯¹è±¡ç»™æ›¿æ¢äº†ï¼Œä½†åœ¨æˆ‘ä»¬è¿™ä¸ªä»£ç é‡Œé¢ nums ä»…ä»…æ˜¯æ”¹å˜äº†å®ƒå†…éƒ¨çš„çŠ¶æ€ï¼ æ‰€ä»¥ï¼Œå®ƒä¸ä¼šè§¦å‘ setValue() çš„è°ƒç”¨ï¼Œä»è€Œä¸ä¼šè§¦å‘è‡ªåŠ¨åˆ·æ–°çš„æ“ä½œã€‚ ä¸ºäº†éªŒè¯æ˜¯ä¸æ˜¯å› ä¸ºæ²¡æœ‰é‡ç»„ï¼Œæˆ‘ä»¬å¯ä»¥æ”¹ä¸‹ä»£ç ï¼š 12345678910111213141516171819202122class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) var nums by mutableStateOf(mutableListOf(1, 2, 3)) var refresh by mutableStateOf(&quot;å¼ºåˆ¶åˆ·æ–°&quot;) setContent { Column { Text(refresh, Modifier.clickable { refresh = &quot;åˆ·æ–°å®Œæˆ&quot;}) Button(onClick = { nums.add(nums.last() + 1) }) { Text(&quot;List åŠ  1&quot;) } for (num in nums) { Text(&quot;ç¬¬ $num å—æ–‡å­—&quot;) } } } }} æˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ª Text() ç»„ä»¶ï¼Œæ”¹å˜ refresh çš„å€¼ï¼Œé‚£ä¹ˆç†è®ºä¸Šå®ƒå°±ä¼šå¸¦ç€ã€Œæ•´ä¸ªé‡ç»„ä½œç”¨åŸŸå†…ã€çš„ç»„ä»¶å…¨éƒ¨ã€Œåˆ·æ–°ã€ï¼ŒåŒ…æ‹¬ Listã€‚ è¿è¡Œï¼š æˆåŠŸåˆ·æ–°äº† List ï¼ ç°åœ¨æˆ‘ä»¬å°±å¾ˆæ¸…æ¥šäº†ï¼ŒmutableStateOf æ²¡æ³•å¯¹ List ç±»å‹çš„å¯¹è±¡å®ç°ç±»ä¼¼ Stringã€Int çš„è‡ªåŠ¨è®¢é˜…åŠåˆ·æ–°ï¼Œé‚£æœ‰æ²¡æœ‰è§£å†³åŠæ³•ï¼Ÿ ä¸Šé¢æˆ‘ä»¬è¯´è¿‡äº†ï¼Œé—®é¢˜çš„æ ¹æœ¬åŸå› æ˜¯ List åªæ˜¯å†…éƒ¨çš„å˜åŒ–ï¼Œè€Œä¸æ˜¯å®ƒè‡ªå·±æœ¬èº«å¯¹è±¡çš„å˜åŒ–ï¼Œé‚£æˆ‘ä»¬åœ¨å†…éƒ¨æ“ä½œå®Œåç›´æ¥æŠŠ List é‡æ–°ç»™æ¢äº†ä¸å°±è¡Œäº†ï¼Ÿè¯•è¯•ï¼š 1234567891011121314151617181920212223class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) var nums by mutableStateOf(mutableListOf(1, 2, 3)) setContent { Column { Button(onClick = { // nums é‡æ–°èµ‹å€¼ nums = nums.toMutableList().apply { add(nums.last() + 1) } }) { Text(&quot;List åŠ  1&quot;) } for (num in nums) { Text(&quot;ç¬¬ $num å—æ–‡å­—&quot;) } } } }} è¿è¡Œï¼š æˆåŠŸåˆ·æ–°äº† List ï¼ ä½†è¿™æ ·å†™å°±ä¼šæ˜¾å¾—å¾ˆå¥‡æ€ªï¼šæ—¢ç„¶å¯¹äº Stringã€Int è¿™äº›ç±»å‹ï¼ŒCompose æä¾›äº† mutableStateOfï¼Œéš¾é“å¯¹äº List è¿™ç§è¿™ä¹ˆå¸¸ç”¨çš„ç±»å‹ï¼Œå°±æ²¡æœ‰ä¸€ä¸ª mutable*** çš„å‡½æ•°ç»™æˆ‘ä»¬ç”¨ï¼Ÿ é‚£å¿…é¡»æœ‰ï¼å®ƒå°±æ˜¯ mutableStateListOfï¼å®ƒå¯ä»¥è§‚æµ‹åˆ°å†…éƒ¨ List çš„æ•°æ®å˜åŒ–ï¼ æˆ‘ä»¬å¯ä»¥åƒä¸‹é¢è¿™æ ·ç”³æ˜ï¼š 12345678910var nums by mutableStateListOf(mutableListOf(1, 2, 3)) // æœ‰çº¢çº¿æ ‡æ³¨ï¼Œå†™æ³•é”™è¯¯// mutableStateListOf æ˜¯å†…éƒ¨å…ƒç´ è¢«è§‚æµ‹ï¼Œè€Œä¸æ˜¯å®ƒæœ¬èº«è¢«è§‚æµ‹ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æŠŠ `by` æ¢æˆ `=`var nums = mutableStateListOf(mutableListOf(1, 2, 3))// `var` ä¹Ÿå¯ä»¥æ¢æˆ `val`val nums = mutableStateListOf(mutableListOf(1, 2, 3))// mutableStateListOf æœ¬èº«å°±ä»£è¡¨ä¸€ä¸ªå¯è§‚æµ‹çš„ Listï¼Œæ‰€ä»¥ mutableListOf ä¹Ÿå¯ä»¥å»é™¤val nums = mutableStateListOf(1, 2, 3) // è¿™å°±æ˜¯æœ€ç»ˆçš„å†™æ³• è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥ä¼˜åŒ–ä¸‹ä»£ç äº†ï¼š 1234567891011121314151617181920class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) val nums = mutableStateListOf(1, 2, 3) setContent { Column { Button(onClick = { nums.add(nums.last() + 1) }) { Text(&quot;List åŠ  1&quot;) } for (num in nums) { Text(&quot;ç¬¬ $num å—æ–‡å­—&quot;) } } } }} è¿è¡Œï¼š æåˆ° Listï¼Œæˆ‘ä»¬å°±ä¼šæƒ³åˆ° Mapï¼ŒåŒæ · Map ä¹Ÿæä¾›äº†ä¸€ä¸ª mutableStateMapOfï¼å®ƒä¹Ÿå¯ä»¥è§‚æµ‹åˆ°å†…éƒ¨ Map çš„æ•°æ®å˜åŒ–ï¼ 12345678910111213141516171819class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) val maps = mutableStateMapOf(1 to &quot;One&quot;, 2 to &quot;Two&quot;) setContent { Column { Button(onClick = { maps[3] = &quot;Three&quot; }) { Text(&quot;Maps åŠ  1&quot;) } for ((key, value) in maps) { Text(&quot;$key å¯¹åº” value: $value&quot;) } } } }} è¿è¡Œï¼š","link":"/2025/06/18/compose/Compose%20--%20%E7%8A%B6%E6%80%81%E8%AE%A2%E9%98%85%20&%20%E8%87%AA%E5%8A%A8%E5%88%B7%E6%96%B0%20--%2004.%20mutableStateListOf/"},{"title":"ä½ çœŸçš„äº†è§£ Compose çš„é‡ç»„å—ï¼Ÿ","text":"é‡ç»„å…ˆè€ƒè™‘ä¸€ä¸ªé—®é¢˜ï¼Œä»€ä¹ˆæ—¶å€™ä¼šã€Œé‡ç»„ã€ï¼Ÿ 123val name by remember { mutableStateOf(&quot;Hi Compose&quot;)}val nums = mutableStateListOf(1, 2, 3)val maps = mutableStateMapOf(1 to &quot;One&quot;, 2 to &quot;Two&quot;) é€šè¿‡ä¹‹å‰çš„å‡ ç¯‡æ–‡ç« ï¼Œä½ åº”è¯¥å¯¹è¿™ä¸‰è¡Œä»£ç ä¸é™Œç”Ÿï¼Œå½“ç”¨ mutableState*Of ç”³æ˜ä¸€ä¸ªå˜é‡çš„æ—¶å€™ï¼Œåœ¨å¯ç»„åˆé¡¹ä¸­ï¼Œã€Œå¦‚æœå˜é‡å˜åŒ–äº†ï¼Œå°±ä¼šè§¦å‘é‡ç»„ã€ã€‚ æ¯”å¦‚ä¸‹é¢ä»£ç ï¼š 12345678910111213class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) var name by mutableStateOf(&quot;Hi, Compose&quot;) setContent { Column { Text(name, Modifier.clickable { name = &quot;Hi, Kotlin&quot; }) } } }} æˆ‘ä»¬çŸ¥é“ï¼šText(name) è¢«é‡ç»„äº†ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯ä»…ä»…æ˜¯ Text(name) è¢«é‡ç»„ï¼Œè€Œæ˜¯æ•´ä¸ª Lambda è¡¨è¾¾å¼ è¢«é‡ç»„ï¼Œæˆ‘ä»¬ä¹‹å‰è¯´è¿‡ï¼Œè¿™å°±æ˜¯ã€Œé‡ç»„ä½œç”¨åŸŸï¼ˆRecompose scopeï¼‰ã€ï¼ã€‚ é‚£ä¹ˆæˆ‘ä¿®æ”¹æˆå¦‚ä¸‹ä»£ç ï¼Œæ€è€ƒä¸€ä¸ªé—®é¢˜ï¼š æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸ªå¥½ç©çš„ä¸œè¥¿ï¼ŒæŸ¥çœ‹ Column å‡½æ•°ï¼š 1234567891011121314@Composableinline fun Column( modifier: Modifier = Modifier, verticalArrangement: Arrangement.Vertical = Arrangement.Top, horizontalAlignment: Alignment.Horizontal = Alignment.Start, content: @Composable ColumnScope.() -&gt; Unit) { val measurePolicy = columnMeasurePolicy(verticalArrangement, horizontalAlignment) Layout( content = { ColumnScopeInstance.content() }, measurePolicy = measurePolicy, modifier = modifier )} Column æ˜¯ä¸ª inline å‡½æ•°ï¼ˆå†…è”å‡½æ•°ï¼‰ï¼Œè¿™å°±æ„å‘³ç€åœ¨å®é™…ç¼–è¯‘ä¹‹å‰ï¼Œè¿™ä¸ªå‡½æ•°çš„è°ƒç”¨ä¼šè¢«æ›¿æ¢æˆå†…éƒ¨å®é™…çš„ä»£ç ã€‚ æ¯”å¦‚ä¼šæ˜¯ä¸‹é¢è¿™ä¸ªæ ·å­ï¼š 12345678910111213141516class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) var name by mutableStateOf(&quot;Hi, Compose&quot;) setContent { // Column { // æ›¿æ¢ä¸º Layout( Text(name, Modifier.clickable { name = &quot;Hi, Kotlin&quot; }) ) // } } }} å†æ¥çœ‹ä¸‹ Layout()ï¼š 1234567891011@Composable inline fun Layout( content: @Composable @UiComposable () -&gt; Unit, modifier: Modifier = Modifier, measurePolicy: MeasurePolicy) { ... ReusableComposeNode&lt;ComposeUiNode, Applier&lt;Any&gt;&gt;( ... content = content )} Layout()ä¹Ÿæ˜¯ä¸ª inline å‡½æ•°ï¼Œé‚£ä¹ˆä»£ç åˆä¼šå˜æˆè¿™æ ·ï¼š 123456789101112131415161718class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) var name by mutableStateOf(&quot;Hi, Compose&quot;) setContent { // Column { // Layout( // æ›¿æ¢ä¸º ReusableComposeNode( Text(name, Modifier.clickable { name = &quot;Hi, Kotlin&quot; }) ) // ) // } } }} å†æ¥çœ‹ä¸‹ ReusableComposeNodeï¼š 1234567891011@Composable @ExplicitGroupsComposableinline fun &lt;T, reified E : Applier&lt;*&gt;&gt; ReusableComposeNode( noinline factory: () -&gt; T, update: @DisallowComposableCalls Updater&lt;T&gt;.() -&gt; Unit, noinline skippableUpdate: @Composable SkippableUpdater&lt;T&gt;.() -&gt; Unit, content: @Composable () -&gt; Unit) { ... content() ...} åˆæ˜¯ inline å‡½æ•°ï¼Œè€Œä¸”ä½ çœ‹å®ƒå†…éƒ¨å¹²äº†ä»€ä¹ˆï¼Ÿ- - ç›´æ¥è°ƒç”¨äº† content()ï¼ æ‰€ä»¥æœ€ç»ˆä»£ç åœ¨ç¼–è¯‘å‰å…¶å®ä¼šæŠŠ Column {} ç»™æ‹¿æ‰ï¼Œå°±è·Ÿä¸‹é¢ä¸€æ ·ï¼š 123456789101112131415161718class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) var name by mutableStateOf(&quot;Hi, Compose&quot;) setContent { // Column { // Layout( // æ›¿æ¢ä¸º // ReusableComposeNode( Text(name, Modifier.clickable { name = &quot;Hi, Kotlin&quot; }) // ) // ) // } } }} é‚£ä¹ˆè¿™å°±æ„å‘³ç€ï¼š 1234567891011121314151617class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) var name by mutableStateOf(&quot;Hi, Compose&quot;) setContent { // ç»„ä»¶ 1ï¼Œè¿™ä¸ªåœ°æ–¹ä¼šå› ä¸º name çš„æ”¹å˜è€Œä¸€èµ·é‡æ–°è°ƒç”¨ Column { // ç»„ä»¶ 2ï¼Œè¿™ä¸ªåœ°æ–¹ä¼šå› ä¸º name çš„æ”¹å˜è€Œä¸€èµ·é‡æ–°è°ƒç”¨ Text(name, Modifier.clickable { name = &quot;Hi, Kotlin&quot; }) // ç»„ä»¶ 3ï¼Œè¿™ä¸ªåœ°æ–¹ä¼šå› ä¸º name çš„æ”¹å˜è€Œä¸€èµ·é‡æ–°è°ƒç”¨ } // ç»„ä»¶4ï¼Œè¿™ä¸ªåœ°æ–¹ä¼šå› ä¸º name çš„æ”¹å˜è€Œä¸€èµ·é‡æ–°è°ƒç”¨ } }} ä¸ºäº†éªŒè¯ï¼Œæˆ‘ä»¬æµ‹è¯•ä¸‹ï¼š 1234567891011121314151617class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) var name by mutableStateOf(&quot;Hi, Compose&quot;) setContent { println(&quot;Recompose èŒƒå›´æµ‹è¯• 1&quot;) Column { println(&quot;Recompose èŒƒå›´æµ‹è¯• 2&quot;) Text(name, Modifier.clickable { name = &quot;Hi, Kotlin&quot; }) println(&quot;Recompose èŒƒå›´æµ‹è¯• 3&quot;) } println(&quot;Recompose èŒƒå›´æµ‹è¯• 4&quot;) } }} è¿è¡Œï¼š è¿™ä¸ª Log æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œç°åœ¨æˆ‘ä»¬ç‚¹å‡»ï¼š Log å·²ç»éªŒè¯äº†æˆ‘ä»¬åˆšæ‰çš„ç»“è®ºï¼Œé‚£è¿™å°±æ¶‰åŠåˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼šæ€§èƒ½é£é™©ï¼ æ¯”å¦‚ä¸‹é¢çš„ä»£ç æœ‰å¯èƒ½å‡ºç°åœ¨ä½ çš„ä»£ç ä¸­ï¼š 123456789101112131415161718192021222324class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) var name by mutableStateOf(&quot;Hi, Compose&quot;) setContent { println(&quot;Recompose èŒƒå›´æµ‹è¯• 1&quot;) Column { println(&quot;Recompose èŒƒå›´æµ‹è¯• 2&quot;) Text(name, Modifier.clickable { name = &quot;Hi, Kotlin&quot; }) println(&quot;Recompose èŒƒå›´æµ‹è¯• 3&quot;) } NBFunction() println(&quot;Recompose èŒƒå›´æµ‹è¯• 4&quot;) } }}@Composablefun NBFunction() { println(&quot;Recompose èŒƒå›´æµ‹è¯•ï¼šæˆ‘å¹²äº†å¾ˆå¤šæ¶ˆè€—æ€§èƒ½çš„äº‹ï½ï½ï½&quot;) // è¿™é‡Œé¢å¹²äº†å¾ˆå¤š NB çš„äº‹ï¼Œé€»è¾‘é‡ç‰¹åˆ«å¤§} ä½ å†™äº†ä¸€ä¸ªå¾ˆç‰›é€¼çš„ Composable å‡½æ•°ï¼Œé‡Œé¢å¹²äº†å¾ˆå¤šå¤æ‚çš„äº‹ï¼Œç‰¹åˆ«æ¶ˆè€—æ€§èƒ½ï¼Œé‚£ä¹ˆæ¯æ¬¡éšç€ name çš„æ›´æ”¹ï¼ŒNBFunction() éƒ½ä¼šè¢«æ‰§è¡Œä¸€éï¼Œå°±ä¼šå­˜åœ¨å·¨å¤§çš„æ€§èƒ½æ¶ˆè€—ï¼ ä½ è¦ä¸ä¿¡ï¼Œæˆ‘ä»¬è¿è¡Œä¸€ä¸‹ï¼Œçœ‹ä¸‹ Logï¼š â€¦ é¢ï¼Œå¥½å°´å°¬â€¦ï¼Œç‚¹å‡» name åï¼ŒNBFunction() ç«Ÿç„¶æ²¡æœ‰å†æ¬¡æ‰§è¡Œï¼Ÿä½†å…¶ä»– Log ä»ç„¶æ‰§è¡Œäº†å•Šï¼ éš¾é“ NBFunction() æ²¡æœ‰è¢«è°ƒç”¨ï¼Ÿ å…¶å® NBFunction() è¢«è°ƒç”¨äº†ï¼Œåªä¸è¿‡è¿›å…¥ NBFunction() å†…éƒ¨åï¼Œå†…éƒ¨çš„ä»£ç æ²¡æœ‰è¢«æ‰§è¡Œï¼ éƒ½è¿›æ¥äº†ï¼Œä½ è·Ÿæˆ‘è¯´å†…éƒ¨ä»£ç ä¸æ‰§è¡Œï¼Ÿ ä¸”å¬æˆ‘ç»™ä½ è§£é‡Šï½ å…¶å®è¿™æ˜¯å› ä¸ºï¼šåœ¨ Compose çš„ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œç¼–è¯‘å™¨æ’ä»¶ä¼šåšå¹²é¢„ï¼Œè¿™ä¸ªå¹²é¢„è¿‡ç¨‹ä¼šä¿®æ”¹æˆ‘ä»¬çš„ Compose å‡½æ•°ï¼Œæ¯”å¦‚è¯´å®ƒä¼šç»™å‡½æ•°å†…éƒ¨çš„ä»£ç åŠ ä¸Šä¸€äº›æ¡ä»¶åˆ¤æ–­ï¼Œåˆ¤æ–­è¿™ä¸ªå‡½æ•°çš„å‚æ•°è·Ÿä¸Šä¸€æ¬¡å‡½æ•°è¢«è°ƒç”¨çš„æ—¶å€™ä¼ å…¥çš„å‚æ•°æœ‰æ²¡æœ‰æ”¹å˜ï¼Œå¦‚æœæ²¡æœ‰æ”¹å˜ï¼Œå°±ç›´æ¥è·³è¿‡è¿™ä¸ªå‡½æ•°çš„å†…éƒ¨ä»£ç çš„æ‰§è¡Œï¼Œè¿™æ˜¯ Compose çš„ä¼˜åŒ–ã€‚ è€Œä½ çœ‹ NBFunction() è¿™ä¸ªå‡½æ•°æœ‰å‚æ•°å—ï¼Ÿ- - æ²¡æœ‰ï¼Œæ‰€ä»¥å®ƒå†…éƒ¨ä»£ç æ°¸è¿œä¸ä¼šæ‰§è¡Œï¼Œæ‰€ä»¥ Log è‚¯å®šä¸ä¼šæ‰“å°å‡ºæ¥ã€‚ é‚£æˆ‘ä»¬åŠ ä¸ªå‚æ•°æµ‹è¯•ä¸€ä¸‹ï¼š 12345678910111213141516171819202122232425class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) var name by mutableStateOf(&quot;Hi, Compose&quot;) setContent { println(&quot;Recompose èŒƒå›´æµ‹è¯• 1&quot;) Column { println(&quot;Recompose èŒƒå›´æµ‹è¯• 2&quot;) Text(name, Modifier.clickable { name = &quot;Hi, Kotlin&quot; }) println(&quot;Recompose èŒƒå›´æµ‹è¯• 3&quot;) NBFunction(name) } println(&quot;Recompose èŒƒå›´æµ‹è¯• 4&quot;) } }}@Composablefun NBFunction(name: String) { println(&quot;Recompose èŒƒå›´æµ‹è¯•ï¼šæˆ‘å¹²äº†å¾ˆå¤šæ¶ˆè€—æ€§èƒ½çš„äº‹ï½ï½ï½&quot;) // è¿™é‡Œé¢å¹²äº†å¾ˆå¤š NB çš„äº‹ï¼Œé€»è¾‘é‡ç‰¹åˆ«å¤§ Text(&quot;$name&quot;)} æˆ‘ä»¬ç»™ NBFunction åŠ ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆéšç€ name çš„æ”¹å˜ï¼Œçœ‹çœ‹å®ƒä¼šä¸ä¼šè¢«æ‰§è¡Œï¼š ç»“æœæ˜¾è€Œæ˜“è§äº†ï¼Compose é‡ç»„è¿‡ç¨‹ä¸­ä¼šåˆ¤æ–­ NBFunction() çš„å‚æ•° String æ˜¯å¦å˜åŒ–ã€‚ é‚£ä¹ˆå¦‚æœæˆ‘çš„å‚æ•°æ˜¯ä¸€ä¸ªå¯¹è±¡å‘¢ï¼Ÿ æ¯”å¦‚æˆ‘ä¼ å…¥çš„æ˜¯ï¼š 1data class User(val name: String) Compose åœ¨é‡ç»„è¿‡ç¨‹ä¸­ï¼Œä¾ç„¶ä¼šå¯¹å¯¹è±¡ç±»å‹çš„å‚æ•°åšåˆ¤æ–­ï¼Œä¸è¿‡å®ƒçš„åˆ¤æ–­è§„åˆ™æ˜¯ Kotlin ä¸­çš„ ==ï¼Œç­‰åŒäº Java çš„ equalsï¼Œæ˜¯ç»“æ„æ€§ç›¸ç­‰åˆ¤æ–­ã€‚ ç°åœ¨æˆ‘ä»¬ä¿®æ”¹ä¸‹ä»£ç ï¼š 12345678910111213141516171819202122232425262728293031class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) var name by mutableStateOf(&quot;Hi, Compose&quot;) var user = User(&quot;marco&quot;) // User å¯¹è±¡ setContent { println(&quot;Recompose èŒƒå›´æµ‹è¯• 1&quot;) Column { println(&quot;Recompose èŒƒå›´æµ‹è¯• 2&quot;) Text(name, Modifier.clickable { name = &quot;Hi, Kotlin&quot; user = User(&quot;marco&quot;) // ç‚¹å‡»åï¼Œæ–°çš„ User å¯¹è±¡ }) println(&quot;Recompose èŒƒå›´æµ‹è¯• 3&quot;) NBFunction(user) } println(&quot;Recompose èŒƒå›´æµ‹è¯• 4&quot;) } }}@Composablefun NBFunction(user: User) { println(&quot;Recompose èŒƒå›´æµ‹è¯•ï¼šæˆ‘å¹²äº†å¾ˆå¤šæ¶ˆè€—æ€§èƒ½çš„äº‹ï½ï½ï½&quot;) // è¿™é‡Œé¢å¹²äº†å¾ˆå¤š NB çš„äº‹ï¼Œé€»è¾‘é‡ç‰¹åˆ«å¤§ Text(&quot;${user.name}&quot;)}data class User(val name: String) ä»£ç å¾ˆç®€å•ï¼Œæˆ‘ä»¬é€šè¿‡ Log éªŒè¯ä¸‹ï¼š æˆ‘ä»¬å†æ”¹ä¸‹ä»£ç ï¼ŒæŠŠ User æ¢æˆä¸€ä¸ªæ–°çš„å†…å®¹ï¼š 123456var user = User(&quot;marco&quot;)Text(name, Modifier.clickable { name = &quot;Hi, Kotlin&quot; user = User(&quot;marco_2&quot;)}) å†çœ‹ä¸‹ Logï¼š ç¡®å®å¦‚æˆ‘ä»¬å‰é¢é¢„æƒ³ä¸€æ ·ï¼ŒCompose é‡ç»„è¿‡ç¨‹ä¸­åŒæ ·ä¼šå¯¹ NBFunction() çš„ã€Œå¯¹è±¡å‚æ•°ã€ä¹Ÿåšåˆ¤æ–­ï¼Œæ˜¯ç»“æ„æ€§ç›¸ç­‰åˆ¤æ–­ã€‚ @Stableæ¥ä¸‹æ¥çœ‹ä¸ªæœ‰è¶£çš„ä¸œè¥¿ï¼Œæˆ‘ä»¬å†æ¥æ”¹ä¸€ä¸‹ä»£ç ï¼š 123456789101112131415var user = User(&quot;marco&quot;)Text(name, Modifier.clickable { name = &quot;Hi, Kotlin&quot; user = User(&quot;marco&quot;). // user æ”¹å›æ¥ï¼Œéƒ½æ˜¯ marco å†…å®¹})==&gt; æ­¤æ—¶è‚¯å®šæ˜¯ä¼šåˆ¤æ–­ç›¸ç­‰ï¼Œä¸ä¼šæ‰§è¡Œ NBFunction() å†…éƒ¨çš„ä»£ç // æ³¨æ„äº†ï¼š==&gt; æ¥ä¸‹æ¥æˆ‘ä»¬åªæ”¹ä¸€ä¸‹å…³é”®å­—ï¼šdata class User(val name: String)// val --&gt; vardata class User(var name: String) ä»…ä»…æŠŠ val æ”¹æˆ varï¼Œè¿è¡Œçœ‹ Logï¼š Why ???? val å°±ä¼šè·³è¿‡ NBFunction() å†…éƒ¨ä»£ç ï¼Œè€Œ var å°±ä¸ä¼šè·³è¿‡ NBFunction() å†…éƒ¨ä»£ç ï¼ å…¶å®ï¼Œè¿™æ˜¯å› ä¸º Compose çš„æœ¬èº«æœºåˆ¶è®¾å®šï¼š 12data class User(val name: String) // Compose ä¼šè®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªå¯é çš„ç±»data class User(var name: String) // Compose ä¼šè®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªä¸å¯é çš„ç±» å¯¹äºä¸å¯é çš„ç±»ï¼Œæˆ‘å°±ä¸ç®¡ä½ äº†ï¼Œç›´æ¥è¿›ï¼è¿™ä¹Ÿæ˜¯å‡ºäºå¯¹ç•Œé¢æ­£ç¡®æ€§çš„è€ƒè™‘ã€‚ æ¯”å¦‚æˆ‘ä»¬ä¿®æ”¹ä¸‹ä»£ç ï¼š ä¸æ€§èƒ½ç›¸æ¯”ï¼Œå‡†ç¡®æ€§æ‰æ˜¯æœ€ç»ˆè¦çš„ï¼Œæ‰€ä»¥å°±ä¼šæ— æ¡ä»¶çš„è¿›å…¥ NBFunction() å‡½æ•°å†æ‰§è¡Œä¸€éã€‚ é‚£å¦‚æœå‡è®¾æˆ‘ä»¬å¯ä»¥ä¿è¯ä¸ä¼šå‡ºç°ä»¥ä¸Šæƒ…å†µï¼Œä¿è¯ User å¯¹è±¡æ°¸è¿œç›¸ç­‰ï¼Œå¸Œæœ› Composable æ’ä»¶ä¹Ÿå¯ä»¥è·³è¿‡å†…éƒ¨æ‰§è¡Œï¼Œæå‡æ€§èƒ½ï¼Œå¦‚ä½•åšå‘¢ï¼Ÿ ç”¨ @Stable æ³¨è§£ï¼Œå®ƒæ˜¯ä¸€ä¸ªç¨³å®šæ€§æ³¨è§£ï¼Œå‘Šè¯‰ Compose ç¼–è¯‘å™¨æ’ä»¶ï¼Œè¿™ä¸ªç±»æ˜¯å¯é çš„ã€‚è¿™æ · Compose é‡ç»„è¿‡ç¨‹ä¸­å°±ä¼šè·³è¿‡ NBFunction() å†…éƒ¨ä»£ç ã€‚ 12@Stabledata class User(var name: String) è¿è¡Œçœ‹ä¸‹ Logï¼š é™¤äº† @Stable å¯ä»¥è®¤å®šå¯é ä»¥å¤–ï¼Œè¿˜æœ‰ä¸€ç§æ–¹å¼å¯ä»¥å‘Šè¯‰ Compose æ˜¯å¯é çš„ï¼š 123class User(name: String) { var name by mutableStateOf(name) // è¿™æ˜¯ä¸€ç§æ›´é€šç”¨çš„å†™æ³•}","link":"/2025/06/22/compose/Compose%20--%20%E7%8A%B6%E6%80%81%E8%AE%A2%E9%98%85%20&%20%E8%87%AA%E5%8A%A8%E5%88%B7%E6%96%B0%20--%2005.%20%E4%BD%A0%E7%9C%9F%E7%9A%84%E4%BA%86%E8%A7%A3%E9%87%8D%E7%BB%84%E5%90%97%EF%BC%9F/"},{"title":"ç»†è¯´ remember å’Œé‡ç»„ä½œç”¨åŸŸ","text":"åŸºäº androidx.compose.runtime:runtime:1.7.1 ç‰ˆæœ¬ é˜…è¯»æœ¬ç¯‡æ–‡ç« ä¹‹å‰ï¼Œå»ºè®®å…ˆçœ‹çœ‹ã€ è§£æ mutableStateOf æºç  ã€‘ ä¸€æ–‡ï¼Œå› ä¸ºä¸¤ç¯‡æ–‡ç« æ˜¯ä¸Šä¸‹ç¯‡çš„å…³ç³»ï¼Œçœ‹å®Œä¸Šç¯‡ï¼Œå¯ä»¥æ›´å¥½çš„ä¸²è”çŸ¥è¯†ç‚¹ã€‚ Simple Code è¯ä¸å¤šè¯´ï¼Œè¿˜æ˜¯è€æ ·å­ï¼Œä» Demo ä¸€æ­¥æ­¥å¼•å‡ºæˆ‘ä»¬çš„æ ¸å¿ƒçŸ¥è¯†ç‚¹ã€‚ 1234567891011121314151617class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) var name by mutableStateOf(&quot;Compose&quot;) setContent { Text(name) // å»¶æ—¶æ›´æ–° Text å†…å®¹ LaunchedEffect(true) { delay(3000) name = &quot;Kotlin&quot; } } }} ä¸€æ®µå¾ˆç®€å•çš„ä»£ç ç¤ºä¾‹ï¼Œ3s åæ–‡å­—ä» Compose å˜ä¸º kotlinï¼Œæ‰§è¡Œçœ‹ä¸‹æ•ˆæœï¼š ç°åœ¨æˆ‘ä»¬æ”¹ä¸‹ä»£ç ï¼š 1234567891011121314151617class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { // ä»å¤–é¢æŒªåˆ°é‡Œé¢æ¥... var name by mutableStateOf(&quot;Compose&quot;) Text(name) // å»¶æ—¶æ›´æ–° Text å†…å®¹ LaunchedEffect(true) { delay(3000) name = &quot;Kotlin&quot; } } }} æ‰§è¡Œçœ‹ä¸‹æ•ˆæœï¼š å¥‡æ€ªçš„äº‹æƒ…å‘ç”Ÿäº†ï¼Œ3s åæ–‡å­—æ²¡æœ‰åˆ·æ–°ï¼ é‡ç»„ä½œç”¨åŸŸ é—®é¢˜å‡ºåœ¨å“ªï¼Ÿ é¦–å…ˆæˆ‘ä»¬å›é¡¾ä¸‹ Compose æ˜¯æ€ä¹ˆã€Œåˆ·æ–°ç•Œé¢ã€çš„ï¼Ÿæ¯”å¦‚ä¸Šé¢çš„ä¾‹å­ï¼Œå½“ name é‡æ–°èµ‹å€¼åï¼Œè¯»å–å®ƒçš„åœ°æ–¹ä¼šè¢«æ ‡è®°ä¸ºã€Œå¤±æ•ˆã€ï¼Œç„¶åã€Œé‡ç»„åˆ·æ–°ã€ã€‚ å…³é”®çŸ¥è¯†ç‚¹ åœ¨ Compose ä¸­ã€Œé‡ç»„åˆ·æ–°ã€å¹¶ä¸æ˜¯å•çº¯çš„åˆ·æ–° Text(name) è¿™ä¸€è¡Œï¼Œè€Œæ˜¯ä¼šæŠŠåŒ…å« Text(name) çš„ä»£ç å—ç»™åŒ…èµ·æ¥ï¼Œåˆ·æ–°çš„æ˜¯ã€Œæ•´ä¸ªä»£ç å—ã€ï¼Œæˆ–è€…è¯´é‡ç»„ã€Œæ•´ä¸ªä»£ç å—ã€ï¼ å°±åƒä¸‹é¢è¿™ä¸ªæ ·å­ï¼š è¿™æ®µè“è‰²èƒŒæ™¯çš„ä»£ç å—ä¼šè¢«é‡æ–°æ‰§è¡Œä¸€éï¼Œè¿™ä¸ªè“è‰²åŒºåŸŸå°±æ˜¯æ‰€è°“çš„ï¼šé‡ç»„ä½œç”¨åŸŸï¼ˆRecompose scopeï¼‰ï¼ æ‰€ä»¥å¯¼è‡´æ²¡æœ‰åˆ·æ–°çš„æ ¹æœ¬åŸå› å°±æ˜¯ï¼š ä¸ä»…ä»… Text(name) ä¼šè¢«é‡æ–°æ‰§è¡Œï¼Œvar name by mutableStateOf(&quot;Compose&quot;) ä¹Ÿä¼šæ‰§è¡Œï¼å¯¼è‡´ name åˆè¢«é‡æ–°åˆå§‹åŒ–äº†ã€‚ rememberé‚£æ€ä¹ˆè§£å†³ï¼Ÿä¸çŸ¥é“ä½ å‘ç°æ²¡æœ‰ï¼Œå…¶å®å¼€å‘å·¥å…·å·²ç»æç¤ºæˆ‘ä»¬äº†ï¼š mutableStateOf æ˜¯æ ‡çº¢çš„ï¼Œå¹¶ä¸”é”™è¯¯æç¤ºï¼šCreating a state object during composition without using remember. æ„æ€å°±æ˜¯ï¼šä½ åœ¨ç»„åˆè¿‡ç¨‹é‡Œé¢åˆ›å»ºäº† StateObject å¯¹è±¡ï¼Œä½†æ˜¯æ²¡æœ‰ç”¨ rememberã€‚ é‚£æ€ä¹ˆä½¿ç”¨ï¼Ÿå¾ˆç®€å•ï¼Œåªéœ€è¦å¥—ä¸€å±‚ rememberï¼Œä»£ç å¦‚ä¸‹ï¼š 123456789101112131415class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { var name by remember { mutableStateOf(&quot;Compose&quot;) } Text(name) LaunchedEffect(true) { delay(3000) name = &quot;Kotlin&quot; } } }} åŠ äº† remember åï¼Œåœ¨ç¬¬ä¸€æ¬¡æ‰§è¡Œçš„æ—¶å€™ï¼Œä¼šæ‰§è¡Œ Lambda è¡¨è¾¾å¼ï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œ mutableStateOf(&quot;Compose&quot;)ï¼Œå¹¶ä¸” remember ä¼šä¿å­˜ç»“æœï¼ˆStateObjectï¼‰ï¼Œå†æ¬¡è°ƒç”¨çš„æ—¶å€™ä¼šç›´æ¥è¿”å›ä¿å­˜çš„è€å¯¹è±¡ï¼ˆStateObjectï¼‰ï¼Œè€Œä¸æ˜¯å†æ¬¡æ‰§è¡Œ Lambda è¡¨è¾¾å¼é‡Œé¢çš„ä»£ç ï¼Œç›¸å½“äºå……å½“äº†ã€Œç¼“å­˜ã€çš„åŠŸèƒ½ã€‚ æˆ‘ä»¬æ‰§è¡Œä¸‹ä¿®æ”¹åçš„ä»£ç ï¼š æ–‡å­—æ›´æ–°äº†ï¼remember èµ·åˆ°äº†ç¼“å­˜çš„ä½œç”¨ï¼Œå°±æ˜¯ä¸ºäº†é˜²æ­¢å¤šæ¬¡åˆå§‹åŒ–å˜é‡è€Œå¯¼è‡´ç¨‹åºä¸å¯æ§ï¼ æ‰€ä»¥æœ‰ä¸ªåŸåˆ™ åœ¨ Compose é‡Œé¢ä½ åªè¦ç”¨äº† mutableStateOfï¼Œé‚£ä¹ˆèƒ½åŠ  remember æˆ‘ä»¬å°±åŠ  rememberã€‚ å¦å¤–æˆ‘ä»¬éœ€è¦æ³¨æ„ remember æ˜¯å¯ä»¥å¸¦å‚æ•°çš„ï¼šå¯ä»¥ã€Œä¸€ä¸ªã€æˆ–è€…ã€Œå¤šä¸ªã€å‚æ•°ã€‚ 1234567891011121314151617181920212223242526272829ğŸ“„ androidx.compose.runtime -&gt; Composables.kt/** * Remember the value returned by [calculation] if [key1] is equal to the previous composition, * otherwise produce and remember a new value by calling [calculation]. */@Composableinline fun &lt;T&gt; remember( key1: Any?, calculation: @DisallowComposableCalls () -&gt; T): T { return currentComposer.cache(currentComposer.changed(key1), calculation)}/** * Remember the value returned by [calculation] if [key1] and [key2] are equal to the previous * composition, otherwise produce and remember a new value by calling [calculation]. */@Composableinline fun &lt;T&gt; remember( key1: Any?, key2: Any?, calculation: @DisallowComposableCalls () -&gt; T): T { return currentComposer.cache( currentComposer.changed(key1) or currentComposer.changed(key2), calculation )} æœ‰ä»€ä¹ˆç”¨ï¼Œä¸¾ä¸ªä¾‹å­è¯´æ˜ï¼Œæ¯”å¦‚æˆ‘ä»¬è‡ªå®šä¹‰äº†ä¸€ä¸ª Composable å‡½æ•°ï¼š 12345@Composablefun showCharCount(value: String) { val length = value.length Text(&quot;å­—ç¬¦ä¸²é•¿åº¦ï¼š$length&quot;)} å¾ˆç®€å•ï¼Œä¸€ä¸ªæ˜¾ç¤ºå­—ç¬¦ä¸²é•¿åº¦çš„å‡½æ•°ã€‚ ç°åœ¨æˆ‘ä»¬æ¥å‡è®¾ä¸€ä¸ªåœºæ™¯ï¼š ä¼ å…¥è¿›æ¥çš„å­—ç¬¦ä¸²ç‰¹åˆ«é•¿ï¼› å¹¶ä¸” showCharCount åå¤è¢«è°ƒç”¨äº†å¾ˆå¤šæ¬¡ï¼› é‚£ä¹ˆ value.length æ¯æ¬¡éƒ½è¢«è°ƒç”¨ï¼Œå°±æ˜¾å¾—æœ‰ç‚¹ç¬¨é‡äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç»™å®ƒåŠ ä¸Šä¸€ä¸ª rememberï¼š 1234567@Composablefun showCharCount(value: String) { val length = remember { value.length } Text(&quot;å­—ç¬¦ä¸²é•¿åº¦ï¼š$length&quot;)} ä½†æ­¤æ—¶å°±ä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼š 12345678910@Composablefun showCharCount(value: String) { // ç¬¬ä¸€æ¬¡ä¼ è¿›æ¥ï¼šabcd // ç¬¬äºŒæ¬¡ä¼ è¿›æ¥ï¼šabcdefg // ç¬¬ä¸‰æ¬¡ä¼ è¿›æ¥ï¼šabcdefghijklmn val length = remember { value.length } Text(&quot;å­—ç¬¦ä¸²é•¿åº¦ï¼š$length&quot;)} å­—ç¬¦ä¸²é•¿åº¦æ°¸è¿œéƒ½æ˜¯ï¼š4ï¼Œå› ä¸º value.length ä¸ä¼šè¢«æ‰§è¡Œï¼Œé‚£æ€ä¹ˆåŠï¼š 12345678910@Composablefun showCharCount(value: String) { // ç¬¬ä¸€æ¬¡ä¼ è¿›æ¥ï¼šabcd // ç¬¬äºŒæ¬¡ä¼ è¿›æ¥ï¼šabcdefg // ç¬¬ä¸‰æ¬¡ä¼ è¿›æ¥ï¼šabcdefghijklmn val length = remember(value) { value.length } Text(&quot;å­—ç¬¦ä¸²é•¿åº¦ï¼š$length&quot;)} æˆ‘ä»¬ç»™ remember åŠ äº†ä¸€ä¸ªå‚æ•°ï¼švalueï¼Œåªè¦è¿™ä¸ª key å˜åŒ–äº†ï¼Œé‚£ä¹ˆå°±ä¼šé‡æ–°æ‰§è¡Œ Lambda è¡¨è¾¾å¼ï¼Œè¿™å°±æ˜¯å¸¦å‚æ•°çš„ remember çš„ç”¨æ³•ã€‚","link":"/2025/06/07/compose/Compose%20--%20%E7%8A%B6%E6%80%81%E8%AE%A2%E9%98%85%20&%20%E8%87%AA%E5%8A%A8%E6%9B%B4%E6%96%B0%20--%2002.%20remember%20%E5%92%8C%E9%87%8D%E7%BB%84%E4%BD%9C%E7%94%A8%E5%9F%9F/"},{"title":"è§£æ DrawModifier","text":"â€œJetpack Compose - - Modifier åŸç†ç³»åˆ—æ–‡ç«  â€œ &nbsp;&nbsp;&nbsp;&nbsp;ğŸ“‘ ã€Š æ·±åº¦è§£æ Compose çš„ Modifier åŸç† - - Modifierã€CombinedModifier ã€‹ &nbsp;&nbsp;&nbsp;&nbsp;ğŸ“‘ ã€Š æ·±åº¦è§£æ Compose çš„ Modifier åŸç† - - Modifier.composed()ã€ComposedModifier ã€‹ &nbsp;&nbsp;&nbsp;&nbsp;ğŸ“‘ ã€Š æ·±åº¦è§£æ Compose çš„ Modifier åŸç† - - Modifier.layout()ã€LayoutModifier ã€‹ &nbsp;&nbsp;&nbsp;&nbsp;ğŸ“‘ ã€Š æ·±åº¦è§£æ Compose çš„ Modifier åŸç† - - DrawModifier ã€‹ &nbsp;&nbsp;&nbsp;&nbsp;ğŸ“‘ ã€Š æ·±åº¦è§£æ Compose çš„ Modifier åŸç† - - PointerInputModifier ã€‹ &nbsp;&nbsp;&nbsp;&nbsp;ğŸ“‘ ã€Š æ·±åº¦è§£æ Compose çš„ Modifier åŸç† - - ParentDataModifier ã€‹ åœ¨æ­£å¼å¼€å§‹åˆ†æ DrawModifier ä¹‹å‰ï¼Œå»ºè®®ä½ å…ˆçœ‹çœ‹ ã€LayoutModifier å’Œ Modifier.layout ç”¨æ³•åŠåŸç†ã€‘è¿™ç¯‡æ–‡ç« ï¼Œæ¯•ç«Ÿå®ƒæ˜¯ä½œä¸º Modifier åŸç†è§£æçš„ç¬¬ä¸€ç¯‡æ–‡ç« ï¼Œå¯¹ä½ äº†è§£æ•´ä¸ª Modifier æ¶æ„è¿˜æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ï¼Œæˆ–è€…è¯´å®ƒæ˜¯æœ€åŸºç¡€çš„ä¸€ç¯‡æ–‡ç« ï¼Œå¦‚æœä¸ç†Ÿæ‚‰ï¼Œåé¢çš„ç³»åˆ— Modifier ä½ å¯èƒ½ä¼šçœ‹çš„æ¯”è¾ƒè´¹åŠ²â€¦ ä¸€ã€è¯é¢˜å¼•å…¥ è€æ ·å­ï¼Œæˆ‘ä»¬ä» Demo å¼€å§‹ï¼Œé¦–å…ˆæˆ‘ä»¬çœ‹ä¸¤ä¸ªç®€å•çš„åœºæ™¯ï¼š 1.1 é—®é¢˜åœºæ™¯ 1ä¸€ä¸ªç»¿è‰²èƒŒæ™¯çš„ Text()ï¼š 123456789101112class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { ComposeBlogTheme { Box(Modifier.background(Color.Green)) { Text(&quot;Hi Compose&quot;) } } } }} æ•ˆæœå¦‚ä¸‹ï¼š ![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/2f6fbfcdc180b9670cfce0abb8236bf4.png =500x) å¦‚æœæˆ‘æ”¹åŠ¨ä¸€ä¸‹ä»£ç ï¼š 12345678910111213class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { ComposeBlogTheme { Box(Modifier.background(Color.Green).size(120.dp)) { Text(&quot;Hi Compose&quot;) } } } }} åªæ˜¯ç»™ Box åŠ äº†ä¸€ä¸ªå°ºå¯¸ï¼š ![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/14eca7bc86b124dccb8a26fb7e731a28.png =500x) å—¯ï¼Œæ•ˆæœä¸é”™ï¼Œé‚£å¦‚æœæˆ‘å†æ”¹ä¸€æ¬¡å‘¢ï¼Ÿ 12345678910111213class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { ComposeBlogTheme { Box(Modifier.background(Color.Green).size(120.dp).background(Color.Red)) { Text(&quot;Hi Compose&quot;) } } } }} åˆåŠ äº†ä¸€ä¸ª backgroundï¼Œçœ‹ä¸‹æ•ˆæœï¼š ![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/da9a778662bd7af48e1d253c5f9edb8f.png =500x) æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼šä¸ºä»€ä¹ˆæ­¤æ—¶çš„ Box æ˜¯çº¢è‰²ï¼Œè€Œä¸æ˜¯ç»¿è‰²ï¼Ÿ å¦‚æœä½ çœ‹äº† LayoutModifier çš„åŸç†è§£æï¼Œè¿™è¾¹å°±ä¼šäº§ç”Ÿä¸€ä¸ªå›°æƒ‘ï¼šModifier ä¸æ˜¯ä»å³è¾¹å¼€å§‹ï¼Œä¾æ¬¡å¾€å·¦éå†ï¼Œæœ€ç»ˆåº”è¯¥æ˜¯ç»¿è‰²èƒŒæ™¯ï¼Œè€Œä¸åº”è¯¥æ˜¯çº¢è‰²èƒŒæ™¯å•Šï¼Ÿ æ‰€ä»¥ï¼Œé—®é¢˜å‡ºåœ¨å“ªï¼Ÿæˆ‘ä»¬ä¸å¦¨å…ˆç®€å•çœ‹ä¸‹ Modifier.background() æºç ï¼š 1234567891011fun Modifier.background( color: Color, shape: Shape = RectangleShape): Modifier { val alpha = 1.0f // for solid colors return this.then( BackgroundElement( ... ) )} å®ƒåˆè°ƒç”¨äº† BackgroundElementï¼š 123private class BackgroundElement( ...) : ModifierNodeElement&lt;BackgroundNode&gt;() { çœ‹è¿‡ä¹‹å‰ LayoutModifier è§£æçš„æ–‡ç« çš„è¯ï¼Œè¿™è¾¹ä½ åº”è¯¥ä¸ä¼šé™Œç”Ÿäº†å§ï¼ŸBackgroundElement ä¼šè½¬æ¢æˆä¸€ä¸ª BackgroundNode å¯¹è±¡ï¼Œå®ƒæ˜¯å®é™…çš„é“¾è¡¨èŠ‚ç‚¹ã€‚ 123private class BackgroundNode( ...) : DrawModifierNode, Modifier.Node() { å®ƒæ˜¯ä¸€ä¸ª DrawModifierNodeï¼Œæ‰€ä»¥æ˜¯ DrawModifierNode å½±å“äº†èƒŒæ™¯çš„ç»˜åˆ¶ï¼Ÿ 1.2 é—®é¢˜åœºæ™¯ 2åœ¨ä¹‹å‰æˆ‘ä»¬åˆ†æ LayoutModifier æ–‡ç« ä¸­æåˆ°è¿‡ï¼šå¦‚æœæˆ‘ä»¬éœ€è¦è‡ªå·±åˆ›å»ºä¸€ä¸ª LayoutModifierï¼Œå¯ä»¥é€šè¿‡ Modifier.layout()ï¼ŒåŒæ ·çš„å¦‚æœæˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ª DrawModifierï¼Œå¯ä»¥é€šè¿‡ Modifier.drawWithContent()ï¼Œæ¯”å¦‚ï¼š 12345678910111213class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { ComposeBlogTheme { Box(Modifier.background(Color.Green).size(120.dp).drawWithContent { }) { Text(&quot;Hi Compose&quot;) } } } }} çœ‹ä¸‹æ•ˆæœï¼š ![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/9f3a175fff1af88c1f664b79614393de.png =500x) ï¼Ÿï¼Ÿï¼Ÿä¸å¯¹å•Šï¼ŒText() å“ªå»äº†ï¼Ÿæˆ‘ç°åœ¨å†æ¥ä¿®æ”¹ä¸‹ä»£ç ï¼š 12345678910111213class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { ComposeBlogTheme { Box(Modifier.background(Color.Green).size(120.dp).drawWithContent { drawContent() }) { Text(&quot;Hi Compose&quot;) } } } }} ä»…ä»…æ˜¯åœ¨ drawWithContent é‡Œé¢åŠ äº†ä¸€ä¸ª drawContent()ï¼Œå†çœ‹ä¸‹æ•ˆæœï¼š ![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/12aed22080dd8c7f7e7c25cc200a1ad4.png =500x) Text() åˆå‡ºæ¥äº†ï¼Œä¸ºä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆè¦åŠ  drawContent()ï¼Œ drawContent() åˆæ˜¯ä»€ä¹ˆï¼Ÿéš¾é“å®ƒè´Ÿè´£ç»˜åˆ¶ Text()ï¼Ÿ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å¸¦ç€è¿™ä¸¤ä¸ªé—®é¢˜æ­£å¼è¿›å…¥è¿™ç¯‡æ–‡ç« çš„ä¸»é¢˜ï¼ äºŒã€DrawModifierNode æŸ¥çœ‹ Modifier.background() å’Œ Modifier.drawWithContent() çš„æºç ï¼Œå‘ç°å®ƒä»¬èƒŒåçš„ BackgroundElement å’Œ DrawWithContentElement éƒ½ç»§æ‰¿è‡ª ModifierNodeElement&lt;N : Modifier.Node&gt;ã€‚ 1234567891011121314151617181920212223242526272829303132&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Modifier.background() &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;fun Modifier.background(...): Modifier { val alpha = 1.0f // for solid colors return this.then( BackgroundElement( ... ) )}private class BackgroundElement( ...) : ModifierNodeElement&lt;BackgroundNode&gt;()private class BackgroundNode( ...) : DrawModifierNode, Modifier.Node()&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Modifier.drawWithContent() &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;fun Modifier.drawWithContent( onDraw: ContentDrawScope.() -&gt; Unit): Modifier = this then DrawWithContentElement(onDraw)private data class DrawWithContentElement( val onDraw: ContentDrawScope.() -&gt; Unit) : ModifierNodeElement&lt;DrawWithContentModifier&gt;()private class DrawWithContentModifier( var onDraw: ContentDrawScope.() -&gt; Unit) : Modifier.Node(), DrawModifierNode { ....} è€Œä¸”æ³›å‹ç±»å‹ BackgroundNode å’Œ DrawWithContentModifier éƒ½å®ç°äº† DrawModifierNode æ¥å£ã€‚ ç”»äº†ä¸ªå›¾ï¼Œçœ‹ç€æ›´ç›´è§‚ï¼š è¿™ä¸ª DrawModifierNode æ¥å£å°±æ˜¯ Draw ä¿®é¥°ç¬¦çš„æ ¸å¿ƒï¼Œå®ƒå®šä¹‰äº† Draw ä¿®é¥°ç¬¦çš„æ ¸å¿ƒé€»è¾‘ã€‚ 123456789101112/** * A [Modifier.Node] that draws into the space of the layout. * * This is the [androidx.compose.ui.Modifier.Node] equivalent of * [androidx.compose.ui.draw.DrawModifier] * * @sample androidx.compose.ui.samples.DrawModifierNodeSample */interface DrawModifierNode : DelegatableNode { fun ContentDrawScope.draw() // draw ç»˜åˆ¶æ–¹æ³• fun onMeasureResultChanged() {}} é‚£ä¹ˆï¼Œæˆ‘ä»¬è¦æ¢ç©¶ Draw ä¿®é¥°ç¬¦å¦‚ä½•å½±å“å…ƒç´ ç»˜åˆ¶è¿‡ç¨‹ï¼Œé‡ç‚¹å°±æ˜¯çœ‹å…ƒç´ çš„ç»˜åˆ¶åœ¨å“ªç”¨åˆ°äº† DrawModifierNodeï¼Œæˆ–è€…æ›´å‡†ç¡®åœ°è¯´ï¼ŒDrawModifierNode çš„ draw() æ–¹æ³•åœ¨ä½•å¤„è¢«è°ƒç”¨äº†ã€‚ ä¸‰ã€ DrawModifierNode å¯¹ç»˜åˆ¶çš„å½±å“ ç°åœ¨æˆ‘ä»¬å·²ç»å¾ˆæ¸…æ¥š LayoutNode æ˜¯å¦‚ä½•å¤„ç† DrawModifierNode çš„äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±çœ‹çœ‹ DrawModifierNode æ˜¯å¦‚ä½•å¯¹ç»˜åˆ¶äº§ç”Ÿç²¾ç»†å½±å“çš„ã€‚ åœ¨ LayoutNode ä¸­ï¼Œç»˜åˆ¶æ˜¯ç”± draw() å‡½æ•°å¤„ç†çš„ã€‚ 1234567// LayoutNode.ktinternal class LayoutNode(...) : ... { internal val outerCoordinator: NodeCoordinator get() = nodes.outerCoordinator internal fun draw(canvas: Canvas) = outerCoordinator.draw(canvas)} çœ‹è¿‡ä¹‹å‰ LayoutModifierNode è§£æçš„æ–‡ç« åï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“ outerCoordinator æ˜¯ä¸€ä¸ª NodeCoordinatorã€‚ 3.1 NodeCoordinator.draw()ç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹ NodeCoordinator çš„ draw() æ–¹æ³•ï¼š 1234567891011121314151617181920// NodeCoordinator.ktinternal abstract class NodeCoordinator( override val layoutNode: LayoutNode,) : ... { fun draw(canvas: Canvas) { // layer: æ˜¯ä¸€ä¸ªç‹¬ç«‹ç»˜åˆ¶çš„å›¾å±‚ï¼Œå®ƒåªæ˜¯åœ¨ä¸€å—é¢å¤–çš„åŒºåŸŸç»˜åˆ¶è€Œå·²ï¼Œå¤§å¤šæ•°æ—¶å€™æ˜¯æ²¡æœ‰çš„ val layer = layer if (layer != null) { layer.drawLayer(canvas) } else { val x = position.x.toFloat() val y = position.y.toFloat() canvas.translate(x, y) drawContainedDrawModifiers(canvas) // å…³é”®ä»£ç  canvas.translate(-x, -y) } }} å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦è€ƒè™‘ layer å›¾å±‚ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥å½“å®ƒä¸º null å¤„ç†ã€‚æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å…³å¿ƒ else åˆ†æ”¯å†…éƒ¨çš„é€»è¾‘ï¼Œæ ¸å¿ƒä»£ç å°±ä¸€è¡Œï¼šdrawContainedDrawModifiers(canvas)ã€‚ 3.2 drawContainedDrawModifiers()12345678910111213141516// NodeCoordinator.ktinternal abstract class NodeCoordinator( override val layoutNode: LayoutNode,) : ... { private fun drawContainedDrawModifiers(canvas: Canvas) { val head = head(Nodes.Draw) if (head == null) { performDraw(canvas) } else { val drawScope = layoutNode.mDrawScope drawScope.draw(canvas, size.toSize(), this, head) } } } è¿™æ®µä»£ç çš„é€»è¾‘å¾ˆæ¸…æ™°ï¼Œä¸»è¦å°±æ˜¯ä¸‰æ­¥ï¼š è·å–å½“å‰ NodeCoordinator èŒƒå›´å†…çš„çš„ç¬¬ä¸€ä¸ª Draw ä¿®é¥°ç¬¦ 1val head = head(Nodes.Draw) è¡¨å¤´å¦‚æœä¸ºç©ºï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰è®¾ç½®è¿‡ DrawModifier 123if (head == null) { performDraw(canvas)} é‚£ä¹ˆå°±ä¼šæ‰§è¡Œ performDraw()ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å®ƒåšäº†ä»€ä¹ˆï¼š 123open fun performDraw(canvas: Canvas) { wrapped?.draw(canvas)} wrapped æ˜¯ä»€ä¹ˆï¼Ÿ 1internal open val wrapped: LayoutNodeWrapper? get() = null å®ƒå°±æ˜¯å½“å‰çš„ LayoutNodeWrapper å¯¹è±¡ï¼Œè€Œ LayoutNodeWrapper æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ã€‚ æ³¨æ„ï¼š æˆ‘ä»¬ç°åœ¨åˆ†æçš„åœºæ™¯æ˜¯æ²¡æœ‰è®¾ç½® DrawModifierï¼Œé‚£ä¹ˆå®é™…ä»£ç å¯èƒ½æ˜¯è¿™æ ·ï¼š 1Box(Modifier.padding(10.dp).size(120.dp)) å¯¹åº”çš„å†…éƒ¨ Modifier çš„ç»“æ„å¤§æ¦‚æ˜¯è¿™ä¸ªæ ·å­ï¼š 123456789ModifiedLayoutNode[ LayoutModifier // padding(10.dp) + ModifiedLayoutNode[ LayoutModifier // size(120.dp) + innerLayoutNodeWrapper // Box() ]] ModifiedLayoutNode æœ¬èº«å°±æ˜¯ä¸€ä¸ª LayoutNodeWrapper çš„å­ç±»ï¼Œæ‰€ä»¥ï¼Œä½ ç°åœ¨çŸ¥é“ä¸Šé¢çš„ wrapped æ˜¯ä»€ä¹ˆäº†å—ï¼Ÿ 123456789ModifiedLayoutNode[ // wrapped LayoutModifier + ModifiedLayoutNode[ // wrapped LayoutModifier + innerLayoutNodeWrapper // wrapped ]] å†æ¥çœ‹çœ‹ wrapped.draw() å¹²äº†ä»€ä¹ˆï¼š 123456789101112fun draw(canvas: Canvas) { val layer = layer if (layer != null) { layer.drawLayer(canvas) } else { val x = position.x.toFloat() val y = position.y.toFloat() canvas.translate(x, y) drawContainedDrawModifiers(canvas) canvas.translate(-x, -y) }} åˆè·³å› draw() å‡½æ•°äº†ï¼Œè€Œä½ è¿˜è®°å¾— drawContainedDrawModifiers æ˜¯å¹²å˜›çš„å—ï¼Ÿå®ƒçš„æ ¸å¿ƒå°±æ˜¯ç”¨æ¥æ£€æŸ¥æ˜¯å¦æœ‰ DrawModifier çš„é“¾è¡¨çš„è¡¨å¤´ï¼Œå¦‚æœæ²¡æœ‰å°±ä¸€ç›´å¾€å†…éƒ¨æ‰¾ï¼š 123456789ModifiedLayoutNode[ LayoutModifier // padding(10.dp) --&gt; æ²¡æœ‰è®¾ç½® DrawModifierï¼Œå°±å»æ‰¾å†…éƒ¨æœ‰æ²¡æœ‰è®¾ç½® DrawModifier + ModifiedLayoutNode[ LayoutModifier // size(120.dp) --&gt; æ²¡æœ‰è®¾ç½® DrawModifierï¼Œå°±å»æ‰¾å†…éƒ¨æœ‰æ²¡æœ‰è®¾ç½® DrawModifier + innerLayoutNodeWrapper // Box() --&gt; æ²¡æœ‰è®¾ç½® DrawModifierï¼Œå®ƒæ²¡æœ‰å†…éƒ¨äº†ï¼Œå°±ä¸æ‰¾äº† ]] æ‰€ä»¥æˆ‘ä»¬æ€»ç»“ä¸‹ï¼šä¸ç®¡ä½ è®¾ç½®äº†å¤šå°‘ Modifier.**ï¼Œåœ¨ç»˜åˆ¶çš„æ—¶å€™ï¼Œéƒ½ä¼šéå†ä¸€éï¼Œåªè¦æ²¡æœ‰ DrawModifier å°±ä¸ä¼šè¿›è¡Œä»»ä½•ç»˜åˆ¶åŠ¨ä½œã€‚ è¡¨å¤´ä¸ä¸ºç©ºï¼Œæœ‰è®¾ç½® DrawModifier 123else { head.draw(canvas)} å¦‚æœæˆ‘ä»¬è®¾ç½®äº† DrawModifierï¼šæ¯”å¦‚ Modifier.background()ï¼Œé‚£ä¹ˆå°±ä¼šæ‰§è¡Œ head.draw()ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹å®ƒåˆåšäº†ä»€ä¹ˆï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748// DrawEntity.ktfun draw(canvas: Canvas) { ... ... val drawScope = layoutNode.mDrawScope // 1. æ ¸å¿ƒä»£ç ï¼Œçœ‹çœ‹ drawScope.draw() åšäº†ä»€ä¹ˆå·¥ä½œ drawScope.draw(canvas, size, layoutNodeWrapper, this) { with(drawScope) { with(modifier) { draw() } } }}// LayoutNodeDrawScope.ktinternal inline fun draw( canvas: Canvas, size: Size, layoutNodeWrapper: LayoutNodeWrapper, drawEntity: DrawEntity, block: DrawScope.() -&gt; Unit) { val previousDrawEntity = this.drawEntity this.drawEntity = drawEntity // 2. æ ¸å¿ƒä»£ç  canvasDrawScope.draw( layoutNodeWrapper.measureScope, layoutNodeWrapper.measureScope.layoutDirection, canvas, size, block ) this.drawEntity = previousDrawEntity}// CanvasDrawScope.ktinline fun draw( density: Density, layoutDirection: LayoutDirection, canvas: Canvas, size: Size, block: DrawScope.() -&gt; Unit) { ... ... this.block() // 3. æ ¸å¿ƒä»£ç  ... ...} æœ€ç»ˆè°ƒç”¨äº† block()ï¼Œè¿™ä¸ª block å¤ªç†Ÿäº†ï¼Œå®ƒè‚¯å®šæ˜¯ä¸€ä¸ªä¼ è¿›æ¥çš„ Lambda è¡¨è¾¾å¼ï¼Œä¹Ÿå°±æ˜¯ï¼š ![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/blog_migrate/6980d794c11d4de2db9540cf3ce46a45.png =700x) æ‰€ä»¥æˆ‘ä»¬çš„é‡ç‚¹å°±è½¬ç§»åˆ°ç ”ç©¶è¿™æ®µ lambda è¡¨è¾¾å¼çš„å·¥ä½œå†…å®¹äº†ã€‚ å®ƒé‡Œé¢ä¹Ÿæœ‰ä¸€ä¸ª draw()ï¼Œæˆ‘ä»¬çœ‹çœ‹å®ƒåšäº†å•¥ï¼š 123456// DrawModifier.kt@JvmDefaultWithCompatibilityinterface DrawModifier : Modifier.Element { fun ContentDrawScope.draw()} å’¦ï¼Ÿæ˜¯ DrawModifier æ¥å£çš„ draw() æ–¹æ³•ï¼Œé‚£è‚¯å®šæœ‰æŸä¸ªè¿™ä¸ªæ¥å£çš„å®ç°ç±»å®ç°äº†è¿™ä¸ª draw() æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥æœç´¢ä¸‹çœ‹çœ‹ï¼š çœ‹åˆ°æ²¡ï¼ŒBackgroundï¼ æ‰€ä»¥æˆ‘ä»¬ç°åœ¨å¯ä»¥æ¥çœ‹ä¸‹ Background çš„å†…éƒ¨çš„ draw() é€»è¾‘ï¼š 123456789101112131415private class Background constructor( ... ...) : DrawModifier, InspectorValueInfo(inspectorInfo) { override fun ContentDrawScope.draw() { if (shape === RectangleShape) { // shortcut to avoid Outline calculation and allocation drawRect() } else { drawOutline() } drawContent() }} ç»†å¿ƒçš„ä½ æ˜¯ä¸æ˜¯å‘ç°äº† drawContent()ï¼Ÿ è¿˜è®°å¾—æˆ‘ä»¬æ–‡ç« å¼€å¤´ç¬¬äºŒä¸ªç–‘æƒ‘çš„é—®é¢˜å—ï¼Ÿæˆ‘ä»¬å›é¡¾ä¸€ä¸‹ä»£ç ï¼š 12345678910111213class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { ComposeBlogTheme { Box(Modifier.background(Color.Green).size(120.dp).drawWithContent { drawContent() }) { Text(&quot;Hi Compose&quot;) } } } }} ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥æ¥çœ‹çœ‹ drawWithContent çš„å†…éƒ¨ä»£ç ï¼š 1234567891011121314151617181920// DrawModifier.ktfun Modifier.drawWithContent( onDraw: ContentDrawScope.() -&gt; Unit): Modifier = this then DrawWithContentElement(onDraw)private data class DrawWithContentElement( val onDraw: ContentDrawScope.() -&gt; Unit) : ModifierNodeElement&lt;DrawWithContentModifier&gt;() { override fun create() = DrawWithContentModifier(onDraw) // åˆ›å»º DrawWithContentModifier ... ...}private class DrawWithContentModifier( var onDraw: ContentDrawScope.() -&gt; Unit) : Modifier.Node(), DrawModifierNode { override fun ContentDrawScope.draw() { onDraw() // è¿™ä¸å°±ç±»ä¼¼äº blockï¼Ÿ }} æ‰€ä»¥å®é™…ä¸Šè°ƒç”¨çš„æ˜¯å•¥ï¼Ÿ ä¹Ÿå°±æ˜¯è°ƒç”¨äº† drawContent()ã€‚ æ‰€ä»¥ä¸ç®¡æ˜¯ Modifier.background() è¿˜æ˜¯ä½ è‡ªå·± drawWithContent()ï¼Œéƒ½ä¼š/éœ€è¦è°ƒç”¨ drawContent() å‡½æ•°ã€‚ æ‰€ä»¥ï¼Œç°åœ¨æˆ‘ä»¬å°±å¯ä»¥é‡ç‚¹ç ”ç©¶ä¸‹ drawContent() åˆ°åº•æ˜¯åšäº†ä»€ä¹ˆäº†ï¼ 123456interface ContentDrawScope : DrawScope { /** * Causes child drawing operations to run during the `onPaint` lambda. */ fun drawContent()} åˆæ˜¯ä¸€ä¸ªæ¥å£å†…éƒ¨çš„æ–¹æ³•ï¼Œå†æœä¸€ä¸‹å“ªä¸ªåœ°æ–¹å®ç°äº† - - å…¨å±€åªæœ‰ä¸€ä¸ªåœ°æ–¹å®ç°äº†ï¼Œå¦‚ä¸‹ï¼š 12345678910111213141516171819internal class LayoutNodeDrawScope( private val canvasDrawScope: CanvasDrawScope = CanvasDrawScope()) : DrawScope by canvasDrawScope, ContentDrawScope { private var drawEntity: DrawEntity? = null override fun drawContent() { drawIntoCanvas { canvas -&gt; val drawEntity = drawEntity!! val nextDrawEntity = drawEntity.next if (nextDrawEntity != null) { nextDrawEntity.draw(canvas) } else { drawEntity.layoutNodeWrapper.performDraw(canvas) } } } ... ...} drawIntoCanvas æ˜¯ä»€ä¹ˆï¼Ÿ 1inline fun DrawScope.drawIntoCanvas(block: (Canvas) -&gt; Unit) = block(drawContext.canvas) åˆæ˜¯ä¸€ä¸ª blockï¼Œæ‰€ä»¥æˆ‘ä»¬åªå…³å¿ƒ lambda è¡¨è¾¾å¼å†…éƒ¨çš„é€»è¾‘å³å¯ï¼Œåˆ†ä¸¤æ­¥èµ°ï¼š å¦‚æœ DrawModifier é“¾è¡¨çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ä¸º nullï¼Œè¯´æ˜åªæœ‰ä¸€ä¸ª DrawModifier é“¾è¡¨å¤´æˆ–æ²¡æœ‰æ›´å¤š DrawModifierï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šè®©ä¸‹ä¸€ä¸ª LayoutNodeWrapper æŸ¥æ‰¾å…¶å†…éƒ¨æœ‰æ²¡æœ‰ DrawModifierã€‚ æ¯”å¦‚ï¼š 1Box(Modifier.padding(10.dp).background(Color.Red).size(120.dp)) å¯¹åº”çš„å†…éƒ¨ Modifier çš„ç»“æ„å¤§æ¦‚æ˜¯è¿™ä¸ªæ ·å­ï¼š 1234567891011ModifiedLayoutNode1( PaddingModifier, [null, null, null, null, null, null, null] ModifiedLayoutNode2( SizeModifier, [DrawModifier, null, null, null, null, null, null] // ç°åœ¨ DrawModifier æ˜¯è¡¨å¤´ innerLayoutNodeWrapper( [null, null, null, null, null, null, null] ) )) ç°åœ¨é’ˆå¯¹è¿™ä¸ªåœºæ™¯ï¼Œåªæœ‰ä¸€ä¸ª DrawModifierï¼Œå®ƒæ˜¯è¡¨å¤´ï¼Œå¹¶ä¸”å®ƒæ²¡æœ‰ä¸‹ä¸€ä¸ªèŠ‚ç‚¹äº†ï¼Œé‚£ä¹ˆå°±ä¼šæ‰§è¡Œï¼š 1drawEntity.layoutNodeWrapper.performDraw(canvas) å…·ä½“å¤„ç†æµç¨‹å¦‚ä¸‹ï¼š &nbsp;&nbsp;&nbsp;&nbsp;==&gt; ModifiedLayoutNode1 æ²¡æœ‰ DrawModifierï¼Œç»§ç»­ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ ModifiedLayoutNode2 æŸ¥æ‰¾æœ‰æ²¡æœ‰ DrawModifierï¼› &nbsp;&nbsp;&nbsp;&nbsp;==&gt; ModifiedLayoutNode2 æœ‰ DrawModifierï¼ŒDrawModifier.draw() è°ƒç”¨ç»˜åˆ¶ï¼ŒDrawModifier é“¾è¡¨æ²¡æœ‰ä¸‹ä¸€ä¸ª DrawModifierï¼Œç»§ç»­ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ InnerNodeCoordinator æŸ¥æ‰¾æœ‰æ²¡æœ‰ DrawModifierï¼› &nbsp;&nbsp;&nbsp;&nbsp;==&gt; InnerNodeCoordinator æ²¡æœ‰ DrawModifierï¼Œç»˜åˆ¶ç»“æŸ å¦‚æœ DrawModifier é“¾è¡¨çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ä¸ä¸º nullï¼Œè¯´æ˜è¿˜æœ‰ DrawModifierï¼Œä» DrawModifier é“¾è¡¨å¤´å¼€å§‹éå†è°ƒç”¨ DrawModifier å¤„ç†ç»˜åˆ¶ã€‚ æ¯”å¦‚ï¼š 1Box(Modifier.padding(10.dp).background(Color.Red).background(Color.Blue).size(120.dp)) å¯¹åº”çš„å†…éƒ¨ Modifier çš„ç»“æ„å¤§æ¦‚æ˜¯è¿™ä¸ªæ ·å­ï¼š 1234567891011ModifiedLayoutNode1( PaddingModifier, [null, null, null, null, null, null, null] ModifiedLayoutNode2( SizeModifier, [DrawModifier2 -&gt; DrawModifier1, null, null, null, null, null, null] innerLayoutNodeWrapper( [null, null, null, null, null, null, null] ) )) ç°åœ¨é’ˆå¯¹è¿™ä¸ªåœºæ™¯ï¼Œè¡¨å¤´æœ‰ä¸‹ä¸€ä¸ªèŠ‚ç‚¹äº†ï¼Œé‚£ä¹ˆå°±ä¼šæ‰§è¡Œï¼š 1nextDrawEntity.draw(canvas) è·³è½¬ä¸€ä¸‹çœ‹çœ‹ï¼š 123456789101112fun draw(canvas: Canvas) { ... ... val drawScope = layoutNode.mDrawScope drawScope.draw(canvas, size, layoutNodeWrapper, this) { with(drawScope) { with(modifier) { draw() } } }} è¿™æ®µä»£ç ç†Ÿæ‚‰å—ï¼ŸDrawModifier2 ç»˜åˆ¶å®Œï¼Œè°ƒç”¨ drawContent()ï¼Œè®© DrawModifier1 å¼€å§‹ç»˜åˆ¶ã€‚ drawContent() æ˜¯é€šçŸ¥å½“å‰ DrawModifier ä¸‹ä¸€çº§çš„ LayoutNodeWrapper çš„ DrawModifier å¤„ç†ç»˜åˆ¶ã€‚æ‰€ä»¥å¦‚æœæœ‰ä¸€ä¸ª DrawModifier æ²¡æœ‰è°ƒç”¨ drawContent()ï¼Œç›¸å½“äºé“¾æ¡æ–­å¼€ä¸ä¼šé€šçŸ¥å†…éƒ¨çš„ DrawModifier å»ç»˜åˆ¶ã€‚","link":"/2025/08/16/compose/Compose%20--%20Modifier%20--%2004.%20%E8%A7%A3%E6%9E%90%20DrawModifier/"},{"title":"è§£æ ComposedModifier","text":"åœ¨æ­£å¼å¼€å§‹åˆ†æè¿™ç¯‡æ–‡ç« çš„ä¸»è§’ä¹‹å‰ï¼Œå»ºè®®ä½ å…ˆçœ‹çœ‹ ã€è§£æ Modifier &amp; CombinedModifierã€‘ ä¸€æ–‡ï¼Œä½œä¸º Modifier åŸç†ç³»åˆ—çš„ç¬¬ä¸€ç¯‡å¼€å±±ä¹‹ä½œï¼Œå®ƒæ˜¯ä¸€ä¸ªæ ¹ï¼Œå¿…é¡»æŒæ¡ï¼ æˆ‘ä»¬ç›´æ¥è¿›å…¥ä¸»é¢˜ï¼ŒæŸ¥çœ‹ ComposedModifier æºç ï¼š 123456ğŸ“„ androidx.compose.ui.ComposedModifier.ktprivate open class ComposedModifier( inspectorInfo: InspectorInfo.() -&gt; Unit, val factory: @Composable Modifier.() -&gt; Modifier) : Modifier.Element, InspectorValueInfo(inspectorInfo) ç»†å¿ƒçš„ä½ ä¼šå‘ç° ComposedModifier æ˜¯ä¸ªç§æœ‰å‡½æ•°ï¼Œä½ æ˜¯æ²¡æœ‰åŠæ³•ç›´æ¥åˆ›å»ºçš„ã€‚æ‰€ä»¥å¦‚æœæˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ª ComposedModifierï¼Œåˆ™éœ€è¦ä½¿ç”¨ Modifier.composed() æ‰©å±•å‡½æ•°ï¼š 1234567891011class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { ComposeBlogTheme { Modifier.composed { } } } }} è¿™æ ·ï¼ŒModifier.composed() æ‰©å±•å‡½æ•°ä¼šå¸®æˆ‘ä»¬åˆ›å»ºå‡ºä¸€ä¸ª ComposedModifierã€‚ 12345678ğŸ“„ androidx.compose.ui.ComposedModifier.ktfun Modifier.composed( inspectorInfo: InspectorInfo.() -&gt; Unit = NoInspectorInfo, factory: @Composable Modifier.() -&gt; Modifier): Modifier = this.then(ComposedModifier(inspectorInfo, factory))==&gt; this.then() ... ç†Ÿæ‚‰å§ï¼Ÿæ˜¯ä¸æ˜¯å¾—åˆ°äº†ä¸€ä¸ª ComposedModifierï¼Ÿ çœ‹åˆ°è¿™é‡Œï¼Œä½ åº”è¯¥ä¼šæœ‰ç–‘é—®ä¸‰è¿äº†ï¼š ğŸ¤”ğŸ¤” ComposedModifier æ˜¯ä¸ªå•¥ï¼Ÿ ğŸ¤”ğŸ¤” ä¸ºä»€ä¹ˆè¦åˆ›å»ºä¸€ä¸ª ComposedModifier ï¼Ÿ ğŸ¤”ğŸ¤” ä»€ä¹ˆæ—¶å€™åˆè¯¥åˆ›å»ºä¸€ä¸ª ComposedModifier ï¼Ÿ å¸¦ç€è¿™ä¸‰ä¸ªç–‘é—®ï¼Œæˆ‘ä»¬å¼€å§‹ç»§ç»­æ¢è®¨ ComposedModifier çš„ç²¾é«“ â€¦ â€¦ é¦–å…ˆæˆ‘ç›´æ¥å‘Šè¯‰ä½  ComposedModifier çš„ä½œç”¨ï¼šComposedModifier çš„ä½œç”¨æ˜¯é€šè¿‡ factory å·¥å‚å‡½æ•°åœ¨ç»„åˆè¿‡ç¨‹ä¸­æ‰§è¡Œ factory åˆ›å»ºå‡º Modifier å¹¶ä½¿ç”¨ã€‚ è¿™æ®µå®šä¹‰çœ‹ä¸æ‡‚æ²¡å…³ç³»ï¼Œè·Ÿç€æˆ‘çš„èŠ‚å¥æ¥ï¼Œæ¯”å¦‚çœ‹ä¸‹é¢è¿™æ®µç®€å•çš„ä»£ç ç¤ºä¾‹ï¼š 1234567891011class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { ComposeBlogTheme { Modifier.padding(10.dp) } } }} æ­£å¸¸æƒ…å†µä¸‹è¿™ä¹ˆå†™ï¼Œå½“æ‰§è¡Œåˆ° Modifier.padding() çš„æ—¶å€™ï¼Œä¼šç«‹å³åˆ›å»ºå‡ºä¸€ä¸ª PaddingElementï¼Œè¿™ä¸ªä½ åº”è¯¥å¾ˆæ¸…æ¥šäº†ã€‚ ç°åœ¨æˆ‘è°ƒæ•´ä¸‹ä»£ç ï¼š 1234567891011class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { ComposeBlogTheme { Modifier.composed { Modifier.padding(10.dp) } } } }} è¿™é‡Œæˆ‘æŠŠ Modifier.padding() ç»™åŒ…è¿›äº† ComposedModifier é‡Œé¢ï¼Œé‚£ä¹ˆå½“ç¨‹åºæ‰§è¡Œåˆ°è¿™æ®µä»£ç çš„æ—¶å€™ï¼Œä½ è§‰å¾— Modifier.padding() è¿˜ä¼šç«‹å³æ‰§è¡Œå—ï¼Ÿ ä¸ç€æ€¥å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å†å›é¡¾ä¸€é ComposedModifier çš„å®šä¹‰ï¼šComposedModifier çš„ä½œç”¨æ˜¯é€šè¿‡ factory å·¥å‚å‡½æ•°åœ¨ç»„åˆè¿‡ç¨‹ä¸­æ‰§è¡Œ factory åˆ›å»ºå‡º Modifier å¹¶ä½¿ç”¨ã€‚ è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥æ‹†åˆ†ä¸‹å®šä¹‰äº†ï¼Œä¸»è¦å°±æ˜¯ä¸¤ä¸ªæ ¸å¿ƒï¼š ç»„åˆè¿‡ç¨‹ä¸­ æ‰§è¡Œ factory åˆ›å»ºå‡º Modifier å…ˆæ¥çœ‹ä¸‹ç¬¬äºŒç‚¹ï¼Œæˆ‘ä»¬å…¶å®ä»åˆšåˆš Modifier.composed å‡½æ•°å®šä¹‰å°±èƒ½çœ‹å‡ºæ¥äº†ï¼š é‚£ä¹ˆç¬¬ä¸€ç‚¹ï¼šç»„åˆè¿‡ç¨‹ä¸­ï¼Œè¯¥å¦‚ä½•ç†è§£ï¼Ÿå…¶å®å¾ˆå¥½ç†è§£ï¼Œä½ æ—¢ç„¶åˆ›å»ºäº† Modifierï¼Œè‚¯å®šè¦ç”¨èµ·æ¥ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ¥çœ‹çœ‹åœ¨ç»„åˆè¿‡ç¨‹ä¸­ ComposedModifier æ˜¯å¦‚ä½•å‘æŒ¥ä½œç”¨çš„ã€‚ æˆ‘ç°åœ¨å†æ¥æ”¹ä¸‹ä»£ç ï¼š 1234567891011class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { ComposeBlogTheme { Box(Modifier.composed { Modifier.padding(10.dp) }) } } }} æ‰€ä»¥ç°åœ¨æˆ‘ä»¬å°±æ¥çœ‹çœ‹ Box() å†…éƒ¨æ˜¯åœ¨å“ªé‡Œæ‰§è¡Œ factory å·¥å‚å‡½æ•°çš„ã€‚ è·³è½¬åˆ° Box()ï¼š 123456ğŸ“„ androidx.compose.foundation.layout.Box.kt@Composablefun Box(modifier: Modifier) { Layout(measurePolicy = EmptyBoxMeasurePolicy, modifier = modifier)} è·³è½¬åˆ° Layout()ï¼š 12345678910111213141516171819202122ğŸ“„ androidx.compose.ui.layout.Layout.kt@Composable@UiComposableinline fun Layout( modifier: Modifier = Modifier, measurePolicy: MeasurePolicy) { val compositeKeyHash = currentCompositeKeyHash val materialized = currentComposer.materialize(modifier) val localMap = currentComposer.currentCompositionLocalMap ReusableComposeNode&lt;ComposeUiNode, Applier&lt;Any&gt;&gt;( factory = ComposeUiNode.Constructor, update = { set(measurePolicy, SetMeasurePolicy) set(localMap, SetResolvedCompositionLocals) set(materialized, SetModifier) @OptIn(ExperimentalComposeUiApi::class) set(compositeKeyHash, SetCompositeKeyHash) }, )} å…³æ³¨ materialize()ï¼š 12345678910ğŸ“„ androidx.compose.ui.ComposedModifier.ktfun Composer.materialize(modifier: Modifier): Modifier { // A group is required here so the number of slot added to the caller's group // is unconditionally the same (in this case, none) as is now required by the runtime. startReplaceGroup(0x1a365f2c) // Random number for fake group key. Chosen by fair die roll. val result = materializeImpl(modifier) endReplaceGroup() return result} ç»§ç»­è·Ÿè¸ª materializeImpl()ï¼š 1234567891011121314151617181920212223private fun Composer.materializeImpl(modifier: Modifier): Modifier { if (modifier.all { it !is ComposedModifier }) { return modifier } startReplaceableGroup(0x48ae8da7) val result = modifier.foldIn&lt;Modifier&gt;(Modifier) { acc, element -&gt; acc.then( if (element is ComposedModifier) { @Suppress(&quot;UNCHECKED_CAST&quot;) val factory = element.factory as Modifier.(Composer, Int) -&gt; Modifier val composedMod = factory(Modifier, this, 0) materializeImpl(composedMod) } else { element } ) } endReplaceableGroup() return result} å¥½ç†Ÿæ‚‰å‘€ï¼Œå‡ºç°äº† foldIn()ï¼æˆ‘ä»¬æ¥è§£è¯»ä¸€ä¸‹è¿™æ®µä»£ç ï¼š è¿™ä¹ˆä¸€åˆ†è§£ï¼Œç°åœ¨ä½ åº”è¯¥å¾ˆæ¸…æ¥š ComposedModifer çš„å·¥å‚å‡½æ•°åœ¨å“ªé‡Œè°ƒç”¨äº†å§ï¼Ÿ ä½†æ˜¯é—®é¢˜åˆæ¥äº†ï¼Œè¿™ä¹ˆè´¹åŠ²æä¸€ä¸ª ComposedModifier æœ‰å•¥æ„ä¹‰ï¼Ÿ 12Box(Modifier.composed { Modifier.padding(10.dp) })Box(Modifier.padding(10.dp) // æˆ‘è¿™ä¹ˆå†™ä¸å°±è¡Œäº†ï¼Ÿ æˆ‘ä»¬æ¥çœ‹ä¸‹ Modifier.composed å‡½æ•°çš„è¯´æ˜ï¼š æ³¨æ„å‡ ä¸ªå…³é”®è¯ï¼š1. stateful modifiersï¼šæœ‰çŠ¶æ€çš„ Modifierï¼›2. reusedï¼šé‡ç”¨ï¼›3. element-specific stateï¼šçŠ¶æ€ç‹¬æœ‰ã€‚ è¯¥å¦‚ä½•ç†è§£è¿™å‡ ä¸ªè¯çš„æ„æ€å‘¢ï¼Ÿ æ¥çœ‹ä»¥ä¸‹ä»£ç ï¼š 12345678910111213141516171819class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { ComposeBlogTheme { // å†™æ³• 1 val modifier1 = Modifier.composed { Modifier.padding(10.dp) } Box(modifier1) Text(&quot;Compose&quot;, modifier1) // å†™æ³• 2 val modifier2 = Modifier.padding(10.dp) Box(modifier2) Text(&quot;Compose&quot;, modifier2) } } }} è¯·é—®ï¼šå†™æ³• 1 å’Œå†™æ³• 2 æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ æˆ‘ç›¸ä¿¡ä½ ç»è¿‡ä¸Šé¢ ComposedModifier çš„è§£ææµç¨‹ï¼Œåº”è¯¥å¯ä»¥å¾ˆæ¸…æ™°çŸ¥é“ï¼šå†™æ³• 1 å’Œå†™æ³• 2 å”¯ä¸€çš„åŒºåˆ«å°±åœ¨äºï¼Œå†™æ³• 1 çš„ Modifier.padding() ä¼šå»¶è¿Ÿåˆ›å»ºï¼ˆç”± ComposedModifier çš„ factory å‡½æ•°åˆ›å»ºï¼‰ï¼Œå®ƒä»¬ä¸¤è€…çš„è¿è¡Œæ˜¾ç¤ºç»“æœæ²¡æœ‰ä»»ä½•åŒºåˆ«ã€‚ å®é™…ä¸Š Modifier.composed() ä¸æ˜¯ç”¨åœ¨æ¡ˆä¾‹å†™çš„è¿™ç§åœºæ™¯ä¸‹ï¼Œè€Œæ˜¯ç”¨åœ¨æœ‰çŠ¶æ€çš„ Modifier çš„åœºæ™¯ã€‚ ä»€ä¹ˆå«æœ‰çŠ¶æ€çš„ Modifierï¼Ÿ æŒ‰ä¸Šé¢çš„ä¾‹å­ 10.dp å°±æ˜¯ä¸€ä¸ªçŠ¶æ€ï¼Œä¸è¿‡å› ä¸ºåœ¨è¿™é‡Œå·²ç»å†™æ­»äº†æ•°å€¼æ‰€ä»¥ Modifier.padding() æ˜¯æ— çŠ¶æ€çš„ï¼Œè¿›è€Œ Modifier.composed() ä¹Ÿæ˜¯æ— çŠ¶æ€çš„ã€‚ ç°åœ¨æˆ‘ä»¬æ¥æ”¹ä¸‹ä»£ç ï¼š 12345678910111213141516class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { ComposeBlogTheme { val modifier = Modifier.composed { var padding by remember { mutableStateOf(10.dp) } Modifier.padding(padding) } Box(modifier) Text(&quot;Compose&quot;, modifier) } } }} æˆ‘ä»¬æŠŠ 10.dp æå–å‡ºæ¥ï¼Œè¿™æ · Modifier.padding() å°±æ˜¯æœ‰çŠ¶æ€çš„äº†ã€‚ ç°åœ¨ Modifier.padding() å°±æ˜¯æœ‰çŠ¶æ€çš„ï¼Œè¿›è€Œ Modifier.composed() å°±æ˜¯æœ‰çŠ¶æ€çš„ï¼Œç°åœ¨æˆ‘ä»¬å†å›é¡¾ä¸‹ Modifier.composed å‡½æ•°æ³¨è§£ï¼š 1. stateful modifiersï¼šæœ‰çŠ¶æ€çš„ Modifierï¼›2. reusedï¼šé‡ç”¨ï¼›3. element-specific stateï¼šçŠ¶æ€ç‹¬æœ‰ å†ç»“åˆè¿™ä¸ªä¾‹å­ï¼š 12345678910111213141516class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { ComposeBlogTheme { val modifier = Modifier.composed { var padding by remember { mutableStateOf(10.dp) } Modifier.padding(padding) // 1. stateful modifiersï¼šæœ‰çŠ¶æ€çš„ Modifier } Box(modifier) // 2. reusedï¼šé‡ç”¨ Text(&quot;Compose&quot;, modifier) // 2. reusedï¼šé‡ç”¨ } } }} æ˜¯ä¸æ˜¯æ»¡è¶³äº†ä¸¤æ¡ï¼Ÿé‚£ â€œçŠ¶æ€ç‹¬æœ‰â€ åˆæ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿè¯¥æ€ä¹ˆéªŒè¯å‘¢ï¼Ÿ æ¥ï¼Œæˆ‘ä»¬å†æ”¹ä¸‹ä»£ç ï¼š 1234567891011121314151617181920class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { ComposeBlogTheme { val modifier = Modifier.composed { var padding by remember { mutableStateOf(10.dp) } Modifier .padding(padding) .clickable { padding = 0.dp } } Column { Box(Modifier.background(Color.Red) then modifier) Text(&quot;Compose&quot;, Modifier.background(Color.Blue) then modifier) } } } }} è¿™é‡Œæˆ‘ä»¬å¯¹ Modifier åˆåŠ äº†ä¸€ä¸ªç‚¹å‡»æ“ä½œï¼šä¿®æ”¹ padding å€¼ä¸º 0ï¼Œçœ‹ä¸‹è¿è¡Œæ•ˆæœï¼š å‘ç°ä»€ä¹ˆæ²¡ï¼ŸText() ç»„ä»¶ç‚¹å‡»åï¼Œpadding ä¿®æ”¹ä¸º 0ï¼Œå´æ²¡æœ‰å½±å“åˆ° Box çš„ paddingï¼Œè¿™å°±æ˜¯ Modifier çŠ¶æ€ç‹¬æœ‰ï¼ é‚£æˆ‘ä»¬å†è¯•è¯•ä¸ç”¨ Modifier.composed() å‡½æ•°åŒ…èµ·æ¥çš„åœºæ™¯ï¼Œæ¯”å¦‚ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { ComposeBlogTheme { var padding by remember { mutableStateOf(10.dp) } val modifier = Modifier .padding(padding) .clickable { padding = 0.dp } Column { Box(Modifier.background(Color.Red) then modifier) Text(&quot;Compose&quot;, Modifier.background(Color.Blue) then modifier) } } } }} è¿™æ®µä»£ç ä¸éš¾ç†è§£å§ï¼Ÿæ¥çœ‹ä¸‹æ•ˆæœï¼š å‘ç°æ²¡ï¼Ÿå®ƒä»¬å…±äº«äº† paddingï¼Œç‚¹å‡»ä»»ä½•ä¸€ä¸ªç»„ä»¶ï¼Œéƒ½ä¼šå½±å“åˆ°å¦å¤–ä¸€ä¸ªçš„ paddingã€‚ æ‰€ä»¥åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±å¯ä»¥æ€»ç»“ä¸‹ Modifier.compose() å‡½æ•°çš„ä½œç”¨äº†ï¼šå®ƒä¼šåˆ›å»ºä¸€ä¸ªå¸¦çŠ¶æ€çš„ Modifierï¼Œè¿™ä¸ª Modifier å¯ä»¥é‡ç”¨ï¼Œå¹¶ä¸”çŠ¶æ€æ˜¯ç‹¬ç«‹çš„ã€‚ ä½†æ˜¯ï¼ä½†æ˜¯ï¼ä½†æ˜¯ï¼ç»†å¿ƒçš„ä½ åº”è¯¥åˆä¼šæœ‰ä¸€ä¸ªç–‘é—®ï¼šè¿™æœ‰ç‚¹ â€œåºŸâ€ å•Šï¼Œæˆ‘å¯ä»¥æœ‰æ›´ç®€å•çš„å†™æ³•å•Šï¼Œæ¯”å¦‚ï¼š 123456789101112131415161718class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { ComposeBlogTheme { var padding1 by remember { mutableStateOf(10.dp) } val modifier1 = Modifier.padding(padding1).clickable { padding1 = 0.dp } var padding2 by remember { mutableStateOf(10.dp) } val modifier2 = Modifier.padding(padding2).clickable { padding2 = 0.dp } Column { Box(Modifier.background(Color.Red) then modifier1) Text(&quot;Compose&quot;, Modifier.background(Color.Blue) then modifier2) } } } }} æ—¢ç„¶ä¸æƒ³ Box() å’Œ Text() çš„ padding ç›¸äº’å½±å“ï¼Œé‚£ä¹ˆåˆ†åˆ«ç»™å®ƒä»¬è®¾ç½®ä¸€ä¸ª Modifier ä¸å°±è¡Œäº†ï¼Ÿä½•å¿…è¦ç”¨ Modifier.composed() è¿™ç§èŠ±é‡Œèƒ¡å“¨ï¼Œçœ‹ä¸Šå»æ›´é«˜ç«¯çš„æ–¹æ³•å‘¢ï¼Ÿè¿™æ®µä»£ç çš„é€»è¾‘çœ‹ä¸Šå»å²‚ä¸æ˜¯æ›´æ¸…æ™°ï¼Ÿ å®é™…ä¸Š Modifier.composed() çš„ä½¿ç”¨åœºæ™¯æ˜¯ï¼šå½“æˆ‘ä»¬éœ€è¦åˆ›å»ºçš„ Modifier éœ€è¦ç»™å®ƒæ·»åŠ ä¸€äº›å†…éƒ¨çŠ¶æ€ï¼Œè¿™æ—¶å€™æˆ‘ä»¬éœ€è¦ä½¿ç”¨ Modifier.composed() æ¥ä¸ºå®ƒæä¾›ä¸€ä¸ª Composable çš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œä»è€Œè®©æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ rememberã€‚ æ€ä¹ˆç†è§£è¿™æ®µè¯ï¼Ÿä½ å¯ä»¥ç†è§£æˆï¼šå½“æˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰ä¸€ä¸ª Modifier æ—¶ï¼ŒåŒæ—¶å½“ Modifier å†…éƒ¨éœ€è¦ç”¨åˆ° remember æ—¶ï¼Œå°±éœ€è¦ç”¨åˆ° ComposeModifierã€‚ æ¯”å¦‚æˆ‘ä»¬ä¿®æ”¹ä¸‹å‰é¢çš„ Modifier.composed() ä»£ç ï¼š 1234567891011121314151617181920212223class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { ComposeBlogTheme { Column { // 2. ç»™å¤–éƒ¨ç»„ä»¶è°ƒç”¨ Box(Modifier.background(Color.Red) then Modifier.paddingJumpModifier()) Text(&quot;Compose&quot;, Modifier.background(Color.Blue) then Modifier.paddingJumpModifier()) } } } }}// 1. è¿™é‡Œè‡ªå®šä¹‰äº†ä¸€ä¸ª Modifier.paddingJumpModifierfun Modifier.paddingJumpModifier() { var padding by remember { mutableStateOf(10.dp) } Modifier .padding(padding) .clickable { padding = 0.dp }} å¦‚æœä½ è¿™ä¹ˆå†™ä¼šæŠ¥é”™ï¼š æŠ¥é”™åŸå› å¾ˆç®€å•ï¼Œremember æ˜¯ä¸€ä¸ª Composable å‡½æ•°ï¼Œä½ å¿…é¡»è¦åœ¨ Composable çš„ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­æ‰èƒ½è°ƒç”¨ã€‚è¿™æ—¶å€™æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ Modifier.composed() ä¸ºå®ƒæä¾›ä¸€ä¸ª Composable çš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œä»è€Œè®©æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ rememberã€‚ å†™æ³•å¾ˆç®€å•ï¼š 123456fun Modifier.paddingJumpModifier() = composed { var padding by remember { mutableStateOf(10.dp) } Modifier .padding(padding) .clickable { padding = 0.dp }} è¿™æ ·ä½ çš„ä»£ç å°±ä¸ä¼šæŠ¥é”™äº†ï¼Œå¹¶ä¸”æ‰€æœ‰è°ƒç”¨ Modifier.paddingJumpModifier çš„åœ°æ–¹å†…éƒ¨çš„ padding çŠ¶æ€ä¹Ÿæ˜¯ç‹¬ç«‹çš„ã€‚ ä¸ºä»€ä¹ˆ Modifier.composed() å‡½æ•°å†…éƒ¨å°±å¯ä»¥ä½¿ç”¨ remember ï¼Ÿ 1234fun Modifier.composed( inspectorInfo: InspectorInfo.() -&gt; Unit = NoInspectorInfo, factory: @Composable Modifier.() -&gt; Modifier // çœ‹è¿™é‡Œï¼Œå®ƒçš„å·¥å‚å‡½æ•°æä¾›äº† Composable ä¸Šä¸‹æ–‡ç¯å¢ƒ): Modifier = this.then(ComposedModifier(inspectorInfo, factory)) æ‰€ä»¥ï¼Œfactory å·¥å‚å‡½æ•°æä¾›äº† Composable ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œæˆ‘ä»¬å°±å¯ä»¥è°ƒç”¨ rememberã€‚ é™¤äº†å¯ä»¥è°ƒç”¨ rememberï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ Modifier.compose() å†…éƒ¨å¼€å¯åç¨‹ï¼š 123456789fun Modifier.paddingJumpModifier() = composed { var padding by remember { mutableStateOf(10.dp) } LaunchedEffect(Unit) { } Modifier .padding(padding) .clickable { padding = 0.dp }} å¦‚æœä½ ä¸åŠ  = composedï¼Œé‚£ä¹ˆä½ è°ƒç”¨ LaunchedEffect å°±ä¼šæŠ¥é”™ï¼Œä¸ä¿¡ä½ è¯•è¯•ã€‚ æœ€åæ€»ç»“ä¸€ä¸‹ ComposedModifier æˆ– Modifier.composed()ï¼š æŒ‰ç…§å®˜æ–¹æ³¨é‡Šçš„è¯´æ³•ï¼ŒModifier.composed() èƒ½åˆ›å»ºå‡ºå¸¦æœ‰çŠ¶æ€çš„ Modifierï¼Œè®©è¿™ä¸ª Modifier åœ¨å¤šå¤„è¢«é‡ç”¨ï¼› æœ‰çŠ¶æ€çš„ Modifier å°±æ˜¯è¢« remember åŒ…ç€çš„å˜é‡å’Œ Modifier æ”¾åœ¨ä¸€èµ·ä½œä¸ºå®ƒçš„å†…éƒ¨çŠ¶æ€ä½¿ç”¨ï¼› é‡ç”¨å°±æ˜¯ Modifier.composed() åœ¨æ¯ä¸€ä¸ªä½¿ç”¨çš„åœ°æ–¹éƒ½åˆ›å»ºä¸€ä¸ªå†…éƒ¨çŠ¶æ€ç‹¬ç«‹çš„ Modifierï¼Œè€Œä¸ä¼šäº’ç›¸å½±å“ï¼› Modifier.composed() ä¸ä»…èƒ½æä¾›å†…éƒ¨çŠ¶æ€ï¼Œåœ¨ä¸€äº›éœ€è¦ Composable ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œä¾‹å¦‚ LaunchedEffect æˆ– CompositionLocal ç­‰åœ°æ–¹ä½¿ç”¨ Modifierï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å®ƒã€‚","link":"/2025/08/03/compose/Compose%20--%20Modifier%20--%2002.%20%E8%A7%A3%E6%9E%90%20ComposedModifier/"},{"title":"æ·±åº¦è§£æ mutableStateOf æºç ","text":"å…¶å®åŸç†æ€§åˆ†æçš„æ–‡ç« ï¼ŒçœŸçš„å¾ˆéš¾è®²çš„é€šä¿—æ˜“æ‡‚ï¼Œè®²çš„ç®€å•æµ…æ˜¾æ²¡å¿…è¦å†™ï¼Œè®²çš„ç¹çéš¾æ‡‚å¾€å¾€å¤§å®¶ä¹Ÿä¸ä¹æ„çœ‹ï¼Œæ‰€ä»¥æ€ä¹ˆæ‰¾ä¸ªå¥½çš„è§’åº¦æ…¢æ…¢é’»è¿›å»å°¤ä¸ºé‡è¦ï¼Œæ¯”å¦‚ï¼šBegin simple codeï¼ Simple Code æ­£å¦‚æˆ‘ä¸Šé¢è¯´çš„ï¼Œç›´æ¥è®²åŸç†å¤ªæ¯ç‡¥ï¼ˆä½ ä¹Ÿä¼šå¾ˆæ‡µï¼‰ï¼Œæˆ‘å–œæ¬¢ä»ç®€å•ä»£ç å…¥æ‰‹ï¼Œå¸¦ä½ ä¸€ç‚¹ç‚¹è¿›å…¥ï¼Œç°åœ¨å¼€å§‹ã€‚ å…ˆçœ‹ä¸€ä¸ªæœ€ç®€å•çš„ä»£ç ç¤ºä¾‹ï¼š 1234567891011121314class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) // è¿™ç§å®šä¹‰å˜é‡çš„æ–¹å¼éšå¤„å¯è§äº† val name = mutableStateOf(&quot;Compose&quot;) setContent { ComposeBlogTheme { Text(name.value) } } }} æˆ‘å…ˆæ¥ç®€å•è§£è¯»ä¸€ä¸‹è¿™æ®µä»£ç èƒŒåçš„åŸç†ï¼š å½“æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå˜é‡ nameï¼Œç”¨ ã€ŒmutableStateOfã€ åŒ…èµ·æ¥åï¼šâ¤µï¸å®ƒå°±å˜æˆäº†ä¸€ä¸ª MutableState ç±»å‹çš„å¯¹è±¡ï¼ˆåé¢ä¼šåˆ†ææºç ï¼‰ã€‚ åŒæ—¶ï¼Œæˆ‘ä»¬å–å€¼çš„è¯å¿…é¡»è¦å†™ ã€Œname.valueã€ï¼Œè¿™æ ·èƒ½æ‰èƒ½å–åˆ°å˜é‡å€¼ï¼šâ€Composeâ€ã€‚â¤µï¸å› ä¸º name ä¸å†æ˜¯ä¸€ä¸ª Stringï¼Œè€Œæ˜¯ MutableState å¯¹è±¡ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠå®ƒå«åšã€ŒState: çŠ¶æ€ã€ã€‚ æ­¤æ—¶ï¼Œname æ˜¯ä¸€ä¸ªã€Œè¢«è®¢é˜…çš„çŠ¶æ€ã€ï¼Œã€Œname.valueã€å°±æ˜¯ä¸€ä¸ªè¢«è®¢é˜…çš„å€¼ï¼šâ¤µï¸å¦‚æœå®ƒå‘ç”Ÿå˜åŒ–ï¼ŒText() å‡½æ•°å°±ä¼šé‡æ–°æ‰§è¡Œä¸€éï¼Œæ›´æ–°åˆ°æœ€æ–°çš„å€¼ã€‚ ç°åœ¨æˆ‘ä»¬ä¿®æ”¹ä¸‹ä»£ç ï¼Œ3s åæ”¹å˜ name.value çš„å€¼ï¼š 123456789101112131415161718class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) val name = mutableStateOf(&quot;Compose&quot;) setContent { ComposeBlogTheme { Text(name.value) } LaunchedEffect(true) { delay(3000) // 3s å»¶è¿Ÿ name.value = &quot;Kotlin&quot; // ä¿®æ”¹ name.value } } }} è¿è¡Œï¼Œæ•ˆæœå¦‚ä¸‹ï¼š ç°åœ¨å…³äº mutableStateOf çš„ç”¨æ³•ä½ å·²ç»æŒæ¡äº†ï¼Œä½†ä½ ä¼šä¸ä¼šäº§ç”Ÿä¸€ä¸ªç–‘é—®ï¼Ÿ name è¢«ã€Œè‡ªåŠ¨è®¢é˜…ã€äº†ï¼Œå®ƒçš„å€¼æ”¹å˜äº†å°±ä¼šè®©ç•Œé¢ã€Œé‡æ–°åˆ·æ–°ã€ï¼Œè¿™èƒŒåçš„ã€ŒçŠ¶æ€è®¢é˜… &amp; åˆ·æ–°æœºåˆ¶ã€çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ å¦‚æœä½ æƒ³æ·±å…¥äº†è§£ï¼Œé‚£ä¹ˆæ¥ç€å¾€ä¸‹çœ‹ã€‚ çŠ¶æ€è®¢é˜… &amp; è‡ªåŠ¨åˆ·æ–° åŸºäº androidx.compose.runtime:runtime:1.7.1 ç‰ˆæœ¬ ç¡¬æ ¸éƒ¨åˆ†èµ°èµ·ï¼ŒæŸ¥çœ‹ mutableStateOf() æºç ï¼š 1234fun &lt;T&gt; mutableStateOf( value: T, policy: SnapshotMutationPolicy&lt;T&gt; = structuralEqualityPolicy()): MutableState&lt;T&gt; = createSnapshotMutableState(value, policy) mutableStateOf() è¿”å›çš„æ˜¯ä¸€ä¸ª MutableState å¯¹è±¡ï¼Œè¿™ä¸ªæˆ‘ä»¬å‰é¢è¯´è¿‡ã€‚ mutableStateOf() åˆè°ƒç”¨äº†å¦ä¸€ä¸ªå‡½æ•°ï¼šcreateSnapshotMutableState()ã€‚ è¿›å…¥ createSnapshotMutableState() ï¼š 1234internal actual fun &lt;T&gt; createSnapshotMutableState( value: T, policy: SnapshotMutationPolicy&lt;T&gt;): SnapshotMutableState&lt;T&gt; = ParcelableSnapshotMutableState(value, policy) åˆè°ƒç”¨äº† ParcelableSnapshotMutableState() å‡½æ•°ï¼š 1234567internal class ParcelableSnapshotMutableState&lt;T&gt;( value: T, policy: SnapshotMutationPolicy&lt;T&gt;) : SnapshotMutableStateImpl&lt;T&gt;(value, policy), Parcelable { // è¿™é‡Œå†…éƒ¨çš„ä»£ç å…¨éƒ¨éƒ½æ˜¯å¯¹ Parcelable æ¥å£çš„å®ç°ï¼Œæˆ‘ä»¬ä¸ç”¨å…³å¿ƒï¼Œä¸æ˜¯æ ¸å¿ƒå†…å®¹ ... ...} å…³é”®åœ¨ SnapshotMutableStateImplï¼Œå®ƒé‡Œé¢æ‰æ˜¯æœ€æ ¸å¿ƒçš„é€»è¾‘ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788internal open class SnapshotMutableStateImpl&lt;T&gt;( value: T, override val policy: SnapshotMutationPolicy&lt;T&gt;) : StateObjectImpl, SnapshotMutableState&lt;T&gt; { @Suppress(&quot;UNCHECKED_CAST&quot;) override var value: T get() = next.readable(this).value set(value) = next.withCurrent { if (!policy.equivalent(it.value, value)) { next.overwritable(this, it) { this.value = value } } } private var next: StateStateRecord&lt;T&gt; = StateStateRecord(value).also { if (Snapshot.isInSnapshot) { it.next = StateStateRecord(value).also { next -&gt; next.snapshotId = Snapshot.PreexistingSnapshotId } } } override val firstStateRecord: StateRecord get() = next override fun prependStateRecord(value: StateRecord) { @Suppress(&quot;UNCHECKED_CAST&quot;) next = value as StateStateRecord&lt;T&gt; } @Suppress(&quot;UNCHECKED_CAST&quot;) override fun mergeRecords( previous: StateRecord, current: StateRecord, applied: StateRecord ): StateRecord? { val previousRecord = previous as StateStateRecord&lt;T&gt; val currentRecord = current as StateStateRecord&lt;T&gt; val appliedRecord = applied as StateStateRecord&lt;T&gt; return if (policy.equivalent(currentRecord.value, appliedRecord.value)) current else { val merged = policy.merge( previousRecord.value, currentRecord.value, appliedRecord.value ) if (merged != null) { appliedRecord.create().also { (it as StateStateRecord&lt;T&gt;).value = merged } } else { null } } } override fun toString(): String = next.withCurrent { &quot;MutableState(value=${it.value})@${hashCode()}&quot; } private class StateStateRecord&lt;T&gt;(myValue: T) : StateRecord() { override fun assign(value: StateRecord) { @Suppress(&quot;UNCHECKED_CAST&quot;) this.value = (value as StateStateRecord&lt;T&gt;).value } override fun create(): StateRecord = StateStateRecord(value) var value: T = myValue } /** * The componentN() operators allow state objects to be used with the property destructuring * syntax */ override operator fun component1(): T = value override operator fun component2(): (T) -&gt; Unit = { value = it } /** * A function used by the debugger to display the value of the current value of the mutable * state object without triggering read observers. */ @Suppress(&quot;unused&quot;) val debuggerDisplayValue: T @JvmName(&quot;getDebuggerDisplayValue&quot;) get() = next.withCurrent { it }.value} å¥½é•¿å•Šï½ç®—äº†ï¼Œä¸çœ‹äº†ğŸ™ˆâ€¦ å¦‚æœä½ ä»æ‰“ç®—ç»§ç»­å¾€ä¸‹çœ‹ï¼Œé‚£æ¥ä¸‹æ¥æˆ‘ä¼šå¸¦ä½ ä¸€æ­¥æ­¥æ¢ç´¢å…¶ä¸­çš„å¥¥ç§˜ï¼ å…ˆçœ‹å¼€å¤´éƒ¨åˆ†ï¼š 12345678910111213141516171819202122232425internal open class SnapshotMutableStateImpl&lt;T&gt;( value: T, override val policy: SnapshotMutationPolicy&lt;T&gt;) : StateObjectImpl, SnapshotMutableState&lt;T&gt; { @Suppress(&quot;UNCHECKED_CAST&quot;) override var value: T get() = next.readable(this).value set(value) = next.withCurrent { if (!policy.equivalent(it.value, value)) { next.overwritable(this, it) { this.value = value } } } private var next: StateStateRecord&lt;T&gt; = StateStateRecord(value).also { if (Snapshot.isInSnapshot) { it.next = StateStateRecord(value).also { next -&gt; next.snapshotId = Snapshot.PreexistingSnapshotId } } } override val firstStateRecord: StateRecord get() = next ... ...} ä¸€ä¸ª value å±æ€§å°å…¥çœ¼å¸˜ï¼Œè¿™å°±æ˜¯æ–‡ç« å¼€å¤´ä»£ç é‡Œé¢ç”¨åˆ°çš„ name.valueã€‚ value æœ‰ get() å’Œ set() å‡½æ•°ï¼Œå¹¶ä¸”éƒ½æœ‰å…·ä½“çš„å®ç°ã€‚ ğŸ““ next æ˜¯ä¸ªå•¥ï¼Ÿ æ— è®ºæ˜¯ get() è¿˜æ˜¯ set() éƒ½æœ‰ä¸€ä¸ª nextã€‚ 12get() = next.readable(this).valueset(value) = next.withCurrent {...} å®ƒæ˜¯ä¸ªå•¥ï¼Ÿæˆ‘ä»¬å¾—å…ˆææ˜ç™½è¿™ä¸ªï¼ 1234567private var next: StateStateRecord&lt;T&gt; = StateStateRecord(value).also { if (Snapshot.isInSnapshot) { it.next = StateStateRecord(value).also { next -&gt; next.snapshotId = Snapshot.PreexistingSnapshotId } }} å®ƒçš„ç±»å‹æ˜¯ StateStateRecordï¼Œé‚£ StateStateRecord åˆæ˜¯ä¸ªå•¥ï¼Ÿ 12345678910private class StateStateRecord&lt;T&gt;(myValue: T) : StateRecord() { override fun assign(value: StateRecord) { @Suppress(&quot;UNCHECKED_CAST&quot;) this.value = (value as StateStateRecord&lt;T&gt;).value } override fun create(): StateRecord = StateStateRecord(value) var value: T = myValue} StateStateRecord åˆç»§æ‰¿äº† StateRecordï¼Œé‚£ StateRecord åˆæ˜¯ä¸ªå•¥å‘¢ï¼Ÿ 123456abstract class StateRecord { internal var snapshotId: Int = currentSnapshot().id // è®°å½•å¿«ç…§ id internal var next: StateRecord? = null // ä¸‹ä¸€ä¸ªçŠ¶æ€è®°å½•çš„å¼•ç”¨ï¼ŒçŠ¶æ€è®°å½•å­˜å‚¨åœ¨ä¸€ä¸ªé“¾è¡¨ä¸­ abstract fun assign(value: StateRecord) // å¤åˆ¶ StateRecord abstract fun create(): StateRecord // åˆ›å»ºä¸€ä¸ªæ–°çš„è®°å½•ç›¸åŒçš„ StateRecord} çœ‹ä¸æ‡‚ï¼Ÿæ²¡å…³ç³»ï¼Œåˆ°è¿™é‡Œä½ åªéœ€è¦è®°ä½ä¸€ç‚¹ï¼šStateRecord æ˜¯ä¸€ä¸ªé“¾è¡¨çš„æ•°æ®ç»“æ„å³å¯ï¼Œè€Œ StateStateRecord å®ç°äº†å®ƒï¼Œå¹¶ä¸”å°† value è¿›è¡Œäº†å°è£…ã€‚ ä¸‹é¢æˆ‘ä»¬è¦è®²åˆ«çš„äº†ï¼Œå…ˆè®°ä½ï¼šStateRecord æ˜¯ä¸€ä¸ªé“¾è¡¨çš„æ•°æ®ç»“æ„ï¼ æ¥ç€è¯´ï¼Œå¦‚æœä½ ä»”ç»†çœ‹ä»£ç çš„è¯ï¼Œä¼šå‘ç° SnapshotMutableStateImpl å…¶å®ç»§æ‰¿äº†ä¸¤ä¸ªæ¥å£ï¼š 123456internal open class SnapshotMutableStateImpl&lt;T&gt;( value: T, override val policy: SnapshotMutationPolicy&lt;T&gt;) : StateObjectImpl, SnapshotMutableState&lt;T&gt; { ... ...} ä¸€ä¸ª StateObjectImplã€ä¸€ä¸ª SnapshotMutableStateã€‚ æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹ SnapshotMutableStateï¼š 123456interface SnapshotMutableState&lt;T&gt; : MutableState&lt;T&gt; { /** * A policy to control how changes are handled in a mutable snapshot. */ val policy: SnapshotMutationPolicy&lt;T&gt;} SnapshotMutableState ç»§æ‰¿äº† MutableStateï¼Œæ­£å¥½å¯¹åº”ç€æˆ‘ä»¬æ–‡ç« å¼€å¤´è¯´çš„ï¼ŒmutableStateOf() è¿”å›çš„å°±æ˜¯ä¸€ä¸ª MutableStateï¼Œæˆ‘ä»¬ä¹‹å‰è¯´æ˜¯å› ä¸ºå®ƒå®ç°äº†ã€Œè®¢é˜…ã€ä»è€Œå¯ä»¥ã€Œåˆ·æ–°ã€ã€‚ ä½†ï¼ï¼ï¼çœŸæ­£çš„åŸå› å¹¶ä¸æ˜¯å› ä¸ºå®ƒï¼ çœŸæ­£å®ç°çŠ¶æ€è®¢é˜…æœºåˆ¶çš„æ˜¯å¦å¤–ä¸€ä¸ªæ¥å£ï¼šStateObjet æˆ‘ä»¬ç°åœ¨æ¥çœ‹ä¸‹ StateObjectImpl å¹²äº†ä»€ä¹ˆäº‹ï¼š 123internal abstract class StateObjectImpl internal constructor() : StateObject { ...} å®ç°äº† StateObject æ¥å£ï¼š 1234567891011121314interface StateObject { /** * The first state record in a linked list of state records. */ val firstStateRecord: StateRecord fun prependStateRecord(value: StateRecord) fun mergeRecords( previous: StateRecord, current: StateRecord, applied: StateRecord ): StateRecord? = null} ä»£ç éå¸¸ç®€å•ï¼Œä½†é‡Œé¢æœ‰ä¸€ä¸ª æ ¸å¿ƒï¼š 1val firstStateRecord: StateRecord å®ƒæ˜¯å¹²å˜›ç”¨çš„ï¼Ÿæˆ‘ä»¬å»ç…ç…å“ªé‡Œç”¨äº†å®ƒï¼š 12345678910private var next: StateStateRecord&lt;T&gt; = StateStateRecord(value).also { if (Snapshot.isInSnapshot) { it.next = StateStateRecord(value).also { next -&gt; next.snapshotId = Snapshot.PreexistingSnapshotId } }} override val firstStateRecord: StateRecord get() = next å“¦ï¼ŒåŸæ¥ firstStateRecord æ˜¯ç”¨æ¥è®°å½• StateRecord è¿™ä¸ªé“¾è¡¨çš„ å¤´èŠ‚ç‚¹ ç”¨çš„ã€‚ ğŸ““ get() ä¸Šé¢åº”è¯¥ç®—æ˜¯æŠŠ next æ˜¯ä»€ä¹ˆè®²æ¸…æ¥šäº†å§ï¼Ÿ å®ƒå°±æ˜¯ StateRecordï¼Œæ›´å‡†ç¡®çš„è¯´å°±æ˜¯ StateRecord é“¾è¡¨çš„å¤´èŠ‚ç‚¹ ä¸‹é¢æˆ‘ä»¬å¼€å§‹æ‰’æ‰’ get() çš„é€»è¾‘ï¼š 1get() = next.readable(this).value è¿›å…¥ readable() ï¼š 1234567891011fun &lt;T : StateRecord&gt; T.readable(state: StateObject): T { val snapshot = Snapshot.current // ç¬¬ä¸€ä»¶äº‹ snapshot.readObserver?.invoke(state) // ç¬¬äºŒä»¶äº‹ return readable(this, snapshot.id, snapshot.invalid) ?: sync { val syncSnapshot = Snapshot.current @Suppress(&quot;UNCHECKED_CAST&quot;) readable(state.firstStateRecord as T, syncSnapshot.id, syncSnapshot.invalid) ?: readError() }} å¹²äº†ä¸¤ä»¶äº‹ï¼Œç¬¬ä¸€ä»¶äº‹ï¼š 1snapshot.readObserver?.invoke(state) // ç¬¬ä¸€ä»¶äº‹ readObserver æ˜¯ä¸€ä¸ªè¯»æ“ä½œçš„è§‚å¯Ÿè€…ï¼Œè¿™ä¸ªæ“ä½œæ˜¯è®°å½• StateObject ä¸­çš„å€¼è¢«å“ªé‡Œè°ƒç”¨äº†ï¼Œæ¯”å¦‚å¼€å¤´çš„ä»£ç ç¤ºä¾‹ï¼š 1234567891011121314151617181920class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) val name = mutableStateOf(&quot;Compose&quot;) setContent { ComposeBlogTheme { // è¿™é‡Œè°ƒç”¨äº† name.valueï¼Œå°±ä¼šæ‰§è¡Œåˆ°ï¼š // get() --&gt; readObserver() --&gt; è®°å½•è¿™é‡Œè°ƒç”¨äº† value å€¼ Text(name.value) } LaunchedEffect(true) { delay(3000) name.value = &quot;Kotlin&quot; } } }} æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªæ“ä½œç†è§£ä¸ºå®ƒæ˜¯ä¸€ä¸ªè®¢é˜…æ“ä½œï¼šè®¢é˜…çŠ¶æ€ï¼Œè®°å½• name.value åœ¨å“ªé‡Œè°ƒç”¨äº†ã€‚ ç¬¬äºŒä»¶äº‹ï¼š 12345return readable(this, snapshot.id, snapshot.invalid) ?: sync { val syncSnapshot = Snapshot.current @Suppress(&quot;UNCHECKED_CAST&quot;) readable(state.firstStateRecord as T, syncSnapshot.id, syncSnapshot.invalid) ?: readError()} åˆè°ƒç”¨äº†ä¸‰å‚æ•°çš„ readable()ï¼š 1234567891011121314151617private fun &lt;T : StateRecord&gt; readable(r: T, id: Int, invalid: SnapshotIdSet): T? { // The readable record is the valid record with the highest snapshotId var current: StateRecord? = r var candidate: StateRecord? = null while (current != null) { if (valid(current, id, invalid)) { candidate = if (candidate == null) current else if (candidate.snapshotId &lt; current.snapshotId) current else candidate } current = current.next } if (candidate != null) { @Suppress(&quot;UNCHECKED_CAST&quot;) return candidate as T } return null} å‰è¾¹æˆ‘ä»¬è¯´è¿‡ï¼šStateRecord æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œè€Œä¸‰å‚æ•°é‡Œé¢çš„å·¥ä½œå°±æ˜¯é€šè¿‡è¡¨å¤´å¯¹è±¡éå†åˆ—è¡¨æ¥è·å– æœ€æ–°çš„ã€æœ‰æ•ˆçš„ StateRecordã€‚ æœ€ç»ˆè¿”å›ä¸€ä¸ª æœ€æ–°çš„ã€æœ‰æ•ˆçš„ StateRecordã€‚ï¼ˆä»€ä¹ˆæ˜¯æœ€æ–°çš„ã€æœ‰æ•ˆçš„ï¼Œè¿™ä¸ªå¯ä»¥ä¸ç”¨å…³å¿ƒï¼Œè¿™è·Ÿè¦ç»“åˆ Snapshot å¿«ç…§ç³»ç»Ÿè¯´ï¼Œä½ ç›´æ¥è¿‡æ»¤å³å¯ï¼Œä¸å½±å“æˆ‘ä»¬åŸç†çš„ç†è§£ï¼‰ æ‰€ä»¥ï¼Œæ•´ä¸ª readable() æ–¹æ³•å°±å¹²äº†ä¸¤ä»¶äº‹ï¼š è¿”å›æœ€æ–°çš„ã€æœ‰æ•ˆçš„ StateRecord è®°å½•åœ¨å“ªé‡Œè°ƒç”¨äº† value 1get() = next.readable(this).value æœ€åè¿˜å‰©ä¸€ä¸ª valueï¼Œè¿™å°±å¾ˆç®€å•äº†ï¼Œå‰é¢æˆ‘ä»¬è¯´è¿‡ StateStateRecord (StateRecord çš„å®ç°ç±») ä¼šå¯¹ value è¿›è¡Œå°è£…ï¼Œè€Œ StateRecord åªæ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œæˆ‘ä»¬è¦æƒ³è·å–åˆ°å€¼ï¼Œå°±è¦å†è°ƒç”¨ value è·å–å†…éƒ¨è¢«åŒ…ç€çš„å€¼ã€‚ åˆ°è¿™é‡Œ get() å°±è®²å®Œäº†ï¼ ğŸ““ set() ç°åœ¨æ¥çœ‹ set() çš„å…·ä½“ä»£ç ï¼šï¼ˆç»†èŠ‚ç‚¹æ³¨æ„ï¼šè¿™è¾¹æˆ‘æŠŠä»£ç æˆªå›¾äº†ï¼Œè€Œä¸æ˜¯çº¯ä»£ç æ®µï¼Œä½ ç•™æ„ä¸€ä¸‹ï¼Œä¸‹é¢ä¼šå›å½’åˆ°è¿™é‡Œï¼‰ next æ˜¯å•¥ä¸ç”¨è¯´äº†å§ï¼Œé‚£ withCurrent æ˜¯ä»€ä¹ˆï¼Ÿ 12inline fun &lt;T : StateRecord, R&gt; T.withCurrent(block: (r: T) -&gt; R): R = block(current(this)) å®ƒåªæœ‰ä¸€ä¸ªå‚æ•° blockï¼Œè€Œ block æ˜¯ä¸€ä¸ªå‡½æ•°ç±»å‹çš„å‚æ•°ï¼Œå®ƒçš„å·¥ä½œå¾ˆç›´æ¥ï¼Œç›´æ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°ç±»å‹çš„å‚æ•°ï¼Œä¹Ÿå°±æ˜¯ withCurrent åé¢è·Ÿç€çš„ Lambda è¡¨è¾¾å¼ã€‚ block é‡Œé¢ä¼ å…¥äº†ä¸€ä¸ª current å‡½æ•°ï¼Œå®ƒåšäº†ä»€ä¹ˆï¼š 12345678internal fun &lt;T : StateRecord&gt; current(r: T) = Snapshot.current.let { snapshot -&gt; readable(r, snapshot.id, snapshot.invalid) ?: sync { Snapshot.current.let { syncSnapshot -&gt; readable(r, syncSnapshot.id, syncSnapshot.invalid) } } ?: readError() } å‘ç°äº†ä»€ä¹ˆï¼Ÿå®ƒè°ƒç”¨äº†ä¸€ä¸ªä¸‰å‚æ•°çš„ readable()ï¼Œä½ è¿˜è®°å¾—ä¸‰å‚æ•°çš„ readable() æ˜¯åšä»€ä¹ˆçš„å—ï¼Ÿ â‡’ è·å– æœ€æ–°çš„ã€æœ‰æ•ˆçš„ StateRecordã€‚ è¿™ä¸ªæ—¶å€™ä½ å†çœ‹ä¸‹æˆ‘å¼€å¤´ä¸ºå•¥å¯¹ä»£ç åšäº†æˆªå›¾ï¼š æ‡‚å•¥æ„æ€æ²¡ï¼ŸwithCurrent ä¼ å…¥çš„ current å‡½æ•°çš„è¿”å›å€¼å°±å¯¹åº”ç€ä»£ç æç¤ºå™¨æç¤ºçš„ it å¯¹è±¡ï¼ˆä¸€ä¸ª StateStateRecordï¼‰ã€‚ æ¥ç€çœ‹ä»£ç ï¼š 123456set(value) = next.withCurrent { // åˆ¤æ–­æ–°æ—§å€¼ if (!policy.equivalent(it.value, value)) { next.overwritable(this, it) { this.value = value } }} if åˆ¤æ–­é‡Œé¢ä¼šåˆ¤æ–­å–åˆ°çš„ StateRecord çš„å€¼å’Œæ–°è®¾ç½®çš„å€¼æ˜¯å¦ç›¸åŒï¼Œæ²¡å˜ç›´æ¥ç»“æŸï¼Œå˜äº†å°±è¿›å…¥ä¸‹ä¸€æ­¥ overwritable()ã€‚ æˆ‘ä»¬çœ‹çœ‹å®ƒåšäº†ä»€ä¹ˆï¼š 123456789101112131415internal inline fun &lt;T : StateRecord, R&gt; T.overwritable( state: StateObject, candidate: T, block: T.() -&gt; R): R { var snapshot: Snapshot = snapshotInitializer return sync { // ç¬¬ä¸€ä»¶äº‹ snapshot = Snapshot.current // ç¬¬äºŒä»¶äº‹ this.overwritableRecord(state, snapshot, candidate).block() }.also { notifyWrite(snapshot, state) }} ä¹Ÿå¹²äº†ä¸¤ä»¶äº‹ï¼š è·å–å¿«ç…§ï¼›2. è°ƒç”¨äº†overwritableRecord() å‡½æ•°ï¼› Snapshot å¿«ç…§çš„çŸ¥è¯†æˆ‘ä»¬å¯ä»¥å…ˆå¿½ç•¥ï¼Œæ¥çœ‹ overwritableRecord() åšäº†ä»€ä¹ˆï¼š 12345678910111213141516171819202122internal fun &lt;T : StateRecord&gt; T.overwritableRecord( state: StateObject, snapshot: Snapshot, candidate: T): T { if (snapshot.readOnly) { // If the snapshot is read-only, use the snapshot recordModified to report it. snapshot.recordModified(state) } val id = snapshot.id // æ ¸å¿ƒæ¨¡å— 1 if (candidate.snapshotId == id) return candidate // æ ¸å¿ƒæ¨¡å— 2 val newData = sync { newOverwritableRecordLocked(state) } newData.snapshotId = id if (candidate.snapshotId != Snapshot.PreexistingSnapshotId) snapshot.recordModified(state) return newData} æˆ‘ä»¬å°†ä»£ç åˆ†ä¸ºä¸¤ç«¯æ¥çœ‹ï¼š æ ¸å¿ƒä»£ç å— 1ï¼š å¦‚æœä¼ è¿›æ¥çš„ StateRecord çš„å¿«ç…§ id æ­£å¥½å¯¹åº”å½“å‰ snapshot çš„ idï¼Œé‚£ä¹ˆç›´æ¥è¿”å›ã€‚ æ ¸å¿ƒä»£ç å— 2ï¼š å¦åˆ™ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æˆ–è€…è¿”å›ä¸€ä¸ªå¼ƒç”¨çš„ StateRecordï¼Œç„¶åå°†å¿«ç…§ id èµ‹äºˆæ–°çš„ StateRecordã€‚ è¯´ç™½äº†æœ€ç»ˆå°±æ˜¯è¦å–åˆ°ä¸€ä¸ªå¯¹åº”å½“å‰ snapshot çš„ StateRecordï¼ 1234567891011121314internal inline fun &lt;T : StateRecord, R&gt; T.overwritable( state: StateObject, candidate: T, block: T.() -&gt; R): R { var snapshot: Snapshot = snapshotInitializer return sync { snapshot = Snapshot.current // å–åˆ°ä¸€ä¸ªå¯¹åº”å½“å‰ snapshot çš„ StateRecord this.overwritableRecord(state, snapshot, candidate).block() }.also { notifyWrite(snapshot, state) }} å–åˆ°å¯¹åº”å½“å‰ snapshot çš„ StateRecord åï¼Œç´§æ¥ç€è°ƒç”¨äº† block()ï¼Œå®ƒæ˜¯ä¼ è¿›æ¥çš„å‚æ•°ï¼Œæ˜¯å¤–é¢ä¼ è¿›æ¥çš„ï¼Œä¹Ÿå°±æ˜¯ {this.value = value}ã€‚ 123456set(value) = next.withCurrent { // åˆ¤æ–­æ–°æ—§å€¼ if (!policy.equivalent(it.value, value)) { next.overwritable(this, it) { this.value = value } }} åˆæ‹å›æ¥äº†ï¼ŒæŠŠä¼ å…¥çš„æ–°å€¼èµ‹å€¼ç»™æ‹¿åˆ°çš„ StateRecord å†…éƒ¨çš„ valueï¼Œè¿™ä¸å°±æ˜¯å†™æ–°å€¼çš„æ“ä½œä¹ˆï¼Ÿ åˆ°è¿™é‡Œæ˜¯ä¸æ˜¯ set() æµç¨‹æ˜¯ä¸æ˜¯æˆ‘ä»¬å°±è®²å®Œäº†ï¼Ÿ Noï½ï¼Œæˆ‘ä»¬å†çœ‹ä¸€ä¸‹ overwritable() æ–¹æ³•å†…éƒ¨ï¼š 1234567891011121314internal inline fun &lt;T : StateRecord, R&gt; T.overwritable( state: StateObject, candidate: T, block: T.() -&gt; R): R { var snapshot: Snapshot = snapshotInitializer return sync { snapshot = Snapshot.current // è¿™é‡Œè®²å®Œäº† this.overwritableRecord(state, snapshot, candidate).block() }.also { notifyWrite(snapshot, state) // ä½†è¿™é‡Œè¿˜æœ‰ä¸ª notifyWrite }} è¿˜æœ‰ä¸€è¡Œæˆ‘ä»¬é—æ¼äº†ï¼ŒnotifyWrite() åˆåšäº†ä»€ä¹ˆï¼Ÿ 1234internal fun notifyWrite(snapshot: Snapshot, state: StateObject) { snapshot.writeCount += 1 snapshot.writeObserver?.invoke(state)} æœ‰ç§ä¼¼æ›¾ç›¸è¯†çš„æ„Ÿè§‰ï¼Œåœ¨å‰é¢åˆ†æ get() å‡½æ•°çš„æ—¶å€™ï¼Œæˆ‘ä»¬çœ‹åˆ°è¿‡å•å‚æ•°çš„ readable() é‡Œé¢æœ‰ä¸€è¡Œï¼š 1snapshot.readObserver?.invoke(state) é‚£è¿™é‡Œçš„ä½œç”¨å‘¢ï¼Ÿ â‡’ å¯»æ‰¾å˜é‡åœ¨å“ªé‡Œè¢«è¯»äº†ï¼Œç„¶åå°†è¿™éƒ¨åˆ†å†…å®¹çš„ç»„åˆæ ‡è®°ä¸ºå¤±æ•ˆï¼Œç­‰åˆ°ä¸‹ä¸€å¸§çš„æ—¶å€™ä¼šé‡ç»„åˆ·æ–°ã€‚ æ‰€ä»¥ï¼Œæ•´ä¸ª set() æ–¹æ³•å°±å¹²äº†ä¸¤ä»¶äº‹ï¼š å°†ä¼ å…¥çš„å€¼èµ‹å€¼ç»™ StateRecord å†…éƒ¨çš„ value å†™å…¥é€šçŸ¥åˆ·æ–° åˆ°è¿™é‡Œæˆ‘ä»¬å°±åŸºæœ¬ä¸Šèƒ½å¤Ÿå¾ˆæ¸…æ™°çš„æ˜ç™½äº†çŠ¶æ€è®¢é˜…&amp;è‡ªåŠ¨åˆ·æ–°æœºåˆ¶çš„åŸç†äº†ï¼š å½“ get() è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œä¸ä»…è¿”å›å€¼ï¼Œè¿˜ä¼šè®°å½•è¯»å€¼çš„åœ°æ–¹ï¼Œä¹Ÿå°±æ˜¯å“ªé‡Œè°ƒç”¨äº†ï¼ˆç›¸å½“äºè®¢é˜…ï¼‰ã€‚ å½“ set() è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œä¸ä»…ä¿®æ”¹å€¼ï¼Œè¿˜ä¼šæŸ¥æ‰¾è¯»å€¼çš„åœ°æ–¹ï¼Œç„¶åè¿›è¡Œåˆ·æ–°æ“ä½œï¼ˆç›¸å½“äºé€šçŸ¥ï¼‰ã€‚ ä»£ç†/å§”æ‰˜ï¼šby åœ¨å®é™…å¼€å‘ä¸­ï¼Œå¦‚æœæ¯æ¬¡è·å–å€¼éƒ½è¦åŠ ä¸Š value ä¼šæ˜¾å¾—å¾ˆå†—ä½™ï¼Œæ‰€ä»¥ Compose ç»™æˆ‘ä»¬æä¾›äº†ä¸€ç§æ›´æ–¹ä¾¿çš„å†™æ³•ï¼šbyã€‚å®ƒæ˜¯ Kotlin çš„ä¸€ä¸ªå…³é”®å­—ï¼Œè¡¨ç¤ºå·¦è¾¹çš„å˜é‡ç”¨å³è¾¹çš„å¯¹è±¡ä½œä¸ºä»£ç†ï¼ˆå§”æ‰˜ï¼‰ã€‚ 12345678910111213class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) val name by mutableStateOf(&quot;Compose&quot;) setContent { ComposeBlogTheme { Text(name) // å¯ä»¥ç›´æ¥ nameï¼Œè€Œä¸éœ€è¦ name.value } } }} å¦‚æœä½ è¿™ä¹ˆå†™ï¼ŒIDLE ä¼šæç¤ºæŠ¥é”™ï¼Œå› ä¸º name å§”æ‰˜ç»™äº† mutableStateOfï¼Œå¦‚æœæˆ‘ä»¬è¦è·å– name çš„å€¼ï¼Œé‚£å§”æ‰˜å¯¹è±¡éœ€è¦è°ƒç”¨ getValue() å’Œ setValue() ä¸¤ä¸ªå‡½æ•°ï¼Œè¿™ä¸¤ä¸ªå‡½æ•°éœ€è¦è‡ªå·±å®ç°ã€‚ ä½†å®é™…ä¸Šå¹¶ä¸éœ€è¦æˆ‘ä»¬å®ç°ï¼Œä½ é€šè¿‡æç¤ºä¹Ÿå¯ä»¥çœ‹å‡ºæ¥ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å¯¼å…¥ï¼Œå› ä¸º Compose å†…éƒ¨å·²ç»å¸®æˆ‘ä»¬å®ç°å¥½äº†è¿™ä¸ªæ–¹æ³•ã€‚ 12import androidx.compose.runtime.getValueimport androidx.compose.runtime.setValue è‡ªæ­¤ï¼Œå…³äº Compose çš„çŠ¶æ€è®¢é˜…&amp;è‡ªåŠ¨åˆ·æ–°æœºåˆ¶çš„åŸç†ç®—æ˜¯è®²æ˜ç™½äº†å§ï¼","link":"/2025/06/01/compose/Compose%20--%20%E7%8A%B6%E6%80%81%E8%AE%A2%E9%98%85%20&%20%E8%87%AA%E5%8A%A8%E6%9B%B4%E6%96%B0%20--%2001.%20%E8%A7%A3%E6%9E%90%20mutableStateOf%20%E6%BA%90%E7%A0%81/"},{"title":"Compose çš„ã€Œæœ‰çŠ¶æ€ã€æ— çŠ¶æ€ã€çŠ¶æ€æå‡ã€","text":"å…ˆæ¥çœ‹ä¸¤æ®µ Compose çš„å®˜æ–¹æè¿°ï¼š åˆ©ç”¨ Composeï¼Œä½ å¯ä»¥æ„å»ºä¸ä¸ç‰¹å®š activity æˆ– fragment ç›¸å…³è”çš„å°å‹ã€Œæ— çŠ¶æ€ã€ç»„ä»¶ï¼Œè¿™è®©ä½ å¯ä»¥è½»æ¾é‡ç”¨å’Œæµ‹è¯•è¿™äº›ç»„ä»¶ã€‚ ä½¿ç”¨ remember å­˜å‚¨å¯¹è±¡çš„å¯ç»„åˆé¡¹åŒ…å«ã€Œå†…éƒ¨çŠ¶æ€ã€ï¼Œè¿™ä¼šä½¿è¯¥å¯ç»„åˆé¡¹ã€Œæœ‰çŠ¶æ€ã€ã€‚åœ¨è°ƒç”¨æ–¹ä¸éœ€è¦æ§åˆ¶çŠ¶æ€ï¼Œå¹¶ä¸”ä¸å¿…è‡ªè¡Œç®¡ç†çŠ¶æ€ä¾¿å¯ä½¿ç”¨çŠ¶æ€çš„æƒ…å†µä¸‹ï¼Œã€Œæœ‰çŠ¶æ€ã€ä¼šéå¸¸æœ‰ç”¨ã€‚ä½†æ˜¯ï¼Œå…·æœ‰ã€Œå†…éƒ¨çŠ¶æ€ã€çš„å¯ç»„åˆé¡¹å¾€å¾€ä¸æ˜“é‡å¤ä½¿ç”¨ï¼Œä¹Ÿæ›´éš¾æµ‹è¯•ã€‚ è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥æŠ›å‡ºä¸‰ä¸ªé—®é¢˜ï¼š ä»€ä¹ˆæ˜¯ã€Œæ— çŠ¶æ€ã€ï¼Ÿ ä»€ä¹ˆæ˜¯ã€Œæœ‰çŠ¶æ€ã€ï¼Ÿ ä»€ä¹ˆæ˜¯ã€Œå†…éƒ¨çŠ¶æ€ã€ï¼Ÿ å¸¦ç€è¿™ä¸‰ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¼€å§‹æ¢è®¨ Compose ä¸­çš„çŠ¶æ€ã€‚ æ— çŠ¶æ€é¦–å…ˆï¼Œæˆ‘ä»¬æ€è€ƒä¸‹ï¼šä»€ä¹ˆæ˜¯çŠ¶æ€ï¼Ÿ åœ¨ä¼ ç»Ÿ Android ä¸­ï¼Œæ¯”å¦‚ TextViewï¼Œå®ƒçš„çŠ¶æ€å°±æ˜¯ã€Œå†…éƒ¨çš„å±æ€§ã€ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ getText() è·å– TextView çš„æ–‡å­—ï¼ŒsetText() è®¾ç½® TextView çš„æ–‡å­—ã€‚ æˆ‘ä»¬çœ‹ä¸‹é¢çš„ä»£ç ï¼š 12345678910class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { val name = &quot;Hi, Compose&quot; Text(name) } }} ç°åœ¨æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼šText() ç»„ä»¶åœ¨è¿™é‡Œèƒ½åƒ TextView() ä¸€æ ·æ—¢èƒ½ getText()ã€ä¹Ÿèƒ½ setText() å—ï¼Ÿ å¾ˆæ˜æ˜¾ä¸èƒ½ï¼ Text(name) åªæ˜¯ç”¨äº† nameï¼Œå¹¶æ²¡æœ‰ä¿å­˜ï¼Œæ‰€ä»¥å®ƒæ˜¯ä¸€ä¸ªã€Œæ— çŠ¶æ€ç»„ä»¶ã€ã€‚ æœ‰çŠ¶æ€ç°åœ¨æˆ‘ä»¬è‡ªå®šä¹‰ä¸€ä¸ª Compose å‡½æ•°ï¼š 12345@Composablefun HiCompose() { val name = &quot;Hi, Compose&quot; Text(name)} è¯·é—®ï¼šText() æœ‰çŠ¶æ€å—ï¼Ÿ æ²¡æœ‰ï¼ˆæˆ‘ä»¬åˆšåˆšæ‰è¯´è¿‡ï¼‰ é‚£ä¹ˆï¼šHiCompose() å‘¢ï¼Ÿ æœ‰ï¼ å®ƒçš„å†…éƒ¨æœ‰ä¸€ä¸ªå±äºå®ƒè‡ªå·±çš„å˜é‡ï¼šname = â€œHi, Composeâ€ï¼Œå‡†ç¡®çš„æ¥è¯´ï¼Œå®ƒæ˜¯æœ‰ã€Œå†…éƒ¨çŠ¶æ€ã€çš„ã€‚ æ‰€ä»¥ï¼ŒCompose ç»„ä»¶æ˜¯å¯ä»¥ã€Œæœ‰çŠ¶æ€ã€ï¼Œä¹Ÿå¯ä»¥ã€Œæ— çŠ¶æ€ã€ï¼Œè€Œæ‰€è°“çš„æœ‰æ²¡æœ‰çŠ¶æ€ - - å…¶å®éƒ½æ˜¯æŒ‡ï¼šã€Œå†…éƒ¨çŠ¶æ€ã€ï¼ çŠ¶æ€æå‡æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼Œæ—¢ç„¶ HiCompose() å‡½æ•°æ˜¯æœ‰ã€Œå†…éƒ¨çŠ¶æ€ã€çš„ï¼Œé‚£æˆ‘å¦‚æœæƒ³ä»ã€Œå¤–éƒ¨ã€è·å–å®ƒçš„ã€Œå†…éƒ¨çŠ¶æ€ã€ï¼Œè¯¥å¦‚ä½•åšï¼Ÿ æ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼š 123456789101112131415class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { HiCompose().name ??? // è¿™é‡Œå¦‚ä½•è·å–åˆ° HiCompose å†…éƒ¨çš„ name? } }}@Composablefun HiCompose() { val name = &quot;Hi, Compose&quot; Text(name)} è¿™å°±ç›¸å½“äºä½ è¦ä»å¤–éƒ¨è·å–ä¸€ä¸ªå‡½æ•°å†…éƒ¨çš„å˜é‡ï¼Œæ˜¯è·å–ä¸åˆ°çš„ï¼Œé‚£å¦‚ä½•åšå‘¢ï¼Ÿ 123456789101112131415class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { val name = &quot;Hi, Compose&quot; HiCompose(name) } }}@Composablefun HiCompose(name: String) { Text(name)} æˆ‘ä»¬æŠŠ HiCompose() ã€Œå†…éƒ¨çŠ¶æ€ã€ç»™æåˆ°äº†ã€Œå‚æ•°ã€é‡Œé¢ï¼Œç„¶åå¤–éƒ¨å°±å¯ä»¥ä¼ å…¥ã€ŒçŠ¶æ€ã€ï¼Œä¸¤è€…å°±è”ç³»èµ·æ¥äº†ã€‚ åœ¨ Compose ä¸­è¿™ç§åšæ³•å°±å«åšï¼šã€ŒçŠ¶æ€æç¤ºã€ï¼ˆState Hoistingï¼‰ é‚£ä¹ˆï¼Œè¯·é—®æ­¤æ—¶ HiCompose è¿˜æœ‰çŠ¶æ€å—ï¼Ÿ ç°åœ¨å®ƒå°±æ˜¯ã€Œæ— çŠ¶æ€ã€çš„ï¼ å› ä¸ºå®ƒå·²ç»æ²¡æœ‰ã€Œå†…éƒ¨çŠ¶æ€ã€äº†ï¼ŒçŠ¶æ€ä¸Šæåˆ°å¤–é¢å»äº†ã€‚ è¾“å…¥æ¡†ï¼šTextFieldCompose æœ‰ä¸€ä¸ªå…¸å‹çš„çŠ¶æ€æå‡çš„ç»„ä»¶ç¤ºä¾‹ï¼šTextFieldï¼Œå®ƒæ˜¯ä¸€ä¸ªæ–‡æœ¬è¾“å…¥æ¡†ï¼Œç±»ä¼¼äº EditTextã€‚ 123456789class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { TextField(value = , onValueChange = ) } }} å…¶ä¸­ value å°±æ˜¯ä» TextField å†…éƒ¨æå‡ä¸Šæ¥çš„ï¼Œæˆ‘ä»¬æ¥ç»™å®ƒä¼ ä¸ªå€¼ï¼š 12345678910class MainActivity : ComponentActivity() { override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { var name = &quot;&quot; TextField(name, onValueChange = ) } }} onValueChange æ˜¯ä¸€ä¸ªå‡½æ•°ç±»å‹çš„å‚æ•°ï¼Œå¯ä»¥å†™æˆ Lambda è¡¨è¾¾å¼ï¼š 12345678910111213class MainActivity : ComponentActivity() { @OptIn(ExperimentalMaterial3Api::class) override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { var name = &quot;&quot; TextField(name, { }) } }} æ­¤æ—¶ä»€ä¹ˆä¹Ÿæ²¡å¡«ï¼Œè¿è¡Œçœ‹ä¸‹æ•ˆæœï¼š é”®ç›˜éƒ½æ•²å†’çƒŸäº†ï¼Œä½†æ˜¯è¾“å…¥æ¡†å´æ²¡æœ‰ä»»ä½•å†…å®¹ï¼Œé—®é¢˜è‚¯å®šå‡ºåœ¨ onValueChangeï¼Œå› ä¸ºæˆ‘ä»¬ä»€ä¹ˆä¹Ÿæ²¡å¡«ï¼Œé‚£å¡«ä»€ä¹ˆï¼Ÿ 12345678910111213class MainActivity : ComponentActivity() { @OptIn(ExperimentalMaterial3Api::class) override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { var name = &quot;&quot; TextField(name, { newValue -&gt; name = newValue }) } }} è¿™å°±è¿™ä¹ˆç®€å•ï¼ŒnewValue å°±æ˜¯è¾“å…¥çš„å†…å®¹ï¼ŒæŠŠ newValue èµ‹å€¼ç»™ nameï¼Œname æ‰æ˜¯è¾“å…¥æ¡†æ˜¾ç¤ºçš„å†…å®¹å®é™…å€¼ã€‚ è¿è¡Œçœ‹ä¸‹æ•ˆæœï¼š æ€ä¹ˆè¿˜ä¸è¡Œï¼Ÿå¦‚æœä½ çœ‹äº†ä¹‹å‰çš„æ–‡ç« ï¼Œåº”è¯¥èƒ½æ‰¾åˆ°é—®é¢˜ç‚¹åœ¨å“ªï¼ ç›´æ¥ä¿®æ”¹ä»£ç ï¼š 12345678910111213class MainActivity : ComponentActivity() { @OptIn(ExperimentalMaterial3Api::class) override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContent { var name by remember { mutableStateOf(&quot;&quot;) } TextField(name, { newValue -&gt; name = newValue }) } }} å†æ¬¡è¿è¡Œï¼š å¦‚æœä½ æ²¡çœ‹æ‡‚ä¸ºå•¥è¿™ä¹ˆæ”¹ï¼Œèµ¶ç´§å›å»çœ‹å‰ä¸¤ç¯‡æ–‡ç« å§ï¼","link":"/2025/06/13/compose/Compose%20--%20%E7%8A%B6%E6%80%81%E8%AE%A2%E9%98%85%20&%20%E8%87%AA%E5%8A%A8%E6%9B%B4%E6%96%B0%20--%2003.%20%E6%9C%89%E7%8A%B6%E6%80%81%E3%80%81%E6%97%A0%E7%8A%B6%E6%80%81%E3%80%81%E7%8A%B6%E6%80%81%E6%8F%90%E5%8D%87/"}],"tags":[{"name":"Compose","slug":"Compose","link":"/tags/Compose/"},{"name":"Modifier","slug":"Modifier","link":"/tags/Modifier/"},{"name":"CombinedModifier","slug":"CombinedModifier","link":"/tags/CombinedModifier/"},{"name":"LayoutModifier","slug":"LayoutModifier","link":"/tags/LayoutModifier/"},{"name":"çŠ¶æ€è®¢é˜… &amp; è‡ªåŠ¨æ›´æ–°","slug":"çŠ¶æ€è®¢é˜…-è‡ªåŠ¨æ›´æ–°","link":"/tags/%E7%8A%B6%E6%80%81%E8%AE%A2%E9%98%85-%E8%87%AA%E5%8A%A8%E6%9B%B4%E6%96%B0/"},{"name":"mutableStateListOf","slug":"mutableStateListOf","link":"/tags/mutableStateListOf/"},{"name":"é‡ç»„","slug":"é‡ç»„","link":"/tags/%E9%87%8D%E7%BB%84/"},{"name":"remember","slug":"remember","link":"/tags/remember/"},{"name":"é‡ç»„ä½œç”¨åŸŸ","slug":"é‡ç»„ä½œç”¨åŸŸ","link":"/tags/%E9%87%8D%E7%BB%84%E4%BD%9C%E7%94%A8%E5%9F%9F/"},{"name":"DrawModifier","slug":"DrawModifier","link":"/tags/DrawModifier/"},{"name":"ComposedModifier","slug":"ComposedModifier","link":"/tags/ComposedModifier/"},{"name":"Compose çŠ¶æ€","slug":"Compose-çŠ¶æ€","link":"/tags/Compose-%E7%8A%B6%E6%80%81/"}],"categories":[{"name":"Compose","slug":"Compose","link":"/categories/Compose/"},{"name":"çŠ¶æ€è®¢é˜… &amp; è‡ªåŠ¨æ›´æ–°","slug":"Compose/çŠ¶æ€è®¢é˜…-è‡ªåŠ¨æ›´æ–°","link":"/categories/Compose/%E7%8A%B6%E6%80%81%E8%AE%A2%E9%98%85-%E8%87%AA%E5%8A%A8%E6%9B%B4%E6%96%B0/"},{"name":"Modifier","slug":"Compose/Modifier","link":"/categories/Compose/Modifier/"}],"pages":[]}