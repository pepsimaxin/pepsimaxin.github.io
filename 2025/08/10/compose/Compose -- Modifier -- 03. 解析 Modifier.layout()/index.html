<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>æ·±åº¦è§£æ LayoutNode çš„æµ‹é‡ã€å¸ƒå±€åŸç† - wikiHow</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="wikiHow"><meta name="msapplication-TileImage" content="/img/wiki.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="wikiHow"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="æ·±å…¥æºç ï¼Œå±‚å±‚è§£æï¼Œå¸¦ä½ å®Œå…¨åƒé€ LayoutNode çš„æµ‹é‡ã€æ‘†æ”¾æµç¨‹ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šæ›´åŠ æ·±åº¦è§£æ Modifier.layout()ã€NodeCoordinator çš„åŸç†ï¼"><meta property="og:type" content="blog"><meta property="og:title" content="æ·±åº¦è§£æ LayoutNode çš„æµ‹é‡ã€å¸ƒå±€åŸç†"><meta property="og:url" content="http://example.com/2025/08/10/compose/Compose%20--%20Modifier%20--%2003.%20%E8%A7%A3%E6%9E%90%20Modifier.layout()/"><meta property="og:site_name" content="wikiHow"><meta property="og:description" content="æ·±å…¥æºç ï¼Œå±‚å±‚è§£æï¼Œå¸¦ä½ å®Œå…¨åƒé€ LayoutNode çš„æµ‹é‡ã€æ‘†æ”¾æµç¨‹ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šæ›´åŠ æ·±åº¦è§£æ Modifier.layout()ã€NodeCoordinator çš„åŸç†ï¼"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://example.com/gallery/covers/compose/cover_modifier_3.png"><meta property="article:published_time" content="2025-08-09T16:00:00.000Z"><meta property="article:modified_time" content="2025-08-19T09:10:03.943Z"><meta property="article:author" content="Marco"><meta property="article:tag" content="Compose"><meta property="article:tag" content="Modifier"><meta property="article:tag" content="LayoutModifier"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://example.com/gallery/covers/compose/cover_modifier_3.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com/2025/08/10/compose/Compose%20--%20Modifier%20--%2003.%20%E8%A7%A3%E6%9E%90%20Modifier.layout()/"},"headline":"æ·±åº¦è§£æ LayoutNode çš„æµ‹é‡ã€å¸ƒå±€åŸç†","image":["http://example.com/gallery/covers/compose/cover_modifier_3.png"],"datePublished":"2025-08-09T16:00:00.000Z","dateModified":"2025-08-19T09:10:03.943Z","author":{"@type":"Person","name":"Marco"},"publisher":{"@type":"Organization","name":"wikiHow","logo":{"@type":"ImageObject","url":"http://example.com/img/wikihow.svg"}},"description":"æ·±å…¥æºç ï¼Œå±‚å±‚è§£æï¼Œå¸¦ä½ å®Œå…¨åƒé€ LayoutNode çš„æµ‹é‡ã€æ‘†æ”¾æµç¨‹ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šæ›´åŠ æ·±åº¦è§£æ Modifier.layout()ã€NodeCoordinator çš„åŸç†ï¼"}</script><link rel="canonical" href="http://example.com/2025/08/10/compose/Compose%20--%20Modifier%20--%2003.%20%E8%A7%A3%E6%9E%90%20Modifier.layout()/"><link rel="icon" href="/img/wiki.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link data-pjax rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-dark.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link data-pjax rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/wikihow.svg" alt="wikiHow" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/pepsimaxin"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="ç›®å½•" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="æœç´¢" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-9-widescreen"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="/gallery/covers/compose/cover_modifier_3.png" alt="æ·±åº¦è§£æ LayoutNode çš„æµ‹é‡ã€å¸ƒå±€åŸç†"></span></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2025-08-09T16:00:00.000Z" title="2025/8/10 00:00:00">2025-08-10</time>å‘è¡¨</span><span class="level-item"><time dateTime="2025-08-19T09:10:03.943Z" title="2025/8/19 17:10:03">2025-08-19</time>æ›´æ–°</span><span class="level-item"><a class="link-muted" href="/categories/Compose/">Compose</a><span>Â /Â </span><a class="link-muted" href="/categories/Compose/Modifier/">Modifier</a></span></div></div><h1 class="title is-3 is-size-4-mobile">æ·±åº¦è§£æ LayoutNode çš„æµ‹é‡ã€å¸ƒå±€åŸç†</h1><div class="content"><hr>
<div class="notification is-danger">
<p>å…¶å®åŸç†æ€§åˆ†æçš„æ–‡ç« ï¼ŒçœŸçš„å¾ˆéš¾è®²çš„é€šä¿—æ˜“æ‡‚ï¼Œè®²çš„ç®€å•æµ…æ˜¾æ²¡å¿…è¦å†™ï¼Œè®²çš„ç¹çéš¾æ‡‚å¾€å¾€å¤§å®¶ä¹Ÿä¸ä¹æ„çœ‹ï¼Œæ‰€ä»¥æ€ä¹ˆæ‰¾ä¸ªå¥½çš„è§’åº¦æ…¢æ…¢é’»è¿›å»å°¤ä¸ºé‡è¦ï¼Œæ¯”å¦‚ï¼šBegin simple codeï¼</p>
</div>

<article class="message is-info"><div class="message-body">
<p>åŸºäº androidx.compose.runtime:runtime:1.7.1 ç‰ˆæœ¬</p>
</div></article>

<h1 id="Simple-Code"><a href="#Simple-Code" class="headerlink" title="Simple Code"></a>Simple Code</h1><hr>
<h2 id="ä¸€ä¸ª-Text"><a href="#ä¸€ä¸ª-Text" class="headerlink" title="ä¸€ä¸ª Text()"></a>ä¸€ä¸ª Text()</h2><p>å…ˆæ¥çœ‹ä¸€æ®µæœ€ç®€å•çš„ä»£ç ç¤ºä¾‹ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MainActivity</span> : <span class="type">ComponentActivity</span>() &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContent &#123;</span><br><span class="line">            ComposeBlogTheme &#123;</span><br><span class="line">                Box(Modifier.background(Color.Green)) &#123;</span><br><span class="line">                    Text(<span class="string">&quot;Hi Compose&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ®µä»£ç å¾ˆç®€å•ï¼Œæ•ˆæœå›¾å¦‚ä¸‹ï¼š</p>
<img src="https://v1.ax1x.com/2025/08/18/EPWp1s.png" alt="" border="0" width="500"/>

<br>

<br>

<p>æ¥ä¸‹æ¥åŸºäºè¿™ä¸ª Demoï¼Œæˆ‘ä»¬ä¼šæ…¢æ…¢å¼•å…¥æœ¬ç¯‡æ–‡ç« çš„ä¸»è§’ã€‚</p>
<hr>
<h2 id="Modifier-layout"><a href="#Modifier-layout" class="headerlink" title="Modifier.layout()"></a>Modifier.layout()</h2><p>åœ¨ Compose ä¸­ <span style="color: #FF5A00;">Modifier.layout() æ˜¯ä¸€ç§ã€Œå¸ƒå±€ä¿®é¥°ç¬¦ã€</span>ï¼š<br>â¤µï¸<br>å®ƒä¼šåŒ…è£¹ä¸€ä¸ªå¸ƒå±€èŠ‚ç‚¹ï¼šLayoutNodeï¼ˆä»€ä¹ˆæ˜¯ LayoutNodeï¼Œä¸‹é¢ä¼šè®²ï¼‰ï¼Œ<br>â¤µï¸<br><span style="color: #085DFF;">é€šå¸¸ç”¨ä½œå¯¹ç›®æ ‡ç»„ä»¶ã€Œè¿›è¡Œæµ‹é‡ã€å’Œã€Œä½ç½®æ‘†æ”¾ã€çš„</span>ã€‚</p>
<br>

<p><strong>è®²çš„æ›´ç›´ç™½ä¸€ç‚¹å°±æ˜¯ï¼š</strong><br>â¤µï¸<br>ä½ å¯ä»¥ç”¨ <span style="color: #FF5A00;">Modifier.layout()</span> æ¥<span style="color: #085DFF;">ã€Œè‡ªå®šä¹‰ç›®æ ‡ç»„ä»¶çš„æµ‹é‡è¿‡ç¨‹ã€</span>ä»¥åŠ<span style="color: #085DFF;">ã€Œå†³å®šç›®æ ‡ç»„ä»¶æ€ä¹ˆæ‘†æ”¾ã€</span>ã€‚</p>
<br>

<p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹åœ¨ä»£ç ä¸­æ€ä¹ˆä½¿ç”¨ï¼Œé€šå¸¸ä¼šåƒä¸‹é¢è¿™æ ·å†™ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MainActivity</span> : <span class="type">ComponentActivity</span>() &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContent &#123;</span><br><span class="line">            ComposeBlogTheme &#123;</span><br><span class="line">                Box(Modifier.background(Color.Green)) &#123;</span><br><span class="line">                    Text(<span class="string">&quot;Hi Compose&quot;</span>,</span><br><span class="line">                        Modifier.layout &#123; measurable, constraints -&gt;  &#125;</span><br><span class="line">                    )</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å°±è¿™ä¹ˆç®€å•ï¼Œ<code>Text</code> å°±æ˜¯ç›®æ ‡ç»„ä»¶ï¼Œæˆ‘ä»¬ç»™å®ƒåŠ äº†ä¸€ä¸ª Modifier.layout()ï¼Œæ²¡æœ‰æ·»åŠ ä»»ä½•å…¶ä»–ä»£ç é€»è¾‘ï¼Œ</p>
<p><code>&#123; measurable, constraints -&gt;  &#125;</code> æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œ</p>
<p>æ­¤æ—¶ä½ ä¼šå‘ç°åœ¨ Android Studio IDLE ä¸­ï¼Œè¿™æ ·å†™æ˜¯ä¼šæ ‡çº¢çš„ï¼š</p>
<img src="https://v1.ax1x.com/2025/08/18/EPWL6a.png" alt="" border="0" width="700"/>

<br>

<br>

<p>æ­£å¸¸æ¥è¯´ï¼Œæˆ‘è¿™é‡Œä»€ä¹ˆä¹Ÿä¸å¡«ä¸å°±ç›¸å½“äºå¯¹ Text() ä¸åšä»»ä½•ä¿®é¥°å—ï¼Ÿä½†å¾ˆæ˜æ˜¾è¿™æ ·æ˜¯ä¸è¡Œçš„ï¼Œä»£ç å·²ç»æŠ¥é”™äº†ï¼</p>
<p><strong>æ¥ä¸‹æ¥æˆ‘ä»¬ä¸€èµ·å°è¯•è§£å†³è¿™ä¸ªæŠ¥é”™ï¼</strong></p>
<p>é¦–å…ˆæˆ‘ä»¬å‘ç°å½“ä½¿ç”¨ Modifier.layout{} ä¿®é¥°ç¬¦æ—¶ï¼Œä¼ å…¥çš„å›è°ƒ lambda åŒ…å«äº†ä¸¤ä¸ªå‚æ•°ï¼š</p>
<div class="buttons">
  <button class="button is-info">measurable</button> ï¼šç”¨äºå­å…ƒç´ çš„æµ‹é‡å’Œä½ç½®æ”¾ç½®ï¼›
</div>

<div class="buttons">
  <button class="button is-warning">constraints</button> ï¼šç”¨äºçº¦æŸå­å…ƒç´  width å’Œ height çš„æœ€å¤§å€¼å’Œæœ€å°å€¼ã€‚
</div>

<p>æˆ‘ä»¬å®šä½åˆ° Modifier.layout() çš„æºç ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ğŸ“„ androidx.compose.ui.layout --&gt; LayoutModifier.kt</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> Modifier.<span class="title">layout</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    measure: <span class="type">MeasureScope</span>.(<span class="type">Measurable</span>, <span class="type">Constraints</span>) -&gt; <span class="type">MeasureResult</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span> = <span class="keyword">this</span> then LayoutElement(measure)</span><br></pre></td></tr></table></figure>

<p>å‘ç°æ²¡ï¼Ÿmeasurable å¯¹åº”çš„æ˜¯ Measurableï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ğŸ“„ androidx.compose.ui.layout --&gt; Measurable.kt</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Measurable</span> : <span class="type">IntrinsicMeasurable</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Measures the layout with [constraints], returning a [Placeable] layout that has its new</span></span><br><span class="line"><span class="comment">     * size. A [Measurable] can only be measured once inside a layout pass.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">// è¿”å›ä¸€ä¸ª Placeableï¼Œå®ƒé‡Œé¢åŒ…å«ç›®æ ‡ç»„ä»¶çš„å®½ã€é«˜ç­‰ä¿¡æ¯</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">measure</span><span class="params">(constraints: <span class="type">Constraints</span>)</span></span>: Placeable</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Measurable æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå†…éƒ¨ä»…æœ‰ä¸€ä¸ª <span style="color: #FF0000; font-weight: bold;">measure()</span> æ–¹æ³•ã€‚</p>
<p>æ‰€ä»¥ç°åœ¨å¯ä»¥å¼€å§‹ä¿®æ”¹åˆšæ‰çš„æŠ¥é”™äº†ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MainActivity</span> : <span class="type">ComponentActivity</span>() &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContent &#123;</span><br><span class="line">            ComposeBlogTheme &#123;</span><br><span class="line">                Box(Modifier.background(Color.Green)) &#123;</span><br><span class="line">                    Text(<span class="string">&quot;Hi Compose&quot;</span>,</span><br><span class="line">                        Modifier.layout &#123; measurable, constraints -&gt;</span><br><span class="line">                            <span class="comment">// ç”¨ä¸€ä¸ªå˜é‡ä¿å­˜è¿”å›çš„ Placeable å¯¹è±¡</span></span><br><span class="line">                            <span class="keyword">val</span> placeable = measurable.measure(constraints)</span><br><span class="line">                        &#125;</span><br><span class="line">                    )</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ä»£ç ä»ç„¶æ˜¯æ ‡çº¢æŠ¥é”™çš„ï¼ŒåŸå› åœ¨äºï¼šæˆ‘ä»¬åªå¤„ç†äº† measurableï¼Œå®ƒè¿”å›çš„æ˜¯ Placeableï¼Œè€Œ Modifier.layout() éœ€è¦è¿”å›çš„ç±»å‹æ˜¯ <span style="color: #085DFF; font-weight: bold;">MeasureResult</span>ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> Modifier.<span class="title">layout</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    measure: <span class="type">MeasureScope</span>.(<span class="type">Measurable</span>, <span class="type">Constraints</span>) -&gt; <span class="type">MeasureResult</span>  <span class="comment">// éœ€è¦è¿”å› MeasureResult</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span> = <span class="keyword">this</span> then LayoutModifierElement(measure)</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥ MeasureResult åˆæ˜¯ä»€ä¹ˆï¼Ÿ</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ğŸ“„ androidx.compose.ui.layout --&gt; MeasureResult.kt</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">MeasureResult</span> &#123;</span><br><span class="line">    <span class="keyword">val</span> width: <span class="built_in">Int</span></span><br><span class="line">    <span class="keyword">val</span> height: <span class="built_in">Int</span></span><br><span class="line">    <span class="keyword">val</span> alignmentLines: Map&lt;AlignmentLine, <span class="built_in">Int</span>&gt;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">placeChildren</span><span class="params">()</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>MeasureResult ä¹Ÿæ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒé‡Œé¢ä¹Ÿæœ‰ <u><strong>width</strong></u> å’Œ <u><strong>height</strong></u>ï¼Œç»§ç»­ä¿®å¤åˆšæ‰çš„æŠ¥é”™ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MainActivity</span> : <span class="type">ComponentActivity</span>() &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContent &#123;</span><br><span class="line">            ComposeBlogTheme &#123;</span><br><span class="line">                Text(<span class="string">&quot;ComposeTest&quot;</span>,</span><br><span class="line">                    Modifier.layout &#123; measurable, constraints -&gt;</span><br><span class="line">                        <span class="keyword">val</span> placeable = measurable.measure(constraints)</span><br><span class="line">                        <span class="keyword">object</span> : MeasureResult &#123;</span><br><span class="line">                            <span class="keyword">override</span> <span class="keyword">val</span> alignmentLines: Map&lt;AlignmentLine, <span class="built_in">Int</span>&gt;</span><br><span class="line">                                <span class="keyword">get</span>() = TODO(<span class="string">&quot;Not yet implemented&quot;</span>)</span><br><span class="line">                            <span class="keyword">override</span> <span class="keyword">val</span> height: <span class="built_in">Int</span></span><br><span class="line">                                <span class="keyword">get</span>() = TODO(<span class="string">&quot;Not yet implemented&quot;</span>)</span><br><span class="line">                            <span class="keyword">override</span> <span class="keyword">val</span> width: <span class="built_in">Int</span></span><br><span class="line">                                <span class="keyword">get</span>() = TODO(<span class="string">&quot;Not yet implemented&quot;</span>)</span><br><span class="line"></span><br><span class="line">                            <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">placeChildren</span><span class="params">()</span></span> &#123;</span><br><span class="line">                                TODO(<span class="string">&quot;Not yet implemented&quot;</span>)</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ—¢ç„¶ Modifier.layout()  éœ€è¦ä¸€ä¸ª MeasureResult è¿”å›å¯¹è±¡ï¼Œé‚£æˆ‘ä»¬å°±åœ¨å†…éƒ¨ç»™å®ƒåˆ›å»ºä¸€ä¸ª MeasureResult å¯¹è±¡ï¼Œæ­¤æ—¶ IDLE å°±ä¸ä¼šå†æŠ¥é”™äº†ã€‚</p>
<p>å½“ç„¶æˆ‘ä»¬è¿˜éœ€è¦åšä¸€ä¸ªå·¥ä½œï¼Œé‚£å°±æ˜¯æŠŠ placeable çš„å®½é«˜ä¼ è¿› MeasureResult å†…éƒ¨ï¼Œæ‰€ä»¥æœ€ç»ˆçš„ä»£ç ä¿®æ”¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MainActivity</span> : <span class="type">ComponentActivity</span>() &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContent &#123;</span><br><span class="line">            ComposeBlogTheme &#123;</span><br><span class="line">                Box(Modifier.background(Color.Green)) &#123;</span><br><span class="line">                    Text(<span class="string">&quot;Hi Compose&quot;</span>,</span><br><span class="line">                        Modifier.layout &#123; measurable, constraints -&gt;</span><br><span class="line">                            <span class="keyword">val</span> placeable = measurable.measure(constraints)</span><br><span class="line">                            <span class="keyword">object</span> : MeasureResult &#123;</span><br><span class="line">                                <span class="comment">// æµ‹é‡åŸºå‡†çº¿ï¼Œæš‚æ—¶ä¸ç”¨å…³å¿ƒ</span></span><br><span class="line">                                <span class="keyword">override</span> <span class="keyword">val</span> alignmentLines: Map&lt;AlignmentLine, <span class="built_in">Int</span>&gt;</span><br><span class="line">                                    <span class="keyword">get</span>() = TODO(<span class="string">&quot;Not yet implemented&quot;</span>)</span><br><span class="line">                                <span class="comment">// é«˜ï¼šplaceable.height</span></span><br><span class="line">                                <span class="keyword">override</span> <span class="keyword">val</span> height: <span class="built_in">Int</span></span><br><span class="line">                                    <span class="keyword">get</span>() = placeable.height</span><br><span class="line">                                <span class="comment">// å®½ï¼šplaceable.width</span></span><br><span class="line">                                <span class="keyword">override</span> <span class="keyword">val</span> width: <span class="built_in">Int</span></span><br><span class="line">                                    <span class="keyword">get</span>() = placeable.width</span><br><span class="line"></span><br><span class="line">                                <span class="comment">// æ‘†æ”¾å†…éƒ¨ç»„ä»¶ï¼Œæš‚æ—¶ä¸ç”¨å…³å¿ƒ</span></span><br><span class="line">                                <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">placeChildren</span><span class="params">()</span></span> &#123;</span><br><span class="line">                                    TODO(<span class="string">&quot;Not yet implemented&quot;</span>)</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    )</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è‡³æ­¤æŠ¥é”™å°±ä¿®å¤äº†ï¼Œä¸Šé¢çš„ä»£ç æ¼”ç¤ºäº†å¯¹ Text() æ·»åŠ  Modifier.layout() è¿›è¡Œä¿®é¥°ï¼ˆå½“ç„¶ä¸Šé¢çš„åšæ³•ç­‰åŒäºå•¥ä¹Ÿæ²¡åšï¼‰ã€‚</p>
<p>ä½†è¿™æ®µä»£ç æœ‰ä¸ªç¼ºé™·ï¼šå¦‚æœæ¯æ¬¡é€šè¿‡ Modifier.layout() å¯¹ç»„ä»¶ä¿®é¥°ï¼Œéƒ½å¾—åƒä¸Šé¢è¿™æ ·å†™ä¸€å †ä»£ç ï¼Œé‚£è¿˜ä¸å¾—ç–¯ï¼Ÿ</p>
<hr>
<h2 id="layout-å‡½æ•°"><a href="#layout-å‡½æ•°" class="headerlink" title="layout() å‡½æ•°"></a>layout() å‡½æ•°</h2><p>å…¶å®åœ¨å®é™…å¼€å‘ä¸­æˆ‘ä»¬å¹¶ä¸ä¼šè¿™ä¹ˆå†™ï¼Œè€Œæ˜¯ä½¿ç”¨ Compose æä¾›ç»™æˆ‘ä»¬çš„ <font color="#085DFF"><strong>layout() å‡½æ•°</strong></font>ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MainActivity</span> : <span class="type">ComponentActivity</span>() &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContent &#123;</span><br><span class="line">            ComposeBlogTheme &#123;</span><br><span class="line">                Box(Modifier.background(Color.Green)) &#123;</span><br><span class="line">                    Text(<span class="string">&quot;Hi Compose&quot;</span>,</span><br><span class="line">                        Modifier.layout &#123; measurable, constraints -&gt;</span><br><span class="line">                            <span class="keyword">val</span> placeable = measurable.measure(constraints)</span><br><span class="line">                            <span class="comment">/*object : MeasureResult &#123;</span></span><br><span class="line"><span class="comment">                                override val alignmentLines: Map&lt;AlignmentLine, Int&gt;</span></span><br><span class="line"><span class="comment">                                    get() = TODO(&quot;Not yet implemented&quot;)</span></span><br><span class="line"><span class="comment">                                override val height: Int</span></span><br><span class="line"><span class="comment">                                    get() = TODO(&quot;Not yet implemented&quot;)</span></span><br><span class="line"><span class="comment">                                override val width: Int</span></span><br><span class="line"><span class="comment">                                    get() = TODO(&quot;Not yet implemented&quot;)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                                override fun placeChildren() &#123;</span></span><br><span class="line"><span class="comment">                                    TODO(&quot;Not yet implemented&quot;)</span></span><br><span class="line"><span class="comment">                                &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                            &#125;*/</span></span><br><span class="line">                            layout() &#123;</span><br><span class="line">                                </span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    )</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ¥çœ‹ä¸‹ layout() æºç ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">ğŸ“„ androidx.compose.ui.layout --&gt; MeasureScope.kt</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">MeasureScope</span> : <span class="type">IntrinsicMeasureScope</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">layout</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        width: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        height: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        alignmentLines: <span class="type">Map</span>&lt;<span class="type">AlignmentLine</span>, <span class="built_in">Int</span>&gt; = emptyMap()</span></span>,</span><br><span class="line">        placementBlock: Placeable.PlacementScope.() -&gt; <span class="built_in">Unit</span></span><br><span class="line">    ) = layout(width, height, alignmentLines, <span class="literal">null</span>, placementBlock)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">layout</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        width: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        height: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        alignmentLines: <span class="type">Map</span>&lt;<span class="type">AlignmentLine</span>, <span class="built_in">Int</span>&gt; = emptyMap()</span></span>,</span><br><span class="line">        rulers: (RulerScope.() -&gt; <span class="built_in">Unit</span>)? = <span class="literal">null</span>,</span><br><span class="line">        placementBlock: Placeable.PlacementScope.() -&gt; <span class="built_in">Unit</span></span><br><span class="line">    ): MeasureResult &#123;</span><br><span class="line">        checkMeasuredSize(width, height)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">object</span> : MeasureResult &#123;</span><br><span class="line">            <span class="keyword">override</span> <span class="keyword">val</span> width = width</span><br><span class="line">            <span class="keyword">override</span> <span class="keyword">val</span> height = height</span><br><span class="line">            <span class="keyword">override</span> <span class="keyword">val</span> alignmentLines = alignmentLines</span><br><span class="line">            <span class="keyword">override</span> <span class="keyword">val</span> rulers = rulers</span><br><span class="line">            <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">placeChildren</span><span class="params">()</span></span> &#123;</span><br><span class="line">                <span class="comment">// This isn&#x27;t called from anywhere inside the compose framework. This might</span></span><br><span class="line">                <span class="comment">// be called by tests or external frameworks.</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">this</span><span class="symbol">@MeasureScope</span> <span class="keyword">is</span> LookaheadCapablePlaceable) &#123;</span><br><span class="line">                    placementScope.placementBlock()</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    SimplePlacementScope(</span><br><span class="line">                        width,</span><br><span class="line">                        layoutDirection</span><br><span class="line">                    ).placementBlock()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¾ˆæ˜æ˜¾ layout() å‡½æ•°å¸®æˆ‘ä»¬åˆ›å»ºå¥½äº† MeasureResult å¯¹è±¡ï¼ŒåŒæ—¶å®ƒè¿˜å¸®æˆ‘ä»¬å¹²äº†å¦å¤–ä¸¤ä»¶æ²¡åšçš„äº‹ï¼š</p>
<ol>
<li>ç»™ alignmentLines è®¾å®šäº†é»˜è®¤å€¼ï¼›</li>
<li>å®ç°äº† placeChildren()ã€‚</li>
</ol>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬ç°åœ¨åªéœ€è¦è¡¥å…¨ layout() å‡½æ•°å‰©ä½™çš„ä¸¤ä¸ªå‚æ•°ï¼š<u><strong>width</strong></u> å’Œ <u><strong>height</strong></u>ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MainActivity</span> : <span class="type">ComponentActivity</span>() &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContent &#123;</span><br><span class="line">            ComposeBlogTheme &#123;</span><br><span class="line">                Box(Modifier.background(Color.Green)) &#123;</span><br><span class="line">                    Text(<span class="string">&quot;Hi Compose&quot;</span>,</span><br><span class="line">                        Modifier.layout &#123; measurable, constraints -&gt;</span><br><span class="line">                            <span class="keyword">val</span> placeable = measurable.measure(constraints)</span><br><span class="line">                            layout(placeable.width, placeable.height) &#123;</span><br><span class="line"></span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    )</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å†™ä»£ç æ˜¯ä¸æ˜¯ç¬é—´æ„Ÿè§‰æ¸…çˆ½äº†å¾ˆå¤šï¼Ÿä½†å·¥ä½œåˆ°è¿™è¾¹è¿˜æ²¡æœ‰ç»“æŸï¼Œlayout() å‡½æ•°è¿˜æœ‰ç¬¬å››ä¸ªå‚æ•°ï¼Œæ˜¯ä¸€ä¸ª Lambda è¡¨è¾¾å¼ï¼Œ<font color="#085DFF"><strong>ä¸»è¦å·¥ä½œæ˜¯å¤„ç†è¢«ä¿®é¥°ç»„ä»¶çš„æ‘†æ”¾è§„åˆ™</strong></font>ï¼Œæ¯”å¦‚åç§»é‡ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">layout</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    width: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    height: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    alignmentLines: <span class="type">Map</span>&lt;<span class="type">AlignmentLine</span>, <span class="built_in">Int</span>&gt; = emptyMap()</span></span>,</span><br><span class="line">    placementBlock: Placeable.PlacementScope.() -&gt; <span class="built_in">Unit</span>    <span class="comment">// Lambda è¡¨è¾¾å¼</span></span><br><span class="line">) = <span class="keyword">object</span> : MeasureResult &#123;</span><br><span class="line">    ... ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ç»§ç»­å®Œå–„ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MainActivity</span> : <span class="type">ComponentActivity</span>() &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContent &#123;</span><br><span class="line">            ComposeBlogTheme &#123;</span><br><span class="line">                Box(Modifier.background(Color.Green)) &#123;</span><br><span class="line">                    Text(<span class="string">&quot;Hi Compose&quot;</span>,</span><br><span class="line">                        Modifier.layout &#123; measurable, constraints -&gt;</span><br><span class="line">                            <span class="keyword">val</span> placeable = measurable.measure(constraints)</span><br><span class="line">                            layout(placeable.width, placeable.height) &#123;</span><br><span class="line">                                <span class="comment">// ä¸åšä»»ä½•åç§»</span></span><br><span class="line">                                placeable.placeRelative(<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    )</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æ‰€æœ‰å·¥ä½œï¼ˆæµ‹é‡ + æ‘†æ”¾ï¼‰éƒ½å·²å®Œæˆï¼Œè¿è¡Œçœ‹ä¸‹æ•ˆæœï¼š</p>
<img src="https://v1.ax1x.com/2025/08/18/EPW3N7.png" alt="" border="0" width="500"/>

<br>

<br>

<p>å¯ä»¥çœ‹å‡ºæ¥ï¼Œæ²¡æœ‰ä»»ä½•å˜åŒ–ï¼Œå› ä¸ºæˆ‘ä»¬è™½ç„¶ç”¨ Modifier.layout() å¯¹ Text åšä¿®é¥°ï¼Œä½†å¹¶æ²¡æœ‰å¯¹å®ƒåšä»»ä½•å°ºå¯¸ä¿®æ”¹å’Œä½ç½®åç§»ã€‚</p>
<p>é‚£å¦‚æœæˆ‘ç°åœ¨æƒ³ä¿®æ”¹ Text() çš„å°ºå¯¸ï¼Œè¯¥æ€ä¹ˆåšï¼Ÿ</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MainActivity</span> : <span class="type">ComponentActivity</span>() &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContent &#123;</span><br><span class="line">            ComposeBlogTheme &#123;</span><br><span class="line">                Box(Modifier.background(Color.Green)) &#123;</span><br><span class="line">                    Text(<span class="string">&quot;Hi Compose&quot;</span>,</span><br><span class="line">                        Modifier.layout &#123; measurable, constraints -&gt;</span><br><span class="line">                            <span class="keyword">val</span> placeable = measurable.measure(constraints)</span><br><span class="line">                            <span class="keyword">val</span> size = min(placeable.width, placeable.height)</span><br><span class="line">                            layout(size, size) &#123;</span><br><span class="line">                                placeable.placeRelative(<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª size å˜é‡ï¼Œé€šè¿‡ min() å‡½æ•°è·å–å®½é«˜æœ€å°å€¼ï¼Œç„¶åé‡æ–°ä¼ å…¥ layout() é‡Œé¢ï¼Œè¿™æ ·å°±ä¼šè·å¾—ä¸€ä¸ªæ­£æ–¹å½¢çš„æ•ˆæœã€‚</p>
<img src="https://v1.ax1x.com/2025/08/18/EPWlvI.png" alt="" border="0" width="500"/>

<br>

<br>

<p>å°ºå¯¸ä¿®æ”¹ç¡®å®ç”Ÿæ•ˆäº†ï¼Œæ¥ä¸‹æ¥å†å¢åŠ ä¸€ä¸ªåç§»ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MainActivity</span> : <span class="type">ComponentActivity</span>() &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContent &#123;</span><br><span class="line">            ComposeBlogTheme &#123;</span><br><span class="line">                Box(Modifier.background(Color.Green)) &#123;</span><br><span class="line">                    Text(<span class="string">&quot;Hi Compose&quot;</span>,</span><br><span class="line">                        Modifier.layout &#123; measurable, constraints -&gt;</span><br><span class="line">                            <span class="keyword">val</span> placeable = measurable.measure(constraints)</span><br><span class="line">                            <span class="keyword">val</span> size = min(placeable.width, placeable.height)</span><br><span class="line">                            layout(size, size) &#123;</span><br><span class="line">                                placeable.placeRelative(<span class="number">30</span>, <span class="number">0</span>)</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>çœ‹ä¸‹æ•ˆæœï¼š</p>
<img src="https://v1.ax1x.com/2025/08/18/EPWQ0L.png" alt="" border="0" width="500"/>

<br>

<br>

<p>å¦å¤–æœ‰ä¸ªç»†èŠ‚éœ€è¦è¯´æ˜ä¸‹ï¼Œé™¤äº†ä½¿ç”¨ <strong>placeRelative</strong> å¯¹ç»„ä»¶åç§»å¤–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ <strong>place</strong> è¿›è¡Œåç§»æ“ä½œï¼Œä¸¤è€…çš„åŒºåˆ«å°±æ˜¯ <strong>placeRelative</strong> ä¼šè‡ªé€‚åº” RTL å¸ƒå±€ã€‚</p>
<hr>
<p>è®²åˆ°è¿™é‡Œï¼ŒModifier.layout() ä¿®é¥°ç¬¦å’Œ layout() å‡½æ•°çš„ç”¨æ³•ä½ åº”è¯¥éƒ½æ¸…æ¥šäº†ï¼Œä½†è¿˜æ²¡ç»“æŸï¼Œå‰é¢æˆ‘ä»¬ä¸€ç›´å¿½ç•¥äº†ä¸€ä¸ªå‚æ•°ï¼š<font color="#FF0000"><strong>constraints</strong></font>ï¼Œå®ƒæ˜¯ä»€ä¹ˆï¼Ÿ</p>
<div class="buttons">
  <button class="button is-info">measurable</button> ï¼šç”¨äºå­å…ƒç´ çš„æµ‹é‡å’Œä½ç½®æ”¾ç½®ï¼›
</div>

<div class="buttons">
  <button class="button is-warning">constraints</button> ï¼šç”¨äºçº¦æŸå­å…ƒç´  width å’Œ height çš„æœ€å¤§å€¼å’Œæœ€å°å€¼ã€‚
</div>

<p>å‰é¢çš„ä¾‹å­å¹¶æ²¡æœ‰å¯¹ constraints åšä»»ä½•ä¿®æ”¹ï¼Œåœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¾€å¾€éœ€è¦é€šè¿‡ constraints å¯¹ç»„ä»¶è¿›è¡Œé™åˆ¶ã€‚</p>
<p>æ¯”å¦‚æˆ‘æƒ³å¯¹ Text() ç»„ä»¶è¿›è¡Œä¸€ä¸ªé™åˆ¶ï¼Œç±»ä¼¼ padding çš„æ•ˆæœï¼Œç»™å®ƒåŠ ä¸€ä¸ª 10dp çš„æœ€å¤§å®½é«˜çš„é™åˆ¶ï¼ˆæœ€å¤§å®½é«˜ç¼©å‡ 10dpï¼‰ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MainActivity</span> : <span class="type">ComponentActivity</span>() &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContent &#123;</span><br><span class="line">            ComposeBlogTheme &#123;</span><br><span class="line">                Box(Modifier.background(Color.Green)) &#123;</span><br><span class="line">                    Text(<span class="string">&quot;Hi Compose&quot;</span>,</span><br><span class="line">                        Modifier.layout &#123; measurable, constraints -&gt;</span><br><span class="line">                            <span class="keyword">val</span> paddingPx = <span class="number">10.</span>dp.roundToPx()</span><br><span class="line">                            <span class="keyword">val</span> placeable = measurable.measure(constraints.copy(</span><br><span class="line">                                maxWidth = constraints.maxWidth - paddingPx * <span class="number">2</span>,</span><br><span class="line">                                maxHeight = constraints.maxHeight - paddingPx * <span class="number">2</span></span><br><span class="line">                            ))</span><br><span class="line">                            layout(placeable.width + paddingPx * <span class="number">2</span>, placeable.height + paddingPx * <span class="number">2</span>) &#123;</span><br><span class="line">                                placeable.placeRelative(paddingPx, paddingPx)</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>çœ‹ä¸‹æ•ˆæœï¼š</p>
<img src="https://v1.ax1x.com/2025/08/18/EPWNxJ.png" alt="" border="0" width="500"/>

<br>

<br>

<p>å¾ˆæ˜æ˜¾ï¼Œæˆ‘ä»¬å®ç°çš„æ•ˆæœè·Ÿ Modifier.padding(10.dp) çš„æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œå¦‚æœä½ å»çœ‹çœ‹ Modifier.padding çš„æºç ï¼Œå°±ä¼šå‘ç°å®ƒçš„å†…éƒ¨åŸç†è·Ÿæˆ‘ä»¬ä¾‹å­æ˜¯ä¸€æ ·çš„ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Stable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> Modifier.<span class="title">padding</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    horizontal: <span class="type">Dp</span> = <span class="number">0.</span>dp,</span></span></span><br><span class="line"><span class="params"><span class="function">    vertical: <span class="type">Dp</span> = <span class="number">0.</span>dp</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span> = <span class="keyword">this</span> then PaddingElement(</span><br><span class="line">    ... ...</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">PaddingElement</span>(</span><br><span class="line">    <span class="keyword">var</span> start: Dp = <span class="number">0.</span>dp,</span><br><span class="line">    <span class="keyword">var</span> top: Dp = <span class="number">0.</span>dp,</span><br><span class="line">    <span class="keyword">var</span> end: Dp = <span class="number">0.</span>dp,</span><br><span class="line">    <span class="keyword">var</span> bottom: Dp = <span class="number">0.</span>dp,</span><br><span class="line">    <span class="keyword">var</span> rtlAware: <span class="built_in">Boolean</span>,</span><br><span class="line">    <span class="keyword">val</span> inspectorInfo: InspectorInfo.() -&gt; <span class="built_in">Unit</span></span><br><span class="line">) : ModifierNodeElement&lt;PaddingNode&gt;() &#123;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">PaddingNode</span>(</span><br><span class="line">    <span class="keyword">var</span> start: Dp = <span class="number">0.</span>dp,</span><br><span class="line">    <span class="keyword">var</span> top: Dp = <span class="number">0.</span>dp,</span><br><span class="line">    <span class="keyword">var</span> end: Dp = <span class="number">0.</span>dp,</span><br><span class="line">    <span class="keyword">var</span> bottom: Dp = <span class="number">0.</span>dp,</span><br><span class="line">    <span class="keyword">var</span> rtlAware: <span class="built_in">Boolean</span></span><br><span class="line">) : LayoutModifierNode, Modifier.Node() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> MeasureScope.<span class="title">measure</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        measurable: <span class="type">Measurable</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        constraints: <span class="type">Constraints</span></span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span>: MeasureResult &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">val</span> horizontal = start.roundToPx() + end.roundToPx()</span><br><span class="line">        <span class="keyword">val</span> vertical = top.roundToPx() + bottom.roundToPx()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">val</span> placeable = measurable.measure(constraints.offset(-horizontal, -vertical))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">val</span> width = constraints.constrainWidth(placeable.width + horizontal)</span><br><span class="line">        <span class="keyword">val</span> height = constraints.constrainHeight(placeable.height + vertical)</span><br><span class="line">        <span class="keyword">return</span> layout(width, height) &#123;</span><br><span class="line">            <span class="keyword">if</span> (rtlAware) &#123;</span><br><span class="line">                placeable.placeRelative(start.roundToPx(), top.roundToPx())</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                placeable.place(start.roundToPx(), top.roundToPx())</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<p><progress class="progress is-success" value="100" max="100"></progress></p>
<h1 id="LayoutNode-æµ…æ"><a href="#LayoutNode-æµ…æ" class="headerlink" title="LayoutNode æµ…æ"></a>LayoutNode æµ…æ</h1><br>

<p>é€šè¿‡å‰é¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼š</p>
<p><font color="#085DFF">ä¸è®ºæ˜¯ä½¿ç”¨ Modifier.layout() ä¿®é¥°ç¬¦è¿˜æ˜¯ä½¿ç”¨ Compose æä¾›ç»™æˆ‘ä»¬çš„ç°æˆçš„ä¿®é¥°ç¬¦ï¼Œæ¯”å¦‚ï¼šModifier.padding() &#x2F; Modifier.size()ï¼Œå®ƒä»¬éƒ½ä¼šå¯¹è¢«ä¿®é¥°ç»„ä»¶äº§ç”Ÿç²¾ç»†å½±å“ï¼ˆç»„ä»¶å¤§å°ã€ä½ç½®åç§»ï¼‰ã€‚</font></p>
<p>ä½†åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä»…ä»…æ˜¯ä» UI æ•ˆæœä¸Šçœ‹åˆ° Modifier.layout() ä¼šå½±å“è¢«ä¿®é¥°ç»„ä»¶ï¼Œä½†æºç åº•å±‚æ˜¯å¦‚ä½•äº§ç”Ÿå½±å“çš„å‘¢ï¼Ÿ</p>
<p>è¿™æ‰æ˜¯æˆ‘ä»¬è¿™ç¯‡æ–‡ç« çš„æ ¸å¿ƒä»·å€¼ï¼</p>
<div class="buttons">
  <button class="button is-danger">æ‰€ä»¥ï¼Œæœ€ç¡¬æ ¸çš„åŸç†éƒ¨åˆ†æ¥äº†ï¼</button>
</div>

<p>æˆ‘ä»¬å°±æ‹¿å¸¸ç”¨çš„ Modifier.padding() åˆ†æï¼Œæ¥çœ‹ä¸‹å®ƒçš„æºç ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">ğŸ“„ androidx.compose.foundation.layout --&gt; Padding.kt</span><br><span class="line"></span><br><span class="line"><span class="meta">@Stable</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> Modifier.<span class="title">padding</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    start: <span class="type">Dp</span> = <span class="number">0.</span>dp,</span></span></span><br><span class="line"><span class="params"><span class="function">    top: <span class="type">Dp</span> = <span class="number">0.</span>dp,</span></span></span><br><span class="line"><span class="params"><span class="function">    end: <span class="type">Dp</span> = <span class="number">0.</span>dp,</span></span></span><br><span class="line"><span class="params"><span class="function">    bottom: <span class="type">Dp</span> = <span class="number">0.</span>dp</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span> = <span class="keyword">this</span> then PaddingElement(</span><br><span class="line">    start = start,</span><br><span class="line">    top = top,</span><br><span class="line">    end = end,</span><br><span class="line">    bottom = bottom,</span><br><span class="line">    rtlAware = <span class="literal">true</span>,</span><br><span class="line">    inspectorInfo = &#123;</span><br><span class="line">        name = <span class="string">&quot;padding&quot;</span></span><br><span class="line">        properties[<span class="string">&quot;start&quot;</span>] = start</span><br><span class="line">        properties[<span class="string">&quot;top&quot;</span>] = top</span><br><span class="line">        properties[<span class="string">&quot;end&quot;</span>] = end</span><br><span class="line">        properties[<span class="string">&quot;bottom&quot;</span>] = bottom</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">PaddingElement</span>(</span><br><span class="line">    <span class="keyword">var</span> start: Dp = <span class="number">0.</span>dp,</span><br><span class="line">    <span class="keyword">var</span> top: Dp = <span class="number">0.</span>dp,</span><br><span class="line">    <span class="keyword">var</span> end: Dp = <span class="number">0.</span>dp,</span><br><span class="line">    <span class="keyword">var</span> bottom: Dp = <span class="number">0.</span>dp,</span><br><span class="line">    <span class="keyword">var</span> rtlAware: <span class="built_in">Boolean</span>,</span><br><span class="line">    <span class="keyword">val</span> inspectorInfo: InspectorInfo.() -&gt; <span class="built_in">Unit</span></span><br><span class="line">) : ModifierNodeElement&lt;PaddingNode&gt;() &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">ModifierNodeElement</span>&lt;<span class="type">N : Modifier.Node</span>&gt; : <span class="type">Modifier.Element</span>, <span class="type">InspectableValue</span> &#123;</span><br></pre></td></tr></table></figure>

<p><strong>å±‚çº§å…³ç³»éå¸¸æ¸…æ™°ï¼š</strong></p>
<ol>
<li>Modifier.padding() è°ƒç”¨ä¸€ä¸ª PaddingElement()ï¼›<br>â¤µï¸</li>
<li>è€Œ PaddingElement å®ç°äº† ModifierNodeElement ç±»ï¼ˆè¿™æ˜¯ä¸ªèŒƒå‹ç±»ï¼Œå…¶ä¸­åˆ›å»ºäº† PaddingNodeï¼‰ï¼›<br>â¤µï¸</li>
<li>è¿™ä¸ª PaddingNodeï¼Œä¼šè¢« Compose ç”¨äºä¿®æ”¹æµ‹é‡å’Œå¸ƒå±€è¿‡ç¨‹ï¼Œä»è€Œæœ€ç»ˆå½±å“åˆ°ç•Œé¢å…ƒç´ çš„ä½ç½®å’Œå°ºå¯¸ã€‚</li>
</ol>
<p>æ‰€ä»¥æˆ‘ä»¬çš„é‡ç‚¹å°±æ˜¯è¦ç ”ç©¶ <span style="color: #085DFF; font-weight: bold;">PaddingNode æ˜¯å¦‚ä½•å½±å“ç»„ä»¶çš„ï¼</span></p>
<br>

<p><span style="color: #FF0000; font-weight: bold;">ä½†æ˜¯ï¼åœ¨ç ”ç©¶ PaddingNode åŸç†ä¹‹å‰ï¼Œæœ‰ä¸€ä¸ªæ ¸å¿ƒçŸ¥è¯†ç‚¹æ˜¯å¿…é¡»è¦æå‰äº†è§£çš„ã€‚</span></p>
<p>æ¥çœ‹ä¸‹é¢è¿™æ®µéå¸¸ç†Ÿæ‚‰çš„ä»£ç ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MainActivity</span> : <span class="type">ComponentActivity</span>() &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContent &#123;</span><br><span class="line">            ComposeBlogTheme &#123;</span><br><span class="line">                Box(Modifier.background(Color.Green)) &#123;</span><br><span class="line">                    Text(<span class="string">&quot;Hi Compose&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Box ã€Text è¿™äº›å‡½æ•°åœ¨å®é™…è¿è¡Œçš„æ—¶å€™ï¼Œå…¶å®å¹¶ä¸æ˜¯è¿™äº›å‡½æ•°ç›´æ¥å­˜åœ¨äºå†…å­˜é‡Œé¢ï¼Œè€Œæ˜¯ Compose åˆ©ç”¨è¿™äº›å‡½æ•°åˆ›é€ å‡ºçš„ä¸€äº›å¯¹è±¡å­˜åœ¨äºå†…å­˜é‡Œé¢ï¼Œè¿™ä¸ªå¯¹è±¡å°±æ˜¯ï¼š<span style="color: #008B45; font-weight: bold;">LayoutNode</span>ã€‚<br>â¤µï¸<br>å®ƒæ‰æ˜¯æœ€åº•å±‚çš„é‚£ä¸ªèŠ‚ç‚¹ï¼Œè¿›è¡Œå®é™…çš„<span style="color: #085DFF; font-weight: bold;">ã€Œ æµ‹é‡ã€å¸ƒå±€ã€ç»˜åˆ¶ã€è§¦æ‘¸åé¦ˆ ã€</span>ç­‰å·¥ä½œã€‚</p>
<div class="notification is-warning">
<p>æˆ‘ä»¬æ—¢ç„¶æƒ³çŸ¥é“ PaddingNode æ˜¯å¦‚ä½•ç²¾ç»†å½±å“ Text() ç»„ä»¶ï¼Œé‚£å°±å¾—å…ˆç ”ç©¶æ˜ç™½ Text() è‡ªå·±çš„æµ‹é‡ã€å¸ƒå±€ã€ç»˜åˆ¶çš„åŸç†ï¼Œå› ä¸º PaddingNode æ˜¯åŒ…ç€è¿™ä¸ª Text() çš„ã€‚</p>
</div>

<p>åœ¨ LayoutNode ä¸­ï¼ˆText å®é™…åº•å±‚èŠ‚ç‚¹ï¼‰ï¼Œæµ‹é‡å’Œå¸ƒå±€æ˜¯ç”± <span style="color: #FF0000; font-weight: bold;">remeasure()</span> å‡½æ•°å’Œ <span style="color: #FF0000; font-weight: bold;">replace()</span> ä¸¤ä¸ªå‡½æ•°å¤„ç†ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ğŸ“„ androidx.compose.ui.node --&gt; LayoutNode.kt</span><br><span class="line"></span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title class_">LayoutNode</span>(..) &#123;</span><br><span class="line">    <span class="keyword">internal</span> <span class="function"><span class="keyword">fun</span> <span class="title">replace</span><span class="params">()</span></span>      <span class="comment">// å¸ƒå±€</span></span><br><span class="line">    <span class="keyword">internal</span> <span class="function"><span class="keyword">fun</span> <span class="title">remeasure</span><span class="params">()</span></span>    <span class="comment">// æµ‹é‡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="remeasure"><a href="#remeasure" class="headerlink" title="remeasure()"></a>remeasure()</h2><p>æˆ‘ä»¬å…ˆæ¥åˆ†æ remeasure() å‡½æ•°ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">ğŸ“„ androidx.compose.ui.node --&gt; LayoutNode.kt</span><br><span class="line"></span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title class_">LayoutNode</span>(..) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">internal</span> <span class="function"><span class="keyword">fun</span> <span class="title">remeasure</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        constraints: <span class="type">Constraints</span>? = layoutDelegate.lastConstraints</span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">if</span> (constraints != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (intrinsicsUsageByParent == UsageByParent.NotUsed) &#123;</span><br><span class="line">                <span class="comment">// ä¹‹å‰è¿™ä¸ªèŠ‚ç‚¹å¯èƒ½å‘å­èŠ‚ç‚¹è¯¢é—®è¿‡ intrinsicsï¼ˆå›ºæœ‰å°ºå¯¸ï¼‰</span></span><br><span class="line">                <span class="comment">// è‹¥çˆ¶èŠ‚ç‚¹è¿™æ¬¡ä¸éœ€è¦ intrinsicsï¼Œå°±æŠŠæ•´æ£µå­æ ‘é‡Œè®°å½•çš„ intrinsics ä½¿ç”¨æ ‡è®°æ¸…æ‰</span></span><br><span class="line">                clearSubtreeIntrinsicsUsage()</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * æ ¸å¿ƒï¼šçœŸæ­£æ‰§è¡Œæµ‹é‡</span></span><br><span class="line"><span class="comment">             *      æµ‹é‡å·¥ä½œäº¤ç»™ LayoutNodeLayoutDelegate çš„å†…éƒ¨ç±» MeasurePassDelegate å¤„ç†</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            measurePassDelegate.remeasure(constraints)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>LayoutNode å†…éƒ¨è¦å¤„ç†çš„äº‹æƒ…éå¸¸å¤šï¼Œå®ƒæŠŠæµ‹é‡çš„å·¥ä½œäº¤ç»™äº† MeasurePassDelegate æ¥å¤„ç†ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">ğŸ“„  androidx.compose.ui.node --&gt; LayoutNodeLayoutDelegate.kt</span><br><span class="line"></span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title class_">LayoutNodeLayoutDelegate</span>(</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> layoutNode: LayoutNode</span><br><span class="line">) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">inner</span> <span class="keyword">class</span> <span class="title class_">MeasurePassDelegate</span> : <span class="type">Measurable</span>, <span class="type">Placeable</span>(), AlignmentLinesOwner,</span><br><span class="line">        MotionReferencePlacementDelegate &#123;</span><br><span class="line">	</span><br><span class="line">	    <span class="function"><span class="keyword">fun</span> <span class="title">remeasure</span><span class="params">(constraints: <span class="type">Constraints</span>)</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">	        ...</span><br><span class="line">	        <span class="keyword">if</span> (layoutNode.measurePending || measurementConstraints != constraints) &#123;</span><br><span class="line">	            ...</span><br><span class="line">	            performMeasure(constraints)    <span class="comment">// å…³é”®ä»£ç </span></span><br><span class="line">	            ...</span><br><span class="line">	        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                ...</span><br><span class="line">            &#125;</span><br><span class="line">	        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">	    &#125;</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ®µä»£ç å¾ˆé•¿ï¼Œä½†æˆ‘ä»¬åªéœ€è¦å…³æ³¨ä¸€è¡Œå…³é”®ä»£ç ï¼š<font color="#CD950C">performMeasure(constraints)</font>ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">ğŸ“„  androidx.compose.ui.node --&gt; LayoutNodeLayoutDelegate.kt</span><br><span class="line"></span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title class_">LayoutNodeLayoutDelegate</span>(</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> layoutNode: LayoutNode</span><br><span class="line">) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> performMeasureConstraints = Constraints()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> performMeasureBlock: () -&gt; <span class="built_in">Unit</span> = &#123;</span><br><span class="line">        outerCoordinator.measure(performMeasureConstraints)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">performMeasure</span><span class="params">(constraints: <span class="type">Constraints</span>)</span></span> &#123;</span><br><span class="line">        ...</span><br><span class="line">        layoutNode.requireOwner().snapshotObserver.observeMeasureSnapshotReads(</span><br><span class="line">            layoutNode,</span><br><span class="line">            affectsLookahead = <span class="literal">false</span>,</span><br><span class="line">            performMeasureBlock   <span class="comment">// å…³é”®ä»£ç </span></span><br><span class="line">        )</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä»ç„¶åªéœ€è¦å…³æ³¨ï¼š<font color="#CD950C">outerCoordinator.measure(performMeasureConstraints)</font>ï¼Œå®ƒæ˜¯åšå®é™…æµ‹é‡å·¥ä½œçš„ã€‚</p>
<p>ç»§ç»­è·Ÿè¸ªï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ğŸ“„  androidx.compose.ui.layout --&gt; Measurable.kt</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Measurable</span> : <span class="type">IntrinsicMeasurable</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Measures the layout with [constraints], returning a [Placeable] layout that has its new</span></span><br><span class="line"><span class="comment">     * size. A [Measurable] can only be measured once inside a layout pass.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">measure</span><span class="params">(constraints: <span class="type">Constraints</span>)</span></span>: Placeable</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><font color="#FF0000">What ï¼Ÿï¼Ÿï¼Ÿæ€ä¹ˆæ˜¯ä¸ªæ¥å£å•Šï¼Œæ²¡æœ‰ä»»ä½•å¤„ç†é€»è¾‘å•Šï¼ï¼ï¼</font></strong></p>
<p>è½¬å¿µä¸€æƒ³ï¼Œæ—¢ç„¶æ˜¯ä¸ªæ¥å£ï¼Œé‚£è‚¯å®šæœ‰å…¶ä»–åœ°æ–¹å®ç°äº†è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥æœä¸€ä¸‹å“ªäº›åœ°æ–¹å®ç°äº†ã€‚</p>
<img src="https://v1.ax1x.com/2025/08/18/EPWgNP.png" alt="" border="0" />

<br>

<br>

<p>æœ‰ 9 ä¸ªåœ°æ–¹å®ç°äº†ï¼Œä½†å“ªä¸€ä¸ªæ‰æ˜¯æˆ‘ä»¬éœ€è¦çš„å‘¢ï¼Ÿåˆ«æ…Œï¼Œæˆ‘å¸¦ä½ æ‰¾ä¸€ä¸‹ã€‚</p>
<p>æˆ‘ä»¬å¾€å›é€€ï¼Œæ‰¾æ‰¾åˆšæ‰å“ªé‡Œè°ƒç”¨ measure() æ–¹æ³•çš„ï¼Ÿ</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">ğŸ“„  androidx.compose.ui.node --&gt; LayoutNodeLayoutDelegate.kt</span><br><span class="line"></span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title class_">LayoutNodeLayoutDelegate</span>(</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> layoutNode: LayoutNode</span><br><span class="line">) &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 2. outerCoordinator ç”±ä¼ è¿›æ¥çš„ layoutNode å‚æ•°å†³å®šï¼Œé‚£ä¹ˆæˆ‘ä»¬å¾—æ‰¾æ‰¾ layoutNode æ˜¯å“ªé‡Œä¼ è¿›æ¥çš„</span></span><br><span class="line"><span class="comment">     *    è¿™é‡Œè®°ä½ï¼š</span></span><br><span class="line"><span class="comment">     *    a. æ¥ä¸‹æ¥æˆ‘ä»¬å…ˆæ‰¾åˆ°å“ªé‡Œä¼ å…¥äº† layoutNode</span></span><br><span class="line"><span class="comment">     *    b. æ‰¾åˆ°åæˆ‘ä»¬å†çœ‹ layoutNode.nodes.outerCoordinator æ˜¯ä»€ä¹ˆï¼Ÿ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">val</span> outerCoordinator: NodeCoordinator</span><br><span class="line">        <span class="keyword">get</span>() = layoutNode.nodes.outerCoordinator</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> performMeasureBlock: () -&gt; <span class="built_in">Unit</span> = &#123;</span><br><span class="line">        <span class="comment">// 1. è¿™é‡Œè°ƒç”¨äº† measure()ï¼Œé‚£ä¹ˆ outerCoordinator æ˜¯ä»€ä¹ˆï¼Ÿ</span></span><br><span class="line">        outerCoordinator.measure(performMeasureConstraints)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç»§ç»­å›é€€åˆ°ä¸Šä¸€å±‚ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">ğŸ“„  androidx.compose.ui.node --&gt; LayoutNodeLayoutDelegate.kt</span><br><span class="line"></span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title class_">LayoutNodeLayoutDelegate</span>(</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> layoutNode: LayoutNode</span><br><span class="line">) &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">inner</span> <span class="keyword">class</span> <span class="title class_">MeasurePassDelegate</span> : <span class="type">Measurable</span>, <span class="type">Placeable</span>(), AlignmentLinesOwner &#123;</span><br><span class="line">	</span><br><span class="line">	    <span class="comment">// 2. æˆ‘ä»¬ç»§ç»­å›é€€</span></span><br><span class="line">	    <span class="function"><span class="keyword">fun</span> <span class="title">remeasure</span><span class="params">(constraints: <span class="type">Constraints</span>)</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">	        ...</span><br><span class="line">	        <span class="keyword">if</span> (layoutNode.measurePending || measurementConstraints != constraints) &#123;</span><br><span class="line">	            ...</span><br><span class="line">	            <span class="comment">// 1. æ²¡æœ‰åœ°æ–¹ä¼ å…¥ layoutNode å•Š</span></span><br><span class="line">	            performMeasure(constraints)</span><br><span class="line">	            ...</span><br><span class="line">	        &#125;</span><br><span class="line">	        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">	    &#125;</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç»§ç»­å›é€€åˆ°ä¸Šä¸€å±‚ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">ğŸ“„ androidx.compose.ui.node --&gt; LayoutNode.kt</span><br><span class="line"></span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title class_">LayoutNode</span>(..) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. é€šè¿‡ layoutDelegate è·å– measurePassDelegateï¼Œé‚£ layoutDelegate æ˜¯ä»€ä¹ˆï¼Ÿ</span></span><br><span class="line">    <span class="keyword">internal</span> <span class="keyword">val</span> measurePassDelegate</span><br><span class="line">        <span class="keyword">get</span>() = layoutDelegate.measurePassDelegate</span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 4. æ¥æ¥æ¥ï¼Œnodes åœ¨è¿™é‡Œï¼ŒNodeChain åˆæ˜¯ä»€ä¹ˆï¼Ÿ</span></span><br><span class="line">    <span class="keyword">internal</span> <span class="keyword">val</span> nodes = NodeChain(<span class="keyword">this</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 3. LayoutNodeLayoutDelegate(this) çœ‹åˆ°è¿™è¡Œä»£ç ä½ æœ‰æ²¡æœ‰æƒ³èµ·æ¥ä»€ä¹ˆï¼Ÿ</span></span><br><span class="line"><span class="comment">     *    è¿™ä¸ª this ä¸å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„é‚£ä¸ª layoutNode å‚æ•°å˜›ï¼</span></span><br><span class="line"><span class="comment">     *    ç°åœ¨æˆ‘ä»¬å†çœ‹ä¸‹åˆšåˆšç”¨åˆ°è¿™ä¸ªå‚æ•°çš„åœ°æ–¹ï¼š</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *        val outerCoordinator: NodeCoordinator</span></span><br><span class="line"><span class="comment">     *            get() = layoutNode.nodes.outerCoordinator</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     *    è¿˜è®°å¾—å§ï¼Ÿç°åœ¨ layoutNode æ‰¾åˆ°äº†ï¼Œæ¥ä¸‹æ¥çœ‹çœ‹ nodes æ˜¯ä»€ä¹ˆï¼Ÿ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">internal</span> <span class="keyword">val</span> layoutDelegate = LayoutNodeLayoutDelegate(<span class="keyword">this</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">internal</span> <span class="function"><span class="keyword">fun</span> <span class="title">remeasure</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        constraints: <span class="type">Constraints</span>? = layoutDelegate.lastConstraints</span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">if</span> (constraints != <span class="literal">null</span>) &#123;</span><br><span class="line">            ...</span><br><span class="line">            <span class="comment">// 1. è¿˜æ˜¯æ²¡æœ‰åœ°æ–¹ä¼ å…¥ layoutNode å•Šï¼Œåˆ«æ€¥ï¼Œæˆ‘ä»¬çœ‹çœ‹ measurePassDelegate æ˜¯ä»€ä¹ˆï¼Ÿ</span></span><br><span class="line">            measurePassDelegate.remeasure(constraints)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="NodeChain"><a href="#NodeChain" class="headerlink" title="NodeChain"></a>NodeChain</h2><p>æˆ‘ä»¬å†æ¥çœ‹çœ‹ NodeChain æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">ğŸ“„ androidx.compose.ui.node --&gt; NodeChain.kt</span><br><span class="line"></span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title class_">NodeChain</span>(<span class="keyword">val</span> layoutNode: LayoutNode) &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 2. å†çœ‹è¿™é‡Œï¼Œè€Œ innerCoordinator åˆæ˜¯ InnerNodeCoordinatorï¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">internal</span> <span class="keyword">val</span> innerCoordinator = InnerNodeCoordinator(layoutNode)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *   ä¸å¿˜åˆå¿ƒï¼Œå†æ¬¡æ¬å‡ºä»£ç ï¼š</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     *        val outerCoordinator: NodeCoordinator</span></span><br><span class="line"><span class="comment">     *            get() = layoutNode.nodes.outerCoordinator</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * 1. å“¦ï¼ŒåŸæ¥å¦‚æ­¤ï¼š</span></span><br><span class="line"><span class="comment">     *    layoutNode.nodes.outerCoordinator æ˜¯ innerCoordinator</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">internal</span> <span class="keyword">var</span> outerCoordinator: NodeCoordinator = innerCoordinator</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">set</span></span><br><span class="line">    ... ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»£ç è·Ÿè¸ªåˆ°è¿™é‡Œå°±çœŸç›¸æ˜¾ç°äº†ï¼Œåˆ°åº•æ˜¯å“ªä¸ªå®ç°ç±»å¤„ç†äº† measure() æ–¹æ³•ï¼Œä½ ç°åœ¨æ¸…æ¥šäº†å§ï¼Ÿå†æ¥çœ‹ä¸‹åˆšåˆšçš„æˆªå›¾ï¼š</p>
<img src="https://v1.ax1x.com/2025/08/18/EPWhaw.png" alt="" border="0" />

<br>

<br>

<p>æ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬å°±çœ‹çœ‹ InnerNodeCoordinator æ˜¯å¦‚ä½•è´Ÿè´£å…·ä½“æµ‹é‡çš„ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">ğŸ“„  androidx.compose.ui.node --&gt; InnerNodeCoordinator.kt</span><br><span class="line"></span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title class_">InnerNodeCoordinator</span>(</span><br><span class="line">    layoutNode: LayoutNode</span><br><span class="line">) : NodeCoordinator(layoutNode) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">measure</span><span class="params">(constraints: <span class="type">Constraints</span>)</span></span>: Placeable &#123;</span><br><span class="line">        <span class="meta">@Suppress(<span class="string">&quot;NAME_SHADOWING&quot;</span>)</span> <span class="keyword">val</span> constraints =</span><br><span class="line">            <span class="keyword">if</span> (forceMeasureWithLookaheadConstraints) &#123;</span><br><span class="line">                lookaheadDelegate!!.constraints</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                constraints</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">return</span> performingMeasure(constraints) &#123;</span><br><span class="line">            <span class="comment">// before rerunning the user&#x27;s measure block reset previous measuredByParent for children</span></span><br><span class="line">            layoutNode.forEachChild &#123;</span><br><span class="line">                it.measurePassDelegate.measuredByParent = LayoutNode.UsageByParent.NotUsed</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 2. è¿”å›ä¸€ä¸ª MeasureResult å¯¹è±¡ç»™ replace() å»å¸ƒå±€</span></span><br><span class="line">            measureResult = with(layoutNode.measurePolicy) &#123;</span><br><span class="line">                <span class="comment">// 1. æœ€æ ¸å¿ƒå¤„ï¼šè¿™è¾¹å°±æ˜¯æœ€åº•å±‚å¼€å§‹æµ‹é‡çš„å·¥ä½œäº†</span></span><br><span class="line">                measure(layoutNode.childMeasurables, constraints)</span><br><span class="line">            &#125;</span><br><span class="line">            onMeasured()</span><br><span class="line">            <span class="keyword">this</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>åˆ†æåˆ°è¿™é‡Œï¼Œå…³äºç»„ä»¶è‡ªèº«çš„æµ‹é‡å’Œå¸ƒå±€æµç¨‹å°±è·‘é€šäº†ï¼š</strong> </p>
<div class="notification is-danger">
<p>æˆ‘ä»¬åœ¨ä»£ç ä¸­æ‰€å†™çš„ Boxã€Text ç­‰ç»„ä»¶å†…éƒ¨ä¼šæœ‰è‡ªå·±è®¾å®šçš„æµ‹é‡æ•°æ®ï¼Œä»–ä»¬åœ¨ä»£ç å®é™…è¿è¡Œè¿‡ç¨‹ä¸­ä¼šè¢« Comopse è½¬æ¢æˆ LayoutNode èŠ‚ç‚¹ï¼ˆåŒ…å«æ‰€æœ‰ç»„ä»¶è‡ªèº«çš„æµ‹é‡æ•°æ®ï¼‰ï¼Œç„¶åä¸€å±‚å±‚å¾€ä¸‹ä¼ ï¼Œæœ€ç»ˆä¼ åˆ° InnerNodeCoordinatorï¼Œç”±å®ƒè¿›è¡Œæœ€åº•å±‚çš„æµ‹é‡å·¥ä½œï¼Œæµ‹é‡å®Œæˆåä¼šè¿”å›ä¸€ä¸ª MeasureResult å¯¹è±¡å†äº¤ç»™ replace() å‡½æ•°å®Œæˆå¸ƒå±€å·¥ä½œã€‚</p>
</div>

<p><strong>æ€»ç»“ä¸€å¥è¯ï¼š</strong></p>
<div class="notification is-info">
<p>InnerNodeCoordinator å°±æ˜¯ LayoutNode çš„â€œåŸå§‹çš®è‚¤â€ï¼ŒæŠŠ LayoutNode çš„åŸç”Ÿæµ‹é‡ &amp; ç»˜åˆ¶é€»è¾‘é€‚é…è¿›æ•´æ¡ Coordinator é“¾ã€‚</p>
</div>

<p>æ‰€ä»¥ï¼ŒDo you understand?</p>
<img src="https://v1.ax1x.com/2025/08/18/EPW8I6.png" alt="" border="0" />

<br>

<br>

<p><progress class="progress is-success" value="100" max="100"></progress></p>
<h1 id="LayoutModifierNode-çš„å·¥ä½œåŸç†"><a href="#LayoutModifierNode-çš„å·¥ä½œåŸç†" class="headerlink" title="LayoutModifierNode çš„å·¥ä½œåŸç†"></a>LayoutModifierNode çš„å·¥ä½œåŸç†</h1><br>

<p>å‰é¢æˆ‘ä»¬å·²ç»äº†è§£äº†<font color="#085DFF"><strong>ç»„ä»¶è‡ªèº«çš„æµ‹é‡å’Œå¸ƒå±€åŸç†</strong></font>ï¼Œç°åœ¨å°±å¯ä»¥å¼€å§‹åˆ†æ LayoutModifierNode æ˜¯å¦‚ä½•å½±å“ç»„ä»¶çš„æµ‹é‡å’Œå¸ƒå±€äº†ã€‚</p>
<p>å°±åƒæˆ‘ä»¬å‰é¢è¯´çš„é‚£æ ·ï¼Œæ‰€æœ‰ç»„ä»¶æœ€ç»ˆéƒ½ä¼šè¢«è½¬æ¢ä¸ºä¸€ä¸ª LayoutNodeï¼Œè¿™ä¸ª LayoutNode åŒ…å«äº†æ‰€æœ‰çš„æµ‹é‡æ•°æ®ï¼Œé‚£åŒæ ·å®ƒä¹Ÿä¼šåŒ…å«ä½ å¯¹ç»„ä»¶è®¾å®šçš„ Modifierï¼Œæ‰€ä»¥æœ€ç»ˆç»è¿‡ä¸€äº›åˆ—è½¬æ¢ï¼Œä¹Ÿä¼šä¼ åˆ° LayoutNode é‡Œé¢ï¼Œè€Œ LayoutNode é‡Œé¢ä¹Ÿæœ‰ä¸€ä¸ª modifier å˜é‡ï¼Œå­˜å‚¨çš„å°±æ˜¯ä¿®é¥° Composable å‡½æ•°çš„ Modifierã€‚</p>
<img src="https://v1.ax1x.com/2025/08/18/EPWx0O.png" alt="" border="0" />

<br>

<h2 id="LayoutNode-Modifer"><a href="#LayoutNode-Modifer" class="headerlink" title="LayoutNode.Modifer"></a>LayoutNode.Modifer</h2><p>ç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹å…·ä½“çš„ä»£ç é€»è¾‘ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ğŸ“„ androidx.compose.ui.node --&gt; LayoutNode.kt</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title class_">LayoutNode</span>(..) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">var</span> modifier: Modifier</span><br><span class="line">        <span class="keyword">get</span>() = _modifier</span><br><span class="line">        <span class="comment">// å¦‚æœæœ‰æ–°å€¼å˜åŒ–</span></span><br><span class="line">        <span class="keyword">set</span>(value) &#123;</span><br><span class="line">            ...</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (isAttached) &#123;</span><br><span class="line">                applyModifier(value)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                pendingModifier = value</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">applyModifier</span><span class="params">(modifier: <span class="type">Modifier</span>)</span></span> &#123;</span><br><span class="line">        _modifier = modifier</span><br><span class="line">        nodes.updateFrom(modifier)    <span class="comment">// å…³é”®ä»£ç </span></span><br><span class="line">        layoutDelegate.updateParentData()</span><br><span class="line">        <span class="keyword">if</span> (lookaheadRoot == <span class="literal">null</span> &amp;&amp; nodes.has(Nodes.ApproachMeasure)) &#123;</span><br><span class="line">            lookaheadRoot = <span class="keyword">this</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„ nodes åº”è¯¥ä¸é™Œç”Ÿäº†å§ï¼Ÿå‰ä¸€èŠ‚æˆ‘ä»¬å·²ç»çŸ¥é“äº†å®ƒæ˜¯ <strong>NodeChain</strong> å¯¹è±¡ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="keyword">val</span> nodes = NodeChain(<span class="keyword">this</span>)</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯ NodeChain æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<div class="buttons">
  <button class="button is-danger">å…¶å®å®ƒå°±æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œè€Œä¸”æ˜¯ä¸ªã€ŒåŒå‘é“¾è¡¨ã€</button>
</div>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ğŸ“„ androidx.compose.ui.node --&gt; NodeChain.kt</span><br><span class="line"></span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title class_">NodeChain</span>(<span class="keyword">val</span> layoutNode: LayoutNode) &#123;</span><br><span class="line">    <span class="keyword">internal</span> <span class="keyword">val</span> innerCoordinator = InnerNodeCoordinator(layoutNode)</span><br><span class="line">    <span class="keyword">internal</span> <span class="keyword">var</span> outerCoordinator: NodeCoordinator = innerCoordinator</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">set</span></span><br><span class="line">    <span class="keyword">internal</span> <span class="keyword">val</span> tail: Modifier.Node = innerCoordinator.tail</span><br><span class="line">    <span class="keyword">internal</span> <span class="keyword">var</span> head: Modifier.Node = tail</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">set</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><font color="#085FFF">1. å¤´ã€å°¾èŠ‚ç‚¹éƒ½æ˜¯ Modifier.Node ç±»å‹ï¼</font></p>
<p><font color="#085FFF">2. å…¶ä¸­çš„ NodeCoordinator æ˜¯ç”¨æ¥è¾…åŠ© Node èŠ‚ç‚¹å¤„ç†æµ‹é‡å’Œå¸ƒå±€çš„ï¼Œå…¶ä¸­åŒ…å« measure å’Œ placeAt çš„å‡½æ•°é€»è¾‘ã€‚</font></p>
<p><font color="#085FFF">3. NodeChain é“¾è¡¨ä¸Šçš„æ¯ä¸€ä¸ª Node éƒ½ä¼šå¯¹åº”çš„ç»‘å®šä¸€ä¸ª NodeCoordinator å¯¹è±¡æ¥è¾…åŠ©å¤„ç†ã€‚ï¼ˆä¸ç†è§£æ²¡å…³ç³»ï¼Œæ¥ç€å¾€ä¸‹çœ‹ï¼ï¼‰</font></p>
<hr>
<h2 id="updateFrom"><a href="#updateFrom" class="headerlink" title="updateFrom()"></a>updateFrom()</h2><p>æ¥ä¸‹æ¥çœ‹çœ‹ updateFrom çš„å…·ä½“å·¥ä½œï¼Œå®ƒä¸»è¦è´Ÿè´£ NodeChain é“¾è¡¨çš„ã€Œæ›´æ–°ã€ï¼Œæ¯å½“æœ‰ Modifier å¯¹è±¡è¢«è®¾ç½®åˆ° LayoutNode ä¸Šé¢ï¼Œéƒ½ä¼šè°ƒç”¨ updateFrom å‡½æ•°è¿›è¡Œæ›´æ–°å¯¹åº”çš„ NodeChainã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">ğŸ“„ androidx.compose.ui.node --&gt; NodeChain.kt</span><br><span class="line"></span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title class_">NodeChain</span>(<span class="keyword">val</span> layoutNode: LayoutNode) &#123;</span><br><span class="line">    <span class="comment">// è´Ÿè´£æœ€å†…å±‚æµ‹é‡çš„ NodeCoordinator</span></span><br><span class="line">    <span class="keyword">internal</span> <span class="keyword">val</span> innerCoordinator = InnerNodeCoordinator(layoutNode)</span><br><span class="line">    <span class="comment">// è´Ÿè´£å¤–å±‚æµ‹é‡çš„ NodeCoordinatorï¼Œåˆå§‹å€¼æ˜¯ InnerNodeCoordinator</span></span><br><span class="line">    <span class="keyword">internal</span> <span class="keyword">var</span> outerCoordinator: NodeCoordinator = innerCoordinator</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">set</span></span><br><span class="line">    <span class="comment">// åŒå‘é“¾è¡¨çš„å°¾èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">internal</span> <span class="keyword">val</span> tail: Modifier.Node = innerCoordinator.tail</span><br><span class="line">    <span class="comment">// åŒå‘é“¾è¡¨çš„å¤´èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">internal</span> <span class="keyword">var</span> head: Modifier.Node = tail</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">set</span></span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">internal</span> <span class="function"><span class="keyword">fun</span> <span class="title">updateFrom</span><span class="params">(m: <span class="type">Modifier</span>)</span></span> &#123;</span><br><span class="line">        <span class="keyword">var</span> coordinatorSyncNeeded = <span class="literal">false</span></span><br><span class="line">        <span class="keyword">val</span> paddedHead = padChain()</span><br><span class="line">        <span class="keyword">var</span> before = current</span><br><span class="line">        <span class="keyword">val</span> beforeSize = before?.size ?: <span class="number">0</span></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * ğŸ“ æ ¸å¿ƒä»£ç  1: </span></span><br><span class="line"><span class="comment">         *    fillVector ä¼šå°† Modifier å±•å¼€é“ºå¹³åˆ°ä¸€ä¸ªæ•°ç»„ï¼Œ</span></span><br><span class="line"><span class="comment">         *    åé¢çš„ä»£ç å°±å¯ä»¥ç”¨è¿™ä¸ªæ•°ç»„éå†</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">val</span> after = m.fillVector(buffer ?: mutableVectorOf())</span><br><span class="line">        <span class="keyword">var</span> i = <span class="number">0</span></span><br><span class="line">        <span class="comment">// æ£€æŸ¥æ›´æ–°å·®å¼‚</span></span><br><span class="line">        <span class="keyword">if</span> (after.size == beforeSize) &#123;</span><br><span class="line">            ...    <span class="comment">// è¿™æ®µä»£ç ä¸ç”¨çœ‹ï¼Œåªè¦åŠ äº† Modifier.xx é»˜è®¤ä¸ä¼šèµ°åˆ°è¿™è¾¹</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (layoutNode.applyingModifierOnAttach &amp;&amp; beforeSize == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// ç¬¬ä¸€æ¬¡ç»„è£… Modifier.Node åŒå‘é“¾è¡¨</span></span><br><span class="line">            coordinatorSyncNeeded = <span class="literal">true</span></span><br><span class="line">            <span class="keyword">var</span> node = paddedHead</span><br><span class="line">            <span class="keyword">while</span> (i &lt; after.size) &#123;</span><br><span class="line">                <span class="keyword">val</span> next = after[i]</span><br><span class="line">                <span class="keyword">val</span> parent = node</span><br><span class="line">                <span class="comment">/**</span></span><br><span class="line"><span class="comment">                 * ğŸ“ æ ¸å¿ƒä»£ç  2: ç»„è£…åŒå‘é“¾è¡¨çš„å…·ä½“é€»è¾‘</span></span><br><span class="line"><span class="comment">                 */</span></span><br><span class="line">                node = createAndInsertNodeAsChild(next, parent)</span><br><span class="line">                logger?.nodeInserted(<span class="number">0</span>, i, next, parent, node)</span><br><span class="line">                i++</span><br><span class="line">            &#125;</span><br><span class="line">            syncAggregateChildKindSet()</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (after.size == <span class="number">0</span>) &#123;  <span class="comment">// åˆ é™¤æ‰€æœ‰ modifier</span></span><br><span class="line">            ...</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        current = after</span><br><span class="line">        buffer = before?.also &#123; it.clear() &#125;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * ğŸ“ æ ¸å¿ƒä»£ç  3: æ›´æ–°å¤´èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        head = trimChain(paddedHead)</span><br><span class="line">        <span class="keyword">if</span> (coordinatorSyncNeeded) &#123;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * ğŸ“ æ ¸å¿ƒä»£ç  4: å…³è” Modifier.Node å’Œ NodeCoordinator</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            syncCoordinators()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<div class="buttons">
  <button class="button is-warning">æ¥ä¸‹æ¥è·Ÿç€æˆ‘æ·±å…¥åˆ†ææ¯ä¸€è¡Œæ ¸å¿ƒä»£ç ï¼å¸Œæœ›ä½ èƒ½æ²‰ä¸‹å¿ƒçœ‹ä¸‹å»ï¼ŒåŒ…æ•™åŒ…ä¼šï¼</button>
</div>

<h3 id="ğŸ“-åˆ†è§£-Modifier"><a href="#ğŸ“-åˆ†è§£-Modifier" class="headerlink" title="ğŸ“ åˆ†è§£ Modifier"></a>ğŸ“ åˆ†è§£ Modifier</h3><p>å…ˆæ¥çœ‹ç¬¬ä¸€ä¸ªæ ¸å¿ƒä»£ç ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> after = m.fillVector(buffer ?: mutableVectorOf())</span><br></pre></td></tr></table></figure>

<p>m å°±æ˜¯ä½ çš„ Modifier é“¾ï¼Œè¿™é‡Œçš„ buffer é»˜è®¤ä¸º nullï¼ŒmutableVectorOf() å…¶å®è·Ÿ buffer ä¸€æ ·éƒ½æ˜¯ä¸€ä¸ªå¯å˜åˆ—è¡¨ï¼Œåªæ˜¯å®¹é‡ä¸åŒè€Œå·²ï¼Œä½ åªè¦çŸ¥é“å®ƒå°±æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œç”¨æ¥è£…åˆ†è§£åçš„å•ä¸ª Modifier ç”¨çš„å°±è¡Œäº†ã€‚</p>
<p>æ¥ç€æˆ‘ä»¬å¼€å§‹åˆ†æ fillVector å‡½æ•°ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">ğŸ“„ androidx.compose.ui.node --&gt; NodeChain.kt</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> Modifier.<span class="title">fillVector</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    result: <span class="type">MutableVector</span>&lt;<span class="type">Modifier</span>.<span class="type">Element</span>&gt;</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>: MutableVector&lt;Modifier.Element&gt; &#123;</span><br><span class="line">    <span class="keyword">val</span> capacity = result.size.coerceAtLeast(<span class="number">16</span>)</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 1. åˆ›å»ºä¸€ä¸ªå…ƒç´ ä¸º Modifier çš„å¯å˜åˆ—è¡¨ï¼Œå¹¶åœ¨åˆå§‹åŒ–åæ·»åŠ ä¼ è¿›æ¥çš„ Modifierï¼Œ</span></span><br><span class="line"><span class="comment">     *    ä» stack åå­—å°±å¯ä»¥çœ‹å‡ºæ¥ï¼Œè¿™é‡Œç›¸å½“äºåˆ›å»ºäº†ä¸€ä¸ªæ ˆï¼Œå¹¶ä¸”å®¹é‡ä¸º 16</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">val</span> stack = MutableVector&lt;Modifier&gt;(capacity).also &#123; it.add(<span class="keyword">this</span>) &#125;</span><br><span class="line">    <span class="keyword">var</span> predicate: ((Modifier.Element) -&gt; <span class="built_in">Boolean</span>)? = <span class="literal">null</span></span><br><span class="line">    <span class="comment">// 2. åªè¦æ ˆä¸ä¸ºç©ºï¼Œä¸€ç›´å¾ªç¯</span></span><br><span class="line">    <span class="keyword">while</span> (stack.isNotEmpty()) &#123;</span><br><span class="line">        <span class="comment">// 3. ä»æ ˆä¸­ç§»é™¤å¹¶è·å–æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå­˜åˆ° next å˜é‡ä¸­</span></span><br><span class="line">        <span class="keyword">when</span> (<span class="keyword">val</span> next = stack.removeAt(stack.size - <span class="number">1</span>)) &#123;</span><br><span class="line">            <span class="comment">// 4. å¦‚æœ next æ˜¯ CombinedModifier ç±»å‹</span></span><br><span class="line">            <span class="keyword">is</span> CombinedModifier -&gt; &#123;</span><br><span class="line">                stack.add(next.<span class="keyword">inner</span>)  <span class="comment">// æŠŠ inner éƒ¨åˆ†åŠ å…¥åˆ° stack ä¸­</span></span><br><span class="line">                stack.add(next.outer)  <span class="comment">// æŠŠ outer éƒ¨åˆ†åŠ å…¥åˆ° stack ä¸­</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 5. å¦‚æœ next æ˜¯ Modifier.Element ç±»å‹ï¼Œåˆ™ç›´æ¥åŠ åˆ° result ä¸­</span></span><br><span class="line">            <span class="keyword">is</span> Modifier.Element -&gt; result.add(next)</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 6. å¦‚æœ next æ˜¯ Modifier çš„å…¶ä»–å®ç°ï¼Œå¯èƒ½æˆ‘ä»¬ä¸çŸ¥é“å…·ä½“å®ç°ç»†èŠ‚ï¼Œ</span></span><br><span class="line"><span class="comment">             *    æŠŠ itï¼ˆå¯èƒ½æ˜¯ Modifier.Element çš„å®ä¾‹ï¼‰åŠ å…¥åˆ° result ä¸­</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="keyword">else</span> -&gt; next.all(predicate ?: &#123; element: Modifier.Element -&gt;</span><br><span class="line">                result.add(element)</span><br><span class="line">                <span class="literal">true</span></span><br><span class="line">            &#125;.also &#123; predicate = it &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 7. åœ¨å¤„ç†å®Œæ‰€æœ‰çš„å…ƒç´ ä¹‹åï¼Œè¿”å› resultï¼Œå®ƒåŒ…å«äº†æ‰€æœ‰çš„ Modifier.Element</span></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå‡½æ•°å…¶å®å°±æ˜¯åˆ›å»ºäº†ä¸€ä¸ª Modifier è°ƒç”¨æ ˆï¼Œä»¥ä¾¿å¯ä»¥è¿­ä»£åœ°å¤„ç†ä¸€ä¸ªå¯èƒ½åµŒå¥—çš„ Modifier ç»“æ„ã€‚æ ˆçš„ä½¿ç”¨æ˜¯ä¸ºäº†åœ¨ä¸ä½¿ç”¨é€’å½’çš„æƒ…å†µä¸‹æ‰å¹³åŒ–ä¿®é¥°ç¬¦çš„ç»“æ„ã€‚</p>
<blockquote>
<p><font color="#085DFF">æ³¨æ„ï¼ä» 1.3.0-beta01 ç‰ˆæœ¬å¼€å§‹ï¼ŒCompose ä¸­ä¸å†ä½¿ç”¨ foldIn&#x2F;foldOut å‡½æ•°å¯¹ Modifier è¿›è¡Œéå†äº†ï¼Œåœ¨ 1.3.0-beta01 ä¹‹å‰çš„ç‰ˆæœ¬ LayoutNode æºç ä¸­æ˜¯é€šè¿‡ foldOut éå† + å¤´æ’æ³•å¤„ç†ï¼Œè€Œç°åœ¨æ˜¯é€šè¿‡ fillVector å‡½æ•°å¤„ç†è¾¾åˆ°ç±»ä¼¼çš„æ•ˆæœã€‚ï¼ˆæé«˜æ€§èƒ½ï¼ï¼‰</font></p>
</blockquote>
<p>çœ‹çš„æ‡‚å—ï¼Ÿæ˜¯ä¸æ˜¯å¾ˆæ‡µï¼Ÿæˆ‘ä»¬æ¥ä¸ªå®é™…ä¾‹å­å§ï¼Œæ¯”å¦‚ä¼ å…¥çš„ Modifier é“¾å¦‚ä¸‹ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿™æ˜¯ä½ å†™çš„ä»£ç </span></span><br><span class="line">Box(Modifier.padding(<span class="number">10.</span>dp).size(<span class="number">20.</span>dp))</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ­¤æ—¶ Modifier é“¾ä¸º:</span></span><br><span class="line">modifierChain = Modifier.padding(<span class="number">10.</span>dp).size(<span class="number">20.</span>dp)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®é™…çš„ç»“æ„ï¼š</span></span><br><span class="line">CombinedModifier(</span><br><span class="line">   PaddingElement  <span class="comment">// outer</span></span><br><span class="line">   SizeElement     <span class="comment">// inner</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><span style="color: #085DFF; font-weight: bold;">æˆ‘ä»¬æ¥çœ‹çœ‹ fillVector æ˜¯æ€ä¹ˆå¤„ç†å®ƒçš„ï¼š</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;â¡ï¸ 1. å½“è°ƒç”¨ fillVector å‡½æ•°æ—¶ï¼Œåˆå§‹çŠ¶æ€æ˜¯ modifierChain æ”¾å…¥äº†ä¸€ä¸ªç©ºçš„ <span style="color: #085DFF;">stack</span> ä¸­ã€‚</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;â¡ï¸ 2. æ­¤æ—¶ <span style="color: #085DFF;">stack</span> ä¸ä¸ºç©ºï¼Œå¼€å§‹å¾ªç¯ï¼š</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ğŸ”¸ removeAt ä» stack çš„æœ«å°¾ï¼ˆæœ€ååŠ å…¥çš„å…ƒç´ ï¼‰ç§»é™¤ <span style="color: #FF0000;">CombinedModifier</span>ï¼ˆå› ä¸ºå®ƒæ˜¯é“¾ä¸­æœ€åä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œå¹¶å°†å…¶èµ‹å€¼ç»™ nextã€‚</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ğŸ”¸ next æ˜¯ä¸€ä¸ª <span style="color: #FF0000;">CombinedModifier</span> å®ä¾‹ï¼Œæ­¤æ—¶å°±æŠŠ inner å’Œ outer åˆ†åˆ«åŠ è¿› stack ä¸­ï¼Œè¿™ä¸ªæ—¶å€™ stack é‡Œé¢å°±æœ‰äº†ä¸¤ä¸ªå…ƒç´ ï¼š<span style="color: #085DFF;">[SizeElement, PaddingElement]</span>ã€‚</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ğŸ”¸ å†æ¬¡å¾ªç¯ï¼Œè¿™ä¸ªæ—¶å€™å†æ¬¡å¼€å§‹ removeAt ä»æœ«å°¾å–ï¼Œå…ˆå–åˆ° <span style="color: #085DFF;">PaddingElement</span>ï¼Œæ¡ä»¶åˆ¤æ–­å‘ç°å®ƒæ˜¯ä¸€ä¸ª <span style="color: #2E8B57;">Modifier.Element</span>ï¼Œé‚£å°±æŠŠå®ƒåŠ è¿› <u><strong>result</strong></u> é‡Œé¢ï¼ˆresult ä¹Ÿæ˜¯ä¸€ä¸ªå¯å˜åˆ—è¡¨ï¼‰ã€‚</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ğŸ”¸ ç»§ç»­å¾ªç¯ï¼Œåˆå–åˆ°äº† <span style="color: #085DFF;">SizeElement</span>ï¼Œå‘ç°å®ƒä¹Ÿæ˜¯ä¸€ä¸ª <span style="color: #2E8B57;">Modifier.Element</span>ï¼Œé‚£å°±ç›´æ¥åŠ è¿› <u><strong>result</strong></u> é‡Œé¢ã€‚</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;â¡ï¸ 3. ç»§ç»­å¾ªç¯ï¼Œå•ªï½ stack æ²¡ä¸œè¥¿äº†ï¼Œå¾ªç¯ç»“æŸï¼Œç›´æ¥è¿”å› <u><strong>result</strong></u> ç»“æœï¼š<span style="color: #085DFF;">[PaddingElement, SizeElement]</span>ã€‚</p>
<br>

<p><font color="#085DFF"><strong>è¿™æ®µæµç¨‹æˆ‘ç»™ä½ ç”»äº†å¼ å›¾ï¼š</strong></font></p>
<img src="https://v1.ax1x.com/2025/08/18/EPWA4f.png" alt="" border="0" />

<br>

<br>

<h3 id="ğŸ“-æ„å»ºåŒå‘é“¾è¡¨"><a href="#ğŸ“-æ„å»ºåŒå‘é“¾è¡¨" class="headerlink" title="ğŸ“ æ„å»ºåŒå‘é“¾è¡¨"></a>ğŸ“ æ„å»ºåŒå‘é“¾è¡¨</h3><p>ç°åœ¨æˆ‘ä»¬æ¥åˆ†æç¬¬äºŒæ®µæ ¸å¿ƒä»£ç ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// NodeChain.kt</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (layoutNode.applyingModifierOnAttach &amp;&amp; beforeSize == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// ç¬¬ä¸€æ¬¡ç»„è£… Modifier.Node åŒå‘é“¾è¡¨</span></span><br><span class="line">    coordinatorSyncNeeded = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">var</span> node = paddedHead     ğŸŸ¡ <span class="number">1.</span> node åˆå§‹å€¼æ˜¯ä»€ä¹ˆï¼Ÿ</span><br><span class="line">    <span class="keyword">while</span> (i &lt; after.size) &#123;  ğŸŸ¡ <span class="number">2.</span> after æ˜¯ä»€ä¹ˆï¼Ÿ</span><br><span class="line">        <span class="keyword">val</span> next = after[i]</span><br><span class="line">        <span class="keyword">val</span> parent = node</span><br><span class="line">        <span class="comment">// ğŸ“ æ ¸å¿ƒä»£ç  2: ç»„è£…åŒå‘é“¾è¡¨çš„å…·ä½“é€»è¾‘</span></span><br><span class="line">        node = createAndInsertNodeAsChild(next, parent)</span><br><span class="line">        logger?.nodeInserted(<span class="number">0</span>, i, next, parent, node)</span><br><span class="line">        i++</span><br><span class="line">    &#125;</span><br><span class="line">    syncAggregateChildKindSet()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>æˆ‘ä»¬å…ˆæ¥çœ‹ nodeï¼Œå®ƒæ˜¯ paddedHeadï¼š</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> paddedHead = padChain()</span><br></pre></td></tr></table></figure>

<p>æ¥çœ‹ä¸‹ padChain() åšäº†ä»€ä¹ˆï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// NodeChain.kt</span></span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">val</span> tail: Modifier.Node = innerCoordinator.tail</span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">var</span> head: Modifier.Node = tail</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">set</span></span><br><span class="line">        </span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">padChain</span><span class="params">()</span></span>: Modifier.Node &#123;</span><br><span class="line">    checkPrecondition(head !== SentinelHead) &#123; <span class="string">&quot;padChain called on already padded chain&quot;</span> &#125;</span><br><span class="line">    <span class="keyword">val</span> currentHead = head</span><br><span class="line">    currentHead.parent = SentinelHead</span><br><span class="line">    SentinelHead.child = currentHead</span><br><span class="line">    <span class="keyword">return</span> SentinelHead</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªæ—¶å€™ <span style="color: #FF0000;">head</span> é»˜è®¤æ˜¯ <span style="color: #085DFF;">tail</span>ï¼Œå…¶å®å°±æ˜¯ç»„ä»¶æœ¬èº«ï¼š<span style="color: #085DFF;">Box</span>ã€‚</p>
<p><span style="color: #FF5A00;">SentinelHead</span> æ˜¯ä»€ä¹ˆï¼Ÿå®ƒæœ€ä¸»è¦çš„ä½œç”¨å°±æ˜¯ä½œä¸ºä¸€ä¸ª<u><strong>å“¨å…µèŠ‚ç‚¹</strong></u>ï¼Œç®€åŒ–é“¾è¡¨æ“ä½œç”¨çš„ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠå®ƒç†è§£ä¸ºåœ¨ Box è¿™ä¸ª Modifier.Node èŠ‚ç‚¹å‰é¢æ’å…¥ä¸€ä¸ªå“¨å…µèŠ‚ç‚¹ï¼Œå®ƒä»¬å½¼æ­¤æ„æˆä¸€ä¸ªåŒå‘é“¾è¡¨ã€‚</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[SentinelHead] &lt;-&gt; [currentHead] = [tail] = [TailModifierNode]</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>ç°åœ¨å†æ¥çœ‹ <span style="color: #FF0000;">after</span>ï¼Œå®ƒå°±æ˜¯å…ˆå‰ <u><strong>result</strong></u> è¿”å›çš„ç»“æœï¼Œå³ï¼š<span style="color: #085DFF;">[PaddingElement, SizeElement]</span>ï¼Œæ‰€ä»¥ next ä¼šè½®æµå–åˆ°è¿™ä¸¤ä¸ª Modifier è¿›è¡Œè¿›ä¸€æ­¥çš„æ“ä½œã€‚</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// NodeChain.kt</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (layoutNode.applyingModifierOnAttach &amp;&amp; beforeSize == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// ç¬¬ä¸€æ¬¡ç»„è£… Modifier.Node åŒå‘é“¾è¡¨</span></span><br><span class="line">    coordinatorSyncNeeded = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">var</span> node = paddedHead     ğŸŸ¡ <span class="number">1.</span> node æ­¤æ—¶æ˜¯åŒå‘é“¾è¡¨çš„å¤´éƒ¨ï¼ŒæŒ‡å‘ <span class="string">&quot;å“¨å…µèŠ‚ç‚¹&quot;</span></span><br><span class="line">    <span class="keyword">while</span> (i &lt; after.size) &#123;  ğŸŸ¡ <span class="number">2.</span> after æ˜¯ [PaddingElement, SizeElement]</span><br><span class="line">        <span class="keyword">val</span> next = after[i]   ğŸŸ¡ <span class="number">3.</span> å–å‡ºç¬¬ä¸€ä¸ªæ˜¯ï¼šPaddingElement</span><br><span class="line">        <span class="keyword">val</span> parent = node     ğŸŸ¡ <span class="number">4.</span> parent æŒ‡å‘ <span class="string">&quot;å“¨å…µèŠ‚ç‚¹&quot;</span></span><br><span class="line">        <span class="comment">// ğŸ“ æ ¸å¿ƒä»£ç  2: ç»„è£…åŒå‘é“¾è¡¨çš„å…·ä½“é€»è¾‘</span></span><br><span class="line">        node = createAndInsertNodeAsChild(next, parent)</span><br><span class="line">        logger?.nodeInserted(<span class="number">0</span>, i, next, parent, node)</span><br><span class="line">        i++</span><br><span class="line">    &#125;</span><br><span class="line">    syncAggregateChildKindSet()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥åˆ†æ createAndInsertNodeAsParent å‡½æ•°ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// NodeChain.kt</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">createAndInsertNodeAsChild</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    element: <span class="type">Modifier</span>.<span class="type">Element</span>,    ğŸŸ¡ elementï¼šPaddingElement</span></span></span><br><span class="line"><span class="params"><span class="function">    parent: <span class="type">Modifier</span>.<span class="type">Node</span>,        ğŸŸ¡ parent ï¼šå“¨å…µèŠ‚ç‚¹</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>: Modifier.Node &#123;</span><br><span class="line">    <span class="comment">// 1. åˆ›å»ºä¸€ä¸ªæ–°çš„èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">val</span> node = <span class="keyword">when</span> (element) &#123;</span><br><span class="line">        <span class="comment">// 2. å¦‚æœ element æ˜¯ ModifierNodeElement çš„å®ä¾‹ï¼Œå®ƒä¼šè°ƒç”¨ element ä¸Šçš„ create æ–¹æ³•ï¼Œ</span></span><br><span class="line">        <span class="comment">// è¿™ä¸ªæ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªæ–°çš„ Modifier.Node</span></span><br><span class="line">        <span class="keyword">is</span> ModifierNodeElement&lt;*&gt; -&gt; element.create().also &#123;</span><br><span class="line">            it.kindSet = calculateNodeKindSetFromIncludingDelegates(it)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> -&gt; BackwardsCompatNode(element)</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// 3. æ’å…¥åˆ°æ ‘ä¸­</span></span><br><span class="line">    <span class="comment">//    node  : PaddingNode</span></span><br><span class="line">    <span class="comment">//    parent: å“¨å…µèŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">return</span> insertChild(node, parent)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬é‡ç‚¹æ¥çœ‹ä¸€ä¸‹ when() å†…éƒ¨çš„æ“ä½œï¼š</p>
<ol>
<li><p>é¦–å…ˆå–åˆ°çš„æ˜¯ <span style="color: #085DFF;">PaddingElement</span>ï¼Œå®ƒæ˜¯ <span style="color: #FF0000;">ModifierNodeElement</span> çš„å®ç°ç±»ï¼Œæ‰€ä»¥æ»¡è¶³æ¡ä»¶ï¼Œæ¥ç€è°ƒç”¨ create() æ–¹æ³•ï¼Œä¼šæŠŠ PaddingElement åŒ…è£…æˆä¸€ä¸ª <span style="color: #FF5A00;">Modifier.Node</span>ã€‚</p>
</li>
<li><p>ç°åœ¨å·²ç»å¾—åˆ°äº†ä¸€ä¸ª Modifier.Nodeï¼Œæ¥ç€æŠŠå®ƒæ’å…¥æ ‘ä¸­ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹æ“ä½œï¼š</p>
</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// NodeChain.kt</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">insertChild</span><span class="params">(node: <span class="type">Modifier</span>.<span class="type">Node</span>, parent: <span class="type">Modifier</span>.<span class="type">Node</span>)</span></span>: Modifier.Node &#123;</span><br><span class="line">    <span class="comment">// 1. parent å°±æ˜¯å“¨å­èŠ‚ç‚¹ï¼Œæ‰€ä»¥ theChild å°±æ˜¯ Box å¯¹åº”çš„ Modifier.Node</span></span><br><span class="line">    <span class="keyword">val</span> theChild = parent.child</span><br><span class="line">    <span class="keyword">if</span> (theChild != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// 2. node æ˜¯ä¼ è¿›æ¥çš„ PaddingNodeï¼Œå°†ä¸¤ä¸ª Modifier.Node å»ºç«‹åŒå‘é“¾è¡¨å…³ç³»</span></span><br><span class="line">        theChild.parent = node</span><br><span class="line">        node.child = theChild</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3. å†æŠŠå“¨å­èŠ‚ç‚¹è·Ÿä¼ è¿›æ¥çš„ PaddingNode æ„å»ºåŒå‘é“¾è¡¨å…³ç³»</span></span><br><span class="line">    parent.child = node</span><br><span class="line">    node.parent = parent</span><br><span class="line">    <span class="comment">// 4. è¿”å› nodeï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œä¸è¿‡æŒ‡å‘ PaddingNode èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">return</span> node</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[SentinelHead] &lt;-&gt; [PaddingNode] &lt;-&gt; [TailModifierNode]</span><br></pre></td></tr></table></figure>

<hr>
<p>èƒ½ç†è§£å—ï¼Ÿæˆ‘ä¹Ÿç»™ä½ ç”»äº†å¼ å›¾ï¼š</p>
<img src="https://v1.ax1x.com/2025/08/18/EPWWkc.png" alt="" border="0" />

<hr>
<p>ç°åœ¨å·²ç»å¤„ç†å®Œäº† PaddingElementï¼Œå¾ªç¯å–å€¼ï¼Œæ‹¿å‡ºç¬¬äºŒä¸ª SizeElementï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// NodeChain.kt</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (layoutNode.applyingModifierOnAttach &amp;&amp; beforeSize == <span class="number">0</span>) &#123;</span><br><span class="line">    coordinatorSyncNeeded = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">var</span> node = paddedHead</span><br><span class="line">    <span class="keyword">while</span> (i &lt; after.size) &#123;</span><br><span class="line">        <span class="keyword">val</span> next = after[i]   ğŸŸ¡ <span class="number">1.</span> å–å‡ºç¬¬ <span class="number">2</span> ä¸ªæ˜¯ï¼šSizeElement</span><br><span class="line">        <span class="keyword">val</span> parent = node     ğŸŸ¡ <span class="number">2.</span> parent æŒ‡å‘ PaddingNode</span><br><span class="line">        node = createAndInsertNodeAsChild(next, parent)</span><br><span class="line">        logger?.nodeInserted(<span class="number">0</span>, i, next, parent, node)</span><br><span class="line">        i++</span><br><span class="line">    &#125;</span><br><span class="line">    syncAggregateChildKindSet()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å†çœ‹ createAndInsertNodeAsChild() å‡½æ•°ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// NodeChain.kt</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">createAndInsertNodeAsChild</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    element: <span class="type">Modifier</span>.<span class="type">Element</span>,    ğŸŸ¡ elementï¼šSizeElement</span></span></span><br><span class="line"><span class="params"><span class="function">    parent: <span class="type">Modifier</span>.<span class="type">Node</span>,        ğŸŸ¡ parent ï¼šPaddingNode</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>: Modifier.Node &#123;</span><br><span class="line">    <span class="comment">// 1. ä¸º SizeElement åˆ›å»ºä¸€ä¸ªæ–°çš„èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">val</span> node = <span class="keyword">when</span> (element) &#123;</span><br><span class="line">        <span class="comment">// 2. åˆ›å»º SizeNode</span></span><br><span class="line">        <span class="keyword">is</span> ModifierNodeElement&lt;*&gt; -&gt; element.create().also &#123;</span><br><span class="line">            it.kindSet = calculateNodeKindSetFromIncludingDelegates(it)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> -&gt; BackwardsCompatNode(element)</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// 3. æ’å…¥åˆ°æ ‘ä¸­</span></span><br><span class="line">    <span class="comment">//    node  : SizeNode</span></span><br><span class="line">    <span class="comment">//    parent: PaddingNode</span></span><br><span class="line">    <span class="keyword">return</span> insertChild(node, parent)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç»§ç»­ï¼Œçœ‹ä¸‹æ€ä¹ˆæ’å…¥æ ‘ä¸­çš„ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// NodeChain.kt</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">insertChild</span><span class="params">(node: <span class="type">Modifier</span>.<span class="type">Node</span>, parent: <span class="type">Modifier</span>.<span class="type">Node</span>)</span></span>: Modifier.Node &#123;</span><br><span class="line">    <span class="comment">// 1. parent å°±æ˜¯ PaddingNodeï¼Œæ‰€ä»¥ theChild å°±æ˜¯ Box å¯¹åº”çš„ Modifier.Node</span></span><br><span class="line">    <span class="keyword">val</span> theChild = parent.child</span><br><span class="line">    <span class="keyword">if</span> (theChild != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// 2. node æ˜¯ä¼ è¿›æ¥çš„ SizeNodeï¼Œå°†ä¸¤ä¸ª Modifier.Node å»ºç«‹åŒå‘é“¾è¡¨å…³ç³»</span></span><br><span class="line">        theChild.parent = node</span><br><span class="line">        node.child = theChild</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3. å†æŠŠ PaddingNode èŠ‚ç‚¹è·Ÿä¼ è¿›æ¥çš„ SizeNode æ„å»ºåŒå‘é“¾è¡¨å…³ç³»</span></span><br><span class="line">    parent.child = node</span><br><span class="line">    node.parent = parent</span><br><span class="line">    <span class="comment">// 4. è¿”å›æœ€æ–°çš„åŒå‘é“¾æ¥</span></span><br><span class="line">    <span class="keyword">return</span> node</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[SentinelHead] &lt;-&gt; [PaddingNode] &lt;-&gt; [SizeNode] &lt;-&gt; [TailModifierNode]</span><br></pre></td></tr></table></figure>

<p>èƒ½ç†è§£å—ï¼Ÿæˆ‘ä¹Ÿç»™ä½ ç”»äº†å¼ å›¾ï¼š</p>
<img src="https://v1.ax1x.com/2025/08/18/EPWcb3.png" alt="" border="0" />

<hr>
<p>è‡³æ­¤ï¼Œç¬¬äºŒéƒ¨æ„å»ºåŒå‘é“¾è¡¨çš„å·¥ä½œå°±ç»“æŸäº†ï¼Œä½ å‘ç°æ²¡æœ‰ï¼Œè™½ç„¶å…ˆå¤„ç†äº† PaddingElementï¼Œåå¤„ç†äº† SizeElementï¼Œä½†å®é™…ä¸Šæ˜¯æŠŠ SizeElement æ’å…¥åˆ°äº† PaddingElement å†…éƒ¨ï¼Œè¿™å…¶å®å°±è·Ÿè€ç‰ˆæœ¬çš„ foldIn ä»å°¾éƒ¨ä¾¿åˆ©ç„¶åå¤´æ’çš„æ–¹å¼ä¸€æ ·ï¼Œå®ç°äº†åŒæ ·çš„åŠŸèƒ½ã€‚</p>
<h3 id="ğŸ“-æ›´æ–°å¤´èŠ‚ç‚¹"><a href="#ğŸ“-æ›´æ–°å¤´èŠ‚ç‚¹" class="headerlink" title="ğŸ“ æ›´æ–°å¤´èŠ‚ç‚¹"></a>ğŸ“ æ›´æ–°å¤´èŠ‚ç‚¹</h3><p>ç¬¬äºŒæ®µæ ¸å¿ƒä»£ç å·²ç»æ„å»ºå¥½äº†åŒå‘é“¾è¡¨ï¼Œä½†å¦‚æœä½ çœ‹è¿‡è€ç‰ˆæœ¬çš„ä»£ç ä¼šå‘ç°ï¼Œä»¥å‰æ˜¯æ²¡æœ‰ SentineHead è¿™ä¸ªå“¨å­èŠ‚ç‚¹çš„ï¼Œç›®å‰çš„åŒå‘é“¾è¡¨çš„å¤´èŠ‚ç‚¹æ˜¯ SentineHeadï¼Œå®ƒå¹¶æ²¡æœ‰å®é™…çš„åŠŸèƒ½ä¸Šçš„ç”¨å¤„ï¼Œæ‰€ä»¥è¿™å°±æ˜¯ç¬¬ä¸‰æ­¥æ ¸å¿ƒä»£ç è¦åšçš„äº‹ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// NodeChain.kt</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">trimChain</span><span class="params">(paddedHead: <span class="type">Modifier</span>.<span class="type">Node</span>)</span></span>: Modifier.Node &#123;</span><br><span class="line">    checkPrecondition(paddedHead === SentinelHead) &#123;</span><br><span class="line">        <span class="string">&quot;trimChain called on already trimmed chain&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 1. å– SentineHead çš„å­èŠ‚ç‚¹ï¼Œæœ‰å—ï¼Ÿæœ‰ -- å°±æ˜¯ PaddingNode</span></span><br><span class="line">    <span class="keyword">val</span> result = SentinelHead.child ?: tail</span><br><span class="line">    <span class="comment">// 2. æ–­å¼€ SentineHead ä¸ PaddingNode ä¹‹é—´çš„é“¾</span></span><br><span class="line">    result.parent = <span class="literal">null</span></span><br><span class="line">    SentinelHead.child = <span class="literal">null</span></span><br><span class="line">    SentinelHead.aggregateChildKindSet = <span class="number">0.</span>inv()</span><br><span class="line">    SentinelHead.updateCoordinator(<span class="literal">null</span>)</span><br><span class="line">    checkPrecondition(result !== SentinelHead) &#123; <span class="string">&quot;trimChain did not update the head&quot;</span> &#125;</span><br><span class="line">    <span class="comment">// 3. è¿”å›é“¾ï¼Œæ­¤æ—¶é“¾å°±å®Œå…¨æ˜¯ä¸€ä¸ªç”±ç»„ä»¶è‡ªèº«çš„ Node å’Œ Modifier çš„ Node ç»„æˆçš„åŒå‘é“¾è¡¨äº†</span></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»£ç å¾ˆç®€å•ï¼Œå°±æ˜¯æŠŠ SentineHead ä»åŒå‘é“¾è¡¨ä¸­æ–­å¼€å»é™¤ï¼Œè¿™æ ·å°±æ˜¯ä¸€ä¸ªæ–°çš„ä»¥ PaddingModifier ä¸ºè¡¨å¤´çš„åŒå‘é“¾è¡¨äº†ã€‚</p>
<h3 id="ğŸ“-åŒæ­¥åè°ƒå™¨"><a href="#ğŸ“-åŒæ­¥åè°ƒå™¨" class="headerlink" title="ğŸ“ åŒæ­¥åè°ƒå™¨"></a>ğŸ“ åŒæ­¥åè°ƒå™¨</h3><p>æˆ‘ä»¬å‰é¢æåˆ°è¿‡ï¼š<font color="#085DFF">NodeCoordinator æ˜¯ç”¨æ¥è¾…åŠ© Node èŠ‚ç‚¹å¤„ç†æµ‹é‡å’Œå¸ƒå±€çš„ï¼Œå…¶ä¸­åŒ…å« measure å’Œ placeAt çš„å‡½æ•°é€»è¾‘ã€‚NodeChain é“¾è¡¨ä¸Šçš„æ¯ä¸€ä¸ª Node éƒ½ä¼šå¯¹åº”çš„ç»‘å®šä¸€ä¸ª NodeCoordinator å¯¹è±¡æ¥è¾…åŠ©å¤„ç†ã€‚</font></p>
<p>ç°åœ¨ NodeChain é“¾è¡¨å·²ç»å…¨éƒ¨æå®šäº†ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±è¦å¼€å§‹å¯¹é“¾è¡¨ä¸Šæ¯ä¸€ä¸ª Modifier.Node ç»‘å®šä¸€ä¸ª NodeCoordinatorï¼Œç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹ syncCoordinator å‡½æ•°æ˜¯æ€ä¹ˆåšçš„ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// NodeChain.kt</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">syncCoordinators</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> coordinator: NodeCoordinator = innerCoordinator</span><br><span class="line">    <span class="comment">// tail å°±æ˜¯é“¾è¡¨çš„å°¾éƒ¨èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯ç»„ä»¶è‡ªèº«çš„ Modifier.Node</span></span><br><span class="line">    <span class="comment">// å¼€å§‹éå†ï¼Œè·å–å®ƒçš„çˆ¶èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯ tail -&gt; SizeNode -&gt; PaddingNode</span></span><br><span class="line">    <span class="keyword">var</span> node: Modifier.Node? = tail.parent</span><br><span class="line">    <span class="keyword">while</span> (node != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// åˆ¤æ–­ Modifier.Node æ˜¯ä¸æ˜¯ LayoutModifierNode</span></span><br><span class="line">        <span class="keyword">val</span> layoutmod = node.asLayoutModifierNode()</span><br><span class="line">    	<span class="comment">// å¦‚æœæ˜¯ LayoutModifierNode</span></span><br><span class="line">        <span class="keyword">if</span> (layoutmod != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœèŠ‚ç‚¹å·²æœ‰å…³è”çš„ coordinatorï¼Œåˆ™ä½¿ç”¨ç°æœ‰çš„åè°ƒå™¨ï¼ŒåŒæ—¶åˆ¤æ–­æ­¤åè°ƒå™¨æ‰€å…³è”çš„èŠ‚ç‚¹æ˜¯å¦å˜åŒ–äº†ï¼Œ</span></span><br><span class="line">            <span class="comment">// å¦‚æœæœ‰å˜åŒ–ï¼Œåˆ™è°ƒç”¨ onLayoutModifierNodeChanged() æ–¹æ³•</span></span><br><span class="line">            <span class="keyword">val</span> next = <span class="keyword">if</span> (node.coordinator != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">val</span> c = node.coordinator <span class="keyword">as</span> LayoutModifierNodeCoordinator</span><br><span class="line">                <span class="keyword">val</span> prevNode = c.layoutModifierNode</span><br><span class="line">                c.layoutModifierNode = layoutmod</span><br><span class="line">                <span class="keyword">if</span> (prevNode !== node) c.onLayoutModifierNodeChanged()</span><br><span class="line">                c</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// å¦‚æœèŠ‚ç‚¹æ²¡æœ‰å…³è”çš„ coordinatorï¼Œåˆ™åˆ›å»ºä¸€ä¸ª LayoutModifierNodeCoordinatorï¼Œ</span></span><br><span class="line">                <span class="comment">// å¹¶é€šè¿‡ updateCoordinator æ–¹æ³•å°†è¿™ä¸ªæ–°åè°ƒå™¨å’ŒèŠ‚ç‚¹ç›¸å…³è”</span></span><br><span class="line">                <span class="keyword">val</span> c = LayoutModifierNodeCoordinator(layoutNode, node)</span><br><span class="line">                node.updateCoordinator(c)</span><br><span class="line">                c</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// ä¸è®ºæ˜¯ä½¿ç”¨æ—§çš„è¿˜æ˜¯æ–°å»ºçš„ coordinatorï¼Œé€šè¿‡è®¾ç½® wrappedBy å’Œ wrapped å±æ€§ï¼Œ</span></span><br><span class="line">            <span class="comment">// å»ºç«‹å½“å‰ coordinator ä¸ä¸‹ä¸€ä¸ª coordinator çš„åŒ…è£…å…³ç³»ï¼Œ</span></span><br><span class="line">            <span class="comment">// ç„¶åå°† coordinator å˜é‡æ›´æ–°ä¸ºä¸‹ä¸€ä¸ª coordinator</span></span><br><span class="line">            <span class="comment">// ä¾‹å¦‚æˆ‘ä»¬è¿™è¾¹çš„ä¾‹å­ï¼štail -&gt; SizeNode</span></span><br><span class="line">            coordinator.wrappedBy = next    <span class="comment">// InnerCoordinator è¢«è°åŒ…è£¹ï¼Ÿ-- LayoutModifierNodeCoordinator</span></span><br><span class="line">            next.wrapped = coordinator      <span class="comment">// LayoutModifierNodeCoordinator åŒ…è£¹äº†è°ï¼Ÿ-- InnerCoordinator</span></span><br><span class="line">            coordinator = next  <span class="comment">// æ›´æ–° coordinatorï¼Œæ¯”å¦‚åé¢å†è·Ÿ PaddingNode å»ºç«‹åŒ…è£¹å…³ç³»</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœ node ä¸æ˜¯å¸ƒå±€ä¿®é¥°ç¬¦èŠ‚ç‚¹ï¼Œç›´æ¥è°ƒç”¨ updateCoordinator æ–¹æ³•æ¥æ›´æ–°åè°ƒå™¨ï¼Œ</span></span><br><span class="line">            <span class="comment">// å°† node å’Œ NodeCoordinator æŒ‚æ¥å…³è”</span></span><br><span class="line">            <span class="comment">// æ¯”å¦‚ï¼š</span></span><br><span class="line">            <span class="comment">//     Modifier.background().size()</span></span><br><span class="line">            <span class="comment">//     è¿™é‡Œ Modifier.background() è½¬æ¢åçš„ Node å¯¹åº”çš„ NodeCoordinator</span></span><br><span class="line">            <span class="comment">//     ä¸º SizeNode å¯¹åº”çš„ NodeCoordinator</span></span><br><span class="line">            node.updateCoordinator(coordinator)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// åœ¨æ¯æ¬¡è¿­ä»£ç»“æŸæ—¶ï¼Œå°† node å˜é‡æ›´æ–°ä¸ºå½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ node.parentï¼Œä¸ºä¸‹ä¸€æ¬¡å¾ªç¯å‡†å¤‡</span></span><br><span class="line">        <span class="comment">// ä¹Ÿå°±æ˜¯è·å– SizeNode çš„çˆ¶èŠ‚ç‚¹ -- PaddingNodeï¼Œç»§ç»­å¤„ç†</span></span><br><span class="line">        node = node.parent</span><br><span class="line">    &#125;</span><br><span class="line">    coordinator.wrappedBy = layoutNode.parent?.innerCoordinator</span><br><span class="line">    outerCoordinator = coordinator    <span class="comment">// è°ƒæ•´å¤–å±‚ NodeCoordinator</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>çœ‹æ‡‚äº†å—ï¼Ÿæˆ‘åˆç”»äº†ä¸€å¼ å›¾ï¼š</p>
<img src="https://v1.ax1x.com/2025/08/18/EPWvPj.png" alt="" border="0" />

<br>

<br>

<p><strong>ç°åœ¨è®©æˆ‘ä»¬ç®€å•æ€»ç»“ä¸‹ updateFrom() çš„å¤„ç†æ­¥éª¤ï¼š</strong></p>
<ol>
<li>åœ¨ Composable ç¼–å†™çš„ Modifier æ˜¯å±‚å±‚åµŒå¥—çš„ï¼Œé¦–å…ˆéœ€è¦å°† Modifier é›†åˆé“ºå¹³åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ï¼›</li>
<li>å¦‚æœ NodeChain è¿˜æ²¡æœ‰ç»„è£…è¿‡åŒå‘é“¾è¡¨ï¼Œéå†æ­¥éª¤ä¸€é“ºå¹³çš„ Modifier æ•°ç»„ç»„è£…æˆåŒå‘é“¾è¡¨ï¼Œå¦åˆ™å°±å¯¹åŒå‘é“¾è¡¨å¢é‡æ›´æ–°ï¼›</li>
<li>æ›´æ–°åŒå‘é“¾è¡¨å¤´èŠ‚ç‚¹ï¼›</li>
<li>å°† Modifier å’Œæ‰€å±çš„ NodeCoordinator æŒ‚æ¥å…³è”ã€‚</li>
</ol>
<hr>
<p>ç°åœ¨å»é™¤ä»£ç åˆ†æéƒ¨åˆ†ï¼Œå†æ¥çœ‹ä¸€ä¸ªæ•´ä½“æ€ç»´æ¨¡å‹å›¾ï¼š</p>
<img src="https://v1.ax1x.com/2025/08/18/EPWaF5.png" alt="" border="0" />

<hr>
<p>çœ‹åˆ°è¿™é‡Œï¼Œæ‰€æœ‰çš„ Modifier å¤„ç†å®Œäº†ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥å¼€å§‹æµ‹é‡äº†ï¼Œä½ è¿˜è®°å¾—ç¬¬äºŒèŠ‚æˆ‘ä»¬è®²çš„ç»„ä»¶è‡ªèº«æµ‹é‡çš„ä»£ç é€»è¾‘å—ï¼Ÿæˆ‘ä¼°è®¡ä½ çœ‹åˆ°è¿™ï¼Œåº”è¯¥å·²ç»å…¨å¿˜äº†ï¼Œæ‰€ä»¥å†çœ‹ä¸€ä¸‹æµç¨‹å›¾å§ï¼š</p>
<img src="https://v1.ax1x.com/2025/08/18/EPW8I6.png" alt="" border="0" />

<br>

<br>

<p>çœ‹åˆ°æ²¡ï¼Ÿæ˜¯è°æµ‹é‡çš„ï¼Ÿâ€“ <span style="color: #085DFF;">outerCoordinatorï¼</font></p>
<p>outerCoordinator å¯¹è±¡å°±æ˜¯åšå®é™…æµ‹é‡å·¥ä½œçš„ï¼Œæ‰€ä»¥å¼€å§‹æµ‹é‡çš„æ—¶å€™ï¼Œä»å“ªå¼€å§‹æµ‹ï¼Ÿä¸ç”¨æˆ‘è¯´äº†å§ï¼Ÿ</p>
<img src="https://v1.ax1x.com/2025/08/18/EPWOqm.png" alt="" border="0" />

<br>

<p><progress class="progress is-success" value="100" max="100"></progress></p>
<h1 id="LayoutModifierNode-çš„æµ‹é‡"><a href="#LayoutModifierNode-çš„æµ‹é‡" class="headerlink" title="LayoutModifierNode çš„æµ‹é‡"></a>LayoutModifierNode çš„æµ‹é‡</h1><p>æˆ‘ä»¬çœ‹ä¸‹ LayoutModifierNodeCoordinator æ˜¯æ€ä¹ˆåšæµ‹é‡çš„ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LayoutModifierNodeCoordinator.kt</span></span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title class_">LayoutModifierNodeCoordinator</span>(</span><br><span class="line">    layoutNode: LayoutNode,</span><br><span class="line">    measureNode: LayoutModifierNode,</span><br><span class="line">) : NodeCoordinator(layoutNode) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">measure</span><span class="params">(constraints: <span class="type">Constraints</span>)</span></span>: Placeable &#123;</span><br><span class="line">        <span class="meta">@Suppress(<span class="string">&quot;NAME_SHADOWING&quot;</span>)</span></span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">        performingMeasure(constraints) &#123;</span><br><span class="line">            <span class="comment">// è¿‡åº¦å‹ Modifierï¼Œæš‚æ—¶ä¸åœ¨æˆ‘ä»¬æœ¬ç¯‡æ–‡ç« çš„è€ƒè™‘èŒƒå›´ï¼Œå¿½ç•¥</span></span><br><span class="line">            measureResult = approachMeasureScope?.let &#123; scope -&gt;</span><br><span class="line">                ... ...</span><br><span class="line">            &#125; ?: with(layoutModifierNode) &#123;    <span class="comment">// æ™®é€š LayoutModifierNode æµ‹é‡</span></span><br><span class="line">                <span class="comment">// 1. æ ¸å¿ƒä»£ç ï¼Œwith åŒ…å«äº† LayoutModifierNodeï¼Œæä¾›äº†ä¸€ä¸ª LayoutModifierNode çš„ä¸Šä¸‹æ–‡</span></span><br><span class="line">                <span class="comment">// 2. è¿™é‡Œçš„ wrappedNonNull æ˜¯ä»€ä¹ˆï¼Ÿæˆ‘ä»¬åé¢é©¬ä¸Šå°±è¯´åˆ°</span></span><br><span class="line">                measure(wrappedNonNull, constraints)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">this</span><span class="symbol">@LayoutModifierNodeCoordinator</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ›´æ–°æœ¬ Coordinator çš„å†…éƒ¨çŠ¶æ€</span></span><br><span class="line">        onMeasured()</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>measure() çš„å·¥ä½œä¼šè·³è½¬åˆ°å“ªé‡Œï¼Œæ˜¯ç”± with() å†³å®šçš„ï¼Œå®ƒæä¾›äº† LayoutModifierNode ä¸Šä¸‹æ–‡ï¼Œæ‰€ä»¥ measure() è·³è½¬åˆ°äº† LayoutModifierNode é‡Œé¢ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LayoutModifierNode.kt</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">LayoutModifierNode</span> : <span class="type">Remeasurement</span>, <span class="type">DelegatableNode</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> MeasureScope.<span class="title">measure</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        measurable: <span class="type">Measurable</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        constraints: <span class="type">Constraints</span></span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span>: MeasureResult</span><br><span class="line"></span><br><span class="line">    ... ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>LayoutModifierNode åªæ˜¯ä¸€ä¸ªæ¥å£ï¼Œæ‰€ä»¥å…·ä½“çš„æµ‹é‡å®ç°åœ¨å“ªï¼Ÿ</p>
<hr>
<p><strong>è¿™é‡Œæˆ‘ä»¬è¦åˆ†ä¸¤ç§åœºæ™¯æ¥çœ‹ï¼š</strong></p>
<p><font color="#085DFF">1. æˆ‘ä»¬é¦–å…ˆæ¥çœ‹æœ€ç®€å•çš„ä¸€ç§æƒ…å†µï¼šModifier.layout()</font></p>
<p>æ¯”å¦‚æˆ‘ä»¬æ–‡ç« å‰é¢å†™è¿‡çš„ä¸€ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MainActivity</span> : <span class="type">ComponentActivity</span>() &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContent &#123;</span><br><span class="line">            ComposeBlogTheme &#123;</span><br><span class="line">                Box(Modifier.background(Color.Green)) &#123;</span><br><span class="line">                    Text(<span class="string">&quot;Hi Compose&quot;</span>,</span><br><span class="line">                        <span class="comment">// hereï¼Œç†Ÿæ‚‰å—ï¼Ÿ</span></span><br><span class="line">                        Modifier.layout &#123; measurable, constraints -&gt;</span><br><span class="line">                            <span class="keyword">val</span> paddingPx = <span class="number">10.</span>dp.roundToPx()</span><br><span class="line">                            <span class="keyword">val</span> placeable = measurable.measure(constraints.copy(</span><br><span class="line">                                maxWidth = constraints.maxWidth - paddingPx * <span class="number">2</span>,</span><br><span class="line">                                maxHeight = constraints.maxHeight - paddingPx * <span class="number">2</span></span><br><span class="line">                            ))</span><br><span class="line">                            layout(placeable.width + paddingPx * <span class="number">2</span>, placeable.height + paddingPx * <span class="number">2</span>) &#123;</span><br><span class="line">                                placeable.placeRelative(paddingPx, paddingPx)</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç‚¹è¿› <code>Modifier.layout &#123;&#125;</code> çœ‹æºç ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LayoutModifier.kt</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> Modifier.<span class="title">layout</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    measure: <span class="type">MeasureScope</span>.(<span class="type">Measurable</span>, <span class="type">Constraints</span>) -&gt; <span class="type">MeasureResult</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span> = <span class="keyword">this</span> then LayoutElement(measure)</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">data</span> <span class="keyword">class</span> <span class="title class_">LayoutElement</span>(</span><br><span class="line">    <span class="keyword">val</span> measure: MeasureScope.(Measurable, Constraints) -&gt; MeasureResult</span><br><span class="line">) : ModifierNodeElement&lt;LayoutModifierImpl&gt;() &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">create</span><span class="params">()</span></span> = LayoutModifierImpl(measure)</span><br><span class="line">    ... ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å†ç‚¹å‡» LayoutModifierImpl è¿›å»çœ‹çœ‹ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title class_">LayoutModifierImpl</span>(</span><br><span class="line">    <span class="keyword">var</span> measureBlock: MeasureScope.(Measurable, Constraints) -&gt; MeasureResult</span><br><span class="line">) : LayoutModifierNode, Modifier.Node() &#123;</span><br><span class="line">    <span class="comment">// çœ‹ï¼ï¼ï¼æ˜¯ä¸æ˜¯é‡å†™äº† MeasureScope.measure æ–¹æ³• ? æ‰€ä»¥å…·ä½“æµ‹é‡å·¥ä½œå°±åœ¨è¿™é‡Œäº†ã€‚</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> MeasureScope.<span class="title">measure</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        measurable: <span class="type">Measurable</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        constraints: <span class="type">Constraints</span></span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span> = measureBlock(measurable, constraints)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">toString</span><span class="params">()</span></span>: String &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;LayoutModifierImpl(measureBlock=<span class="variable">$measureBlock</span>)&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œ <code>measure</code> ç›´æ¥è°ƒç”¨äº† <code>measureBlock()</code>ï¼Œå®ƒæ˜¯å‚æ•°ä¼ è¿›æ¥çš„ï¼Œå¾€å›é€€ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LayoutModifier.kt</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> Modifier.<span class="title">layout</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    measure: <span class="type">MeasureScope</span>.(<span class="type">Measurable</span>, <span class="type">Constraints</span>) -&gt; <span class="type">MeasureResult</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span> = <span class="keyword">this</span> then LayoutElement(measure)</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">data</span> <span class="keyword">class</span> <span class="title class_">LayoutElement</span>(</span><br><span class="line">    <span class="keyword">val</span> measure: MeasureScope.(Measurable, Constraints) -&gt; MeasureResult</span><br><span class="line">) : ModifierNodeElement&lt;LayoutModifierImpl&gt;() &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">create</span><span class="params">()</span></span> = LayoutModifierImpl(measure)</span><br><span class="line">    ... ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>measureBlock</code> åˆæ˜¯ <code>measure</code>ï¼Œè€Œ <code>measure</code> æ˜¯å•¥ï¼Ÿå°±æ˜¯ä½ ä¸»ä»£ç é‡Œé¢å†™åœ¨ <code>Modifier.layout &#123;&#125;</code> é‡Œé¢çš„æµ‹é‡å’Œå¸ƒå±€é€»è¾‘ï¼Œè¿™å°±ç›¸å½“äºå®ç°äº†å°†å†…éƒ¨çš„æµ‹é‡ç»“æœæš´éœ²ç»™ä¸Šå±‚ï¼Œè®©æˆ‘ä»¬èƒ½ä¿®é¥°åšäºŒæ¬¡æµ‹é‡å¤„ç†ã€‚</p>
<p><font color="#085DFF">2. ç°åœ¨æˆ‘ä»¬å†æ¥çœ‹ç¬¬äºŒç§åœºæ™¯ï¼šModifier.padding(10.dp).size(20.dp)</font></p>
<p>è¿™ä¸ªä¾‹å­ä¸ç”¨å¤šè¯´äº†å§ï¼Œä¹‹å‰åˆ†ææºç å°±æ˜¯åŸºäºå®ƒï¼Œè¿™ä¸ªåœºæ™¯å°±è¦å…³è”åˆ°æˆ‘ä»¬åˆšåˆšæåˆ°çš„ wrappedNonNull äº†ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LayoutModifierNodeCoordinator.kt</span></span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title class_">LayoutModifierNodeCoordinator</span>(</span><br><span class="line">    layoutNode: LayoutNode,</span><br><span class="line">    measureNode: LayoutModifierNode,</span><br><span class="line">) : NodeCoordinator(layoutNode) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. wrapped æ˜¯ LayoutModifierNodeCoordinator çš„å†…éƒ¨ NodeCoordinator</span></span><br><span class="line">    <span class="keyword">val</span> wrappedNonNull: NodeCoordinator <span class="keyword">get</span>() = wrapped!!</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">measure</span><span class="params">(constraints: <span class="type">Constraints</span>)</span></span>: Placeable &#123;</span><br><span class="line">        ...</span><br><span class="line">        performingMeasure(constraints) &#123;</span><br><span class="line">            measureResult = approachMeasureScope?.let &#123; scope -&gt;</span><br><span class="line">                ... ...</span><br><span class="line">            &#125; ?: with(layoutModifierNode) &#123;</span><br><span class="line">                <span class="comment">// 1. è¿™é‡Œçš„ wrappedNonNull æ˜¯ä»€ä¹ˆï¼Ÿ</span></span><br><span class="line">                measure(wrappedNonNull, constraints)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">this</span><span class="symbol">@LayoutModifierNodeCoordinator</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ›´æ–°æœ¬ Coordinator çš„å†…éƒ¨çŠ¶æ€</span></span><br><span class="line">        onMeasured()</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨é‡Šå†™çš„å¾ˆæ¸…æ¥šï¼šwrapped æ˜¯æœ€å¤–å±‚ LayoutModifierNodeCoordinator çš„å†…éƒ¨ NodeCoordinatorï¼Œæ˜¯è°ï¼Ÿ</p>
<img src="https://v1.ax1x.com/2025/08/18/EPWSa4.png" alt="" border="0" />

<p>æ‰€ä»¥ä½ èƒ½çœ‹å‡ºä»€ä¹ˆé—¨é“å—ï¼Ÿæµç¨‹å¾ˆæ¸…æ™°ï¼šæµ‹é‡è¿‡ç¨‹ä¸­ä¼šä»å¤–å¾€é‡Œæ‰§è¡Œæ¯ä¸€ä¸ª NodeCoordinator çš„ measure æ–¹æ³•ï¼Œç›´åˆ°è§¦åº•é‡åˆ°ç»„ä»¶è‡ªèº«çš„ InnerNodeCoordinatorï¼Œå®ƒè´Ÿè´£è‡ªèº«çš„æµ‹é‡ã€‚</p>
<p>æˆ‘ä»¬çœ‹ä¸‹æºç æ›´æ¸…æ™°ï¼Œæ¯”å¦‚å…ˆ Padding()ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">PaddingNode</span>(</span><br><span class="line">    <span class="keyword">var</span> start: Dp = <span class="number">0.</span>dp,</span><br><span class="line">    <span class="keyword">var</span> top: Dp = <span class="number">0.</span>dp,</span><br><span class="line">    <span class="keyword">var</span> end: Dp = <span class="number">0.</span>dp,</span><br><span class="line">    <span class="keyword">var</span> bottom: Dp = <span class="number">0.</span>dp,</span><br><span class="line">    <span class="keyword">var</span> rtlAware: <span class="built_in">Boolean</span></span><br><span class="line">) : LayoutModifierNode, Modifier.Node() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * çœ‹è¿™é‡Œçš„ measurable æ˜¯ä»€ä¹ˆï¼Ÿ</span></span><br><span class="line"><span class="comment">     * ==&gt; å°±æ˜¯å®ƒå†…éƒ¨çš„ SizeNode çš„ NodeCoordinator</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> MeasureScope.<span class="title">measure</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        measurable: <span class="type">Measurable</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        constraints: <span class="type">Constraints</span></span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span>: MeasureResult &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">val</span> horizontal = start.roundToPx() + end.roundToPx()</span><br><span class="line">        <span class="keyword">val</span> vertical = top.roundToPx() + bottom.roundToPx()</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¾€å†…éƒ¨ä¼ ï¼Œè®© SizeNode å»æµ‹</span></span><br><span class="line">        <span class="keyword">val</span> placeable = measurable.measure(constraints.offset(-horizontal, -vertical))</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ‹¿åˆ°é‡Œå±‚ç»“æœå TODO</span></span><br><span class="line">        <span class="keyword">val</span> width = constraints.constrainWidth(placeable.width + horizontal)</span><br><span class="line">        <span class="keyword">val</span> height = constraints.constrainHeight(placeable.height + vertical)</span><br><span class="line">        <span class="keyword">return</span> layout(width, height) &#123;</span><br><span class="line">            <span class="keyword">if</span> (rtlAware) &#123;</span><br><span class="line">                placeable.placeRelative(start.roundToPx(), top.roundToPx())</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                placeable.place(start.roundToPx(), top.roundToPx())</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å†æ¥çœ‹ Size()ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">SizeNode</span>(</span><br><span class="line">    <span class="keyword">var</span> minWidth: Dp = Dp.Unspecified,</span><br><span class="line">    <span class="keyword">var</span> minHeight: Dp = Dp.Unspecified,</span><br><span class="line">    <span class="keyword">var</span> maxWidth: Dp = Dp.Unspecified,</span><br><span class="line">    <span class="keyword">var</span> maxHeight: Dp = Dp.Unspecified,</span><br><span class="line">    <span class="keyword">var</span> enforceIncoming: <span class="built_in">Boolean</span></span><br><span class="line">) : LayoutModifierNode, Modifier.Node() &#123;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * çœ‹è¿™é‡Œçš„ measurable æ˜¯ä»€ä¹ˆï¼Ÿ</span></span><br><span class="line"><span class="comment">     * ==&gt; å°±æ˜¯å®ƒå†…éƒ¨çš„ Box çš„ NodeCoordinatorï¼Œä¹Ÿå°±æ˜¯ InnerNodeCoordinator</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> MeasureScope.<span class="title">measure</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        measurable: <span class="type">Measurable</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        constraints: <span class="type">Constraints</span></span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span>: MeasureResult &#123;</span><br><span class="line">        <span class="keyword">val</span> wrappedConstraints = targetConstraints.let &#123; targetConstraints -&gt;</span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å†å¾€å†…éƒ¨ä¼ ï¼Œè®© Box å»æµ‹è‡ªå·±</span></span><br><span class="line">        <span class="keyword">val</span> placeable = measurable.measure(wrappedConstraints)</span><br><span class="line">        <span class="keyword">return</span> layout(placeable.width, placeable.height) &#123;</span><br><span class="line">            placeable.placeRelative(<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æŠŠè¿™ä¸ªç»“æœå›ä¼ ç»™ä¸Šå±‚ï¼ˆpaddingï¼‰â€ â†’ è¿”å›çš„ MeasureResult</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">val</span> placeable = measurable.measure(wrappedConstraints)</span><br><span class="line">        <span class="keyword">return</span> layout(placeable.width, placeable.height) &#123;</span><br><span class="line">            placeable.placeRelative(<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>å†æ¥çœ‹ </p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title class_">InnerNodeCoordinator</span>(</span><br><span class="line">    layoutNode: LayoutNode</span><br><span class="line">) : NodeCoordinator(layoutNode) &#123;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">measure</span><span class="params">(constraints: <span class="type">Constraints</span>)</span></span>: Placeable &#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">return</span> performingMeasure(constraints) &#123;</span><br><span class="line">            <span class="comment">// before rerunning the user&#x27;s measure block reset previous measuredByParent for children</span></span><br><span class="line">            layoutNode.forEachChild &#123;</span><br><span class="line">                it.measurePassDelegate.measuredByParent = LayoutNode.UsageByParent.NotUsed</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 2. è¿”å›ä¸€ä¸ª MeasureResult å¯¹è±¡ç»™ replace() å»å¸ƒå±€</span></span><br><span class="line">            measureResult = with(layoutNode.measurePolicy) &#123;</span><br><span class="line">                <span class="comment">// 1. æœ€æ ¸å¿ƒå¤„ï¼šè¿™è¾¹å°±æ˜¯æœ€åº•å±‚å¼€å§‹æµ‹é‡çš„å·¥ä½œäº†</span></span><br><span class="line">                measure(layoutNode.childMeasurables, constraints)</span><br><span class="line">            &#125;</span><br><span class="line">            onMeasured()</span><br><span class="line">            <span class="keyword">this</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æµç¨‹å¦‚ä¸‹ï¼š</strong></p>
<ol>
<li>æˆ‘ä»¬è¦ç»™ Box å¢åŠ  10dp çš„ paddingï¼Œä½†æ­¤æ—¶è¿˜ä¸çŸ¥é“ç»„ä»¶æœ¬èº«å¤§å°ï¼Œæ‰€ä»¥å°±éœ€è¦å…ˆæµ‹é‡å†…éƒ¨ï¼Œä¼šå…ˆå»æ‰¾ 10dp å¥—ç€çš„å†…éƒ¨ï¼›</li>
<li>ç°åœ¨å†…éƒ¨è¦è®¾å®š 20dp çš„ sizeï¼Œä½†ä»ç„¶ä¸çŸ¥é“ç»„ä»¶æœ¬èº«å¤§å°ï¼Œéœ€è¦å…ˆæµ‹é‡å†…éƒ¨ï¼Œç»§ç»­å¾€ä¸‹æ‰¾å®ƒçš„å†…éƒ¨ï¼›</li>
<li>æ‰¾åˆ°äº†å…·ä½“ç»„ä»¶ Boxï¼Œå®ƒæ˜¯ InnerNodeCoordinatorï¼ŒInnerNodeCoordinator å·²ç»æ²¡æœ‰å†…éƒ¨äº†ï¼Œæ‰€ä»¥ Box æŒ‰ç…§è‡ªå·±çš„æµ‹é‡æ–¹å¼å»æµ‹é‡æ‹¿åˆ°æµ‹é‡ç»“æœï¼›</li>
<li>InnerNodeCoordinator æµ‹é‡å‡ºç»“æœåï¼Œå¾€ä¸Šä¼ ç»™è¦è®¾å®š size çš„ LayoutModifierNodeï¼Œåœ¨æµ‹é‡ç»“æœä¸Šè®¾å®š 20dp çš„ size åè¿”å›æµ‹é‡ç»“æœï¼›</li>
<li>æ‹¿åˆ°è®¾å®š 20dp size çš„æµ‹é‡ç»“æœåï¼Œå†å¾€ä¸Šä¼ ç»™è¦åŠ  padding çš„ LayoutModifierNodeï¼Œåœ¨æµ‹é‡ç»“æœä¸Šå†æ·»åŠ  10dp çš„ paddingï¼ŒLayoutNode æ‹¿åˆ°æœ€ç»ˆçš„æµ‹é‡ç»“æœã€‚</li>
</ol>
</div><div class="article-licensing box"><div class="licensing-title"><p>æ·±åº¦è§£æ LayoutNode çš„æµ‹é‡ã€å¸ƒå±€åŸç†</p><p><a href="http://example.com/2025/08/10/compose/Compose -- Modifier -- 03. è§£æ Modifier.layout()/">http://example.com/2025/08/10/compose/Compose -- Modifier -- 03. è§£æ Modifier.layout()/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>ä½œè€…</h6><p>Marco</p></div></div><div class="level-item is-narrow"><div><h6>å‘å¸ƒäº</h6><p>2025-08-10</p></div></div><div class="level-item is-narrow"><div><h6>æ›´æ–°äº</h6><p>2025-08-19</p></div></div><div class="level-item is-narrow"><div><h6>è®¸å¯åè®®</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/Compose/">Compose</a><a class="link-muted mr-2" rel="tag" href="/tags/Modifier/">Modifier</a><a class="link-muted mr-2" rel="tag" href="/tags/LayoutModifier/">LayoutModifier</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2025/08/16/compose/Compose%20--%20Modifier%20--%2004.%20%E8%A7%A3%E6%9E%90%20DrawModifier/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">è§£æ DrawModifier</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2025/08/03/compose/Compose%20--%20Modifier%20--%2002.%20%E8%A7%A3%E6%9E%90%20ComposedModifier/"><span class="level-item">è§£æ ComposedModifier</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">æœ€æ–°æ–‡ç« </h3><article class="media"><figure class="media-left"><a class="image" href="/2025/08/16/compose/Compose%20--%20Modifier%20--%2004.%20%E8%A7%A3%E6%9E%90%20DrawModifier/"><img src="/gallery/covers/compose/cover_modifier_4.png" alt="è§£æ DrawModifier"></a></figure><div class="media-content"><p class="date"><time dateTime="2025-08-15T16:00:00.000Z">2025-08-16</time></p><p class="title"><a href="/2025/08/16/compose/Compose%20--%20Modifier%20--%2004.%20%E8%A7%A3%E6%9E%90%20DrawModifier/">è§£æ DrawModifier</a></p><p class="categories"><a href="/categories/Compose/">Compose</a> / <a href="/categories/Compose/Modifier/">Modifier</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2025/08/10/compose/Compose%20--%20Modifier%20--%2003.%20%E8%A7%A3%E6%9E%90%20Modifier.layout()/"><img src="/gallery/covers/compose/cover_modifier_3.png" alt="æ·±åº¦è§£æ LayoutNode çš„æµ‹é‡ã€å¸ƒå±€åŸç†"></a></figure><div class="media-content"><p class="date"><time dateTime="2025-08-09T16:00:00.000Z">2025-08-10</time></p><p class="title"><a href="/2025/08/10/compose/Compose%20--%20Modifier%20--%2003.%20%E8%A7%A3%E6%9E%90%20Modifier.layout()/">æ·±åº¦è§£æ LayoutNode çš„æµ‹é‡ã€å¸ƒå±€åŸç†</a></p><p class="categories"><a href="/categories/Compose/">Compose</a> / <a href="/categories/Compose/Modifier/">Modifier</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2025/08/03/compose/Compose%20--%20Modifier%20--%2002.%20%E8%A7%A3%E6%9E%90%20ComposedModifier/"><img src="/gallery/covers/compose/cover_modifier_2.png" alt="è§£æ ComposedModifier"></a></figure><div class="media-content"><p class="date"><time dateTime="2025-08-02T16:00:00.000Z">2025-08-03</time></p><p class="title"><a href="/2025/08/03/compose/Compose%20--%20Modifier%20--%2002.%20%E8%A7%A3%E6%9E%90%20ComposedModifier/">è§£æ ComposedModifier</a></p><p class="categories"><a href="/categories/Compose/">Compose</a> / <a href="/categories/Compose/Modifier/">Modifier</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2025/08/01/compose/Compose%20--%20Modifier%20--%2001.%20%E8%A7%A3%E6%9E%90%20Modifier%20&amp;%20CombinedModifier/"><img src="/gallery/covers/compose/cover_modifier_1.png" alt="è§£æ Modifier &amp; CombinedModifier"></a></figure><div class="media-content"><p class="date"><time dateTime="2025-07-31T16:00:00.000Z">2025-08-01</time></p><p class="title"><a href="/2025/08/01/compose/Compose%20--%20Modifier%20--%2001.%20%E8%A7%A3%E6%9E%90%20Modifier%20&amp;%20CombinedModifier/">è§£æ Modifier &amp; CombinedModifier</a></p><p class="categories"><a href="/categories/Compose/">Compose</a> / <a href="/categories/Compose/Modifier/">Modifier</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2025/06/22/compose/Compose%20--%20%E7%8A%B6%E6%80%81%E8%AE%A2%E9%98%85%20&amp;%20%E8%87%AA%E5%8A%A8%E5%88%B7%E6%96%B0%20--%2005.%20%E4%BD%A0%E7%9C%9F%E7%9A%84%E4%BA%86%E8%A7%A3%E9%87%8D%E7%BB%84%E5%90%97%EF%BC%9F/"><img src="/gallery/covers/compose/cover_state_3.png" alt="ä½ çœŸçš„äº†è§£ Compose çš„é‡ç»„å—ï¼Ÿ"></a></figure><div class="media-content"><p class="date"><time dateTime="2025-06-21T16:00:00.000Z">2025-06-22</time></p><p class="title"><a href="/2025/06/22/compose/Compose%20--%20%E7%8A%B6%E6%80%81%E8%AE%A2%E9%98%85%20&amp;%20%E8%87%AA%E5%8A%A8%E5%88%B7%E6%96%B0%20--%2005.%20%E4%BD%A0%E7%9C%9F%E7%9A%84%E4%BA%86%E8%A7%A3%E9%87%8D%E7%BB%84%E5%90%97%EF%BC%9F/">ä½ çœŸçš„äº†è§£ Compose çš„é‡ç»„å—ï¼Ÿ</a></p><p class="categories"><a href="/categories/Compose/">Compose</a> / <a href="/categories/Compose/%E7%8A%B6%E6%80%81%E8%AE%A2%E9%98%85-%E8%87%AA%E5%8A%A8%E6%9B%B4%E6%96%B0/">çŠ¶æ€è®¢é˜… &amp; è‡ªåŠ¨æ›´æ–°</a></p></div></article></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">ç›®å½•</h3><ul class="menu-list"><li><a class="level is-mobile" href="#Simple-Code"><span class="level-left"><span class="level-item">1</span><span class="level-item">Simple Code</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#ä¸€ä¸ª-Text"><span class="level-left"><span class="level-item">1.1</span><span class="level-item">ä¸€ä¸ª Text()</span></span></a></li><li><a class="level is-mobile" href="#Modifier-layout"><span class="level-left"><span class="level-item">1.2</span><span class="level-item">Modifier.layout()</span></span></a></li><li><a class="level is-mobile" href="#layout-å‡½æ•°"><span class="level-left"><span class="level-item">1.3</span><span class="level-item">layout() å‡½æ•°</span></span></a></li></ul></li><li><a class="level is-mobile" href="#LayoutNode-æµ…æ"><span class="level-left"><span class="level-item">2</span><span class="level-item">LayoutNode æµ…æ</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#remeasure"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">remeasure()</span></span></a></li><li><a class="level is-mobile" href="#NodeChain"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">NodeChain</span></span></a></li></ul></li><li><a class="level is-mobile" href="#LayoutModifierNode-çš„å·¥ä½œåŸç†"><span class="level-left"><span class="level-item">3</span><span class="level-item">LayoutModifierNode çš„å·¥ä½œåŸç†</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#LayoutNode-Modifer"><span class="level-left"><span class="level-item">3.1</span><span class="level-item">LayoutNode.Modifer</span></span></a></li><li><a class="level is-mobile" href="#updateFrom"><span class="level-left"><span class="level-item">3.2</span><span class="level-item">updateFrom()</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#ğŸ“-åˆ†è§£-Modifier"><span class="level-left"><span class="level-item">3.2.1</span><span class="level-item">ğŸ“ åˆ†è§£ Modifier</span></span></a></li><li><a class="level is-mobile" href="#ğŸ“-æ„å»ºåŒå‘é“¾è¡¨"><span class="level-left"><span class="level-item">3.2.2</span><span class="level-item">ğŸ“ æ„å»ºåŒå‘é“¾è¡¨</span></span></a></li><li><a class="level is-mobile" href="#ğŸ“-æ›´æ–°å¤´èŠ‚ç‚¹"><span class="level-left"><span class="level-item">3.2.3</span><span class="level-item">ğŸ“ æ›´æ–°å¤´èŠ‚ç‚¹</span></span></a></li><li><a class="level is-mobile" href="#ğŸ“-åŒæ­¥åè°ƒå™¨"><span class="level-left"><span class="level-item">3.2.4</span><span class="level-item">ğŸ“ åŒæ­¥åè°ƒå™¨</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#LayoutModifierNode-çš„æµ‹é‡"><span class="level-left"><span class="level-item">4</span><span class="level-item">LayoutModifierNode çš„æµ‹é‡</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/wikihow.svg" alt="wikiHow" height="28"></a><p class="is-size-7"><span>&copy; 2025 Marco</span>Â Â Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>Â &amp;Â <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7">Â© Honey Badger Team</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/pepsimaxin"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-cn");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script data-pjax src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="å›åˆ°é¡¶ç«¯" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script data-pjax src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "æ­¤ç½‘ç«™ä½¿ç”¨Cookieæ¥æ”¹å–„æ‚¨çš„ä½“éªŒã€‚",
          dismiss: "çŸ¥é“äº†ï¼",
          allow: "å…è®¸ä½¿ç”¨Cookie",
          deny: "æ‹’ç»",
          link: "äº†è§£æ›´å¤š",
          policy: "Cookieæ”¿ç­–",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script src="/js/pjax.js"></script><!--!--><!--!--><!--!--><script data-pjax src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="æƒ³è¦æŸ¥æ‰¾ä»€ä¹ˆ..."></div><a class="searchbox-close" href="javascript:;">Ã—</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"æƒ³è¦æŸ¥æ‰¾ä»€ä¹ˆ...","untitled":"(æ— æ ‡é¢˜)","posts":"æ–‡ç« ","pages":"é¡µé¢","categories":"åˆ†ç±»","tags":"æ ‡ç­¾"});
        });</script></body></html>